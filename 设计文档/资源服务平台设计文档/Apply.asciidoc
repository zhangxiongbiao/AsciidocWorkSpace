= 服务方、请求方申请审批
:imagesdir: images
:y: icon:check[role="green"]
:n: icon:times[role="red"]
:c: icon:file-text-o[role="blue"]

== 请求方申请审批

请求方的申请审批即前台用户需要手动注册请求方信息，经其上级（后台）管理员审核通过后，方可完成请求方信息的注册。

=== 流程图

.请求方注册申请流程图
image::consumer_reg.jpg[]


=== 数据库表设计
.请求方注册申请单
image::consumer_reg.png[]

.申请单历史记录
image::apply_history.png[]

=== 详细说明

==== 用户申请
前台用户经过指定的请求方注册申请应用图标进入请求方注册申请页面后，需要手动录入请求方信息。

.请求方信息列说明
|===
|列名称|说明|是否必填|备注
|ID|主键ID|{n}|后台自动生成
|FWQQZBS|服务请求者标识|{n}|待审核通过生成请求方信息后再回写
|FWQQZMC|服务请求者名称|{y}|
|REGION_CODE|请求方所属区域代码|{y}|由用户选择下所辖的部门
|REGION_NAME|请求方所属区域名称|{y}|由用户选择下所辖的部门
|APPLY_USER_CODE|申请人账号|{n}|由系统读取当前登陆用户账号
|APPLY_USER_NAME|申请人姓名|{n}|由系统读取当前登陆用户姓名
|APPLY_TIME|申请时间|{n}|由系统自动生成
|AUDIT_USER_CODE|审核人账号|{n}|由系统获取最后一次审核的人员账号
|AUDIT_USER_NAME|审核人姓名|{n}|由系统获取最后一次审核的人员姓名
|AUDIT_STATUS|审核状态|{n}|由系统获取申请单的最后一次审核状态
|AUDIT_SUGGESTION|审核意见|{n}|由系统获取申请单的最后一次审核意见
|AUDIT_TIME|审核时间|{n}|由系统读取最后一次审核时间
|LXR_XM|联系人姓名|{n}|页面需要提供，如果用户没有填写，则读取其账号姓名
|LXDH|联系人电话|{n}|页面需要提供，如果用户没有填写，则读取其账户的电话
|TXDZ|通讯地址|{n}|页面需要提供
|LXR_GMSFHM|联系人公民身份证号码|{n}|页面需要提供，如果页面没有填写，则读取其账户的身份证号
|FWQQZ_IPDZ|服务请求者IP地址|{y}|
|FWQQZ_DKHM|服务请求方机器IP端口号|{y}|
|===

[TIP]
====
用户填写申请单后，需要在 *用户与申请单关联表* 表中添加一行关联信息。
====


==== 管理员审核
管理员可进行的操作：

. 审核通过
. 驳回，驳回时必须写意见

当管理员进行审核时，需要管理员继续填写请求方的一些信息，方可进行审核通过。

.列信息
|===
|代码|名称|是否必填|说明
|ZWJBDM|请求方职务级别|{n}|请求方的职务级别
|GWQJDM|岗位权级|{n}|岗位权级
|XZQHDM|行政区划|{n}|行政区划代码
|MMDJDM|秘密等级|{y}|请求方的秘密等级代码
|JZDM|警种代码|{n}|请求方的警种代码
|===

审核通过后，将上述提交的信息及请求方注册的信息写入到 S_SERVICE_CONSUMER 表，并同时写入 S_CONSUMER_APPLY_MAPPING 关联记录。


[NOTE]
====
每一次的审核信息，都需要写入到 `S_APPLY_HISOTRY` 表中。当多次重复提交审核时，或多个不同人审核时，可以查看历史审核记录。
====


==== 页面说明
. 进入页面
进入页面时，应显示用户已经提交的申请单信息，可供用户查看申请单状态等。


== 服务方申请审批

服务方的申请审批即前台用户需要手动注册请求方信息，经其上级（后台）管理员审核通过后，方可完成服务方信息的注册。

=== 流程图

.服务方注册申请流程图
image::provider_reg.jpg[]

=== 详细说明
基本同上面的请求方注册申请类似


== 数据库表设计
link:images/apply_database.html[详细表设计]

== 服务方发布服务申请
当前台用户经过申请成为服务提供方后，便可进行服务的发布。服务的发布前同样需要经过管理员审批后方可发布出来。

=== 流程图
image::service_apply.jpg[]

== 请求方服务访问授权申请
当请求方注册成功后，如果需要访问其它提供方的服务，此时需要申请授权访问。

=== 流程图
image::consumer_apply_service.jpg[]

=== 详细说明

==== 查看可用服务列表
用户通过请求方的操作区按钮，即可进行已被允许访问的服务列表界面。
