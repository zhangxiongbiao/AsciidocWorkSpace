<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.4">
<title>Java API</title>
<style>
/*! normalize.css v2.1.2 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }

/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video { display: inline-block; }

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) { display: none; height: 0; }

/** Address `[hidden]` styling not present in IE 8/9. Hide the `template` element in IE, Safari, and Firefox < 22. */
[hidden], template { display: none; }

script { display: none !important; }

/* ========================================================================== Base ========================================================================== */
/** 1. Set default font family to sans-serif. 2. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html { font-family: sans-serif; /* 1 */ -ms-text-size-adjust: 100%; /* 2 */ -webkit-text-size-adjust: 100%; /* 2 */ }

/** Remove default margin. */
body { margin: 0; }

/* ========================================================================== Links ========================================================================== */
/** Remove the gray background color from active links in IE 10. */
a { background: transparent; }

/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus { outline: thin dotted; }

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover { outline: 0; }

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 { font-size: 2em; margin: 0.67em 0; }

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] { border-bottom: 1px dotted; }

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong { font-weight: bold; }

/** Address styling not present in Safari 5 and Chrome. */
dfn { font-style: italic; }

/** Address differences between Firefox and other browsers. */
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }

/** Address styling not present in IE 8/9. */
mark { background: #ff0; color: #000; }

/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }

/** Improve readability of pre-formatted text in all browsers. */
pre { white-space: pre-wrap; }

/** Set consistent quote types. */
q { quotes: "\201C" "\201D" "\2018" "\2019"; }

/** Address inconsistent and variable font size in all browsers. */
small { font-size: 80%; }

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }

sup { top: -0.5em; }

sub { bottom: -0.25em; }

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img { border: 0; }

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) { overflow: hidden; }

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure { margin: 0; }

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend { border: 0; /* 1 */ padding: 0; /* 2 */ }

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea { font-family: inherit; /* 1 */ font-size: 100%; /* 2 */ margin: 0; /* 3 */ }

/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input { line-height: normal; }

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select { text-transform: none; }

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; /* 2 */ cursor: pointer; /* 3 */ }

/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] { cursor: default; }

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ }

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] { -webkit-appearance: textfield; /* 1 */ -moz-box-sizing: content-box; -webkit-box-sizing: content-box; /* 2 */ box-sizing: content-box; }

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea { overflow: auto; /* 1 */ vertical-align: top; /* 2 */ }

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table { border-collapse: collapse; border-spacing: 0; }

meta.foundation-mq-small { font-family: "only screen and (min-width: 768px)"; width: 768px; }

meta.foundation-mq-medium { font-family: "only screen and (min-width:1280px)"; width: 1280px; }

meta.foundation-mq-large { font-family: "only screen and (min-width:1440px)"; width: 1440px; }

*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }

html, body { font-size: 100%; }

body { background: #fff; color: #222; padding: 0; margin: 0; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }

a:hover { cursor: pointer; }

img, object, embed { max-width: 100%; height: auto; }

object, embed { height: 100%; }

img { -ms-interpolation-mode: bicubic; }

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }

.left { float: left !important; }

.right { float: right !important; }

.text-left { text-align: left !important; }

.text-right { text-align: right !important; }

.text-center { text-align: center !important; }

.text-justify { text-align: justify !important; }

.hide { display: none; }

.antialiased, body { -webkit-font-smoothing: antialiased; }

img { display: inline-block; vertical-align: middle; }

textarea { height: auto; min-height: 50px; }

select { width: 100%; }

object, svg { display: inline-block; vertical-align: middle; }

.center { margin-left: auto; margin-right: auto; }

.spread { width: 100%; }

p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }

.subheader, .admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { line-height: 1.4; color: #003b6b; font-weight: 300; margin-top: 0.2em; margin-bottom: 0.5em; }

/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }

/* Default Link Styles */
a { color: #00579e; text-decoration: none; line-height: inherit; }
a:hover, a:focus { color: #333; }
a img { border: none; }

/* Default paragraph styles */
p { font-family: Arial, sans-serif; font-weight: normal; font-size: 1em; line-height: 1.6; margin-bottom: 0.75em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }

/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: Arial, sans-serif; font-weight: normal; font-style: normal; color: #7B2D00; text-rendering: optimizeLegibility; margin-top: 0.5em; margin-bottom: 0.5em; line-height: 1.2125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #ff6b15; line-height: 0; }

h1 { font-size: 2.125em; }

h2 { font-size: 1.6875em; }

h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }

h4 { font-size: 1.125em; }

h5 { font-size: 1.125em; }

h6 { font-size: 1em; }

hr { border: solid #ddd; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }

/* Helpful Typography Defaults */
em, i { font-style: italic; line-height: inherit; }

strong, b { font-weight: bold; line-height: inherit; }

small { font-size: 60%; line-height: inherit; }

code { font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: bold; color: #003426; }

/* Lists */
ul, ol, dl { font-size: 1em; line-height: 1.6; margin-bottom: 0.75em; list-style-position: outside; font-family: Arial, sans-serif; }

ul, ol { margin-left: 1.5em; }
ul.no-bullet, ol.no-bullet { margin-left: 1.5em; }

/* Unordered Lists */
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; /* Override nested font-size change */ }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }

/* Ordered Lists */
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }

/* Definition Lists */
dl dt { margin-bottom: 0.3em; font-weight: bold; }
dl dd { margin-bottom: 0.75em; }

/* Abbreviations */
abbr, acronym { text-transform: uppercase; font-size: 90%; color: black; border-bottom: 1px dotted #ddd; cursor: help; }

abbr { text-transform: none; }

/* Blockquotes */
blockquote { margin: 0 0 0.75em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #ddd; }
blockquote cite { display: block; font-size: 0.8125em; color: #e15200; }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: #e15200; }

blockquote, blockquote p { line-height: 1.6; color: #333; }

/* Microformats */
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #ddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }

.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }

@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }
/* Tables */
table { background: #fff; margin-bottom: 1.25em; border: solid 1px #d8d8ce; }
table thead, table tfoot { background: -webkit-linear-gradient(top, #add386, #90b66a); font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: #fff; text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: #6d6e71; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #edf2f2; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.4; }

body { tab-size: 4; }

h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }

a:hover, a:focus { text-decoration: underline; }

.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }

*:not(pre) > code { font-size: inherit; font-style: normal !important; letter-spacing: 0; padding: 3px 2px 1px 2px; background-color: #eee; border: 1px solid #ddd; -webkit-border-radius: 0; border-radius: 0; line-height: inherit; }

pre, pre > code { line-height: 1.6; color: black; font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: normal; }

.keyseq { color: #333333; }

kbd { font-family: Consolas, "Liberation Mono", Courier, monospace; display: inline-block; color: black; font-size: 0.65em; line-height: 1.45; background-color: #f7f7f7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -moz-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; margin: 0 0.15em; padding: 0.2em 0.5em; vertical-align: middle; position: relative; top: -0.1em; white-space: nowrap; }

.keyseq kbd:first-child { margin-left: 0; }

.keyseq kbd:last-child { margin-right: 0; }

.menuseq, .menu { color: black; }

b.button:before, b.button:after { position: relative; top: -1px; font-weight: normal; }

b.button:before { content: "["; padding: 0 3px 0 2px; }

b.button:after { content: "]"; padding: 0 2px 0 3px; }

#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 1.5em; padding-right: 1.5em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }

#content { margin-top: 1.25em; }

#content:before { content: none; }

#header > h1:first-child { color: #7B2D00; margin-top: 2.25rem; margin-bottom: 0; }
#header > h1:first-child + #toc { margin-top: 8px; border-top: 1px solid #ddd; }
#header > h1:only-child, body.toc2 #header > h1:nth-last-child(2) { border-bottom: 1px solid #ddd; padding-bottom: 8px; }
#header .details { border-bottom: 1px solid #ddd; line-height: 1.45; padding-top: 0.25em; padding-bottom: 0.25em; padding-left: 0.25em; color: #e15200; display: -ms-flexbox; display: -webkit-flex; display: flex; -ms-flex-flow: row wrap; -webkit-flex-flow: row wrap; flex-flow: row wrap; }
#header .details span:first-child { margin-left: -0.125em; }
#header .details span.email a { color: #333; }
#header .details br { display: none; }
#header .details br + span:before { content: "\00a0\2013\00a0"; }
#header .details br + span.author:before { content: "\00a0\22c5\00a0"; color: #333; }
#header .details br + span#revremark:before { content: "\00a0|\00a0"; }
#header #revnumber { text-transform: capitalize; }
#header #revnumber:after { content: "\00a0"; }

#content > h1:first-child:not([class]) { color: #7B2D00; border-bottom: 1px solid #ddd; padding-bottom: 8px; margin-top: 0; padding-top: 1rem; margin-bottom: 1.25rem; }

#toc { border-bottom: 0 solid #ddd; padding-bottom: 0.5em; }
#toc > ul { margin-left: 0.125em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin: 0.5em 0; }
#toc ul { font-family: Arial, sans-serif; list-style-type: none; }
#toc li { line-height: 1.3334; margin-top: 0.3334em; }
#toc a { text-decoration: none; }
#toc a:active { text-decoration: underline; }

#toctitle { color: #003b6b; font-size: 1.2em; }

@media only screen and (min-width: 768px) { #toctitle { font-size: 1.375em; }
  body.toc2 { padding-left: 15em; padding-right: 0; }
  #toc.toc2 { margin-top: 0 !important; background-color: #fff; position: fixed; width: 15em; left: 0; top: 0; border-right: 1px solid #ddd; border-top-width: 0 !important; border-bottom-width: 0 !important; z-index: 1000; padding: 1.25em 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; margin-bottom: 0.8rem; font-size: 1.2em; }
  #toc.toc2 > ul { font-size: 0.9em; margin-bottom: 0; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 15em; }
  body.toc2.toc-right #toc.toc2 { border-right-width: 0; border-left: 1px solid #ddd; left: auto; right: 0; } }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; padding-right: 0; }
  #toc.toc2 { width: 20em; }
  #toc.toc2 #toctitle { font-size: 1.375em; }
  #toc.toc2 > ul { font-size: 0.95em; }
  #toc.toc2 ul ul { padding-left: 1.25em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: #fff; -webkit-border-radius: 0; border-radius: 0; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }

#footer { max-width: 100%; background-color: none; padding: 1.25em; }

#footer-text { color: black; line-height: 1.44; }

.sect1 { padding-bottom: 0.625em; }

@media only screen and (min-width: 768px) { .sect1 { padding-bottom: 1.25em; } }
.sect1 + .sect1 { border-top: 0 solid #ddd; }

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; z-index: 1001; width: 1.5ex; margin-left: -1.5ex; display: block; text-decoration: none !important; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: "\00A7"; font-size: 0.85em; display: block; padding-top: 0.1em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #7B2D00; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #622400; }

.audioblock, .imageblock, .literalblock, .listingblock, .stemblock, .videoblock { margin-bottom: 1.25em; }

.admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-rendering: optimizeLegibility; text-align: left; }

table.tableblock > caption.title { white-space: nowrap; overflow: visible; max-width: 0; }

.paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { color: #7B2D00; }

table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }

.admonitionblock > table { border-collapse: separate; border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; font-family: Arial, sans-serif; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #ddd; color: #e15200; }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }

.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: #fff; -webkit-border-radius: 0; border-radius: 0; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }

.sidebarblock { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: #fff; -webkit-border-radius: 0; border-radius: 0; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock > .content > .title { color: #003b6b; margin-top: 0; }

.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }

.literalblock pre, .listingblock pre:not(.highlight), .listingblock pre[class="highlight"], .listingblock pre[class^="highlight "], .listingblock pre.CodeRay, .listingblock pre.prettyprint { background: #eee; }
.sidebarblock .literalblock pre, .sidebarblock .listingblock pre:not(.highlight), .sidebarblock .listingblock pre[class="highlight"], .sidebarblock .listingblock pre[class^="highlight "], .sidebarblock .listingblock pre.CodeRay, .sidebarblock .listingblock pre.prettyprint { background: #f2f1f1; }

.literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { border: 1px dashed #666; -webkit-border-radius: 0; border-radius: 0; word-wrap: break-word; padding: 1.25em 1.5625em 1.125em 1.5625em; font-size: 0.8125em; }
.literalblock pre.nowrap, .literalblock pre[class].nowrap, .listingblock pre.nowrap, .listingblock pre[class].nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
@media only screen and (min-width: 768px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.90625em; } }
@media only screen and (min-width: 1280px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 1em; } }

.literalblock.output pre { color: #eee; background-color: black; }

.listingblock pre.highlightjs { padding: 0; }
.listingblock pre.highlightjs > code { padding: 1.25em 1.5625em 1.125em 1.5625em; -webkit-border-radius: 0; border-radius: 0; }

.listingblock > .content { position: relative; }

.listingblock code[data-lang]:before { display: none; content: attr(data-lang); position: absolute; font-size: 0.75em; top: 0.425rem; right: 0.5rem; line-height: 1; text-transform: uppercase; color: #999; }

.listingblock:hover code[data-lang]:before { display: block; }

.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }

.listingblock.terminal pre .command:not([data-prompt]):before { content: "$"; }

table.pyhltable { border-collapse: separate; border: 0; margin-bottom: 0; background: none; }

table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; line-height: 1.6; }

table.pyhltable td.code { padding-left: .75em; padding-right: 0; }

pre.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #ddd; }

pre.pygments .lineno { display: inline-block; margin-right: .25em; }

table.pyhltable .linenodiv { background: none !important; padding-right: 0 !important; }

.quoteblock { margin: 0 1em 0.75em 1.5em; display: table; }
.quoteblock > .title { margin-left: -1.5em; margin-bottom: 0.75em; }
.quoteblock blockquote, .quoteblock blockquote p { color: #333; font-size: 1.15rem; line-height: 1.75; word-spacing: 0.1em; letter-spacing: 0; font-style: italic; text-align: justify; }
.quoteblock blockquote { margin: 0; padding: 0; border: 0; }
.quoteblock blockquote:before { content: "\201c"; float: left; font-size: 2.75em; font-weight: bold; line-height: 0.6em; margin-left: -0.6em; color: #003b6b; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: 0.5em; margin-right: 0.5ex; text-align: right; }
.quoteblock .quoteblock { margin-left: 0; margin-right: 0; padding: 0.5em 0; border-left: 3px solid #e15200; }
.quoteblock .quoteblock blockquote { padding: 0 0 0 0.75em; }
.quoteblock .quoteblock blockquote:before { display: none; }

.verseblock { margin: 0 1em 0.75em 1em; }
.verseblock pre { font-family: "Open Sans", "DejaVu Sans", sans; font-size: 1.15rem; color: #333; font-weight: 300; text-rendering: optimizeLegibility; }
.verseblock pre strong { font-weight: 400; }
.verseblock .attribution { margin-top: 1.25rem; margin-left: 0.5ex; }

.quoteblock .attribution, .verseblock .attribution { font-size: 0.8125em; line-height: 1.45; font-style: italic; }
.quoteblock .attribution br, .verseblock .attribution br { display: none; }
.quoteblock .attribution cite, .verseblock .attribution cite { display: block; letter-spacing: -0.025em; color: #e15200; }

.quoteblock.abstract { margin: 0 0 0.75em 0; display: block; }
.quoteblock.abstract blockquote, .quoteblock.abstract blockquote p { text-align: left; word-spacing: 0; }
.quoteblock.abstract blockquote:before, .quoteblock.abstract blockquote p:first-of-type:before { display: none; }

table.tableblock { max-width: 100%; border-collapse: separate; }
table.tableblock td > .paragraph:last-child p > p:last-child, table.tableblock th > p:last-child, table.tableblock td > p:last-child { margin-bottom: 0; }

table.tableblock, th.tableblock, td.tableblock { border: 0 solid #d8d8ce; }

table.grid-all th.tableblock, table.grid-all td.tableblock { border-width: 0 1px 1px 0; }

table.grid-all tfoot > tr > th.tableblock, table.grid-all tfoot > tr > td.tableblock { border-width: 1px 1px 0 0; }

table.grid-cols th.tableblock, table.grid-cols td.tableblock { border-width: 0 1px 0 0; }

table.grid-all * > tr > .tableblock:last-child, table.grid-cols * > tr > .tableblock:last-child { border-right-width: 0; }

table.grid-rows th.tableblock, table.grid-rows td.tableblock { border-width: 0 0 1px 0; }

table.grid-all tbody > tr:last-child > th.tableblock, table.grid-all tbody > tr:last-child > td.tableblock, table.grid-all thead:last-child > tr > th.tableblock, table.grid-rows tbody > tr:last-child > th.tableblock, table.grid-rows tbody > tr:last-child > td.tableblock, table.grid-rows thead:last-child > tr > th.tableblock { border-bottom-width: 0; }

table.grid-rows tfoot > tr > th.tableblock, table.grid-rows tfoot > tr > td.tableblock { border-width: 1px 0 0 0; }

table.frame-all { border-width: 1px; }

table.frame-sides { border-width: 0 1px; }

table.frame-topbot { border-width: 1px 0; }

th.halign-left, td.halign-left { text-align: left; }

th.halign-right, td.halign-right { text-align: right; }

th.halign-center, td.halign-center { text-align: center; }

th.valign-top, td.valign-top { vertical-align: top; }

th.valign-bottom, td.valign-bottom { vertical-align: bottom; }

th.valign-middle, td.valign-middle { vertical-align: middle; }

table thead th, table tfoot th { font-weight: bold; }

tbody tr th { display: table-cell; line-height: 1.4; background: -webkit-linear-gradient(top, #add386, #90b66a); }

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p { color: #fff; font-weight: bold; }

p.tableblock > code:only-child { background: none; padding: 0; }

p.tableblock { font-size: 1em; }

td > div.verse { white-space: pre; }

ol { margin-left: 1.75em; }

ul li ol { margin-left: 1.5em; }

dl dd { margin-left: 1.125em; }

dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.375em; }

ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }

ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 0.625em; }

ul.checklist li > p:first-child > .fa-square-o:first-child, ul.checklist li > p:first-child > .fa-check-square-o:first-child { width: 1em; font-size: 0.85em; }

ul.checklist li > p:first-child > input[type="checkbox"]:first-child { width: 1em; position: relative; top: 1px; }

ul.inline { margin: 0 auto 0.375em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }

.unstyled dl dt { font-weight: normal; font-style: normal; }

ol.arabic { list-style-type: decimal; }

ol.decimal { list-style-type: decimal-leading-zero; }

ol.loweralpha { list-style-type: lower-alpha; }

ol.upperalpha { list-style-type: upper-alpha; }

ol.lowerroman { list-style-type: lower-roman; }

ol.upperroman { list-style-type: upper-roman; }

ol.lowergreek { list-style-type: lower-greek; }

.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }

td.hdlist1, td.hdlist2 { vertical-align: top; padding: 0 0.625em; }

td.hdlist1 { font-weight: bold; padding-bottom: 0.75em; }

.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }

.colist > table tr > td:first-of-type { padding: 0 0.75em; line-height: 1; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }

.thumb, .th { line-height: 0; display: inline-block; border: solid 4px #fff; -webkit-box-shadow: 0 0 0 1px #ddd; box-shadow: 0 0 0 1px #ddd; }

.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }

.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }

a.image { text-decoration: none; display: inline-block; }
a.image object { pointer-events: none; }

sup.footnote, sup.footnoteref { font-size: 0.875em; position: static; vertical-align: super; }
sup.footnote a, sup.footnoteref a { text-decoration: none; }
sup.footnote a:active, sup.footnoteref a:active { text-decoration: underline; }

#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -0.25em 0 0.75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em 0 0.225em; line-height: 1.3334; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.05em; margin-bottom: 0.2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }
#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }

.gist .file-data > table { border: 0; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }

div.unbreakable { page-break-inside: avoid; }

.big { font-size: larger; }

.small { font-size: smaller; }

.underline { text-decoration: underline; }

.overline { text-decoration: overline; }

.line-through { text-decoration: line-through; }

.aqua { color: #00bfbf; }

.aqua-background { background-color: #00fafa; }

.black { color: black; }

.black-background { background-color: black; }

.blue { color: #0000bf; }

.blue-background { background-color: #0000fa; }

.fuchsia { color: #bf00bf; }

.fuchsia-background { background-color: #fa00fa; }

.gray { color: #606060; }

.gray-background { background-color: #7d7d7d; }

.green { color: #006000; }

.green-background { background-color: #007d00; }

.lime { color: #00bf00; }

.lime-background { background-color: #00fa00; }

.maroon { color: #600000; }

.maroon-background { background-color: #7d0000; }

.navy { color: #000060; }

.navy-background { background-color: #00007d; }

.olive { color: #606000; }

.olive-background { background-color: #7d7d00; }

.purple { color: #600060; }

.purple-background { background-color: #7d007d; }

.red { color: #bf0000; }

.red-background { background-color: #fa0000; }

.silver { color: #909090; }

.silver-background { background-color: #bcbcbc; }

.teal { color: #006060; }

.teal-background { background-color: #007d7d; }

.white { color: #bfbfbf; }

.white-background { background-color: #fafafa; }

.yellow { color: #bfbf00; }

.yellow-background { background-color: #fafa00; }

span.icon > .fa { cursor: default; }

.admonitionblock td.icon [class^="fa icon-"] { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #004177; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }

.conum[data-value] { display: inline-block; color: #fff !important; background-color: black; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; font-size: 0.75em; width: 1.67em; height: 1.67em; line-height: 1.67em; font-family: "Open Sans", "DejaVu Sans", sans-serif; font-style: normal; font-weight: bold; }
.conum[data-value] * { color: #fff !important; }
.conum[data-value] + b { display: none; }
.conum[data-value]:after { content: attr(data-value); }
pre .conum[data-value] { position: relative; top: -0.125em; }

b.conum * { color: inherit !important; }

.conum:not([data-value]):empty { display: none; }

h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { border-bottom: 1px solid #ddd; }

.sect1 { padding-bottom: 0; }

#toctitle { color: #00406F; font-weight: normal; margin-top: 1.5em; }

.sidebarblock { border-color: #aaa; }

code { -webkit-border-radius: 4px; border-radius: 4px; }

p.tableblock.header { color: #6d6e71; }

.literalblock pre, .listingblock pre { background: #eee; }

</style>
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body id="java-api" class="book toc2 toc-left">
<div id="header">
<h1>Java API</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_preface">1. Preface</a></li>
<li><a href="#_maven_repository">2. Maven Repository</a></li>
<li><a href="#_dealing_with_jar_dependency_conflicts">3. Dealing with JAR dependency conflicts</a></li>
<li><a href="#_embedding_jar_with_dependencies">4. Embedding jar with dependencies</a></li>
<li><a href="#_deploying_in_jboss_eap6_module">5. Deploying in JBoss EAP6 module</a></li>
<li><a href="#client">6. Client</a>
<ul class="sectlevel2">
<li><a href="#transport-client">6.1. Transport Client</a></li>
<li><a href="#client-connected-to-client-node">6.2. Connecting a Client to a Client Node</a></li>
</ul>
</li>
<li><a href="#java-docs">7. Document APIs</a>
<ul class="sectlevel2">
<li><a href="#java-docs-index">7.1. Index API</a>
<ul class="sectlevel3">
<li><a href="#java-docs-index-generate">7.1.1. Generate JSON document</a></li>
<li><a href="#java-docs-index-doc">7.1.2. Index document</a></li>
<li><a href="#java-docs-index-thread">7.1.3. Operation Threading</a></li>
</ul>
</li>
<li><a href="#java-docs-get">7.2. Get API</a>
<ul class="sectlevel3">
<li><a href="#java-docs-get-thread">7.2.1. Operation Threading</a></li>
</ul>
</li>
<li><a href="#java-docs-delete">7.3. Delete API</a>
<ul class="sectlevel3">
<li><a href="#java-docs-delete-thread">7.3.1. Operation Threading</a></li>
</ul>
</li>
<li><a href="#java-docs-update">7.4. Update API</a>
<ul class="sectlevel3">
<li><a href="#java-docs-update-api-script">7.4.1. Update by script</a></li>
<li><a href="#java-docs-update-api-merge-docs">7.4.2. Update by merging documents</a></li>
<li><a href="#java-docs-update-api-upsert">7.4.3. Upsert</a></li>
</ul>
</li>
<li><a href="#java-docs-multi-get">7.5. Multi Get API</a></li>
<li><a href="#java-docs-bulk">7.6. Bulk API</a></li>
<li><a href="#java-docs-bulk-processor">7.7. Using Bulk Processor</a></li>
</ul>
</li>
<li><a href="#java-search">8. Search API</a>
<ul class="sectlevel2">
<li><a href="#java-search-scrolling">8.1. Using scrolls in Java</a></li>
<li><a href="#java-search-msearch">8.2. MultiSearch API</a></li>
<li><a href="#java-search-aggs">8.3. Using Aggregations</a></li>
<li><a href="#java-search-terminate-after">8.4. Terminate After</a></li>
</ul>
</li>
<li><a href="#count">9. Count API</a>
<ul class="sectlevel2">
<li><a href="#_operation_threading">9.1. Operation Threading</a></li>
</ul>
</li>
<li><a href="#java-aggs">10. Aggregations</a>
<ul class="sectlevel2">
<li><a href="#_structuring_aggregations">10.1. Structuring aggregations</a></li>
<li><a href="#_metrics_aggregations">10.2. Metrics aggregations</a>
<ul class="sectlevel3">
<li><a href="#java-aggs-metrics-min">10.2.1. Min Aggregation</a></li>
<li><a href="#java-aggs-metrics-max">10.2.2. Max Aggregation</a></li>
<li><a href="#java-aggs-metrics-sum">10.2.3. Sum Aggregation</a></li>
<li><a href="#java-aggs-metrics-avg">10.2.4. Avg Aggregation</a></li>
<li><a href="#java-aggs-metrics-stats">10.2.5. Stats Aggregation</a></li>
<li><a href="#java-aggs-metrics-extendedstats">10.2.6. Extended Stats Aggregation</a></li>
<li><a href="#java-aggs-metrics-valuecount">10.2.7. Value Count Aggregation</a></li>
<li><a href="#java-aggs-metrics-percentile">10.2.8. Percentile Aggregation</a></li>
<li><a href="#java-aggs-metrics-percentile-rank">10.2.9. Percentile Ranks Aggregation</a></li>
<li><a href="#java-aggs-metrics-cardinality">10.2.10. Cardinality Aggregation</a></li>
<li><a href="#java-aggs-metrics-geobounds">10.2.11. Cardinality Aggregation</a></li>
<li><a href="#java-aggs-metrics-tophits">10.2.12. Top Hits Aggregation</a></li>
<li><a href="#java-aggs-metrics-scripted-metric">10.2.13. Scripted Metric Aggregation</a></li>
</ul>
</li>
<li><a href="#_bucket_aggregations">10.3. Bucket aggregations</a>
<ul class="sectlevel3">
<li><a href="#java-aggs-bucket-global">10.3.1. Global Aggregation</a></li>
<li><a href="#java-aggs-bucket-filter">10.3.2. Filter Aggregation</a></li>
<li><a href="#java-aggs-bucket-filters">10.3.3. Filters Aggregation</a></li>
<li><a href="#java-aggs-bucket-missing">10.3.4. Missing Aggregation</a></li>
<li><a href="#java-aggs-bucket-nested">10.3.5. Nested Aggregation</a></li>
<li><a href="#java-aggs-bucket-reverse-nested">10.3.6. Reverse Nested Aggregation</a></li>
<li><a href="#java-aggs-bucket-children">10.3.7. Children Aggregation</a></li>
<li><a href="#java-aggs-bucket-terms">10.3.8. Terms Aggregation</a></li>
<li><a href="#_order">10.3.9. Order</a></li>
<li><a href="#java-aggs-bucket-significantterms">10.3.10. Significant Terms Aggregation</a></li>
<li><a href="#java-aggs-bucket-range">10.3.11. Range Aggregation</a></li>
<li><a href="#java-aggs-bucket-daterange">10.3.12. Date Range Aggregation</a></li>
<li><a href="#java-aggs-bucket-iprange">10.3.13. Ip Range Aggregation</a></li>
<li><a href="#java-aggs-bucket-histogram">10.3.14. Histogram Aggregation</a></li>
<li><a href="#java-aggs-bucket-datehistogram">10.3.15. Date Histogram Aggregation</a></li>
<li><a href="#java-aggs-bucket-geodistance">10.3.16. Geo Distance Aggregation</a></li>
<li><a href="#java-aggs-bucket-geohashgrid">10.3.17. Geo Hash Grid Aggregation</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#percolate">11. Percolate API</a></li>
<li><a href="#java-query-dsl">12. Query DSL</a>
<ul class="sectlevel2">
<li><a href="#java-query-dsl-match-all-query">12.1. Match All Query</a></li>
<li><a href="#java-full-text-queries">12.2. Full text queries</a>
<ul class="sectlevel3">
<li><a href="#java-query-dsl-match-query">12.2.1. Match Query</a></li>
<li><a href="#java-query-dsl-multi-match-query">12.2.2. Multi Match Query</a></li>
<li><a href="#java-query-dsl-common-terms-query">12.2.3. Common Terms Query</a></li>
<li><a href="#java-query-dsl-query-string-query">12.2.4. Query String Query</a></li>
<li><a href="#java-query-dsl-simple-query-string-query">12.2.5. Simple Query String Query</a></li>
</ul>
</li>
<li><a href="#java-term-level-queries">12.3. Term level queries</a>
<ul class="sectlevel3">
<li><a href="#java-query-dsl-term-query">12.3.1. Term Query</a></li>
<li><a href="#java-query-dsl-terms-query">12.3.2. Terms Query</a></li>
<li><a href="#java-query-dsl-range-query">12.3.3. Range Query</a></li>
<li><a href="#java-query-dsl-exists-query">12.3.4. Exists Query</a></li>
<li><a href="#java-query-dsl-missing-query">12.3.5. Missing Query</a></li>
<li><a href="#java-query-dsl-prefix-query">12.3.6. Prefix Query</a></li>
<li><a href="#java-query-dsl-wildcard-query">12.3.7. Wildcard Query</a></li>
<li><a href="#java-query-dsl-regexp-query">12.3.8. Regexp Query</a></li>
<li><a href="#java-query-dsl-fuzzy-query">12.3.9. Fuzzy Query</a></li>
<li><a href="#java-query-dsl-type-query">12.3.10. Type Query</a></li>
<li><a href="#java-query-dsl-ids-query">12.3.11. Ids Query</a></li>
</ul>
</li>
<li><a href="#java-compound-queries">12.4. Compound queries</a>
<ul class="sectlevel3">
<li><a href="#java-query-dsl-constant-score-query">12.4.1. Constant Score Query</a></li>
<li><a href="#java-query-dsl-dis-max-query">12.4.2. Dis Max Query</a></li>
<li><a href="#java-query-dsl-boosting-query">12.4.3. Boosting Query</a></li>
<li><a href="#java-query-dsl-indices-query">12.4.4. Indices Query</a></li>
<li><a href="#java-query-dsl-and-query">12.4.5. And Query</a></li>
<li><a href="#java-query-dsl-not-query">12.4.6. Not Query</a></li>
<li><a href="#java-query-dsl-or-query">12.4.7. Or Query</a></li>
<li><a href="#java-query-dsl-filtered-query">12.4.8. Filtered Query</a></li>
<li><a href="#java-query-dsl-limit-query">12.4.9. Limit Query</a></li>
</ul>
</li>
<li><a href="#java-joining-queries">12.5. Joining queries</a>
<ul class="sectlevel3">
<li><a href="#java-query-dsl-nested-query">12.5.1. Nested Query</a></li>
<li><a href="#java-query-dsl-has-child-query">12.5.2. Has Child Query</a></li>
<li><a href="#java-query-dsl-has-parent-query">12.5.3. Has Parent Query</a></li>
</ul>
</li>
<li><a href="#java-geo-queries">12.6. Geo queries</a>
<ul class="sectlevel3">
<li><a href="#java-query-dsl-geo-shape-query">12.6.1. GeoShape Query</a></li>
<li><a href="#java-query-dsl-geo-bounding-box-query">12.6.2. Geo Bounding Box Query</a></li>
<li><a href="#java-query-dsl-geo-distance-query">12.6.3. Geo Distance Query</a></li>
<li><a href="#java-query-dsl-geo-distance-range-query">12.6.4. Geo Distance Range Query</a></li>
<li><a href="#java-query-dsl-geo-polygon-query">12.6.5. Geo Polygon Query</a></li>
<li><a href="#java-query-dsl-geohash-cell-query">12.6.6. Geohash Cell Query</a></li>
</ul>
</li>
<li><a href="#java-specialized-queries">12.7. Specialized queries</a>
<ul class="sectlevel3">
<li><a href="#java-query-dsl-mlt-query">12.7.1. More Like This Query (mlt)</a></li>
<li><a href="#java-query-dsl-template-query">12.7.2. Template Query</a></li>
<li><a href="#java-query-dsl-script-query">12.7.3. Script Query</a></li>
</ul>
</li>
<li><a href="#java-span-queries">12.8. Span queries</a>
<ul class="sectlevel3">
<li><a href="#java-query-dsl-span-term-query">12.8.1. Span Term Query</a></li>
<li><a href="#java-query-dsl-span-multi-term-query">12.8.2. Span Multi Term Query</a></li>
<li><a href="#java-query-dsl-span-first-query">12.8.3. Span First Query</a></li>
<li><a href="#java-query-dsl-span-near-query">12.8.4. Span Near Query</a></li>
<li><a href="#java-query-dsl-span-or-query">12.8.5. Span Or Query</a></li>
<li><a href="#java-query-dsl-span-not-query">12.8.6. Span Not Query</a></li>
<li><a href="#java-query-dsl-span-containing-query">12.8.7. Span Containing Query</a></li>
<li><a href="#java-query-dsl-span-within-query">12.8.8. Span Within Query</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#indexed-scripts">13. Indexed Scripts API</a>
<ul class="sectlevel2">
<li><a href="#_script_language">13.1. Script Language</a></li>
</ul>
</li>
<li><a href="#java-admin">14. Java API Administration</a>
<ul class="sectlevel2">
<li><a href="#java-admin-indices">14.1. Indices Administration</a>
<ul class="sectlevel3">
<li><a href="#java-admin-indices-create-index">14.1.1. Create Index</a></li>
<li><a href="#java-admin-indices-put-mapping">14.1.2. Put Mapping</a></li>
<li><a href="#java-admin-indices-refresh">14.1.3. Refresh</a></li>
<li><a href="#java-admin-indices-get-settings">14.1.4. Get Settings</a></li>
</ul>
</li>
<li><a href="#java-admin-cluster">14.2. Cluster Administration</a>
<ul class="sectlevel3">
<li><a href="#java-admin-cluster-health">14.2.1. Cluster Health</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_preface"><a class="anchor" href="#_preface"></a>1. Preface</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section describes the Java API that elasticsearch provides. All
elasticsearch operations are executed using a
<a href="#client">Client</a> object. All
operations are completely asynchronous in nature (either accepts a
listener, or returns a future).</p>
</div>
<div class="paragraph">
<p>Additionally, operations on a client may be accumulated and executed in
<a href="#java-docs-bulk">Bulk</a>.</p>
</div>
<div class="paragraph">
<p>Note, all the APIs are exposed through the
Java API (actually, the Java API is used internally to execute them).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_maven_repository"><a class="anchor" href="#_maven_repository"></a>2. Maven Repository</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Elasticsearch is hosted on
<a href="http://search.maven.org/#search%7Cga%7C1%7Ca%3A%22elasticsearch%22">Maven
Central</a>.</p>
</div>
<div class="paragraph">
<p>For example, you can define the latest version in your <code>pom.xml</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.elasticsearch<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>elasticsearch<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>${es.version}<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dealing_with_jar_dependency_conflicts"><a class="anchor" href="#_dealing_with_jar_dependency_conflicts"></a>3. Dealing with JAR dependency conflicts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you want to use Elasticsearch in your Java application, you may have to deal with version conflicts with third party
dependencies like Guava and Joda.  For instance, perhaps Elasticsearch uses Joda 2.8, while your code uses Joda 2.1.</p>
</div>
<div class="paragraph">
<p>You have two choices:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The simplest solution is to upgrade. Newer module versions are likely to have fixed old bugs.
The further behind you fall, the harder it will be to upgrade later. Of course, it is possible that you are using a
third party dependency that in turn depends on an outdated version of a package, which prevents you from upgrading.</p>
</li>
<li>
<p>The second option is to relocate the troublesome dependencies and to shade them either with your own application
or with Elasticsearch and any plugins needed by the Elasticsearch client.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <a href="https://www.elastic.co/blog/to-shade-or-not-to-shade">"To shade or not to shade" blog post</a> describes
all the steps for doing so.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_embedding_jar_with_dependencies"><a class="anchor" href="#_embedding_jar_with_dependencies"></a>4. Embedding jar with dependencies</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you want to create a single jar containing your application and all dependencies, you should not
use <code>maven-assembly-plugin</code> for that because it can not deal with <code>META-INF/services</code> structure which is
required by Lucene jars.</p>
</div>
<div class="paragraph">
<p>Instead, you can use <code>maven-shade-plugin</code> and configure it as follow:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>maven-shade-plugin<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>2.4.1<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;executions&gt;</span>
        <span class="tag">&lt;execution&gt;</span>
            <span class="tag">&lt;phase&gt;</span>package<span class="tag">&lt;/phase&gt;</span>
            <span class="tag">&lt;goals&gt;</span><span class="tag">&lt;goal&gt;</span>shade<span class="tag">&lt;/goal&gt;</span><span class="tag">&lt;/goals&gt;</span>
            <span class="tag">&lt;configuration&gt;</span>
                <span class="tag">&lt;transformers&gt;</span>
                    <span class="tag">&lt;transformer</span> <span class="attribute-name">implementation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.maven.plugins.shade.resource.ServicesResourceTransformer</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;/transformers&gt;</span>
            <span class="tag">&lt;/configuration&gt;</span>
        <span class="tag">&lt;/execution&gt;</span>
    <span class="tag">&lt;/executions&gt;</span>
<span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that if you have a <code>main</code> class you want to automatically call when running <code>java -jar yourjar.jar</code>, just add
it to the <code>transformers</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;transformer</span> <span class="attribute-name">implementation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.maven.plugins.shade.resource.ManifestResourceTransformer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;mainClass&gt;</span>org.elasticsearch.demo.Generate<span class="tag">&lt;/mainClass&gt;</span>
<span class="tag">&lt;/transformer&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_deploying_in_jboss_eap6_module"><a class="anchor" href="#_deploying_in_jboss_eap6_module"></a>5. Deploying in JBoss EAP6 module</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Elasticsearch and Lucene classes need to be in the same JBoss module.</p>
</div>
<div class="paragraph">
<p>You should define a <code>module.xml</code> file like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;module</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:module:1.1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.elasticsearch</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;resources&gt;</span>
    <span class="comment">&lt;!-- Elasticsearch --&gt;</span>
    <span class="tag">&lt;resource-root</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">elasticsearch-2.0.0.jar</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="comment">&lt;!-- Lucene --&gt;</span>
    <span class="tag">&lt;resource-root</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">lucene-core-5.1.0.jar</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;resource-root</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">lucene-analyzers-common-5.1.0.jar</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;resource-root</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">lucene-queries-5.1.0.jar</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;resource-root</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">lucene-memory-5.1.0.jar</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;resource-root</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">lucene-highlighter-5.1.0.jar</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;resource-root</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">lucene-queryparser-5.1.0.jar</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;resource-root</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">lucene-sandbox-5.1.0.jar</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;resource-root</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">lucene-suggest-5.1.0.jar</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;resource-root</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">lucene-misc-5.1.0.jar</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;resource-root</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">lucene-join-5.1.0.jar</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;resource-root</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">lucene-grouping-5.1.0.jar</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;resource-root</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">lucene-spatial-5.1.0.jar</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;resource-root</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">lucene-expressions-5.1.0.jar</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="comment">&lt;!-- Insert other resources here --&gt;</span>
  <span class="tag">&lt;/resources&gt;</span>

  <span class="tag">&lt;dependencies&gt;</span>
    <span class="tag">&lt;module</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sun.jdk</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">export</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="tag">&gt;</span>
        <span class="tag">&lt;imports&gt;</span>
            <span class="tag">&lt;include</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sun/misc/Unsafe</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;/imports&gt;</span>
    <span class="tag">&lt;/module&gt;</span>
    <span class="tag">&lt;module</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.log4j</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;module</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.commons.logging</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;module</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.api</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/dependencies&gt;</span>
<span class="tag">&lt;/module&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="client"><a class="anchor" href="#client"></a>6. Client</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can use the <strong>Java client</strong> in multiple ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Perform standard <a href="#java-docs-index">index</a>, <a href="#java-docs-get">get</a>,
<a href="#java-docs-delete">delete</a> and <a href="#java-search">search</a> operations on an
existing cluster</p>
</li>
<li>
<p>Perform administrative tasks on a running cluster</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Obtaining an elasticsearch <code>Client</code> is simple. The most common way to
get a client is by creating a <a href="#transport-client"><code>TransportClient</code></a>
that connects to a cluster.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<img src="./images/icons/important.png" alt="Important">
</td>
<td class="content">
<div class="paragraph">
<p>The client must have the same major version (e.g. <code>2.x</code>, or <code>5.x</code>) as the
nodes in the cluster. Clients may connect to clusters which have a different
minor version (e.g. <code>2.3.x</code>) but it is possible that new funcionality may not
be supported.  Ideally, the client should have the same version as the
cluster.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="transport-client"><a class="anchor" href="#transport-client"></a>6.1. Transport Client</h3>
<div class="paragraph">
<p>The <code>TransportClient</code> connects remotely to an Elasticsearch cluster
using the transport module. It does not join the cluster, but simply
gets one or more initial transport addresses and communicates with them
in round robin fashion on each action (though most actions will probably
be "two hop" operations).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// on startup</span>

Client client = TransportClient.builder().build()
        .addTransportAddress(<span class="keyword">new</span> InetSocketTransportAddress(<span class="predefined-type">InetAddress</span>.getByName(<span class="string"><span class="delimiter">&quot;</span><span class="content">host1</span><span class="delimiter">&quot;</span></span>), <span class="integer">9300</span>))
        .addTransportAddress(<span class="keyword">new</span> InetSocketTransportAddress(<span class="predefined-type">InetAddress</span>.getByName(<span class="string"><span class="delimiter">&quot;</span><span class="content">host2</span><span class="delimiter">&quot;</span></span>), <span class="integer">9300</span>));

<span class="comment">// on shutdown</span>

client.close();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that you have to set the cluster name if you use one different than
"elasticsearch":</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Settings settings = Settings.settingsBuilder()
        .put(<span class="string"><span class="delimiter">&quot;</span><span class="content">cluster.name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">myClusterName</span><span class="delimiter">&quot;</span></span>).build();
Client client = TransportClient.builder().settings(settings).build();
<span class="comment">//Add transport addresses and do something with the client...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Transport client comes with a cluster sniffing feature which
allows it to dynamically add new hosts and remove old ones.
When sniffing is enabled the the transport client will connect to the nodes in its
internal node list, which is built via calls to addTransportAddress.
After this, the client will call the internal cluster state API on those nodes
to discover available data nodes. The internal node list of the client will
be replaced with those data nodes only. This list is refreshed every five seconds by default.
Note that the IP addresses the sniffer connects to are the ones declared as the <em>publish</em>
address in those node&#8217;s elasticsearch config.</p>
</div>
<div class="paragraph">
<p>Keep in mind that list might possibly not include the original node it connected to
if that node is not a data node. If, for instance, you initially connect to a
master node, after sniffing no further requests will go to that master node,
but rather to any data nodes instead. The reason the transport excludes non-data
nodes is to avoid sending search traffic to master only nodes.</p>
</div>
<div class="paragraph">
<p>In order to enable sniffing, set <code>client.transport.sniff</code> to <code>true</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Settings settings = Settings.settingsBuilder()
        .put(<span class="string"><span class="delimiter">&quot;</span><span class="content">client.transport.sniff</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">true</span>).build();
TransportClient client = TransportClient.builder().settings(settings).build();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Other transport client level settings include:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>client.transport.ignore_cluster_name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set to <code>true</code> to ignore cluster
name validation of connected nodes. (since 0.19.4)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>client.transport.ping_timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The time to wait for a ping response
from a node. Defaults to <code>5s</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>client.transport.nodes_sampler_interval</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">How often to sample / ping
the nodes listed and connected. Defaults to <code>5s</code>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="client-connected-to-client-node"><a class="anchor" href="#client-connected-to-client-node"></a>6.2. Connecting a Client to a Client Node</h3>
<div class="paragraph">
<p>You can start locally a <a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/modules-node.html#client-node">Client Node</a> and then simply create
a <a href="#transport-client"><code>TransportClient</code></a> in your application which connects to this Client Node.</p>
</div>
<div class="paragraph">
<p>This way, the client node will be able to load whatever plugin you need (think about discovery plugins for example).</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="java-docs"><a class="anchor" href="#java-docs"></a>7. Document APIs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section describes the following CRUD APIs:</p>
</div>
<div class="ulist">
<div class="title">Single document APIs</div>
<ul>
<li>
<p><a href="#java-docs-index">Index API</a></p>
</li>
<li>
<p><a href="#java-docs-get">Get API</a></p>
</li>
<li>
<p><a href="#java-docs-delete">Delete API</a></p>
</li>
<li>
<p><a href="#java-docs-update">Update API</a></p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Multi-document APIs</div>
<ul>
<li>
<p><a href="#java-docs-multi-get">Multi Get API</a></p>
</li>
<li>
<p><a href="#java-docs-bulk">Bulk API</a></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<img src="./images/icons/note.png" alt="Note">
</td>
<td class="content">
All CRUD APIs are single-index APIs. The <code>index</code> parameter accepts a single
index name, or an <code>alias</code> which points to a single index.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="java-docs-index"><a class="anchor" href="#java-docs-index"></a>7.1. Index API</h3>
<div class="paragraph">
<p>The index API allows one to index a typed JSON document into a specific
index and make it searchable.</p>
</div>
<div class="sect3">
<h4 id="java-docs-index-generate"><a class="anchor" href="#java-docs-index-generate"></a>7.1.1. Generate JSON document</h4>
<div class="paragraph">
<p>There are several different ways of generating a JSON document:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Manually (aka do it yourself) using native <code>byte[]</code> or as a <code>String</code></p>
</li>
<li>
<p>Using a <code>Map</code> that will be automatically converted to its JSON
equivalent</p>
</li>
<li>
<p>Using a third party library to serialize your beans such as
<a href="http://wiki.fasterxml.com/JacksonHome">Jackson</a></p>
</li>
<li>
<p>Using built-in helpers XContentFactory.jsonBuilder()</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Internally, each type is converted to <code>byte[]</code> (so a String is converted
to a <code>byte[]</code>). Therefore, if the object is in this form already, then
use it. The <code>jsonBuilder</code> is highly optimized JSON generator that
directly constructs a <code>byte[]</code>.</p>
</div>
<div class="sect4">
<h5 id="java-docs-index-generate-diy"><a class="anchor" href="#java-docs-index-generate-diy"></a>Do It Yourself</h5>
<div class="paragraph">
<p>Nothing really difficult here but note that you will have to encode
dates according to the
<a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/mapping-date-format.html">Date Format</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> json = <span class="string"><span class="delimiter">&quot;</span><span class="content">{</span><span class="delimiter">&quot;</span></span> +
        <span class="string"><span class="delimiter">&quot;</span><span class="char">\&quot;</span><span class="content">user</span><span class="char">\&quot;</span><span class="content">:</span><span class="char">\&quot;</span><span class="content">kimchy</span><span class="char">\&quot;</span><span class="content">,</span><span class="delimiter">&quot;</span></span> +
        <span class="string"><span class="delimiter">&quot;</span><span class="char">\&quot;</span><span class="content">postDate</span><span class="char">\&quot;</span><span class="content">:</span><span class="char">\&quot;</span><span class="content">2013-01-30</span><span class="char">\&quot;</span><span class="content">,</span><span class="delimiter">&quot;</span></span> +
        <span class="string"><span class="delimiter">&quot;</span><span class="char">\&quot;</span><span class="content">message</span><span class="char">\&quot;</span><span class="content">:</span><span class="char">\&quot;</span><span class="content">trying out Elasticsearch</span><span class="char">\&quot;</span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">}</span><span class="delimiter">&quot;</span></span>;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="java-docs-index-generate-using-map"><a class="anchor" href="#java-docs-index-generate-using-map"></a>Using Map</h5>
<div class="paragraph">
<p>Map is a key:values pair collection. It represents a JSON structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; json = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt;();
json.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">kimchy</span><span class="delimiter">&quot;</span></span>);
json.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">postDate</span><span class="delimiter">&quot;</span></span>,<span class="keyword">new</span> <span class="predefined-type">Date</span>());
json.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">message</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">trying out Elasticsearch</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="java-docs-index-generate-beans"><a class="anchor" href="#java-docs-index-generate-beans"></a>Serialize your beans</h5>
<div class="paragraph">
<p>Elasticsearch already uses <a href="http://wiki.fasterxml.com/JacksonHome">Jackson</a>.
So you can use it to serialize your beans to JSON:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">com.fasterxml.jackson.databind</span>.*;

<span class="comment">// instance a json mapper</span>
ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper(); <span class="comment">// create once, reuse</span>

<span class="comment">// generate json</span>
<span class="type">byte</span><span class="type">[]</span> json = mapper.writeValueAsBytes(yourbeaninstance);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="java-docs-index-generate-helpers"><a class="anchor" href="#java-docs-index-generate-helpers"></a>Use Elasticsearch helpers</h5>
<div class="paragraph">
<p>Elasticsearch provides built-in helpers to generate JSON content.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">static</span> <span class="include">org.elasticsearch.common.xcontent.XContentFactory</span>.*;

XContentBuilder builder = jsonBuilder()
    .startObject()
        .field(<span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">kimchy</span><span class="delimiter">&quot;</span></span>)
        .field(<span class="string"><span class="delimiter">&quot;</span><span class="content">postDate</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> <span class="predefined-type">Date</span>())
        .field(<span class="string"><span class="delimiter">&quot;</span><span class="content">message</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">trying out Elasticsearch</span><span class="delimiter">&quot;</span></span>)
    .endObject()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that you can also add arrays with <code>startArray(String)</code> and
<code>endArray()</code> methods. By the way, the <code>field</code> method<br>
 accepts many object types. You can directly pass numbers, dates and even
other XContentBuilder objects.</p>
</div>
<div class="paragraph">
<p>If you need to see the generated JSON content, you can use the
<code>string()</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> json = builder.string();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-docs-index-doc"><a class="anchor" href="#java-docs-index-doc"></a>7.1.2. Index document</h4>
<div class="paragraph">
<p>The following example indexes a JSON document into an index called
twitter, under a type called tweet, with id valued 1:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">static</span> <span class="include">org.elasticsearch.common.xcontent.XContentFactory</span>.*;

IndexResponse response = client.prepareIndex(<span class="string"><span class="delimiter">&quot;</span><span class="content">twitter</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">tweet</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>)
        .setSource(jsonBuilder()
                    .startObject()
                        .field(<span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">kimchy</span><span class="delimiter">&quot;</span></span>)
                        .field(<span class="string"><span class="delimiter">&quot;</span><span class="content">postDate</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> <span class="predefined-type">Date</span>())
                        .field(<span class="string"><span class="delimiter">&quot;</span><span class="content">message</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">trying out Elasticsearch</span><span class="delimiter">&quot;</span></span>)
                    .endObject()
                  )
        .get();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that you can also index your documents as JSON String and that you
don&#8217;t have to give an ID:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> json = <span class="string"><span class="delimiter">&quot;</span><span class="content">{</span><span class="delimiter">&quot;</span></span> +
        <span class="string"><span class="delimiter">&quot;</span><span class="char">\&quot;</span><span class="content">user</span><span class="char">\&quot;</span><span class="content">:</span><span class="char">\&quot;</span><span class="content">kimchy</span><span class="char">\&quot;</span><span class="content">,</span><span class="delimiter">&quot;</span></span> +
        <span class="string"><span class="delimiter">&quot;</span><span class="char">\&quot;</span><span class="content">postDate</span><span class="char">\&quot;</span><span class="content">:</span><span class="char">\&quot;</span><span class="content">2013-01-30</span><span class="char">\&quot;</span><span class="content">,</span><span class="delimiter">&quot;</span></span> +
        <span class="string"><span class="delimiter">&quot;</span><span class="char">\&quot;</span><span class="content">message</span><span class="char">\&quot;</span><span class="content">:</span><span class="char">\&quot;</span><span class="content">trying out Elasticsearch</span><span class="char">\&quot;</span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">}</span><span class="delimiter">&quot;</span></span>;

IndexResponse response = client.prepareIndex(<span class="string"><span class="delimiter">&quot;</span><span class="content">twitter</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">tweet</span><span class="delimiter">&quot;</span></span>)
        .setSource(json)
        .get();</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>IndexResponse</code> object will give you a report:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Index name</span>
<span class="predefined-type">String</span> _index = response.getIndex();
<span class="comment">// Type name</span>
<span class="predefined-type">String</span> _type = response.getType();
<span class="comment">// Document ID (generated or not)</span>
<span class="predefined-type">String</span> _id = response.getId();
<span class="comment">// Version (if it's the first time you index this document, you will get: 1)</span>
<span class="type">long</span> _version = response.getVersion();
<span class="comment">// isCreated() is true if the document is a new one, false if it has been updated</span>
<span class="type">boolean</span> created = response.isCreated();</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information on the index operation, check out the REST
<a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/docs-index_.html">index</a> docs.</p>
</div>
</div>
<div class="sect3">
<h4 id="java-docs-index-thread"><a class="anchor" href="#java-docs-index-thread"></a>7.1.3. Operation Threading</h4>
<div class="paragraph">
<p>The index API allows one to set the threading model the operation will be
performed when the actual execution of the API is performed on the same
node (the API is executed on a shard that is allocated on the same
server).</p>
</div>
<div class="paragraph">
<p>The options are to execute the operation on a different thread, or to
execute it on the calling thread (note that the API is still asynchronous). By
default, <code>operationThreaded</code> is set to <code>true</code> which means the operation
is executed on a different thread.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="java-docs-get"><a class="anchor" href="#java-docs-get"></a>7.2. Get API</h3>
<div class="paragraph">
<p>The get API allows to get a typed JSON document from the index based on
its id. The following example gets a JSON document from an index called
twitter, under a type called tweet, with id valued 1:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">GetResponse response = client.prepareGet(<span class="string"><span class="delimiter">&quot;</span><span class="content">twitter</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">tweet</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>).get();</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information on the get operation, check out the REST
<a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/docs-get.html">get</a> docs.</p>
</div>
<div class="sect3">
<h4 id="java-docs-get-thread"><a class="anchor" href="#java-docs-get-thread"></a>7.2.1. Operation Threading</h4>
<div class="paragraph">
<p>The get API allows to set the threading model the operation will be
performed when the actual execution of the API is performed on the same
node (the API is executed on a shard that is allocated on the same
server).</p>
</div>
<div class="paragraph">
<p>The options are to execute the operation on a different thread, or to
execute it on the calling thread (note that the API is still async). By
default, <code>operationThreaded</code> is set to <code>true</code> which means the operation
is executed on a different thread. Here is an example that sets it to
<code>false</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">GetResponse response = client.prepareGet(<span class="string"><span class="delimiter">&quot;</span><span class="content">twitter</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">tweet</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>)
        .setOperationThreaded(<span class="predefined-constant">false</span>)
        .get();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="java-docs-delete"><a class="anchor" href="#java-docs-delete"></a>7.3. Delete API</h3>
<div class="paragraph">
<p>The delete API allows one to delete a typed JSON document from a specific
index based on its id. The following example deletes the JSON document
from an index called twitter, under a type called tweet, with id valued
1:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">DeleteResponse response = client.prepareDelete(<span class="string"><span class="delimiter">&quot;</span><span class="content">twitter</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">tweet</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>).get();</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information on the delete operation, check out the
<a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/docs-delete.html">delete API</a> docs.</p>
</div>
<div class="sect3">
<h4 id="java-docs-delete-thread"><a class="anchor" href="#java-docs-delete-thread"></a>7.3.1. Operation Threading</h4>
<div class="paragraph">
<p>The delete API allows to set the threading model the operation will be
performed when the actual execution of the API is performed on the same
node (the API is executed on a shard that is allocated on the same
server).</p>
</div>
<div class="paragraph">
<p>The options are to execute the operation on a different thread, or to
execute it on the calling thread (note that the API is still async). By
default, <code>operationThreaded</code> is set to <code>true</code> which means the operation
is executed on a different thread. Here is an example that sets it to
<code>false</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">DeleteResponse response = client.prepareDelete(<span class="string"><span class="delimiter">&quot;</span><span class="content">twitter</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">tweet</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>)
        .setOperationThreaded(<span class="predefined-constant">false</span>)
        .get();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="java-docs-update"><a class="anchor" href="#java-docs-update"></a>7.4. Update API</h3>
<div class="paragraph">
<p>You can either create an <code>UpdateRequest</code> and send it to the client:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">UpdateRequest updateRequest = <span class="keyword">new</span> UpdateRequest();
updateRequest.index(<span class="string"><span class="delimiter">&quot;</span><span class="content">index</span><span class="delimiter">&quot;</span></span>);
updateRequest.type(<span class="string"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>);
updateRequest.id(<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>);
updateRequest.doc(jsonBuilder()
        .startObject()
            .field(<span class="string"><span class="delimiter">&quot;</span><span class="content">gender</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">male</span><span class="delimiter">&quot;</span></span>)
        .endObject());
client.update(updateRequest).get();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or you can use <code>prepareUpdate()</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">client.prepareUpdate(<span class="string"><span class="delimiter">&quot;</span><span class="content">ttl</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">doc</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>)
        .setScript(<span class="keyword">new</span> Script(<span class="string"><span class="delimiter">&quot;</span><span class="content">ctx._source.gender = </span><span class="char">\&quot;</span><span class="content">male</span><span class="char">\&quot;</span><span class="delimiter">&quot;</span></span> &lt;<span class="integer">1</span>&gt; , ScriptService.ScriptType.INLINE, <span class="predefined-constant">null</span>, <span class="predefined-constant">null</span>))
        .get();

client.prepareUpdate(<span class="string"><span class="delimiter">&quot;</span><span class="content">ttl</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">doc</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>)
        .setDoc(jsonBuilder()               <img src="./images/icons/callouts/2.png" alt="2">
            .startObject()
                .field(<span class="string"><span class="delimiter">&quot;</span><span class="content">gender</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">male</span><span class="delimiter">&quot;</span></span>)
            .endObject())
        .get();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>Your script. It could also be a locally stored script name.
In that case, you&#8217;ll need to use <code>ScriptService.ScriptType.FILE</code></td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>Document which will be merged to the existing one.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that you can&#8217;t provide both <code>script</code> and <code>doc</code>.</p>
</div>
<div class="sect3">
<h4 id="java-docs-update-api-script"><a class="anchor" href="#java-docs-update-api-script"></a>7.4.1. Update by script</h4>
<div class="paragraph">
<p>The update API allows to update a document based on a script provided:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">UpdateRequest updateRequest = <span class="keyword">new</span> UpdateRequest(<span class="string"><span class="delimiter">&quot;</span><span class="content">ttl</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">doc</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>)
        .script(<span class="keyword">new</span> Script(<span class="string"><span class="delimiter">&quot;</span><span class="content">ctx._source.gender = </span><span class="char">\&quot;</span><span class="content">male</span><span class="char">\&quot;</span><span class="delimiter">&quot;</span></span>));
client.update(updateRequest).get();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-docs-update-api-merge-docs"><a class="anchor" href="#java-docs-update-api-merge-docs"></a>7.4.2. Update by merging documents</h4>
<div class="paragraph">
<p>The update API also support passing a partial document, which will be merged into the existing document (simple
recursive merge, inner merging of objects, replacing core "keys/values" and arrays). For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">UpdateRequest updateRequest = <span class="keyword">new</span> UpdateRequest(<span class="string"><span class="delimiter">&quot;</span><span class="content">index</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>)
        .doc(jsonBuilder()
            .startObject()
                .field(<span class="string"><span class="delimiter">&quot;</span><span class="content">gender</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">male</span><span class="delimiter">&quot;</span></span>)
            .endObject());
client.update(updateRequest).get();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-docs-update-api-upsert"><a class="anchor" href="#java-docs-update-api-upsert"></a>7.4.3. Upsert</h4>
<div class="paragraph">
<p>There is also support for <code>upsert</code>. If the document does not exist, the content of the <code>upsert</code>
element will be used to index the fresh doc:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">IndexRequest indexRequest = <span class="keyword">new</span> IndexRequest(<span class="string"><span class="delimiter">&quot;</span><span class="content">index</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>)
        .source(jsonBuilder()
            .startObject()
                .field(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Joe Smith</span><span class="delimiter">&quot;</span></span>)
                .field(<span class="string"><span class="delimiter">&quot;</span><span class="content">gender</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">male</span><span class="delimiter">&quot;</span></span>)
            .endObject());
UpdateRequest updateRequest = <span class="keyword">new</span> UpdateRequest(<span class="string"><span class="delimiter">&quot;</span><span class="content">index</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>)
        .doc(jsonBuilder()
            .startObject()
                .field(<span class="string"><span class="delimiter">&quot;</span><span class="content">gender</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">male</span><span class="delimiter">&quot;</span></span>)
            .endObject())
        .upsert(indexRequest);              <img src="./images/icons/callouts/1.png" alt="1">
client.update(updateRequest).get();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>If the document does not exist, the one in <code>indexRequest</code> will be added</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the document <code>index/type/1</code> already exists, we will have after this operation a document like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>  : <span class="string"><span class="delimiter">&quot;</span><span class="content">Joe Dalton</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">gender</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">male</span><span class="delimiter">&quot;</span></span>        <img src="./images/icons/callouts/1.png" alt="1">
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>This field is added by the update request</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If it does not exist, we will have a new document:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">Joe Smith</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">gender</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">male</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="java-docs-multi-get"><a class="anchor" href="#java-docs-multi-get"></a>7.5. Multi Get API</h3>
<div class="paragraph">
<p>The multi get API allows to get a list of documents based on their <code>index</code>, <code>type</code> and <code>id</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">MultiGetResponse multiGetItemResponses = client.prepareMultiGet()
    .add(<span class="string"><span class="delimiter">&quot;</span><span class="content">twitter</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">tweet</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>)           <img src="./images/icons/callouts/1.png" alt="1">
    .add(<span class="string"><span class="delimiter">&quot;</span><span class="content">twitter</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">tweet</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">4</span><span class="delimiter">&quot;</span></span>) <img src="./images/icons/callouts/2.png" alt="2">
    .add(<span class="string"><span class="delimiter">&quot;</span><span class="content">another</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>)          <img src="./images/icons/callouts/3.png" alt="3">
    .get();

<span class="keyword">for</span> (MultiGetItemResponse itemResponse : multiGetItemResponses) { <img src="./images/icons/callouts/4.png" alt="4">
    GetResponse response = itemResponse.getResponse();
    <span class="keyword">if</span> (response.isExists()) {                      <img src="./images/icons/callouts/5.png" alt="5">
        <span class="predefined-type">String</span> json = response.getSourceAsString(); <img src="./images/icons/callouts/6.png" alt="6">
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>get by a single id</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>or by a list of ids for the same index / type</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/3.png" alt="3"></td>
<td>you can also get from another index</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/4.png" alt="4"></td>
<td>iterate over the result set</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/5.png" alt="5"></td>
<td>you can check if the document exists</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/6.png" alt="6"></td>
<td>access to the <code>_source</code> field</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For more information on the multi get operation, check out the REST
<a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/docs-multi-get.html">multi get</a> docs.</p>
</div>
</div>
<div class="sect2">
<h3 id="java-docs-bulk"><a class="anchor" href="#java-docs-bulk"></a>7.6. Bulk API</h3>
<div class="paragraph">
<p>The bulk API allows one to index and delete several documents in a
single request. Here is a sample usage:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">static</span> <span class="include">org.elasticsearch.common.xcontent.XContentFactory</span>.*;

BulkRequestBuilder bulkRequest = client.prepareBulk();

<span class="comment">// either use client#prepare, or use Requests# to directly build index/delete requests</span>
bulkRequest.add(client.prepareIndex(<span class="string"><span class="delimiter">&quot;</span><span class="content">twitter</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">tweet</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>)
        .setSource(jsonBuilder()
                    .startObject()
                        .field(<span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">kimchy</span><span class="delimiter">&quot;</span></span>)
                        .field(<span class="string"><span class="delimiter">&quot;</span><span class="content">postDate</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> <span class="predefined-type">Date</span>())
                        .field(<span class="string"><span class="delimiter">&quot;</span><span class="content">message</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">trying out Elasticsearch</span><span class="delimiter">&quot;</span></span>)
                    .endObject()
                  )
        );

bulkRequest.add(client.prepareIndex(<span class="string"><span class="delimiter">&quot;</span><span class="content">twitter</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">tweet</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>)
        .setSource(jsonBuilder()
                    .startObject()
                        .field(<span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">kimchy</span><span class="delimiter">&quot;</span></span>)
                        .field(<span class="string"><span class="delimiter">&quot;</span><span class="content">postDate</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> <span class="predefined-type">Date</span>())
                        .field(<span class="string"><span class="delimiter">&quot;</span><span class="content">message</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">another post</span><span class="delimiter">&quot;</span></span>)
                    .endObject()
                  )
        );

BulkResponse bulkResponse = bulkRequest.get();
<span class="keyword">if</span> (bulkResponse.hasFailures()) {
    <span class="comment">// process failures by iterating through each bulk response item</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="java-docs-bulk-processor"><a class="anchor" href="#java-docs-bulk-processor"></a>7.7. Using Bulk Processor</h3>
<div class="paragraph">
<p>The <code>BulkProcessor</code> class offers a simple interface to flush bulk operations automatically based on the number or size
of requests, or after a given period.</p>
</div>
<div class="paragraph">
<p>To use it, first create a <code>BulkProcessor</code> instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.elasticsearch.action.bulk.BackoffPolicy</span>;
<span class="keyword">import</span> <span class="include">org.elasticsearch.action.bulk.BulkProcessor</span>;
<span class="keyword">import</span> <span class="include">org.elasticsearch.common.unit.ByteSizeUnit</span>;
<span class="keyword">import</span> <span class="include">org.elasticsearch.common.unit.ByteSizeValue</span>;
<span class="keyword">import</span> <span class="include">org.elasticsearch.common.unit.TimeValue</span>;

BulkProcessor bulkProcessor = BulkProcessor.builder(
        client,  <img src="./images/icons/callouts/1.png" alt="1">
        <span class="keyword">new</span> BulkProcessor.Listener() {
            <span class="annotation">@Override</span>
            <span class="directive">public</span> <span class="type">void</span> beforeBulk(<span class="type">long</span> executionId,
                                   BulkRequest request) { ... } <img src="./images/icons/callouts/2.png" alt="2">

            <span class="annotation">@Override</span>
            <span class="directive">public</span> <span class="type">void</span> afterBulk(<span class="type">long</span> executionId,
                                  BulkRequest request,
                                  BulkResponse response) { ... } <img src="./images/icons/callouts/3.png" alt="3">

            <span class="annotation">@Override</span>
            <span class="directive">public</span> <span class="type">void</span> afterBulk(<span class="type">long</span> executionId,
                                  BulkRequest request,
                                  <span class="predefined-type">Throwable</span> failure) { ... } <img src="./images/icons/callouts/4.png" alt="4">
        })
        .setBulkActions(<span class="integer">10000</span>) <img src="./images/icons/callouts/5.png" alt="5">
        .setBulkSize(<span class="keyword">new</span> ByteSizeValue(<span class="integer">1</span>, ByteSizeUnit.GB)) <img src="./images/icons/callouts/6.png" alt="6">
        .setFlushInterval(TimeValue.timeValueSeconds(<span class="integer">5</span>)) <img src="./images/icons/callouts/7.png" alt="7">
        .setConcurrentRequests(<span class="integer">1</span>) <img src="./images/icons/callouts/8.png" alt="8">
        .setBackoffPolicy(
            BackoffPolicy.exponentialBackoff(TimeValue.timeValueMillis(<span class="integer">100</span>), <span class="integer">3</span>)) <img src="./images/icons/callouts/9.png" alt="9">
        .build();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>Add your elasticsearch client</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>This method is called just before bulk is executed. You can for example see the numberOfActions with
<code>request.numberOfActions()</code></td>
</tr>
<tr>
<td><img src="./images/icons/callouts/3.png" alt="3"></td>
<td>This method is called after bulk execution. You can for example check if there was some failing requests
with <code>response.hasFailures()</code></td>
</tr>
<tr>
<td><img src="./images/icons/callouts/4.png" alt="4"></td>
<td>This method is called when the bulk failed and raised a <code>Throwable</code></td>
</tr>
<tr>
<td><img src="./images/icons/callouts/5.png" alt="5"></td>
<td>We want to execute the bulk every 10 000 requests</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/6.png" alt="6"></td>
<td>We want to flush the bulk every 1gb</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/7.png" alt="7"></td>
<td>We want to flush the bulk every 5 seconds whatever the number of requests</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/8.png" alt="8"></td>
<td>Set the number of concurrent requests. A value of 0 means that only a single request will  be allowed to be
executed. A value of 1 means 1 concurrent request is allowed to be executed while accumulating new bulk requests.</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/9.png" alt="9"></td>
<td>Set a custom backoff policy which will initially wait for 100ms, increase exponentially and retries up to three
times. A retry is attempted whenever one or more bulk item requests have failed with an <code>EsRejectedExecutionException</code>
which indicates that there were too little compute resources available for processing the request. To disable backoff,
pass <code>BackoffPolicy.noBackoff()</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then you can simply add your requests to the <code>BulkProcessor</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">bulkProcessor.add(<span class="keyword">new</span> IndexRequest(<span class="string"><span class="delimiter">&quot;</span><span class="content">twitter</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">tweet</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>).source(<span class="comment">/* your doc here */</span>));
bulkProcessor.add(<span class="keyword">new</span> DeleteRequest(<span class="string"><span class="delimiter">&quot;</span><span class="content">twitter</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">tweet</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, <code>BulkProcessor</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>sets bulkActions to <code>1000</code></p>
</li>
<li>
<p>sets bulkSize to <code>5mb</code></p>
</li>
<li>
<p>does not set flushInterval</p>
</li>
<li>
<p>sets concurrentRequests to 1</p>
</li>
<li>
<p>sets backoffPolicy to an exponential backoff with 8 retries and a start delay of 50ms. The total wait time is roughly 5.1 seconds.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When all documents are loaded to the <code>BulkProcessor</code> it can be closed by using <code>awaitClose</code> or <code>close</code> methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">bulkProcessor.awaitClose(<span class="integer">10</span>, <span class="predefined-type">TimeUnit</span>.MINUTES);</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">bulkProcessor.close();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Both methods flush any remaining documents and disable all other scheduled flushes if they were scheduled by setting
<code>flushInterval</code>. If concurrent requests were enabled the <code>awaitClose</code> method waits for up to the specified timeout for
all bulk requests to complete then returns <code>true</code>, if the specified waiting time elapses before all bulk requests complete,
<code>false</code> is returned. The <code>close</code> method doesn&#8217;t wait for any remaining bulk requests to complete and exits immediately.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="java-search"><a class="anchor" href="#java-search"></a>8. Search API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The search API allows one to execute a search query and get back search hits
that match the query. It can be executed across one or more indices and
across one or more types. The query can provided using the <a href="#java-query-dsl">query Java API</a>.
The body of the search request is built using the <code>SearchSourceBuilder</code>. Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.elasticsearch.action.search.SearchResponse</span>;
<span class="keyword">import</span> <span class="include">org.elasticsearch.action.search.SearchType</span>;
<span class="keyword">import</span> <span class="include">org.elasticsearch.index.query.QueryBuilders</span>.*;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">SearchResponse response = client.prepareSearch(<span class="string"><span class="delimiter">&quot;</span><span class="content">index1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">index2</span><span class="delimiter">&quot;</span></span>)
        .setTypes(<span class="string"><span class="delimiter">&quot;</span><span class="content">type1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">type2</span><span class="delimiter">&quot;</span></span>)
        .setSearchType(SearchType.DFS_QUERY_THEN_FETCH)
        .setQuery(QueryBuilders.termQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">multi</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>))                 <span class="comment">// Query</span>
        .setPostFilter(QueryBuilders.rangeQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>).from(<span class="integer">12</span>).to(<span class="integer">18</span>))     <span class="comment">// Filter</span>
        .setFrom(<span class="integer">0</span>).setSize(<span class="integer">60</span>).setExplain(<span class="predefined-constant">true</span>)
        .execute()
        .actionGet();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that all parameters are optional. Here is the smallest search call
you can write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// MatchAll on the whole cluster with all default options</span>
SearchResponse response = client.prepareSearch().execute().actionGet();</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<img src="./images/icons/note.png" alt="Note">
</td>
<td class="content">
Although the Java API defines the additional search types QUERY_AND_FETCH and
        DFS_QUERY_AND_FETCH, these modes are internal optimizations and should not
        be specified explicitly by users of the API.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For more information on the search operation, check out the REST
<a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/search.html">search</a> docs.</p>
</div>
<div class="sect2">
<h3 id="java-search-scrolling"><a class="anchor" href="#java-search-scrolling"></a>8.1. Using scrolls in Java</h3>
<div class="paragraph">
<p>Read the <a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/search-request-scroll.html">scroll documentation</a>
first!</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">static</span> <span class="include">org.elasticsearch.index.query.QueryBuilders</span>.*;

QueryBuilder qb = termQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">multi</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>);

SearchResponse scrollResp = client.prepareSearch(test)
        .setSearchType(SearchType.SCAN)
        .setScroll(<span class="keyword">new</span> TimeValue(<span class="integer">60000</span>))
        .setQuery(qb)
        .setSize(<span class="integer">100</span>).execute().actionGet(); <span class="comment">//100 hits per shard will be returned for each scroll</span>
<span class="comment">//Scroll until no hits are returned</span>
<span class="keyword">while</span> (<span class="predefined-constant">true</span>) {

    <span class="keyword">for</span> (SearchHit hit : scrollResp.getHits().getHits()) {
        <span class="comment">//Handle the hit...</span>
    }
    scrollResp = client.prepareSearchScroll(scrollResp.getScrollId()).setScroll(<span class="keyword">new</span> TimeValue(<span class="integer">60000</span>)).execute().actionGet();
    <span class="comment">//Break condition: No hits are returned</span>
    <span class="keyword">if</span> (scrollResp.getHits().getHits().length == <span class="integer">0</span>) {
        <span class="keyword">break</span>;
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<img src="./images/icons/note.png" alt="Note">
</td>
<td class="content">
<div class="paragraph">
<p>The size-parameter is per shard, so if you run a query against multiple indices (leading to many shards being involved in the query) the result might be more documents per execution of the scroll than you would expect!</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="java-search-msearch"><a class="anchor" href="#java-search-msearch"></a>8.2. MultiSearch API</h3>
<div class="paragraph">
<p>See <a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/search-multi-search.html">MultiSearch API Query</a>
documentation</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">SearchRequestBuilder srb1 = node.client()
    .prepareSearch().setQuery(QueryBuilders.queryStringQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">elasticsearch</span><span class="delimiter">&quot;</span></span>)).setSize(<span class="integer">1</span>);
SearchRequestBuilder srb2 = node.client()
    .prepareSearch().setQuery(QueryBuilders.matchQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">kimchy</span><span class="delimiter">&quot;</span></span>)).setSize(<span class="integer">1</span>);

MultiSearchResponse sr = node.client().prepareMultiSearch()
        .add(srb1)
        .add(srb2)
        .execute().actionGet();

<span class="comment">// You will get all individual responses from MultiSearchResponse#getResponses()</span>
<span class="type">long</span> nbHits = <span class="integer">0</span>;
<span class="keyword">for</span> (MultiSearchResponse.Item item : sr.getResponses()) {
    SearchResponse response = item.getResponse();
    nbHits += response.getHits().getTotalHits();
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="java-search-aggs"><a class="anchor" href="#java-search-aggs"></a>8.3. Using Aggregations</h3>
<div class="paragraph">
<p>The following code shows how to add two aggregations within your search:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">SearchResponse sr = node.client().prepareSearch()
    .setQuery(QueryBuilders.matchAllQuery())
    .addAggregation(
            AggregationBuilders.terms(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg1</span><span class="delimiter">&quot;</span></span>).field(<span class="string"><span class="delimiter">&quot;</span><span class="content">field</span><span class="delimiter">&quot;</span></span>)
    )
    .addAggregation(
            AggregationBuilders.dateHistogram(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg2</span><span class="delimiter">&quot;</span></span>)
                    .field(<span class="string"><span class="delimiter">&quot;</span><span class="content">birth</span><span class="delimiter">&quot;</span></span>)
                    .interval(DateHistogramInterval.YEAR)
    )
    .execute().actionGet();

<span class="comment">// Get your facet results</span>
Terms agg1 = sr.getAggregations().get(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg1</span><span class="delimiter">&quot;</span></span>);
DateHistogram agg2 = sr.getAggregations().get(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg2</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="#java-aggs">Aggregations Java API</a>
documentation for details.</p>
</div>
</div>
<div class="sect2">
<h3 id="java-search-terminate-after"><a class="anchor" href="#java-search-terminate-after"></a>8.4. Terminate After</h3>
<div class="paragraph">
<p>The maximum number of documents to collect for each shard, upon reaching which the query execution will terminate early.
If set, you will be able to check if the operation terminated early by asking for <code>isTerminatedEarly()</code> in the
<code>SearchResponse</code> onject:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">SearchResponse sr = client.prepareSearch(INDEX)
    .setTerminateAfter(<span class="integer">1000</span>)    <img src="./images/icons/callouts/1.png" alt="1">
    .get();

<span class="keyword">if</span> (sr.isTerminatedEarly()) {
    <span class="comment">// We finished early</span>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>Finish after 1000 docs</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="count"><a class="anchor" href="#count"></a>9. Count API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>deprecated[2.1.0, Use the <code>search</code> api instead and set <code>size</code> to <code>0</code>]</p>
</div>
<div class="paragraph">
<p>The count API allows one to easily execute a query and get the number of
matches for that query. It can be executed across one or more indices
and across one or more types. The query can be provided using the
<a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/query-dsl.html">Query DSL</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">static</span> <span class="include">org.elasticsearch.index.query.QueryBuilders</span>.*;

CountResponse response = client.prepareCount(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>)
        .setQuery(termQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">_type</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">type1</span><span class="delimiter">&quot;</span></span>))
        .execute()
        .actionGet();</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information on the count operation, check out the REST
<a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/search-count.html">count</a> docs.</p>
</div>
<div class="sect2">
<h3 id="_operation_threading"><a class="anchor" href="#_operation_threading"></a>9.1. Operation Threading</h3>
<div class="paragraph">
<p>The count API allows one to set the threading model the operation will be
performed when the actual execution of the API is performed on the same
node (the API is executed on a shard that is allocated on the same
server).</p>
</div>
<div class="paragraph">
<p>There are three threading modes.The <code>NO_THREADS</code> mode means that the
count operation will be executed on the calling thread. The
<code>SINGLE_THREAD</code> mode means that the count operation will be executed on
a single different thread for all local shards. The <code>THREAD_PER_SHARD</code>
mode means that the count operation will be executed on a different
thread for each local shard.</p>
</div>
<div class="paragraph">
<p>The default mode is <code>SINGLE_THREAD</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="java-aggs"><a class="anchor" href="#java-aggs"></a>10. Aggregations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Elasticsearch provides a full Java API to play with aggregations. See the
<a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/search-aggregations.html">Aggregations guide</a>.</p>
</div>
<div class="paragraph">
<p>Use the factory for aggregation builders (<code>AggregationBuilders</code>) and add each aggregation
you want to compute when querying and add it to your search request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">SearchResponse sr = node.client().prepareSearch()
        .setQuery( <span class="comment">/* your query */</span> )
        .addAggregation( <span class="comment">/* add an aggregation */</span> )
        .execute().actionGet();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that you can add more than one aggregation. See
<a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/search-search.html">Search Java API</a> for details.</p>
</div>
<div class="paragraph">
<p>To build aggregation requests, use <code>AggregationBuilders</code> helpers. Just import them
in your class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.elasticsearch.search.aggregations.AggregationBuilders</span>;</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_structuring_aggregations"><a class="anchor" href="#_structuring_aggregations"></a>10.1. Structuring aggregations</h3>
<div class="paragraph">
<p>As explained in the
<a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/search-aggregations.html">Aggregations guide</a>, you can define
sub aggregations inside an aggregation.</p>
</div>
<div class="paragraph">
<p>An aggregation could be a metrics aggregation or a bucket aggregation.</p>
</div>
<div class="paragraph">
<p>For example, here is a 3 levels aggregation composed of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Terms aggregation (bucket)</p>
</li>
<li>
<p>Date Histogram aggregation (bucket)</p>
</li>
<li>
<p>Average aggregation (metric)</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">SearchResponse sr = node.client().prepareSearch()
    .addAggregation(
        AggregationBuilders.terms(<span class="string"><span class="delimiter">&quot;</span><span class="content">by_country</span><span class="delimiter">&quot;</span></span>).field(<span class="string"><span class="delimiter">&quot;</span><span class="content">country</span><span class="delimiter">&quot;</span></span>)
        .subAggregation(AggregationBuilders.dateHistogram(<span class="string"><span class="delimiter">&quot;</span><span class="content">by_year</span><span class="delimiter">&quot;</span></span>)
            .field(<span class="string"><span class="delimiter">&quot;</span><span class="content">dateOfBirth</span><span class="delimiter">&quot;</span></span>)
            .interval((DateHistogramInterval.YEAR)
            .subAggregation(AggregationBuilders.avg(<span class="string"><span class="delimiter">&quot;</span><span class="content">avg_children</span><span class="delimiter">&quot;</span></span>).field(<span class="string"><span class="delimiter">&quot;</span><span class="content">children</span><span class="delimiter">&quot;</span></span>))
        )
    )
    .execute().actionGet();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_metrics_aggregations"><a class="anchor" href="#_metrics_aggregations"></a>10.2. Metrics aggregations</h3>
<div class="sect3">
<h4 id="java-aggs-metrics-min"><a class="anchor" href="#java-aggs-metrics-min"></a>10.2.1. Min Aggregation</h4>
<div class="paragraph">
<p>Here is how you can use
<a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/search-aggregations-metrics-min-aggregation.html">Min Aggregation</a>
with Java API.</p>
</div>
<div class="sect4">
<h5 id="_prepare_aggregation_request"><a class="anchor" href="#_prepare_aggregation_request"></a>Prepare aggregation request</h5>
<div class="paragraph">
<p>Here is an example on how to create the aggregation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">MetricsAggregationBuilder aggregation =
        AggregationBuilders
                .min(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>)
                .field(<span class="string"><span class="delimiter">&quot;</span><span class="content">height</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_use_aggregation_response"><a class="anchor" href="#_use_aggregation_response"></a>Use aggregation response</h5>
<div class="paragraph">
<p>Import Aggregation definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.elasticsearch.search.aggregations.metrics.min.Min</span>;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// sr is here your SearchResponse object</span>
Min agg = sr.getAggregations().get(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>);
<span class="type">double</span> value = agg.getValue();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-aggs-metrics-max"><a class="anchor" href="#java-aggs-metrics-max"></a>10.2.2. Max Aggregation</h4>
<div class="paragraph">
<p>Here is how you can use
<a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/search-aggregations-metrics-max-aggregation.html">Max Aggregation</a>
with Java API.</p>
</div>
<div class="sect4">
<h5 id="_prepare_aggregation_request_2"><a class="anchor" href="#_prepare_aggregation_request_2"></a>Prepare aggregation request</h5>
<div class="paragraph">
<p>Here is an example on how to create the aggregation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">MetricsAggregationBuilder aggregation =
        AggregationBuilders
                .max(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>)
                .field(<span class="string"><span class="delimiter">&quot;</span><span class="content">height</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_use_aggregation_response_2"><a class="anchor" href="#_use_aggregation_response_2"></a>Use aggregation response</h5>
<div class="paragraph">
<p>Import Aggregation definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.elasticsearch.search.aggregations.metrics.max.Max</span>;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// sr is here your SearchResponse object</span>
Max agg = sr.getAggregations().get(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>);
<span class="type">double</span> value = agg.getValue();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-aggs-metrics-sum"><a class="anchor" href="#java-aggs-metrics-sum"></a>10.2.3. Sum Aggregation</h4>
<div class="paragraph">
<p>Here is how you can use
<a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/search-aggregations-metrics-sum-aggregation.html">Sum Aggregation</a>
with Java API.</p>
</div>
<div class="sect4">
<h5 id="_prepare_aggregation_request_3"><a class="anchor" href="#_prepare_aggregation_request_3"></a>Prepare aggregation request</h5>
<div class="paragraph">
<p>Here is an example on how to create the aggregation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">MetricsAggregationBuilder aggregation =
        AggregationBuilders
                .sum(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>)
                .field(<span class="string"><span class="delimiter">&quot;</span><span class="content">height</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_use_aggregation_response_3"><a class="anchor" href="#_use_aggregation_response_3"></a>Use aggregation response</h5>
<div class="paragraph">
<p>Import Aggregation definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.elasticsearch.search.aggregations.metrics.sum.Sum</span>;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// sr is here your SearchResponse object</span>
Sum agg = sr.getAggregations().get(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>);
<span class="type">double</span> value = agg.getValue();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-aggs-metrics-avg"><a class="anchor" href="#java-aggs-metrics-avg"></a>10.2.4. Avg Aggregation</h4>
<div class="paragraph">
<p>Here is how you can use
<a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/search-aggregations-metrics-avg-aggregation.html">Avg Aggregation</a>
with Java API.</p>
</div>
<div class="sect4">
<h5 id="_prepare_aggregation_request_4"><a class="anchor" href="#_prepare_aggregation_request_4"></a>Prepare aggregation request</h5>
<div class="paragraph">
<p>Here is an example on how to create the aggregation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">MetricsAggregationBuilder aggregation =
        AggregationBuilders
                .avg(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>)
                .field(<span class="string"><span class="delimiter">&quot;</span><span class="content">height</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_use_aggregation_response_4"><a class="anchor" href="#_use_aggregation_response_4"></a>Use aggregation response</h5>
<div class="paragraph">
<p>Import Aggregation definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.elasticsearch.search.aggregations.metrics.avg.Avg</span>;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// sr is here your SearchResponse object</span>
Avg agg = sr.getAggregations().get(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>);
<span class="type">double</span> value = agg.getValue();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-aggs-metrics-stats"><a class="anchor" href="#java-aggs-metrics-stats"></a>10.2.5. Stats Aggregation</h4>
<div class="paragraph">
<p>Here is how you can use
<a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/search-aggregations-metrics-stats-aggregation.html">Stats Aggregation</a>
with Java API.</p>
</div>
<div class="sect4">
<h5 id="_prepare_aggregation_request_5"><a class="anchor" href="#_prepare_aggregation_request_5"></a>Prepare aggregation request</h5>
<div class="paragraph">
<p>Here is an example on how to create the aggregation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">MetricsAggregationBuilder aggregation =
        AggregationBuilders
                .stats(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>)
                .field(<span class="string"><span class="delimiter">&quot;</span><span class="content">height</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_use_aggregation_response_5"><a class="anchor" href="#_use_aggregation_response_5"></a>Use aggregation response</h5>
<div class="paragraph">
<p>Import Aggregation definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.elasticsearch.search.aggregations.metrics.stats.Stats</span>;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// sr is here your SearchResponse object</span>
Stats agg = sr.getAggregations().get(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>);
<span class="type">double</span> min = agg.getMin();
<span class="type">double</span> max = agg.getMax();
<span class="type">double</span> avg = agg.getAvg();
<span class="type">double</span> sum = agg.getSum();
<span class="type">long</span> count = agg.getCount();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-aggs-metrics-extendedstats"><a class="anchor" href="#java-aggs-metrics-extendedstats"></a>10.2.6. Extended Stats Aggregation</h4>
<div class="paragraph">
<p>Here is how you can use
<a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/search-aggregations-metrics-extendedstats-aggregation.html">Extended Stats Aggregation</a>
with Java API.</p>
</div>
<div class="sect4">
<h5 id="_prepare_aggregation_request_6"><a class="anchor" href="#_prepare_aggregation_request_6"></a>Prepare aggregation request</h5>
<div class="paragraph">
<p>Here is an example on how to create the aggregation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">MetricsAggregationBuilder aggregation =
        AggregationBuilders
                .extendedStats(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>)
                .field(<span class="string"><span class="delimiter">&quot;</span><span class="content">height</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_use_aggregation_response_6"><a class="anchor" href="#_use_aggregation_response_6"></a>Use aggregation response</h5>
<div class="paragraph">
<p>Import Aggregation definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.elasticsearch.search.aggregations.metrics.stats.extended.ExtendedStats</span>;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// sr is here your SearchResponse object</span>
ExtendedStats agg = sr.getAggregations().get(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>);
<span class="type">double</span> min = agg.getMin();
<span class="type">double</span> max = agg.getMax();
<span class="type">double</span> avg = agg.getAvg();
<span class="type">double</span> sum = agg.getSum();
<span class="type">long</span> count = agg.getCount();
<span class="type">double</span> stdDeviation = agg.getStdDeviation();
<span class="type">double</span> sumOfSquares = agg.getSumOfSquares();
<span class="type">double</span> variance = agg.getVariance();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-aggs-metrics-valuecount"><a class="anchor" href="#java-aggs-metrics-valuecount"></a>10.2.7. Value Count Aggregation</h4>
<div class="paragraph">
<p>Here is how you can use
<a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/search-aggregations-metrics-valuecount-aggregation.html">Value Count Aggregation</a>
with Java API.</p>
</div>
<div class="sect4">
<h5 id="_prepare_aggregation_request_7"><a class="anchor" href="#_prepare_aggregation_request_7"></a>Prepare aggregation request</h5>
<div class="paragraph">
<p>Here is an example on how to create the aggregation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">MetricsAggregationBuilder aggregation =
        AggregationBuilders
                .count(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>)
                .field(<span class="string"><span class="delimiter">&quot;</span><span class="content">height</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_use_aggregation_response_7"><a class="anchor" href="#_use_aggregation_response_7"></a>Use aggregation response</h5>
<div class="paragraph">
<p>Import Aggregation definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.elasticsearch.search.aggregations.metrics.valuecount.ValueCount</span>;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// sr is here your SearchResponse object</span>
ValueCount agg = sr.getAggregations().get(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>);
<span class="type">long</span> value = agg.getValue();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-aggs-metrics-percentile"><a class="anchor" href="#java-aggs-metrics-percentile"></a>10.2.8. Percentile Aggregation</h4>
<div class="paragraph">
<p>Here is how you can use
<a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/search-aggregations-metrics-percentile-aggregation.html">Percentile Aggregation</a>
with Java API.</p>
</div>
<div class="sect4">
<h5 id="_prepare_aggregation_request_8"><a class="anchor" href="#_prepare_aggregation_request_8"></a>Prepare aggregation request</h5>
<div class="paragraph">
<p>Here is an example on how to create the aggregation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">MetricsAggregationBuilder aggregation =
        AggregationBuilders
                .percentiles(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>)
                .field(<span class="string"><span class="delimiter">&quot;</span><span class="content">height</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can provide your own percentiles instead of using defaults:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">MetricsAggregationBuilder aggregation =
        AggregationBuilders
                .percentiles(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>)
                .field(<span class="string"><span class="delimiter">&quot;</span><span class="content">height</span><span class="delimiter">&quot;</span></span>)
                .percentiles(<span class="float">1.0</span>, <span class="float">5.0</span>, <span class="float">10.0</span>, <span class="float">20.0</span>, <span class="float">30.0</span>, <span class="float">75.0</span>, <span class="float">95.0</span>, <span class="float">99.0</span>);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_use_aggregation_response_8"><a class="anchor" href="#_use_aggregation_response_8"></a>Use aggregation response</h5>
<div class="paragraph">
<p>Import Aggregation definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.elasticsearch.search.aggregations.metrics.percentiles.Percentile</span>;
<span class="keyword">import</span> <span class="include">org.elasticsearch.search.aggregations.metrics.percentiles.Percentiles</span>;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// sr is here your SearchResponse object</span>
Percentiles agg = sr.getAggregations().get(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>);
<span class="comment">// For each entry</span>
<span class="keyword">for</span> (Percentile entry : agg) {
    <span class="type">double</span> percent = entry.getPercent();    <span class="comment">// Percent</span>
    <span class="type">double</span> value = entry.getValue();        <span class="comment">// Value</span>

    logger.info(<span class="string"><span class="delimiter">&quot;</span><span class="content">percent [{}], value [{}]</span><span class="delimiter">&quot;</span></span>, percent, value);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will basically produce for the first example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">percent [1.0], value [0.814338896154595]
percent [5.0], value [0.8761912455821302]
percent [25.0], value [1.173346540141847]
percent [50.0], value [1.5432023318692198]
percent [75.0], value [1.923915462033674]
percent [95.0], value [2.2273644908535335]
percent [99.0], value [2.284989339108279]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-aggs-metrics-percentile-rank"><a class="anchor" href="#java-aggs-metrics-percentile-rank"></a>10.2.9. Percentile Ranks Aggregation</h4>
<div class="paragraph">
<p>Here is how you can use
<a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/search-aggregations-metrics-percentile-rank-aggregation.html">Percentile Ranks Aggregation</a>
with Java API.</p>
</div>
<div class="sect4">
<h5 id="_prepare_aggregation_request_9"><a class="anchor" href="#_prepare_aggregation_request_9"></a>Prepare aggregation request</h5>
<div class="paragraph">
<p>Here is an example on how to create the aggregation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">MetricsAggregationBuilder aggregation =
        AggregationBuilders
                .percentileRanks(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>)
                .field(<span class="string"><span class="delimiter">&quot;</span><span class="content">height</span><span class="delimiter">&quot;</span></span>)
                .percentiles(<span class="float">1.24</span>, <span class="float">1.91</span>, <span class="float">2.22</span>);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_use_aggregation_response_9"><a class="anchor" href="#_use_aggregation_response_9"></a>Use aggregation response</h5>
<div class="paragraph">
<p>Import Aggregation definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.elasticsearch.search.aggregations.metrics.percentiles.Percentile</span>;
<span class="keyword">import</span> <span class="include">org.elasticsearch.search.aggregations.metrics.percentiles.PercentileRanks</span>;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// sr is here your SearchResponse object</span>
PercentileRanks agg = sr.getAggregations().get(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>);
<span class="comment">// For each entry</span>
<span class="keyword">for</span> (Percentile entry : agg) {
    <span class="type">double</span> percent = entry.getPercent();    <span class="comment">// Percent</span>
    <span class="type">double</span> value = entry.getValue();        <span class="comment">// Value</span>

    logger.info(<span class="string"><span class="delimiter">&quot;</span><span class="content">percent [{}], value [{}]</span><span class="delimiter">&quot;</span></span>, percent, value);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will basically produce:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">percent [29.664353095090945], value [1.24]
percent [73.9335313461868], value [1.91]
percent [94.40095147327283], value [2.22]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-aggs-metrics-cardinality"><a class="anchor" href="#java-aggs-metrics-cardinality"></a>10.2.10. Cardinality Aggregation</h4>
<div class="paragraph">
<p>Here is how you can use
<a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/search-aggregations-metrics-cardinality-aggregation.html">Cardinality Aggregation</a>
with Java API.</p>
</div>
<div class="sect4">
<h5 id="_prepare_aggregation_request_10"><a class="anchor" href="#_prepare_aggregation_request_10"></a>Prepare aggregation request</h5>
<div class="paragraph">
<p>Here is an example on how to create the aggregation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">MetricsAggregationBuilder aggregation =
        AggregationBuilders
                .cardinality(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>)
                .field(<span class="string"><span class="delimiter">&quot;</span><span class="content">tags</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_use_aggregation_response_10"><a class="anchor" href="#_use_aggregation_response_10"></a>Use aggregation response</h5>
<div class="paragraph">
<p>Import Aggregation definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.elasticsearch.search.aggregations.metrics.cardinality.Cardinality</span>;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// sr is here your SearchResponse object</span>
Cardinality agg = sr.getAggregations().get(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>);
<span class="type">long</span> value = agg.getValue();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-aggs-metrics-geobounds"><a class="anchor" href="#java-aggs-metrics-geobounds"></a>10.2.11. Cardinality Aggregation</h4>
<div class="paragraph">
<p>Here is how you can use
<a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/search-aggregations-metrics-geobounds-aggregation.html">Geo Bounds Aggregation</a>
with Java API.</p>
</div>
<div class="sect4">
<h5 id="_prepare_aggregation_request_11"><a class="anchor" href="#_prepare_aggregation_request_11"></a>Prepare aggregation request</h5>
<div class="paragraph">
<p>Here is an example on how to create the aggregation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">GeoBoundsBuilder aggregation =
        AggregationBuilders
                .geoBounds(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>)
                .field(<span class="string"><span class="delimiter">&quot;</span><span class="content">address.location</span><span class="delimiter">&quot;</span></span>)
                .wrapLongitude(<span class="predefined-constant">true</span>);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_use_aggregation_response_11"><a class="anchor" href="#_use_aggregation_response_11"></a>Use aggregation response</h5>
<div class="paragraph">
<p>Import Aggregation definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.elasticsearch.search.aggregations.metrics.geobounds.GeoBounds</span>;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// sr is here your SearchResponse object</span>
GeoBounds agg = sr.getAggregations().get(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>);
GeoPoint bottomRight = agg.bottomRight();
GeoPoint topLeft = agg.topLeft();
logger.info(<span class="string"><span class="delimiter">&quot;</span><span class="content">bottomRight {}, topLeft {}</span><span class="delimiter">&quot;</span></span>, bottomRight, topLeft);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will basically produce:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">bottomRight [40.70500764381921, 13.952946866893775], topLeft [53.49603022435221, -4.190029308156676]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-aggs-metrics-tophits"><a class="anchor" href="#java-aggs-metrics-tophits"></a>10.2.12. Top Hits Aggregation</h4>
<div class="paragraph">
<p>Here is how you can use
<a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/search-aggregations-metrics-top-hits-aggregation.html">Top Hits Aggregation</a>
with Java API.</p>
</div>
<div class="sect4">
<h5 id="_prepare_aggregation_request_12"><a class="anchor" href="#_prepare_aggregation_request_12"></a>Prepare aggregation request</h5>
<div class="paragraph">
<p>Here is an example on how to create the aggregation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">AggregationBuilder aggregation =
    AggregationBuilders
        .terms(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>).field(<span class="string"><span class="delimiter">&quot;</span><span class="content">gender</span><span class="delimiter">&quot;</span></span>)
        .subAggregation(
            AggregationBuilders.topHits(<span class="string"><span class="delimiter">&quot;</span><span class="content">top</span><span class="delimiter">&quot;</span></span>)
        );</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use most of the options available for standard search such as <code>from</code>, <code>size</code>, <code>sort</code>, <code>highlight</code>, <code>explain</code>&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">AggregationBuilder aggregation =
    AggregationBuilders
        .terms(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>).field(<span class="string"><span class="delimiter">&quot;</span><span class="content">gender</span><span class="delimiter">&quot;</span></span>)
        .subAggregation(
            AggregationBuilders.topHits(<span class="string"><span class="delimiter">&quot;</span><span class="content">top</span><span class="delimiter">&quot;</span></span>)
                .setExplain(<span class="predefined-constant">true</span>)
                .setSize(<span class="integer">1</span>)
                .setFrom(<span class="integer">10</span>)
        );</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_use_aggregation_response_12"><a class="anchor" href="#_use_aggregation_response_12"></a>Use aggregation response</h5>
<div class="paragraph">
<p>Import Aggregation definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.elasticsearch.search.aggregations.bucket.terms.Terms</span>;
<span class="keyword">import</span> <span class="include">org.elasticsearch.search.aggregations.metrics.tophits.TopHits</span>;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// sr is here your SearchResponse object</span>
Terms agg = sr.getAggregations().get(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// For each entry</span>
<span class="keyword">for</span> (Terms.Bucket entry : agg.getBuckets()) {
    <span class="predefined-type">String</span> key = entry.getKey();                    <span class="comment">// bucket key</span>
    <span class="type">long</span> docCount = entry.getDocCount();            <span class="comment">// Doc count</span>
    logger.info(<span class="string"><span class="delimiter">&quot;</span><span class="content">key [{}], doc_count [{}]</span><span class="delimiter">&quot;</span></span>, key, docCount);

    <span class="comment">// We ask for top_hits for each bucket</span>
    TopHits topHits = entry.getAggregations().get(<span class="string"><span class="delimiter">&quot;</span><span class="content">top</span><span class="delimiter">&quot;</span></span>);
    <span class="keyword">for</span> (SearchHit hit : topHits.getHits().getHits()) {
        logger.info(<span class="string"><span class="delimiter">&quot;</span><span class="content"> -&gt; id [{}], _source [{}]</span><span class="delimiter">&quot;</span></span>, hit.getId(), hit.getSourceAsString());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will basically produce for the first example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">key [male], doc_count [5107]
 -&gt; id [AUnzSZze9k7PKXtq04x2], _source [{&quot;gender&quot;:&quot;male&quot;,...}]
 -&gt; id [AUnzSZzj9k7PKXtq04x4], _source [{&quot;gender&quot;:&quot;male&quot;,...}]
 -&gt; id [AUnzSZzl9k7PKXtq04x5], _source [{&quot;gender&quot;:&quot;male&quot;,...}]
key [female], doc_count [4893]
 -&gt; id [AUnzSZzM9k7PKXtq04xy], _source [{&quot;gender&quot;:&quot;female&quot;,...}]
 -&gt; id [AUnzSZzp9k7PKXtq04x8], _source [{&quot;gender&quot;:&quot;female&quot;,...}]
 -&gt; id [AUnzSZ0W9k7PKXtq04yS], _source [{&quot;gender&quot;:&quot;female&quot;,...}]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-aggs-metrics-scripted-metric"><a class="anchor" href="#java-aggs-metrics-scripted-metric"></a>10.2.13. Scripted Metric Aggregation</h4>
<div class="paragraph">
<p>Here is how you can use
<a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/search-aggregations-metrics-scripted-metric-aggregation.html">Scripted Metric Aggregation</a>
with Java API.</p>
</div>
<div class="paragraph">
<p>Don&#8217;t forget to add Groovy in your classpath if you want to run Groovy scripts in an embedded data node
(for unit tests for example).
For example, with Maven, add this dependency to your <code>pom.xml</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.codehaus.groovy<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>groovy-all<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>2.3.2<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;classifier&gt;</span>indy<span class="tag">&lt;/classifier&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_prepare_aggregation_request_13"><a class="anchor" href="#_prepare_aggregation_request_13"></a>Prepare aggregation request</h5>
<div class="paragraph">
<p>Here is an example on how to create the aggregation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">MetricsAggregationBuilder aggregation =
        AggregationBuilders
                .scriptedMetric(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>)
                .initScript(<span class="string"><span class="delimiter">&quot;</span><span class="content">_agg['heights'] = []</span><span class="delimiter">&quot;</span></span>)
                .mapScript(<span class="keyword">new</span> Script(<span class="string"><span class="delimiter">&quot;</span><span class="content">if (doc['gender'].value == </span><span class="char">\&quot;</span><span class="content">male</span><span class="char">\&quot;</span><span class="content">) </span><span class="delimiter">&quot;</span></span> +
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">{ _agg.heights.add(doc['height'].value) } </span><span class="delimiter">&quot;</span></span> +
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">else </span><span class="delimiter">&quot;</span></span> +
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">{ _agg.heights.add(-1 * doc['height'].value) }</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also specify a <code>combine</code> script which will be executed on each shard:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">MetricsAggregationBuilder aggregation =
        AggregationBuilders
                .scriptedMetric(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>)
                .initScript(<span class="keyword">new</span> Script(<span class="string"><span class="delimiter">&quot;</span><span class="content">_agg['heights'] = []</span><span class="delimiter">&quot;</span></span>))
                .mapScript(<span class="keyword">new</span> Script(<span class="string"><span class="delimiter">&quot;</span><span class="content">if (doc['gender'].value == </span><span class="char">\&quot;</span><span class="content">male</span><span class="char">\&quot;</span><span class="content">) </span><span class="delimiter">&quot;</span></span> +
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">{ _agg.heights.add(doc['height'].value) } </span><span class="delimiter">&quot;</span></span> +
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">else </span><span class="delimiter">&quot;</span></span> +
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">{ _agg.heights.add(-1 * doc['height'].value) }</span><span class="delimiter">&quot;</span></span>))
                .combineScript(<span class="keyword">new</span> Script(<span class="string"><span class="delimiter">&quot;</span><span class="content">heights_sum = 0; for (t in _agg.heights) { heights_sum += t }; return heights_sum</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also specify a <code>reduce</code> script which will be executed on the node which gets the request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">MetricsAggregationBuilder aggregation =
        AggregationBuilders
                .scriptedMetric(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>)
                .initScript(<span class="keyword">new</span> Script(<span class="string"><span class="delimiter">&quot;</span><span class="content">_agg['heights'] = []</span><span class="delimiter">&quot;</span></span>))
                .mapScript(<span class="keyword">new</span> Script(<span class="string"><span class="delimiter">&quot;</span><span class="content">if (doc['gender'].value == </span><span class="char">\&quot;</span><span class="content">male</span><span class="char">\&quot;</span><span class="content">) </span><span class="delimiter">&quot;</span></span> +
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">{ _agg.heights.add(doc['height'].value) } </span><span class="delimiter">&quot;</span></span> +
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">else </span><span class="delimiter">&quot;</span></span> +
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">{ _agg.heights.add(-1 * doc['height'].value) }</span><span class="delimiter">&quot;</span></span>))
                .combineScript(<span class="keyword">new</span> Script(<span class="string"><span class="delimiter">&quot;</span><span class="content">heights_sum = 0; for (t in _agg.heights) { heights_sum += t }; return heights_sum</span><span class="delimiter">&quot;</span></span>))
                .reduceScript(<span class="keyword">new</span> Script(<span class="string"><span class="delimiter">&quot;</span><span class="content">heights_sum = 0; for (a in _aggs) { heights_sum += a }; return heights_sum</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_use_aggregation_response_13"><a class="anchor" href="#_use_aggregation_response_13"></a>Use aggregation response</h5>
<div class="paragraph">
<p>Import Aggregation definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.elasticsearch.search.aggregations.bucket.terms.Terms</span>;
<span class="keyword">import</span> <span class="include">org.elasticsearch.search.aggregations.metrics.tophits.TopHits</span>;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// sr is here your SearchResponse object</span>
ScriptedMetric agg = sr.getAggregations().get(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">Object</span> scriptedResult = agg.aggregation();
logger.info(<span class="string"><span class="delimiter">&quot;</span><span class="content">scriptedResult [{}]</span><span class="delimiter">&quot;</span></span>, scriptedResult);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the result depends on the script you built.
For the first example, this will basically produce:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">scriptedResult object [ArrayList]
scriptedResult [ {
&quot;heights&quot; : [ 1.122218480146643, -1.8148918111233887, -1.7626731575142909, ... ]
}, {
&quot;heights&quot; : [ -0.8046067304119863, -2.0785486707864553, -1.9183567430207953, ... ]
}, {
&quot;heights&quot; : [ 2.092635728868694, 1.5697545960886536, 1.8826954461968808, ... ]
}, {
&quot;heights&quot; : [ -2.1863201099468403, 1.6328549117346856, -1.7078288405893842, ... ]
}, {
&quot;heights&quot; : [ 1.6043904836424177, -2.0736538674414025, 0.9898266674373053, ... ]
} ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The second example will produce:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">scriptedResult object [ArrayList]
scriptedResult [-41.279615707402876,
                -60.88007362339038,
                38.823270659734256,
                14.840192739445632,
                11.300902755741326]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The last example will produce:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">scriptedResult object [Double]
scriptedResult [2.171917696507009]</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_bucket_aggregations"><a class="anchor" href="#_bucket_aggregations"></a>10.3. Bucket aggregations</h3>
<div class="sect3">
<h4 id="java-aggs-bucket-global"><a class="anchor" href="#java-aggs-bucket-global"></a>10.3.1. Global Aggregation</h4>
<div class="paragraph">
<p>Here is how you can use
<a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/search-aggregations-bucket-global-aggregation.html">Global Aggregation</a>
with Java API.</p>
</div>
<div class="sect4">
<h5 id="_prepare_aggregation_request_14"><a class="anchor" href="#_prepare_aggregation_request_14"></a>Prepare aggregation request</h5>
<div class="paragraph">
<p>Here is an example on how to create the aggregation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">AggregationBuilders
    .global(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>)
    .subAggregation(AggregationBuilders.terms(<span class="string"><span class="delimiter">&quot;</span><span class="content">genders</span><span class="delimiter">&quot;</span></span>).field(<span class="string"><span class="delimiter">&quot;</span><span class="content">gender</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_use_aggregation_response_14"><a class="anchor" href="#_use_aggregation_response_14"></a>Use aggregation response</h5>
<div class="paragraph">
<p>Import Aggregation definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.elasticsearch.search.aggregations.bucket.global.Global</span>;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// sr is here your SearchResponse object</span>
Global agg = sr.getAggregations().get(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>);
agg.getDocCount(); <span class="comment">// Doc count</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-aggs-bucket-filter"><a class="anchor" href="#java-aggs-bucket-filter"></a>10.3.2. Filter Aggregation</h4>
<div class="paragraph">
<p>Here is how you can use
<a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/search-aggregations-bucket-filter-aggregation.html">Filter Aggregation</a>
with Java API.</p>
</div>
<div class="sect4">
<h5 id="_prepare_aggregation_request_15"><a class="anchor" href="#_prepare_aggregation_request_15"></a>Prepare aggregation request</h5>
<div class="paragraph">
<p>Here is an example on how to create the aggregation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">AggregationBuilders
    .filter(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>)
    .filter(QueryBuilders.termQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">gender</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">male</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_use_aggregation_response_15"><a class="anchor" href="#_use_aggregation_response_15"></a>Use aggregation response</h5>
<div class="paragraph">
<p>Import Aggregation definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.elasticsearch.search.aggregations.bucket.filter.Filter</span>;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// sr is here your SearchResponse object</span>
<span class="predefined-type">Filter</span> agg = sr.getAggregations().get(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>);
agg.getDocCount(); <span class="comment">// Doc count</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-aggs-bucket-filters"><a class="anchor" href="#java-aggs-bucket-filters"></a>10.3.3. Filters Aggregation</h4>
<div class="paragraph">
<p>Here is how you can use
<a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/search-aggregations-bucket-filters-aggregation.html">Filters Aggregation</a>
with Java API.</p>
</div>
<div class="sect4">
<h5 id="_prepare_aggregation_request_16"><a class="anchor" href="#_prepare_aggregation_request_16"></a>Prepare aggregation request</h5>
<div class="paragraph">
<p>Here is an example on how to create the aggregation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">AggregationBuilder aggregation =
    AggregationBuilders
        .filters(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>)
            .filter(<span class="string"><span class="delimiter">&quot;</span><span class="content">men</span><span class="delimiter">&quot;</span></span>, QueryBuilders.termQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">gender</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">male</span><span class="delimiter">&quot;</span></span>))
            .filter(<span class="string"><span class="delimiter">&quot;</span><span class="content">women</span><span class="delimiter">&quot;</span></span>, QueryBuilders.termQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">gender</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">female</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_use_aggregation_response_16"><a class="anchor" href="#_use_aggregation_response_16"></a>Use aggregation response</h5>
<div class="paragraph">
<p>Import Aggregation definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.elasticsearch.search.aggregations.bucket.filters.Filters</span>;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// sr is here your SearchResponse object</span>
Filters agg = sr.getAggregations().get(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// For each entry</span>
<span class="keyword">for</span> (Filters.Bucket entry : agg.getBuckets()) {
    <span class="predefined-type">String</span> key = entry.getKeyAsString();            <span class="comment">// bucket key</span>
    <span class="type">long</span> docCount = entry.getDocCount();            <span class="comment">// Doc count</span>
    logger.info(<span class="string"><span class="delimiter">&quot;</span><span class="content">key [{}], doc_count [{}]</span><span class="delimiter">&quot;</span></span>, key, docCount);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will basically produce:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">key [men], doc_count [4982]
key [women], doc_count [5018]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-aggs-bucket-missing"><a class="anchor" href="#java-aggs-bucket-missing"></a>10.3.4. Missing Aggregation</h4>
<div class="paragraph">
<p>Here is how you can use
<a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/search-aggregations-bucket-missing-aggregation.html">Missing Aggregation</a>
with Java API.</p>
</div>
<div class="sect4">
<h5 id="_prepare_aggregation_request_17"><a class="anchor" href="#_prepare_aggregation_request_17"></a>Prepare aggregation request</h5>
<div class="paragraph">
<p>Here is an example on how to create the aggregation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">AggregationBuilders.missing(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>).field(<span class="string"><span class="delimiter">&quot;</span><span class="content">gender</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_use_aggregation_response_17"><a class="anchor" href="#_use_aggregation_response_17"></a>Use aggregation response</h5>
<div class="paragraph">
<p>Import Aggregation definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.elasticsearch.search.aggregations.bucket.missing.Missing</span>;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// sr is here your SearchResponse object</span>
Missing agg = sr.getAggregations().get(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>);
agg.getDocCount(); <span class="comment">// Doc count</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-aggs-bucket-nested"><a class="anchor" href="#java-aggs-bucket-nested"></a>10.3.5. Nested Aggregation</h4>
<div class="paragraph">
<p>Here is how you can use
<a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/search-aggregations-bucket-nested-aggregation.html">Nested Aggregation</a>
with Java API.</p>
</div>
<div class="sect4">
<h5 id="_prepare_aggregation_request_18"><a class="anchor" href="#_prepare_aggregation_request_18"></a>Prepare aggregation request</h5>
<div class="paragraph">
<p>Here is an example on how to create the aggregation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">AggregationBuilders
    .nested(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>)
    .path(<span class="string"><span class="delimiter">&quot;</span><span class="content">resellers</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_use_aggregation_response_18"><a class="anchor" href="#_use_aggregation_response_18"></a>Use aggregation response</h5>
<div class="paragraph">
<p>Import Aggregation definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.elasticsearch.search.aggregations.bucket.nested.Nested</span>;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// sr is here your SearchResponse object</span>
Nested agg = sr.getAggregations().get(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>);
agg.getDocCount(); <span class="comment">// Doc count</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-aggs-bucket-reverse-nested"><a class="anchor" href="#java-aggs-bucket-reverse-nested"></a>10.3.6. Reverse Nested Aggregation</h4>
<div class="paragraph">
<p>Here is how you can use
<a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/search-aggregations-bucket-reverse-nested-aggregation.html">Reverse Nested Aggregation</a>
with Java API.</p>
</div>
<div class="sect4">
<h5 id="_prepare_aggregation_request_19"><a class="anchor" href="#_prepare_aggregation_request_19"></a>Prepare aggregation request</h5>
<div class="paragraph">
<p>Here is an example on how to create the aggregation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">AggregationBuilder aggregation =
    AggregationBuilders
        .nested(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>).path(<span class="string"><span class="delimiter">&quot;</span><span class="content">resellers</span><span class="delimiter">&quot;</span></span>)
        .subAggregation(
                AggregationBuilders
                        .terms(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>).field(<span class="string"><span class="delimiter">&quot;</span><span class="content">resellers.name</span><span class="delimiter">&quot;</span></span>)
                        .subAggregation(
                                AggregationBuilders
                                        .reverseNested(<span class="string"><span class="delimiter">&quot;</span><span class="content">reseller_to_product</span><span class="delimiter">&quot;</span></span>)
                        )
        );</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_use_aggregation_response_19"><a class="anchor" href="#_use_aggregation_response_19"></a>Use aggregation response</h5>
<div class="paragraph">
<p>Import Aggregation definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.elasticsearch.search.aggregations.bucket.nested.Nested</span>;
<span class="keyword">import</span> <span class="include">org.elasticsearch.search.aggregations.bucket.nested.ReverseNested</span>;
<span class="keyword">import</span> <span class="include">org.elasticsearch.search.aggregations.bucket.terms.Terms</span>;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// sr is here your SearchResponse object</span>
Nested agg = sr.getAggregations().get(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>);
Terms name = agg.getAggregations().get(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>);
<span class="keyword">for</span> (Terms.Bucket bucket : name.getBuckets()) {
    ReverseNested resellerToProduct = bucket.getAggregations().get(<span class="string"><span class="delimiter">&quot;</span><span class="content">reseller_to_product</span><span class="delimiter">&quot;</span></span>);
    resellerToProduct.getDocCount(); <span class="comment">// Doc count</span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-aggs-bucket-children"><a class="anchor" href="#java-aggs-bucket-children"></a>10.3.7. Children Aggregation</h4>
<div class="paragraph">
<p>Here is how you can use
<a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/search-aggregations-bucket-children-aggregation.html">Children Aggregation</a>
with Java API.</p>
</div>
<div class="sect4">
<h5 id="_prepare_aggregation_request_20"><a class="anchor" href="#_prepare_aggregation_request_20"></a>Prepare aggregation request</h5>
<div class="paragraph">
<p>Here is an example on how to create the aggregation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">AggregationBuilder aggregation =
    AggregationBuilders
        .children(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>)
        .childType(<span class="string"><span class="delimiter">&quot;</span><span class="content">reseller</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_use_aggregation_response_20"><a class="anchor" href="#_use_aggregation_response_20"></a>Use aggregation response</h5>
<div class="paragraph">
<p>Import Aggregation definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.elasticsearch.search.aggregations.bucket.children.Children</span>;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// sr is here your SearchResponse object</span>
Children agg = sr.getAggregations().get(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>);
agg.getDocCount(); <span class="comment">// Doc count</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-aggs-bucket-terms"><a class="anchor" href="#java-aggs-bucket-terms"></a>10.3.8. Terms Aggregation</h4>
<div class="paragraph">
<p>Here is how you can use
<a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/search-aggregations-bucket-terms-aggregation.html">Terms Aggregation</a>
with Java API.</p>
</div>
<div class="sect4">
<h5 id="_prepare_aggregation_request_21"><a class="anchor" href="#_prepare_aggregation_request_21"></a>Prepare aggregation request</h5>
<div class="paragraph">
<p>Here is an example on how to create the aggregation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">AggregationBuilders
    .terms(<span class="string"><span class="delimiter">&quot;</span><span class="content">genders</span><span class="delimiter">&quot;</span></span>)
    .field(<span class="string"><span class="delimiter">&quot;</span><span class="content">gender</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_use_aggregation_response_21"><a class="anchor" href="#_use_aggregation_response_21"></a>Use aggregation response</h5>
<div class="paragraph">
<p>Import Aggregation definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.elasticsearch.search.aggregations.bucket.terms.Terms</span>;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// sr is here your SearchResponse object</span>
Terms genders = sr.getAggregations().get(<span class="string"><span class="delimiter">&quot;</span><span class="content">genders</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// For each entry</span>
<span class="keyword">for</span> (Terms.Bucket entry : genders.getBuckets()) {
    entry.getKey();      <span class="comment">// Term</span>
    entry.getDocCount(); <span class="comment">// Doc count</span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_order"><a class="anchor" href="#_order"></a>10.3.9. Order</h4>
<div class="paragraph">
<p>Ordering the buckets by their <code>doc_count</code> in an ascending manner:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">AggregationBuilders
    .terms(<span class="string"><span class="delimiter">&quot;</span><span class="content">genders</span><span class="delimiter">&quot;</span></span>)
    .field(<span class="string"><span class="delimiter">&quot;</span><span class="content">gender</span><span class="delimiter">&quot;</span></span>)
    .order(Terms.Order.count(<span class="predefined-constant">true</span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ordering the buckets alphabetically by their terms in an ascending manner:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">AggregationBuilders
    .terms(<span class="string"><span class="delimiter">&quot;</span><span class="content">genders</span><span class="delimiter">&quot;</span></span>)
    .field(<span class="string"><span class="delimiter">&quot;</span><span class="content">gender</span><span class="delimiter">&quot;</span></span>)
    .order(Terms.Order.term(<span class="predefined-constant">true</span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ordering the buckets by single value metrics sub-aggregation (identified by the aggregation name):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">AggregationBuilders
    .terms(<span class="string"><span class="delimiter">&quot;</span><span class="content">genders</span><span class="delimiter">&quot;</span></span>)
    .field(<span class="string"><span class="delimiter">&quot;</span><span class="content">gender</span><span class="delimiter">&quot;</span></span>)
    .order(Terms.Order.aggregation(<span class="string"><span class="delimiter">&quot;</span><span class="content">avg_height</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">false</span>))
    .subAggregation(
        AggregationBuilders.avg(<span class="string"><span class="delimiter">&quot;</span><span class="content">avg_height</span><span class="delimiter">&quot;</span></span>).field(<span class="string"><span class="delimiter">&quot;</span><span class="content">height</span><span class="delimiter">&quot;</span></span>)
    )</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-aggs-bucket-significantterms"><a class="anchor" href="#java-aggs-bucket-significantterms"></a>10.3.10. Significant Terms Aggregation</h4>
<div class="paragraph">
<p>Here is how you can use
<a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/search-aggregations-bucket-significantterms-aggregation.html">Significant Terms Aggregation</a>
with Java API.</p>
</div>
<div class="sect4">
<h5 id="_prepare_aggregation_request_22"><a class="anchor" href="#_prepare_aggregation_request_22"></a>Prepare aggregation request</h5>
<div class="paragraph">
<p>Here is an example on how to create the aggregation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">AggregationBuilder aggregation =
        AggregationBuilders
                .significantTerms(<span class="string"><span class="delimiter">&quot;</span><span class="content">significant_countries</span><span class="delimiter">&quot;</span></span>)
                .field(<span class="string"><span class="delimiter">&quot;</span><span class="content">address.country</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// Let say you search for men only</span>
SearchResponse sr = client.prepareSearch()
        .setQuery(QueryBuilders.termQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">gender</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">male</span><span class="delimiter">&quot;</span></span>))
        .addAggregation(aggregation)
        .get();</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_use_aggregation_response_22"><a class="anchor" href="#_use_aggregation_response_22"></a>Use aggregation response</h5>
<div class="paragraph">
<p>Import Aggregation definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.elasticsearch.search.aggregations.bucket.significant.SignificantTerms</span>;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// sr is here your SearchResponse object</span>
SignificantTerms agg = sr.getAggregations().get(<span class="string"><span class="delimiter">&quot;</span><span class="content">significant_countries</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// For each entry</span>
<span class="keyword">for</span> (SignificantTerms.Bucket entry : agg.getBuckets()) {
    entry.getKey();      <span class="comment">// Term</span>
    entry.getDocCount(); <span class="comment">// Doc count</span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-aggs-bucket-range"><a class="anchor" href="#java-aggs-bucket-range"></a>10.3.11. Range Aggregation</h4>
<div class="paragraph">
<p>Here is how you can use
<a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/search-aggregations-bucket-range-aggregation.html">Range Aggregation</a>
with Java API.</p>
</div>
<div class="sect4">
<h5 id="_prepare_aggregation_request_23"><a class="anchor" href="#_prepare_aggregation_request_23"></a>Prepare aggregation request</h5>
<div class="paragraph">
<p>Here is an example on how to create the aggregation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">AggregationBuilder aggregation =
        AggregationBuilders
                .range(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>)
                .field(<span class="string"><span class="delimiter">&quot;</span><span class="content">height</span><span class="delimiter">&quot;</span></span>)
                .addUnboundedTo(<span class="float">1.0f</span>)               <span class="comment">// from -infinity to 1.0 (excluded)</span>
                .addRange(<span class="float">1.0f</span>, <span class="float">1.5f</span>)               <span class="comment">// from 1.0 to 1.5 (excluded)</span>
                .addUnboundedFrom(<span class="float">1.5f</span>);            <span class="comment">// from 1.5 to +infinity</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_use_aggregation_response_23"><a class="anchor" href="#_use_aggregation_response_23"></a>Use aggregation response</h5>
<div class="paragraph">
<p>Import Aggregation definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.elasticsearch.search.aggregations.bucket.range.Range</span>;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// sr is here your SearchResponse object</span>
Range agg = sr.getAggregations().get(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// For each entry</span>
<span class="keyword">for</span> (Range.Bucket entry : agg.getBuckets()) {
    <span class="predefined-type">String</span> key = entry.getKeyAsString();             <span class="comment">// Range as key</span>
    <span class="predefined-type">Number</span> from = (<span class="predefined-type">Number</span>) entry.getFrom();          <span class="comment">// Bucket from</span>
    <span class="predefined-type">Number</span> to = (<span class="predefined-type">Number</span>) entry.getTo();              <span class="comment">// Bucket to</span>
    <span class="type">long</span> docCount = entry.getDocCount();    <span class="comment">// Doc count</span>

    logger.info(<span class="string"><span class="delimiter">&quot;</span><span class="content">key [{}], from [{}], to [{}], doc_count [{}]</span><span class="delimiter">&quot;</span></span>, key, from, to, docCount);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will basically produce for the first example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">key [*-1.0], from [-Infinity], to [1.0], doc_count [9]
key [1.0-1.5], from [1.0], to [1.5], doc_count [21]
key [1.5-*], from [1.5], to [Infinity], doc_count [20]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-aggs-bucket-daterange"><a class="anchor" href="#java-aggs-bucket-daterange"></a>10.3.12. Date Range Aggregation</h4>
<div class="paragraph">
<p>Here is how you can use
<a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/search-aggregations-bucket-daterange-aggregation.html">Date Range Aggregation</a>
with Java API.</p>
</div>
<div class="sect4">
<h5 id="_prepare_aggregation_request_24"><a class="anchor" href="#_prepare_aggregation_request_24"></a>Prepare aggregation request</h5>
<div class="paragraph">
<p>Here is an example on how to create the aggregation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">AggregationBuilder aggregation =
        AggregationBuilders
                .dateRange(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>)
                .field(<span class="string"><span class="delimiter">&quot;</span><span class="content">dateOfBirth</span><span class="delimiter">&quot;</span></span>)
                .format(<span class="string"><span class="delimiter">&quot;</span><span class="content">yyyy</span><span class="delimiter">&quot;</span></span>)
                .addUnboundedTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">1950</span><span class="delimiter">&quot;</span></span>)    <span class="comment">// from -infinity to 1950 (excluded)</span>
                .addRange(<span class="string"><span class="delimiter">&quot;</span><span class="content">1950</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">1960</span><span class="delimiter">&quot;</span></span>)  <span class="comment">// from 1950 to 1960 (excluded)</span>
                .addUnboundedFrom(<span class="string"><span class="delimiter">&quot;</span><span class="content">1960</span><span class="delimiter">&quot;</span></span>); <span class="comment">// from 1960 to +infinity</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_use_aggregation_response_24"><a class="anchor" href="#_use_aggregation_response_24"></a>Use aggregation response</h5>
<div class="paragraph">
<p>Import Aggregation definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.elasticsearch.search.aggregations.bucket.range.Range</span>;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// sr is here your SearchResponse object</span>
Range agg = sr.getAggregations().get(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// For each entry</span>
<span class="keyword">for</span> (Range.Bucket entry : agg.getBuckets()) {
    <span class="predefined-type">String</span> key = entry.getKeyAsString();                <span class="comment">// Date range as key</span>
    DateTime fromAsDate = (DateTime) entry.getFrom();   <span class="comment">// Date bucket from as a Date</span>
    DateTime toAsDate = (DateTime) entry.getTo();       <span class="comment">// Date bucket to as a Date</span>
    <span class="type">long</span> docCount = entry.getDocCount();                <span class="comment">// Doc count</span>

    logger.info(<span class="string"><span class="delimiter">&quot;</span><span class="content">key [{}], from [{}], to [{}], doc_count [{}]</span><span class="delimiter">&quot;</span></span>, key, fromAsDate, toAsDate, docCount);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will basically produce:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">key [*-1950], from [null], to [1950-01-01T00:00:00.000Z], doc_count [8]
key [1950-1960], from [1950-01-01T00:00:00.000Z], to [1960-01-01T00:00:00.000Z], doc_count [5]
key [1960-*], from [1960-01-01T00:00:00.000Z], to [null], doc_count [37]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-aggs-bucket-iprange"><a class="anchor" href="#java-aggs-bucket-iprange"></a>10.3.13. Ip Range Aggregation</h4>
<div class="paragraph">
<p>Here is how you can use
<a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/search-aggregations-bucket-iprange-aggregation.html">Ip Range Aggregation</a>
with Java API.</p>
</div>
<div class="sect4">
<h5 id="_prepare_aggregation_request_25"><a class="anchor" href="#_prepare_aggregation_request_25"></a>Prepare aggregation request</h5>
<div class="paragraph">
<p>Here is an example on how to create the aggregation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">AggregationBuilder aggregation =
        AggregationBuilders
                .ipRange(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>)
                .field(<span class="string"><span class="delimiter">&quot;</span><span class="content">ip</span><span class="delimiter">&quot;</span></span>)
                .addUnboundedTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">192.168.1.0</span><span class="delimiter">&quot;</span></span>)             <span class="comment">// from -infinity to 192.168.1.0 (excluded)</span>
                .addRange(<span class="string"><span class="delimiter">&quot;</span><span class="content">192.168.1.0</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">192.168.2.0</span><span class="delimiter">&quot;</span></span>)    <span class="comment">// from 192.168.1.0 to 192.168.2.0 (excluded)</span>
                .addUnboundedFrom(<span class="string"><span class="delimiter">&quot;</span><span class="content">192.168.2.0</span><span class="delimiter">&quot;</span></span>);          <span class="comment">// from 192.168.2.0 to +infinity</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that you could also use ip masks as ranges:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">AggregationBuilder aggregation =
        AggregationBuilders
                .ipRange(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>)
                .field(<span class="string"><span class="delimiter">&quot;</span><span class="content">ip</span><span class="delimiter">&quot;</span></span>)
                .addMaskRange(<span class="string"><span class="delimiter">&quot;</span><span class="content">192.168.0.0/32</span><span class="delimiter">&quot;</span></span>)
                .addMaskRange(<span class="string"><span class="delimiter">&quot;</span><span class="content">192.168.0.0/24</span><span class="delimiter">&quot;</span></span>)
                .addMaskRange(<span class="string"><span class="delimiter">&quot;</span><span class="content">192.168.0.0/16</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_use_aggregation_response_25"><a class="anchor" href="#_use_aggregation_response_25"></a>Use aggregation response</h5>
<div class="paragraph">
<p>Import Aggregation definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.elasticsearch.search.aggregations.bucket.range.Range</span>;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// sr is here your SearchResponse object</span>
Range agg = sr.getAggregations().get(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// For each entry</span>
<span class="keyword">for</span> (Range.Bucket entry : agg.getBuckets()) {
    <span class="predefined-type">String</span> key = entry.getKeyAsString();            <span class="comment">// Ip range as key</span>
    <span class="predefined-type">String</span> fromAsString = entry.getFromAsString();  <span class="comment">// Ip bucket from as a String</span>
    <span class="predefined-type">String</span> toAsString = entry.getToAsString();      <span class="comment">// Ip bucket to as a String</span>
    <span class="type">long</span> docCount = entry.getDocCount();            <span class="comment">// Doc count</span>

    logger.info(<span class="string"><span class="delimiter">&quot;</span><span class="content">key [{}], from [{}], to [{}], doc_count [{}]</span><span class="delimiter">&quot;</span></span>, key, fromAsString, toAsString, docCount);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will basically produce for the first example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">key [*-192.168.1.0], from [null], to [192.168.1.0], doc_count [13]
key [192.168.1.0-192.168.2.0], from [192.168.1.0], to [192.168.2.0], doc_count [14]
key [192.168.2.0-*], from [192.168.2.0], to [null], doc_count [23]</code></pre>
</div>
</div>
<div class="paragraph">
<p>And for the second one (using Ip masks):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">key [192.168.0.0/32], from [192.168.0.0], to [192.168.0.1], doc_count [0]
key [192.168.0.0/24], from [192.168.0.0], to [192.168.1.0], doc_count [13]
key [192.168.0.0/16], from [192.168.0.0], to [192.169.0.0], doc_count [50]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-aggs-bucket-histogram"><a class="anchor" href="#java-aggs-bucket-histogram"></a>10.3.14. Histogram Aggregation</h4>
<div class="paragraph">
<p>Here is how you can use
<a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/search-aggregations-bucket-histogram-aggregation.html">Histogram Aggregation</a>
with Java API.</p>
</div>
<div class="sect4">
<h5 id="_prepare_aggregation_request_26"><a class="anchor" href="#_prepare_aggregation_request_26"></a>Prepare aggregation request</h5>
<div class="paragraph">
<p>Here is an example on how to create the aggregation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">AggregationBuilder aggregation =
        AggregationBuilders
                .histogram(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>)
                .field(<span class="string"><span class="delimiter">&quot;</span><span class="content">height</span><span class="delimiter">&quot;</span></span>)
                .interval(<span class="integer">1</span>);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_use_aggregation_response_26"><a class="anchor" href="#_use_aggregation_response_26"></a>Use aggregation response</h5>
<div class="paragraph">
<p>Import Aggregation definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.elasticsearch.search.aggregations.bucket.histogram.Histogram</span>;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// sr is here your SearchResponse object</span>
Histogram agg = sr.getAggregations().get(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// For each entry</span>
<span class="keyword">for</span> (Histogram.Bucket entry : agg.getBuckets()) {
    <span class="predefined-type">Long</span> key = (<span class="predefined-type">Long</span>) entry.getKey();       <span class="comment">// Key</span>
    <span class="type">long</span> docCount = entry.getDocCount();    <span class="comment">// Doc count</span>

    logger.info(<span class="string"><span class="delimiter">&quot;</span><span class="content">key [{}], doc_count [{}]</span><span class="delimiter">&quot;</span></span>, key, docCount);
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-aggs-bucket-datehistogram"><a class="anchor" href="#java-aggs-bucket-datehistogram"></a>10.3.15. Date Histogram Aggregation</h4>
<div class="paragraph">
<p>Here is how you can use
<a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/search-aggregations-bucket-datehistogram-aggregation.html">Date Histogram Aggregation</a>
with Java API.</p>
</div>
<div class="sect4">
<h5 id="_prepare_aggregation_request_27"><a class="anchor" href="#_prepare_aggregation_request_27"></a>Prepare aggregation request</h5>
<div class="paragraph">
<p>Here is an example on how to create the aggregation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">AggregationBuilder aggregation =
        AggregationBuilders
                .dateHistogram(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>)
                .field(<span class="string"><span class="delimiter">&quot;</span><span class="content">dateOfBirth</span><span class="delimiter">&quot;</span></span>)
                .interval(DateHistogramInterval.YEAR);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or if you want to set an interval of 10 days:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">AggregationBuilder aggregation =
        AggregationBuilders
                .dateHistogram(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>)
                .field(<span class="string"><span class="delimiter">&quot;</span><span class="content">dateOfBirth</span><span class="delimiter">&quot;</span></span>)
                .interval(DateHistogramInterval.days(<span class="integer">10</span>));</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_use_aggregation_response_27"><a class="anchor" href="#_use_aggregation_response_27"></a>Use aggregation response</h5>
<div class="paragraph">
<p>Import Aggregation definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.elasticsearch.search.aggregations.bucket.histogram.Histogram</span>;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// sr is here your SearchResponse object</span>
Histogram agg = sr.getAggregations().get(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// For each entry</span>
<span class="keyword">for</span> (Histogram.Bucket entry : agg.getBuckets()) {
    DateTime key = (DateTime) entry.getKey();    <span class="comment">// Key</span>
    <span class="predefined-type">String</span> keyAsString = entry.getKeyAsString(); <span class="comment">// Key as String</span>
    <span class="type">long</span> docCount = entry.getDocCount();         <span class="comment">// Doc count</span>

    logger.info(<span class="string"><span class="delimiter">&quot;</span><span class="content">key [{}], date [{}], doc_count [{}]</span><span class="delimiter">&quot;</span></span>, keyAsString, key.getYear(), docCount);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will basically produce for the first example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">key [1942-01-01T00:00:00.000Z], date [1942], doc_count [1]
key [1945-01-01T00:00:00.000Z], date [1945], doc_count [1]
key [1946-01-01T00:00:00.000Z], date [1946], doc_count [1]
...
key [2005-01-01T00:00:00.000Z], date [2005], doc_count [1]
key [2007-01-01T00:00:00.000Z], date [2007], doc_count [2]
key [2008-01-01T00:00:00.000Z], date [2008], doc_count [3]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-aggs-bucket-geodistance"><a class="anchor" href="#java-aggs-bucket-geodistance"></a>10.3.16. Geo Distance Aggregation</h4>
<div class="paragraph">
<p>Here is how you can use
<a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/search-aggregations-bucket-geodistance-aggregation.html">Geo Distance Aggregation</a>
with Java API.</p>
</div>
<div class="sect4">
<h5 id="_prepare_aggregation_request_28"><a class="anchor" href="#_prepare_aggregation_request_28"></a>Prepare aggregation request</h5>
<div class="paragraph">
<p>Here is an example on how to create the aggregation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">AggregationBuilder aggregation =
        AggregationBuilders
                .geoDistance(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>)
                .field(<span class="string"><span class="delimiter">&quot;</span><span class="content">address.location</span><span class="delimiter">&quot;</span></span>)
                .point(<span class="keyword">new</span> GeoPoint(<span class="float">48.84237171118314</span>,<span class="float">2.33320027692004</span>))
                .unit(DistanceUnit.KILOMETERS)
                .addUnboundedTo(<span class="float">3.0</span>)
                .addRange(<span class="float">3.0</span>, <span class="float">10.0</span>)
                .addRange(<span class="float">10.0</span>, <span class="float">500.0</span>);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_use_aggregation_response_28"><a class="anchor" href="#_use_aggregation_response_28"></a>Use aggregation response</h5>
<div class="paragraph">
<p>Import Aggregation definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.elasticsearch.search.aggregations.bucket.range.Range</span>;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// sr is here your SearchResponse object</span>
Range agg = sr.getAggregations().get(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// For each entry</span>
<span class="keyword">for</span> (Range.Bucket entry : agg.getBuckets()) {
    <span class="predefined-type">String</span> key = entry.getKeyAsString();    <span class="comment">// key as String</span>
    <span class="predefined-type">Number</span> from = (<span class="predefined-type">Number</span>) entry.getFrom(); <span class="comment">// bucket from value</span>
    <span class="predefined-type">Number</span> to = (<span class="predefined-type">Number</span>) entry.getTo();     <span class="comment">// bucket to value</span>
    <span class="type">long</span> docCount = entry.getDocCount();    <span class="comment">// Doc count</span>

    logger.info(<span class="string"><span class="delimiter">&quot;</span><span class="content">key [{}], from [{}], to [{}], doc_count [{}]</span><span class="delimiter">&quot;</span></span>, key, from, to, docCount);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will basically produce:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">key [*-3.0], from [0.0], to [3.0], doc_count [161]
key [3.0-10.0], from [3.0], to [10.0], doc_count [460]
key [10.0-500.0], from [10.0], to [500.0], doc_count [4925]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-aggs-bucket-geohashgrid"><a class="anchor" href="#java-aggs-bucket-geohashgrid"></a>10.3.17. Geo Hash Grid Aggregation</h4>
<div class="paragraph">
<p>Here is how you can use
<a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/search-aggregations-bucket-geohashgrid-aggregation.html">Geo Hash Grid Aggregation</a>
with Java API.</p>
</div>
<div class="sect4">
<h5 id="_prepare_aggregation_request_29"><a class="anchor" href="#_prepare_aggregation_request_29"></a>Prepare aggregation request</h5>
<div class="paragraph">
<p>Here is an example on how to create the aggregation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">AggregationBuilder aggregation =
        AggregationBuilders
                .geohashGrid(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>)
                .field(<span class="string"><span class="delimiter">&quot;</span><span class="content">address.location</span><span class="delimiter">&quot;</span></span>)
                .precision(<span class="integer">4</span>);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_use_aggregation_response_29"><a class="anchor" href="#_use_aggregation_response_29"></a>Use aggregation response</h5>
<div class="paragraph">
<p>Import Aggregation definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.elasticsearch.search.aggregations.bucket.geogrid.GeoHashGrid</span>;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// sr is here your SearchResponse object</span>
GeoHashGrid agg = sr.getAggregations().get(<span class="string"><span class="delimiter">&quot;</span><span class="content">agg</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// For each entry</span>
<span class="keyword">for</span> (GeoHashGrid.Bucket entry : agg.getBuckets()) {
    <span class="predefined-type">String</span> keyAsString = entry.getKeyAsString(); <span class="comment">// key as String</span>
    GeoPoint key = (GeoPoint) entry.getKey();    <span class="comment">// key as geo point</span>
    <span class="type">long</span> docCount = entry.getDocCount();         <span class="comment">// Doc count</span>

    logger.info(<span class="string"><span class="delimiter">&quot;</span><span class="content">key [{}], point {}, doc_count [{}]</span><span class="delimiter">&quot;</span></span>, keyAsString, key, docCount);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will basically produce:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">key [gbqu], point [47.197265625, -1.58203125], doc_count [1282]
key [gbvn], point [50.361328125, -4.04296875], doc_count [1248]
key [u1j0], point [50.712890625, 7.20703125], doc_count [1156]
key [u0j2], point [45.087890625, 7.55859375], doc_count [1138]
...</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="percolate"><a class="anchor" href="#percolate"></a>11. Percolate API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The percolator allows one to register queries against an index, and then
send <code>percolate</code> requests which include a doc, getting back the
queries that match on that doc out of the set of registered queries.</p>
</div>
<div class="paragraph">
<p>Read the main <a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/search-percolate.html">percolate</a>
documentation before reading this guide.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">//This is the query we're registering in the percolator</span>
QueryBuilder qb = termQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">content</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">amazing</span><span class="delimiter">&quot;</span></span>);

<span class="comment">//Index the query = register it in the percolator</span>
client.prepareIndex(<span class="string"><span class="delimiter">&quot;</span><span class="content">myIndexName</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">.percolator</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">myDesignatedQueryName</span><span class="delimiter">&quot;</span></span>)
    .setSource(jsonBuilder()
        .startObject()
            .field(<span class="string"><span class="delimiter">&quot;</span><span class="content">query</span><span class="delimiter">&quot;</span></span>, qb) <span class="comment">// Register the query</span>
        .endObject())
    .setRefresh(<span class="predefined-constant">true</span>) <span class="comment">// Needed when the query shall be available immediately</span>
    .execute().actionGet();</code></pre>
</div>
</div>
<div class="paragraph">
<p>This indexes the above term query under the name
<strong>myDesignatedQueryName</strong>.</p>
</div>
<div class="paragraph">
<p>In order to check a document against the registered queries, use this
code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">//Build a document to check against the percolator</span>
XContentBuilder docBuilder = XContentFactory.jsonBuilder().startObject();
docBuilder.field(<span class="string"><span class="delimiter">&quot;</span><span class="content">doc</span><span class="delimiter">&quot;</span></span>).startObject(); <span class="comment">//This is needed to designate the document</span>
docBuilder.field(<span class="string"><span class="delimiter">&quot;</span><span class="content">content</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">This is amazing!</span><span class="delimiter">&quot;</span></span>);
docBuilder.endObject(); <span class="comment">//End of the doc field</span>
docBuilder.endObject(); <span class="comment">//End of the JSON root object</span>
<span class="comment">//Percolate</span>
PercolateResponse response = client.preparePercolate()
                        .setIndices(<span class="string"><span class="delimiter">&quot;</span><span class="content">myIndexName</span><span class="delimiter">&quot;</span></span>)
                        .setDocumentType(<span class="string"><span class="delimiter">&quot;</span><span class="content">myDocumentType</span><span class="delimiter">&quot;</span></span>)
                        .setSource(docBuilder).execute().actionGet();
<span class="comment">//Iterate over the results</span>
<span class="keyword">for</span>(PercolateResponse.Match match : response) {
    <span class="comment">//Handle the result which is the name of</span>
    <span class="comment">//the query in the percolator</span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="java-query-dsl"><a class="anchor" href="#java-query-dsl"></a>12. Query DSL</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Elasticsearch provides a full Java query dsl in a similar manner to the
REST <a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/query-dsl.html">Query DSL</a>. The factory for query
builders is <code>QueryBuilders</code>. Once your query is ready, you can use the
<a href="#java-search">Search API</a>.</p>
</div>
<div class="paragraph">
<p>To use <code>QueryBuilders</code> just import them in your class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">static</span> <span class="include">org.elasticsearch.index.query.QueryBuilders</span>.*;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that you can easily print (aka debug) JSON generated queries using
<code>toString()</code> method on <code>QueryBuilder</code> object.</p>
</div>
<div class="paragraph">
<p>The <code>QueryBuilder</code> can then be used with any API that accepts a query,
such as <code>count</code> and <code>search</code>.</p>
</div>
<div class="sect2">
<h3 id="java-query-dsl-match-all-query"><a class="anchor" href="#java-query-dsl-match-all-query"></a>12.1. Match All Query</h3>
<div class="paragraph">
<p>See <a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/query-dsl-match-all-query.html">Match All Query</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">QueryBuilder qb = matchAllQuery();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="java-full-text-queries"><a class="anchor" href="#java-full-text-queries"></a>12.2. Full text queries</h3>
<div class="paragraph">
<p>The high-level full text queries are usually used for running full text
queries on full text fields like the body of an email. They understand how the
field being queried is analyzed and will apply each field&#8217;s
<code>analyzer</code> (or <code>search_analyzer</code>) to the query string before executing.</p>
</div>
<div class="paragraph">
<p>The queries in this group are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="#java-query-dsl-match-query"><code>match</code> query</a></dt>
<dd>
<p>The standard query for performing full text queries, including fuzzy matching
and phrase or proximity queries.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-multi-match-query"><code>multi_match</code> query</a></dt>
<dd>
<p>The multi-field version of the <code>match</code> query.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-common-terms-query"><code>common_terms</code> query</a></dt>
<dd>
<p>A more specialized query which gives more preference to uncommon words.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-query-string-query"><code>query_string</code> query</a></dt>
<dd>
<p>Supports the compact Lucene query string syntax,
allowing you to specify AND|OR|NOT conditions and multi-field search
within a single query string. For expert users only.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-simple-query-string-query"><code>simple_query_string</code></a></dt>
<dd>
<p>A simpler, more robust version of the <code>query_string</code> syntax suitable
for exposing directly to users.</p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="java-query-dsl-match-query"><a class="anchor" href="#java-query-dsl-match-query"></a>12.2.1. Match Query</h4>
<div class="paragraph">
<p>See <a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/query-dsl-match-query.html">Match Query</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">QueryBuilder qb = matchQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>,                  <img src="./images/icons/callouts/1.png" alt="1">
    <span class="string"><span class="delimiter">&quot;</span><span class="content">kimchy elasticsearch</span><span class="delimiter">&quot;</span></span>   <img src="./images/icons/callouts/2.png" alt="2">
);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>field</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>text</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-multi-match-query"><a class="anchor" href="#java-query-dsl-multi-match-query"></a>12.2.2. Multi Match Query</h4>
<div class="paragraph">
<p>See <a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/query-dsl-multi-match-query.html">Multi Match Query</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">QueryBuilder qb = multiMatchQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">kimchy elasticsearch</span><span class="delimiter">&quot;</span></span>, <img src="./images/icons/callouts/1.png" alt="1">
    <span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">message</span><span class="delimiter">&quot;</span></span>       <img src="./images/icons/callouts/2.png" alt="2">
);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>text</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>fields</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-common-terms-query"><a class="anchor" href="#java-query-dsl-common-terms-query"></a>12.2.3. Common Terms Query</h4>
<div class="paragraph">
<p>See <a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/query-dsl-common-terms-query.html">Common Terms Query</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">QueryBuilder qb = commonTermsQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>,    <img src="./images/icons/callouts/1.png" alt="1">
                                   <span class="string"><span class="delimiter">&quot;</span><span class="content">kimchy</span><span class="delimiter">&quot;</span></span>); <img src="./images/icons/callouts/2.png" alt="2"></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>field</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>value</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-query-string-query"><a class="anchor" href="#java-query-dsl-query-string-query"></a>12.2.4. Query String Query</h4>
<div class="paragraph">
<p>See <a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/query-dsl-query-string-query.html">Query String Query</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">QueryBuilder qb = queryStringQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">+kimchy -elasticsearch</span><span class="delimiter">&quot;</span></span>);    <img src="./images/icons/callouts/1.png" alt="1"></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>text</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-simple-query-string-query"><a class="anchor" href="#java-query-dsl-simple-query-string-query"></a>12.2.5. Simple Query String Query</h4>
<div class="paragraph">
<p>See <a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/query-dsl-simple-query-string-query.html">Simple Query String Query</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">QueryBuilder qb = simpleQueryStringQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">+kimchy -elasticsearch</span><span class="delimiter">&quot;</span></span>);    <img src="./images/icons/callouts/1.png" alt="1"></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>text</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="java-term-level-queries"><a class="anchor" href="#java-term-level-queries"></a>12.3. Term level queries</h3>
<div class="paragraph">
<p>While the <a href="#java-full-text-queries">full text queries</a> will analyze the query
string before executing, the <em>term-level queries</em> operate on the exact terms
that are stored in the inverted index.</p>
</div>
<div class="paragraph">
<p>These queries are usually used for structured data like numbers, dates, and
enums, rather than full text fields.  Alternatively, they allow you to craft
low-level queries, foregoing the analysis process.</p>
</div>
<div class="paragraph">
<p>The queries in this group are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="#java-query-dsl-term-query"><code>term</code> query</a></dt>
<dd>
<p>Find documents which contain the exact term specified in the field
specified.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-terms-query"><code>terms</code> query</a></dt>
<dd>
<p>Find documents which contain any of the exact terms specified in the field
specified.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-range-query"><code>range</code> query</a></dt>
<dd>
<p>Find documents where the field specified contains values (dates, numbers,
or strings) in the range specified.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-exists-query"><code>exists</code> query</a></dt>
<dd>
<p>Find documents where the field specified contains any non-null value.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-missing-query"><code>missing</code> query</a></dt>
<dd>
<p>Find documents where the field specified does is missing or contains only
<code>null</code> values.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-prefix-query"><code>prefix</code> query</a></dt>
<dd>
<p>Find documents where the field specified contains terms which being with
the exact prefix specified.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-wildcard-query"><code>wildcard</code> query</a></dt>
<dd>
<p>Find documents where the field specified contains terms which match the
pattern specified, where the pattern supports single character wildcards
(<code>?</code>) and multi-character wildcards (<code>*</code>)</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-regexp-query"><code>regexp</code> query</a></dt>
<dd>
<p>Find documents where the field specified contains terms which match the
regular expression specified.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-fuzzy-query"><code>fuzzy</code> query</a></dt>
<dd>
<p>Find documents where the field specified contains terms which are fuzzily
similar to the specified term.  Fuzziness is measured as a
<a href="http://en.wikipedia.org/wiki/Damerau%E2%80%93Levenshtein_distance">Levenshtein edit distance</a>
of 1 or 2.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-type-query"><code>type</code> query</a></dt>
<dd>
<p>Find documents of the specified type.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-ids-query"><code>ids</code> query</a></dt>
<dd>
<p>Find documents with the specified type and IDs.</p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="java-query-dsl-term-query"><a class="anchor" href="#java-query-dsl-term-query"></a>12.3.1. Term Query</h4>
<div class="paragraph">
<p>See <a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/query-dsl-term-query.html">Term Query</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">QueryBuilder qb = term(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>,    <img src="./images/icons/callouts/1.png" alt="1">
    <span class="string"><span class="delimiter">&quot;</span><span class="content">kimchy</span><span class="delimiter">&quot;</span></span>   <img src="./images/icons/callouts/2.png" alt="2">
);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>field</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>text</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-terms-query"><a class="anchor" href="#java-query-dsl-terms-query"></a>12.3.2. Terms Query</h4>
<div class="paragraph">
<p>See <a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/query-dsl-terms-query.html">Terms Query</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">QueryBuilder qb = termsQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">tags</span><span class="delimiter">&quot;</span></span>,    <img src="./images/icons/callouts/1.png" alt="1">
    <span class="string"><span class="delimiter">&quot;</span><span class="content">blue</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">pill</span><span class="delimiter">&quot;</span></span>);                    <img src="./images/icons/callouts/2.png" alt="2"></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>field</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>values</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-range-query"><a class="anchor" href="#java-query-dsl-range-query"></a>12.3.3. Range Query</h4>
<div class="paragraph">
<p>See <a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/query-dsl-range-query.html">Range Query</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">QueryBuilder qb = rangeQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">price</span><span class="delimiter">&quot;</span></span>)   <img src="./images/icons/callouts/1.png" alt="1">
    .from(<span class="integer">5</span>)                            <img src="./images/icons/callouts/2.png" alt="2">
    .to(<span class="integer">10</span>)                             <img src="./images/icons/callouts/3.png" alt="3">
    .includeLower(<span class="predefined-constant">true</span>)                 <img src="./images/icons/callouts/4.png" alt="4">
    .includeUpper(<span class="predefined-constant">false</span>);               <img src="./images/icons/callouts/5.png" alt="5"></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>field</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>from</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/3.png" alt="3"></td>
<td>to</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/4.png" alt="4"></td>
<td>include lower value means that <code>from</code> is <code>gt</code> when <code>false</code> or <code>gte</code> when <code>true</code></td>
</tr>
<tr>
<td><img src="./images/icons/callouts/5.png" alt="5"></td>
<td>include upper value means that <code>to</code> is <code>lt</code> when <code>false</code> or <code>lte</code> when <code>true</code></td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// A simplified form using gte, gt, lt or lte</span>
QueryBuilder qb = rangeQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>)   <img src="./images/icons/callouts/1.png" alt="1">
    .gte(<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span>)                        <img src="./images/icons/callouts/2.png" alt="2">
    .lt(<span class="string"><span class="delimiter">&quot;</span><span class="content">20</span><span class="delimiter">&quot;</span></span>);                        <img src="./images/icons/callouts/3.png" alt="3"></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>field</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>set <code>from</code> to 10 and <code>includeLower</code> to <code>true</code></td>
</tr>
<tr>
<td><img src="./images/icons/callouts/3.png" alt="3"></td>
<td>set <code>to</code> to 20 and <code>includeUpper</code> to <code>false</code></td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-exists-query"><a class="anchor" href="#java-query-dsl-exists-query"></a>12.3.4. Exists Query</h4>
<div class="paragraph">
<p>See <a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/query-dsl-exists-query.html">Exists Query</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">QueryBuilder qb = existsQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>);       <img src="./images/icons/callouts/1.png" alt="1"></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>field</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-missing-query"><a class="anchor" href="#java-query-dsl-missing-query"></a>12.3.5. Missing Query</h4>
<div class="paragraph">
<p>deprecated[2.2.0, Use <code>exists</code> query inside a <code>must_not</code> clause instead]</p>
</div>
<div class="paragraph">
<p>See <a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/query-dsl-missing-query.html">Missing Query</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">QueryBuilder qb = missingQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>);         <img src="./images/icons/callouts/1.png" alt="1">
    .existence(<span class="predefined-constant">true</span>)                            <img src="./images/icons/callouts/2.png" alt="2">
    .nullValue(<span class="predefined-constant">true</span>);                           <img src="./images/icons/callouts/3.png" alt="3"></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>field</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>find missing field that doesn’t exist</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/3.png" alt="3"></td>
<td>find missing field with an explicit <code>null</code> value</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-prefix-query"><a class="anchor" href="#java-query-dsl-prefix-query"></a>12.3.6. Prefix Query</h4>
<div class="paragraph">
<p>See <a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/query-dsl-prefix-query.html">Prefix Query</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">QueryBuilder qb = prefixQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">brand</span><span class="delimiter">&quot;</span></span>,    <img src="./images/icons/callouts/1.png" alt="1">
    <span class="string"><span class="delimiter">&quot;</span><span class="content">heine</span><span class="delimiter">&quot;</span></span>     <img src="./images/icons/callouts/2.png" alt="2">
);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>field</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>prefix</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-wildcard-query"><a class="anchor" href="#java-query-dsl-wildcard-query"></a>12.3.7. Wildcard Query</h4>
<div class="paragraph">
<p>See <a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/query-dsl-wildcard-query.html">Wildcard Query</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">QueryBuilder qb = wildcardQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">k?mc*</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-regexp-query"><a class="anchor" href="#java-query-dsl-regexp-query"></a>12.3.8. Regexp Query</h4>
<div class="paragraph">
<p>See <a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/query-dsl-regexp-query.html">Regexp Query</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">QueryBuilder qb = regexpQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">name.first</span><span class="delimiter">&quot;</span></span>,        <img src="./images/icons/callouts/1.png" alt="1">
    <span class="string"><span class="delimiter">&quot;</span><span class="content">s.*y</span><span class="delimiter">&quot;</span></span>);             <img src="./images/icons/callouts/2.png" alt="2"></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>field</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>regexp</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-fuzzy-query"><a class="anchor" href="#java-query-dsl-fuzzy-query"></a>12.3.9. Fuzzy Query</h4>
<div class="paragraph">
<p>See <a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/query-dsl-fuzzy-query.html">Fuzzy Query</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">QueryBuilder qb = fuzzyQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>,     <img src="./images/icons/callouts/1.png" alt="1">
    <span class="string"><span class="delimiter">&quot;</span><span class="content">kimzhy</span><span class="delimiter">&quot;</span></span>    <img src="./images/icons/callouts/2.png" alt="2">
);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>field</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>text</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-type-query"><a class="anchor" href="#java-query-dsl-type-query"></a>12.3.10. Type Query</h4>
<div class="paragraph">
<p>See <a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/query-dsl-type-query.html">Type Query</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">QueryBuilder qb = typeQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">my_type</span><span class="delimiter">&quot;</span></span>); <img src="./images/icons/callouts/1.png" alt="1"></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>type</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-ids-query"><a class="anchor" href="#java-query-dsl-ids-query"></a>12.3.11. Ids Query</h4>
<div class="paragraph">
<p>See <a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/query-dsl-ids-query.html">Ids Query</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">QueryBuilder qb = idsQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">my_type</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">type2</span><span class="delimiter">&quot;</span></span>)
    .addIds(<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">4</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">100</span><span class="delimiter">&quot;</span></span>);

QueryBuilder qb = idsQuery() <img src="./images/icons/callouts/1.png" alt="1">
    .addIds(<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">4</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">100</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>type is optional</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="java-compound-queries"><a class="anchor" href="#java-compound-queries"></a>12.4. Compound queries</h3>
<div class="paragraph">
<p>Compound queries wrap other compound or leaf queries, either to combine their
results and scores, to change their behaviour, or to switch from query to
filter context.</p>
</div>
<div class="paragraph">
<p>The queries in this group are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="#java-query-dsl-constant-score-query"><code>constant_score</code> query</a></dt>
<dd>
<p>A query which wraps another query, but executes it in filter context.  All
matching documents are given the same &#8220;constant&#8221; <code>_score</code>.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-bool-query"><code>bool</code> query</a></dt>
<dd>
<p>The default query for combining multiple leaf or compound query clauses, as
<code>must</code>, <code>should</code>, <code>must_not</code>, or <code>filter</code> clauses.  The <code>must</code> and <code>should</code>
clauses have their scores combined&#8201;&#8212;&#8201;the more matching clauses, the better&#8201;&#8212;&#8201;while the <code>must_not</code> and <code>filter</code> clauses are executed in filter context.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-dis-max-query"><code>dis_max</code> query</a></dt>
<dd>
<p>A query which accepts multiple queries, and returns any documents which match
any of the query clauses.  While the <code>bool</code> query combines the scores from all
matching queries, the <code>dis_max</code> query uses the score of the single best-
matching query clause.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-function-score-query"><code>function_score</code> query</a></dt>
<dd>
<p>Modify the scores returned by the main query with functions to take into
account factors like popularity, recency, distance, or custom algorithms
implemented with scripting.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-boosting-query"><code>boosting</code> query</a></dt>
<dd>
<p>Return documents which match a <code>positive</code> query, but reduce the score of
documents which also match a <code>negative</code> query.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-indices-query"><code>indices</code> query</a></dt>
<dd>
<p>Execute one query for the specified indices, and another for other indices.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-and-query"><code>and</code></a>, <a href="#java-query-dsl-or-query"><code>or</code></a>, <a href="#java-query-dsl-not-query"><code>not</code></a></dt>
<dd>
<p>Synonyms for the <code>bool</code> query.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-filtered-query"><code>filtered</code> query</a></dt>
<dd>
<p>Combine a query clause in query context with another in filter context. deprecated[2.0.0,Use the <code>bool</code> query instead]</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-limit-query"><code>limit</code> query</a></dt>
<dd>
<p>Limits the number of documents examined per shard.</p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="java-query-dsl-constant-score-query"><a class="anchor" href="#java-query-dsl-constant-score-query"></a>12.4.1. Constant Score Query</h4>
<div class="paragraph">
<p>See <a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/query-dsl-constant-score-query.html">Constant Score Query</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">QueryBuilder qb = constantScoreQuery(
        termQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">kimchy</span><span class="delimiter">&quot;</span></span>)      <img src="./images/icons/callouts/1.png" alt="1">
    )
    .boost(<span class="float">2.0f</span>);                       <img src="./images/icons/callouts/2.png" alt="2"></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>your query</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>query score
==== Bool Query</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See <a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/query-dsl-bool-query.html">Bool Query</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">QueryBuilder qb = boolQuery()
    .must(termQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">content</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">test1</span><span class="delimiter">&quot;</span></span>))    <img src="./images/icons/callouts/1.png" alt="1">
    .must(termQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">content</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">test4</span><span class="delimiter">&quot;</span></span>))    <img src="./images/icons/callouts/1.png" alt="1">
    .mustNot(termQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">content</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">test2</span><span class="delimiter">&quot;</span></span>)) <img src="./images/icons/callouts/2.png" alt="2">
    .should(termQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">content</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">test3</span><span class="delimiter">&quot;</span></span>)); <img src="./images/icons/callouts/3.png" alt="3"></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>must query</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>must not query</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/3.png" alt="3"></td>
<td>should query</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-dis-max-query"><a class="anchor" href="#java-query-dsl-dis-max-query"></a>12.4.2. Dis Max Query</h4>
<div class="paragraph">
<p>See <a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/query-dsl-dis-max-query.html">Dis Max Query</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">QueryBuilder qb = disMaxQuery()
    .add(termQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">kimchy</span><span class="delimiter">&quot;</span></span>))        <img src="./images/icons/callouts/1.png" alt="1">
    .add(termQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">elasticsearch</span><span class="delimiter">&quot;</span></span>)) <img src="./images/icons/callouts/2.png" alt="2">
    .boost(<span class="float">1.2f</span>)                             <img src="./images/icons/callouts/3.png" alt="3">
    .tieBreaker(<span class="float">0.7f</span>);                       <img src="./images/icons/callouts/4.png" alt="4"></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>add your queries</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>add your queries</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/3.png" alt="3"></td>
<td>boost factor</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/4.png" alt="4"></td>
<td>tie breaker
==== Function Score Query</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See <a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/query-dsl-function-score-query.html">Function Score Query</a>.</p>
</div>
<div class="paragraph">
<p>To use <code>ScoreFunctionBuilders</code> just import them in your class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">static</span> <span class="include">org.elasticsearch.index.query.functionscore.ScoreFunctionBuilders</span>.*;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">QueryBuilder qb = functionScoreQuery()
    .add(
        matchQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">kimchy</span><span class="delimiter">&quot;</span></span>),             <img src="./images/icons/callouts/1.png" alt="1">
        randomFunction(<span class="string"><span class="delimiter">&quot;</span><span class="content">ABCDEF</span><span class="delimiter">&quot;</span></span>)                  <img src="./images/icons/callouts/2.png" alt="2">
    )
    .add(
        exponentialDecayFunction(<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>, <span class="integer">0L</span>, <span class="integer">1L</span>)   <img src="./images/icons/callouts/3.png" alt="3">
    );</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>Add a first function based on a query</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>And randomize the score based on a given seed</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/3.png" alt="3"></td>
<td>Add another function based on the age field</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-boosting-query"><a class="anchor" href="#java-query-dsl-boosting-query"></a>12.4.3. Boosting Query</h4>
<div class="paragraph">
<p>See <a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/query-dsl-boosting-query.html">Boosting Query</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">QueryBuilder qb = boostingQuery()
    .positive(termQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">kimchy</span><span class="delimiter">&quot;</span></span>))   <img src="./images/icons/callouts/1.png" alt="1">
    .negative(termQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">dadoonet</span><span class="delimiter">&quot;</span></span>)) <img src="./images/icons/callouts/2.png" alt="2">
    .negativeBoost(<span class="float">0.2f</span>);                   <img src="./images/icons/callouts/3.png" alt="3"></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>query that will promote documents</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>query that will demote documents</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/3.png" alt="3"></td>
<td>negative boost</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-indices-query"><a class="anchor" href="#java-query-dsl-indices-query"></a>12.4.4. Indices Query</h4>
<div class="paragraph">
<p>See <a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/query-dsl-indices-query.html">Indices Query</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Using another query when no match for the main one</span>
QueryBuilder qb = indicesQuery(
        termQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">tag</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">wow</span><span class="delimiter">&quot;</span></span>),             <img src="./images/icons/callouts/1.png" alt="1">
        <span class="string"><span class="delimiter">&quot;</span><span class="content">index1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">index2</span><span class="delimiter">&quot;</span></span>                   <img src="./images/icons/callouts/2.png" alt="2">
    ).noMatchQuery(termQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">tag</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">kow</span><span class="delimiter">&quot;</span></span>)); <img src="./images/icons/callouts/3.png" alt="3"></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>query to be executed on selected indices</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>selected indices</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/3.png" alt="3"></td>
<td>query to be executed on non matching indices</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Using all (match all) or none (match no documents)</span>
QueryBuilder qb = indicesQuery(
        termQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">tag</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">wow</span><span class="delimiter">&quot;</span></span>),            <img src="./images/icons/callouts/1.png" alt="1">
        <span class="string"><span class="delimiter">&quot;</span><span class="content">index1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">index2</span><span class="delimiter">&quot;</span></span>                  <img src="./images/icons/callouts/2.png" alt="2">
    ).noMatchQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">all</span><span class="delimiter">&quot;</span></span>);                  <img src="./images/icons/callouts/3.png" alt="3"></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>query to be executed on selected indices</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>selected indices</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/3.png" alt="3"></td>
<td><code>none</code> (to match no documents), and <code>all</code> (to match all documents). Defaults to <code>all</code>.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-and-query"><a class="anchor" href="#java-query-dsl-and-query"></a>12.4.5. And Query</h4>
<div class="paragraph">
<p>deprecated[2.0.0, Use the <code>bool</code> query instead]</p>
</div>
<div class="paragraph">
<p>See <a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/query-dsl-and-query.html">And Query</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">QueryBuilder query = andQuery(
    rangeQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">postDate</span><span class="delimiter">&quot;</span></span>).from(<span class="string"><span class="delimiter">&quot;</span><span class="content">2010-03-01</span><span class="delimiter">&quot;</span></span>).to(<span class="string"><span class="delimiter">&quot;</span><span class="content">2010-04-01</span><span class="delimiter">&quot;</span></span>),    <img src="./images/icons/callouts/1.png" alt="1">
    prefixQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">name.second</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">ba</span><span class="delimiter">&quot;</span></span>));                             <img src="./images/icons/callouts/1.png" alt="1"></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>queries</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-not-query"><a class="anchor" href="#java-query-dsl-not-query"></a>12.4.6. Not Query</h4>
<div class="paragraph">
<p>deprecated[2.1.0, Use <code>boolQuery()</code> with added <code>mustNot()</code> clause instead]</p>
</div>
<div class="paragraph">
<p>See <a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/query-dsl-not-query.html">Not Query</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">QueryBuilder qb = notQuery(
    rangeQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">price</span><span class="delimiter">&quot;</span></span>).from(<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>).to(<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>)  <img src="./images/icons/callouts/1.png" alt="1">
);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>query</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-or-query"><a class="anchor" href="#java-query-dsl-or-query"></a>12.4.7. Or Query</h4>
<div class="paragraph">
<p>deprecated[2.0.0, Use the <code>bool</code> query instead]</p>
</div>
<div class="paragraph">
<p>See <a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/query-dsl-or-query.html">Or Query</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">QueryBuilder qb = orQuery(
    rangeQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">price</span><span class="delimiter">&quot;</span></span>).from(<span class="integer">1</span>).to(<span class="integer">2</span>),  <img src="./images/icons/callouts/1.png" alt="1">
    matchQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">joe</span><span class="delimiter">&quot;</span></span>)           <img src="./images/icons/callouts/1.png" alt="1">
);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>queries</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-filtered-query"><a class="anchor" href="#java-query-dsl-filtered-query"></a>12.4.8. Filtered Query</h4>
<div class="paragraph">
<p>deprecated[2.0.0, Use the <code>bool</code> query instead with a <code>must</code> clause for the query and a <code>filter</code> clause for the filter]</p>
</div>
<div class="paragraph">
<p>See <a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/query-dsl-filtered-query.html">Filtered Query</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">QueryBuilder qb = filteredQuery(
        matchQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">kimchy</span><span class="delimiter">&quot;</span></span>),                       <img src="./images/icons/callouts/1.png" alt="1">
        rangeQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">dateOfBirth</span><span class="delimiter">&quot;</span></span>).from(<span class="string"><span class="delimiter">&quot;</span><span class="content">1900</span><span class="delimiter">&quot;</span></span>).to(<span class="string"><span class="delimiter">&quot;</span><span class="content">2100</span><span class="delimiter">&quot;</span></span>)   <img src="./images/icons/callouts/2.png" alt="2">
);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>query which will be used for scoring</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>query which will only be used for filtering the result set</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-limit-query"><a class="anchor" href="#java-query-dsl-limit-query"></a>12.4.9. Limit Query</h4>
<div class="paragraph">
<p>See <a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/query-dsl-limit-query.html">Limit Query</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">QueryBuilder qb = limitQuery(<span class="integer">100</span>);   <img src="./images/icons/callouts/1.png" alt="1"></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>number of documents per shard</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="java-joining-queries"><a class="anchor" href="#java-joining-queries"></a>12.5. Joining queries</h3>
<div class="paragraph">
<p>Performing full SQL-style joins in a distributed system like Elasticsearch is
prohibitively expensive.  Instead, Elasticsearch offers two forms of join
which are designed to scale horizontally.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="#java-query-dsl-nested-query"><code>nested</code> query</a></dt>
<dd>
<p>Documents may contains fields of type <code>nested</code>. These
fields are used to index arrays of objects, where each object can be queried
(with the <code>nested</code> query) as an independent document.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-has-child-query"><code>has_child</code></a> and <a href="#java-query-dsl-has-parent-query"><code>has_parent</code></a> queries</dt>
<dd>
<p>A parent-child relationship can exist between two
document types within a single index. The <code>has_child</code> query returns parent
documents whose child documents match the specified query, while the
<code>has_parent</code> query returns child documents whose parent document matches the
specified query.</p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="java-query-dsl-nested-query"><a class="anchor" href="#java-query-dsl-nested-query"></a>12.5.1. Nested Query</h4>
<div class="paragraph">
<p>See <a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/query-dsl-nested-query.html">Nested Query</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">QueryBuilder qb = nestedQuery(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">obj1</span><span class="delimiter">&quot;</span></span>,               <img src="./images/icons/callouts/1.png" alt="1">
        boolQuery()           <img src="./images/icons/callouts/2.png" alt="2">
                .must(matchQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">obj1.name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">blue</span><span class="delimiter">&quot;</span></span>))
                .must(rangeQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">obj1.count</span><span class="delimiter">&quot;</span></span>).gt(<span class="integer">5</span>))
    )
    .scoreMode(<span class="string"><span class="delimiter">&quot;</span><span class="content">avg</span><span class="delimiter">&quot;</span></span>);        <img src="./images/icons/callouts/3.png" alt="3"></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>path to nested document</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>your query. Any fields referenced inside the query must use the complete path (fully qualified).</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/3.png" alt="3"></td>
<td>score mode could be <code>max</code>, <code>total</code>, <code>avg</code> (default) or <code>none</code></td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-has-child-query"><a class="anchor" href="#java-query-dsl-has-child-query"></a>12.5.2. Has Child Query</h4>
<div class="paragraph">
<p>See <a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/query-dsl-has-child-query.html">Has Child Query</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">QueryBuilder qb = hasChildQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">blog_tag</span><span class="delimiter">&quot;</span></span>,                     <img src="./images/icons/callouts/1.png" alt="1">
    termQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">tag</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">something</span><span class="delimiter">&quot;</span></span>)    <img src="./images/icons/callouts/2.png" alt="2">
);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>child type to query against</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>query</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-has-parent-query"><a class="anchor" href="#java-query-dsl-has-parent-query"></a>12.5.3. Has Parent Query</h4>
<div class="paragraph">
<p>See <a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/query-dsl-has-parent-query.html">Has Parent</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">QueryBuilder qb = hasParentQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">blog</span><span class="delimiter">&quot;</span></span>,                         <img src="./images/icons/callouts/1.png" alt="1">
    termQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">tag</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">something</span><span class="delimiter">&quot;</span></span>)    <img src="./images/icons/callouts/2.png" alt="2">
);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>parent type to query against</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>query</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="java-geo-queries"><a class="anchor" href="#java-geo-queries"></a>12.6. Geo queries</h3>
<div class="paragraph">
<p>Elasticsearch supports two types of geo data:
<code>geo_point</code> fields which support lat/lon pairs, and
<code>geo_shape</code> fields, which support points, lines, circles, polygons, multi-polygons etc.</p>
</div>
<div class="paragraph">
<p>The queries in this group are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="#java-query-dsl-geo-shape-query"><code>geo_shape</code></a> query</dt>
<dd>
<p>Find document with geo-shapes which either intersect, are contained by, or
do not intersect with the specified geo-shape.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-geo-bounding-box-query"><code>geo_bounding_box</code></a> query</dt>
<dd>
<p>Finds documents with geo-points that fall into the specified rectangle.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-geo-distance-query"><code>geo_distance</code></a> query</dt>
<dd>
<p>Finds document with geo-points within the specified distance of a central
point.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-geo-distance-range-query"><code>geo_distance_range</code></a> query</dt>
<dd>
<p>Like the <code>geo_point</code> query, but the range starts at a specified distance
from the central point.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-geo-polygon-query"><code>geo_polygon</code></a> query</dt>
<dd>
<p>Find documents with geo-points within the specified polygon.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-geohash-cell-query"><code>geohash_cell</code></a> query</dt>
<dd>
<p>Find geo-points whose geohash intersects with the geohash of the specified
point.</p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="java-query-dsl-geo-shape-query"><a class="anchor" href="#java-query-dsl-geo-shape-query"></a>12.6.1. GeoShape Query</h4>
<div class="paragraph">
<p>See <a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/query-dsl-geo-shape-query.html">Geo Shape Query</a></p>
</div>
<div class="paragraph">
<p>Note: the <code>geo_shape</code> type uses <code>Spatial4J</code> and <code>JTS</code>, both of which are
optional dependencies. Consequently you must add <code>Spatial4J</code> and <code>JTS</code>
to your classpath in order to use this type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>com.spatial4j<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>spatial4j<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>0.4.1<span class="tag">&lt;/version&gt;</span>                        <img src="./images/icons/callouts/1.png" alt="1">
<span class="tag">&lt;/dependency&gt;</span>

<span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>com.vividsolutions<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>jts<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>1.13<span class="tag">&lt;/version&gt;</span>                         <img src="./images/icons/callouts/2.png" alt="2">
    <span class="tag">&lt;exclusions&gt;</span>
        <span class="tag">&lt;exclusion&gt;</span>
            <span class="tag">&lt;groupId&gt;</span>xerces<span class="tag">&lt;/groupId&gt;</span>
            <span class="tag">&lt;artifactId&gt;</span>xercesImpl<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;/exclusion&gt;</span>
    <span class="tag">&lt;/exclusions&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>check for updates in <a href="http://search.maven.org/#search%7Cga%7C1%7Cg%3A%22com.spatial4j%22%20AND%20a%3A%22spatial4j%22">Maven Central</a></td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>check for updates in <a href="http://search.maven.org/#search%7Cga%7C1%7Cg%3A%22com.vividsolutions%22%20AND%20a%3A%22jts%22">Maven Central</a></td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Import ShapeRelation and ShapeBuilder</span>
<span class="keyword">import</span> <span class="include">org.elasticsearch.common.geo.ShapeRelation</span>;
<span class="keyword">import</span> <span class="include">org.elasticsearch.common.geo.builders.ShapeBuilder</span>;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">QueryBuilder qb = geoShapeQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">pin.location</span><span class="delimiter">&quot;</span></span>,                     <img src="./images/icons/callouts/1.png" alt="1">
    ShapeBuilder.newMultiPoint()        <img src="./images/icons/callouts/2.png" alt="2">
        .point(<span class="integer">0</span>, <span class="integer">0</span>)
        .point(<span class="integer">0</span>, <span class="integer">10</span>)
        .point(<span class="integer">10</span>, <span class="integer">10</span>)
        .point(<span class="integer">10</span>, <span class="integer">0</span>)
        .point(<span class="integer">0</span>, <span class="integer">0</span>),
    ShapeRelation.WITHIN);              <img src="./images/icons/callouts/3.png" alt="3"></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>field</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>shape</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/3.png" alt="3"></td>
<td>relation can be <code>ShapeRelation.WITHIN</code>, <code>ShapeRelation.INTERSECTS</code> or <code>ShapeRelation.DISJOINT</code></td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Using pre-indexed shapes</span>
QueryBuilder qb = geoShapeQuery(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">pin.location</span><span class="delimiter">&quot;</span></span>,             <img src="./images/icons/callouts/1.png" alt="1">
        <span class="string"><span class="delimiter">&quot;</span><span class="content">DEU</span><span class="delimiter">&quot;</span></span>,                      <img src="./images/icons/callouts/2.png" alt="2">
        <span class="string"><span class="delimiter">&quot;</span><span class="content">countries</span><span class="delimiter">&quot;</span></span>,                <img src="./images/icons/callouts/3.png" alt="3">
        ShapeRelation.WITHIN)       <img src="./images/icons/callouts/4.png" alt="4">
    .indexedShapeIndex(<span class="string"><span class="delimiter">&quot;</span><span class="content">shapes</span><span class="delimiter">&quot;</span></span>)    <img src="./images/icons/callouts/5.png" alt="5">
    .indexedShapePath(<span class="string"><span class="delimiter">&quot;</span><span class="content">location</span><span class="delimiter">&quot;</span></span>);  <img src="./images/icons/callouts/6.png" alt="6"></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>field</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>The ID of the document that containing the pre-indexed shape.</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/3.png" alt="3"></td>
<td>Index type where the pre-indexed shape is.</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/4.png" alt="4"></td>
<td>relation</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/5.png" alt="5"></td>
<td>Name of the index where the pre-indexed shape is. Defaults to <em>shapes</em>.</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/6.png" alt="6"></td>
<td>The field specified as path containing the pre-indexed shape. Defaults to <em>shape</em>.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-geo-bounding-box-query"><a class="anchor" href="#java-query-dsl-geo-bounding-box-query"></a>12.6.2. Geo Bounding Box Query</h4>
<div class="paragraph">
<p>See <a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/query-dsl-geo-bounding-box-query.html">Geo Bounding Box Query</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">QueryBuilder qb = geoBoundingBoxQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">pin.location</span><span class="delimiter">&quot;</span></span>) <img src="./images/icons/callouts/1.png" alt="1">
    .topLeft(<span class="float">40.73</span>, -<span class="float">74.1</span>)                            <img src="./images/icons/callouts/2.png" alt="2">
    .bottomRight(<span class="float">40.717</span>, -<span class="float">73.99</span>);                     <img src="./images/icons/callouts/3.png" alt="3"></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>field</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>bounding box top left point</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/3.png" alt="3"></td>
<td>bounding box bottom right point</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-geo-distance-query"><a class="anchor" href="#java-query-dsl-geo-distance-query"></a>12.6.3. Geo Distance Query</h4>
<div class="paragraph">
<p>See <a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/query-dsl-geo-distance-query.html">Geo Distance Query</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">QueryBuilder qb = geoDistanceQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">pin.location</span><span class="delimiter">&quot;</span></span>)  <img src="./images/icons/callouts/1.png" alt="1">
    .point(<span class="integer">40</span>, -<span class="integer">70</span>)                                 <img src="./images/icons/callouts/2.png" alt="2">
    .distance(<span class="integer">200</span>, DistanceUnit.KILOMETERS)         <img src="./images/icons/callouts/3.png" alt="3">
    .optimizeBbox(<span class="string"><span class="delimiter">&quot;</span><span class="content">memory</span><span class="delimiter">&quot;</span></span>)                         <img src="./images/icons/callouts/4.png" alt="4">
    .geoDistance(GeoDistance.ARC);                  <img src="./images/icons/callouts/5.png" alt="5"></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>field</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>center point</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/3.png" alt="3"></td>
<td>distance from center point</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/4.png" alt="4"></td>
<td>optimize bounding box: <code>memory</code>, <code>indexed</code> or <code>none</code></td>
</tr>
<tr>
<td><img src="./images/icons/callouts/5.png" alt="5"></td>
<td>distance computation mode: <code>GeoDistance.SLOPPY_ARC</code> (default), <code>GeoDistance.ARC</code> (slightly more precise but
significantly slower) or <code>GeoDistance.PLANE</code> (faster, but inaccurate on long distances and close to the poles)</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-geo-distance-range-query"><a class="anchor" href="#java-query-dsl-geo-distance-range-query"></a>12.6.4. Geo Distance Range Query</h4>
<div class="paragraph">
<p>See <a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/query-dsl-geo-distance-range-query.html">Geo Distance Range Query</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">QueryBuilder qb = geoDistanceRangeQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">pin.location</span><span class="delimiter">&quot;</span></span>)         <img src="./images/icons/callouts/1.png" alt="1">
    .point(<span class="integer">40</span>, -<span class="integer">70</span>)                                             <img src="./images/icons/callouts/2.png" alt="2">
    .from(<span class="string"><span class="delimiter">&quot;</span><span class="content">200km</span><span class="delimiter">&quot;</span></span>)                                              <img src="./images/icons/callouts/3.png" alt="3">
    .to(<span class="string"><span class="delimiter">&quot;</span><span class="content">400km</span><span class="delimiter">&quot;</span></span>)                                                <img src="./images/icons/callouts/4.png" alt="4">
    .includeLower(<span class="predefined-constant">true</span>)                                         <img src="./images/icons/callouts/5.png" alt="5">
    .includeUpper(<span class="predefined-constant">false</span>)                                        <img src="./images/icons/callouts/6.png" alt="6">
    .optimizeBbox(<span class="string"><span class="delimiter">&quot;</span><span class="content">memory</span><span class="delimiter">&quot;</span></span>)                                     <img src="./images/icons/callouts/7.png" alt="7">
    .geoDistance(GeoDistance.ARC);                              <img src="./images/icons/callouts/8.png" alt="8"></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>field</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>center point</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/3.png" alt="3"></td>
<td>starting distance from center point</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/4.png" alt="4"></td>
<td>ending distance from center point</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/5.png" alt="5"></td>
<td>include lower value means that <code>from</code> is <code>gt</code> when <code>false</code> or <code>gte</code> when <code>true</code></td>
</tr>
<tr>
<td><img src="./images/icons/callouts/6.png" alt="6"></td>
<td>include upper value means that <code>to</code> is <code>lt</code> when <code>false</code> or <code>lte</code> when <code>true</code></td>
</tr>
<tr>
<td><img src="./images/icons/callouts/7.png" alt="7"></td>
<td>optimize bounding box: <code>memory</code>, <code>indexed</code> or <code>none</code></td>
</tr>
<tr>
<td><img src="./images/icons/callouts/8.png" alt="8"></td>
<td>distance computation mode: <code>GeoDistance.SLOPPY_ARC</code> (default), <code>GeoDistance.ARC</code> (slightly more precise but
significantly slower) or <code>GeoDistance.PLANE</code> (faster, but inaccurate on long distances and close to the poles)</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-geo-polygon-query"><a class="anchor" href="#java-query-dsl-geo-polygon-query"></a>12.6.5. Geo Polygon Query</h4>
<div class="paragraph">
<p>See <a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/query-dsl-geo-polygon-query.html">Geo Polygon Query</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">QueryBuilder qb = geoPolygonQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">pin.location</span><span class="delimiter">&quot;</span></span>)       <img src="./images/icons/callouts/1.png" alt="1">
    .addPoint(<span class="integer">40</span>, -<span class="integer">70</span>)                                  <img src="./images/icons/callouts/2.png" alt="2">
    .addPoint(<span class="integer">30</span>, -<span class="integer">80</span>)                                  <img src="./images/icons/callouts/2.png" alt="2">
    .addPoint(<span class="integer">20</span>, -<span class="integer">90</span>);                                 <img src="./images/icons/callouts/2.png" alt="2"></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>field</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>add your polygon of points a document should fall within</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-geohash-cell-query"><a class="anchor" href="#java-query-dsl-geohash-cell-query"></a>12.6.6. Geohash Cell Query</h4>
<div class="paragraph">
<p>See <a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/query-dsl-geohash-cell-query.html">Geohash Cell Query</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">QueryBuilder qb = geoHashCellQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">pin.location</span><span class="delimiter">&quot;</span></span>,  <img src="./images/icons/callouts/1.png" alt="1">
            <span class="keyword">new</span> GeoPoint(<span class="float">13.4080</span>, <span class="float">52.5186</span>))         <img src="./images/icons/callouts/2.png" alt="2">
        .neighbors(<span class="predefined-constant">true</span>)                            <img src="./images/icons/callouts/3.png" alt="3">
        .precision(<span class="integer">3</span>);                              <img src="./images/icons/callouts/4.png" alt="4"></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>field</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>point. Can also be a hash like <code>u30</code></td>
</tr>
<tr>
<td><img src="./images/icons/callouts/3.png" alt="3"></td>
<td>The <code>neighbors</code> option of the filter offers the possibility to filter cells
next to the given cell.</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/4.png" alt="4"></td>
<td>precision level</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="java-specialized-queries"><a class="anchor" href="#java-specialized-queries"></a>12.7. Specialized queries</h3>
<div class="paragraph">
<p>This group contains queries which do not fit into the other groups:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="#java-query-dsl-mlt-query"><code>more_like_this</code> query</a></dt>
<dd>
<p>This query finds documents which are similar to the specified text, document,
or collection of documents.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-template-query"><code>template</code> query</a></dt>
<dd>
<p>The <code>template</code> query accepts a Mustache template (either inline, indexed, or
from a file), and a map of parameters,  and combines the two to generate the
final query to execute.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-script-query"><code>script</code> query</a></dt>
<dd>
<p>This query allows a script to act as a filter.  Also see the
<a href="#java-query-dsl-function-score-query"><code>function_score</code> query</a>.</p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="java-query-dsl-mlt-query"><a class="anchor" href="#java-query-dsl-mlt-query"></a>12.7.1. More Like This Query (mlt)</h4>
<div class="paragraph">
<p>See:
 * <a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/query-dsl-mlt-query.html">More Like This Query</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">QueryBuilder qb = moreLikeThisQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">name.first</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">name.last</span><span class="delimiter">&quot;</span></span>) <img src="./images/icons/callouts/1.png" alt="1">
    .like(<span class="string"><span class="delimiter">&quot;</span><span class="content">text like this one</span><span class="delimiter">&quot;</span></span>)                                <img src="./images/icons/callouts/2.png" alt="2">
    .minTermFreq(<span class="integer">1</span>)                                            <img src="./images/icons/callouts/3.png" alt="3">
    .maxQueryTerms(<span class="integer">12</span>);                                        <img src="./images/icons/callouts/4.png" alt="4"></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>fields</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>text</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/3.png" alt="3"></td>
<td>ignore threshold</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/4.png" alt="4"></td>
<td>max num of Terms in generated queries</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-template-query"><a class="anchor" href="#java-query-dsl-template-query"></a>12.7.2. Template Query</h4>
<div class="paragraph">
<p>See <a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/search-template.html">Search Template</a> documentation</p>
</div>
<div class="paragraph">
<p>Define your template parameters as a <code>Map&lt;String,Object&gt;</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; template_params = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;&gt;();
template_params.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">param_gender</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">male</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use your stored search templates in <code>config/scripts</code>.
For example, if you have a file named <code>config/scripts/template_gender.mustache</code> containing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">template</span><span class="delimiter">&quot;</span></span> : {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">query</span><span class="delimiter">&quot;</span></span> : {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">match</span><span class="delimiter">&quot;</span></span> : {
                <span class="key"><span class="delimiter">&quot;</span><span class="content">gender</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">{{param_gender}}</span><span class="delimiter">&quot;</span></span>
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Define your template query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">QueryBuilder qb = templateQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">gender_template</span><span class="delimiter">&quot;</span></span>,                  <img src="./images/icons/callouts/1.png" alt="1">
    ScriptService.ScriptType.FILE,      <img src="./images/icons/callouts/2.png" alt="2">
    template_params);                   <img src="./images/icons/callouts/3.png" alt="3"></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>template name</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>template stored on disk in <code>gender_template.mustache</code></td>
</tr>
<tr>
<td><img src="./images/icons/callouts/3.png" alt="3"></td>
<td>parameters</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also store your template in a special index named <code>.scripts</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">client.preparePutIndexedScript(<span class="string"><span class="delimiter">&quot;</span><span class="content">mustache</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">template_gender</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">{</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
        <span class="string"><span class="delimiter">&quot;</span><span class="content">    </span><span class="char">\&quot;</span><span class="content">template</span><span class="char">\&quot;</span><span class="content"> : {</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
        <span class="string"><span class="delimiter">&quot;</span><span class="content">        </span><span class="char">\&quot;</span><span class="content">query</span><span class="char">\&quot;</span><span class="content"> : {</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
        <span class="string"><span class="delimiter">&quot;</span><span class="content">            </span><span class="char">\&quot;</span><span class="content">match</span><span class="char">\&quot;</span><span class="content"> : {</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
        <span class="string"><span class="delimiter">&quot;</span><span class="content">                </span><span class="char">\&quot;</span><span class="content">gender</span><span class="char">\&quot;</span><span class="content"> : </span><span class="char">\&quot;</span><span class="content">{{param_gender}}</span><span class="char">\&quot;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
        <span class="string"><span class="delimiter">&quot;</span><span class="content">            }</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
        <span class="string"><span class="delimiter">&quot;</span><span class="content">        }</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
        <span class="string"><span class="delimiter">&quot;</span><span class="content">    }</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
        <span class="string"><span class="delimiter">&quot;</span><span class="content">}</span><span class="delimiter">&quot;</span></span>).get();</code></pre>
</div>
</div>
<div class="paragraph">
<p>To execute an indexed templates, use <code>ScriptService.ScriptType.INDEXED</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">QueryBuilder qb = templateQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">gender_template</span><span class="delimiter">&quot;</span></span>,                  <img src="./images/icons/callouts/1.png" alt="1">
    ScriptService.ScriptType.INDEXED,   <img src="./images/icons/callouts/2.png" alt="2">
    template_params);                   <img src="./images/icons/callouts/3.png" alt="3"></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>template name</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>template stored in an index</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/3.png" alt="3"></td>
<td>parameters</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-script-query"><a class="anchor" href="#java-query-dsl-script-query"></a>12.7.3. Script Query</h4>
<div class="paragraph">
<p>See <a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/query-dsl-script-query.html">Script Query</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">QueryBuilder qb = scriptQuery(
    <span class="keyword">new</span> Script(<span class="string"><span class="delimiter">&quot;</span><span class="content">doc['num1'].value &gt; 1</span><span class="delimiter">&quot;</span></span>) <img src="./images/icons/callouts/1.png" alt="1">
);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>inlined script</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you have stored on each data node a script named <code>mygroovyscript.groovy</code> with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">doc[<span class="string"><span class="delimiter">'</span><span class="content">num1</span><span class="delimiter">'</span></span>].value &gt; param1</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use it then with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">QueryBuilder qb = scriptQuery(
    <span class="keyword">new</span> Script(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">mygroovyscript</span><span class="delimiter">&quot;</span></span>,                    <img src="./images/icons/callouts/1.png" alt="1">
        ScriptService.ScriptType.FILE,       <img src="./images/icons/callouts/2.png" alt="2">
        <span class="string"><span class="delimiter">&quot;</span><span class="content">groovy</span><span class="delimiter">&quot;</span></span>,                            <img src="./images/icons/callouts/3.png" alt="3">
        ImmutableMap.of(<span class="string"><span class="delimiter">&quot;</span><span class="content">param1</span><span class="delimiter">&quot;</span></span>, <span class="integer">5</span>))        <img src="./images/icons/callouts/4.png" alt="4">
);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>Script name</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>Script type: either <code>ScriptType.FILE</code>, <code>ScriptType.INLINE</code> or <code>ScriptType.INDEXED</code></td>
</tr>
<tr>
<td><img src="./images/icons/callouts/3.png" alt="3"></td>
<td>Scripting engine</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/4.png" alt="4"></td>
<td>Parameters as a <code>Map</code> of <code>&lt;String, Object&gt;</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>æ</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="java-span-queries"><a class="anchor" href="#java-span-queries"></a>12.8. Span queries</h3>
<div class="paragraph">
<p>Span queries are low-level positional queries which provide expert control
over the order and proximity of the specified terms. These are typically used
to implement very specific queries on legal documents or patents.</p>
</div>
<div class="paragraph">
<p>Span queries cannot be mixed with non-span queries (with the exception of the <code>span_multi</code> query).</p>
</div>
<div class="paragraph">
<p>The queries in this group are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="#java-query-dsl-span-term-query"><code>span_term</code> query</a></dt>
<dd>
<p>The equivalent of the <a href="#java-query-dsl-term-query"><code>term</code> query</a> but for use with
other span queries.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-span-multi-term-query"><code>span_multi</code> query</a></dt>
<dd>
<p>Wraps a <a href="#java-query-dsl-term-query"><code>term</code></a>, <a href="#java-query-dsl-range-query"><code>range</code></a>,
<a href="#java-query-dsl-prefix-query"><code>prefix</code></a>, <a href="#java-query-dsl-wildcard-query"><code>wildcard</code></a>,
<a href="#java-query-dsl-regexp-query"><code>regexp</code></a>, or <a href="#java-query-dsl-fuzzy-query"><code>fuzzy</code></a> query.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-span-first-query"><code>span_first</code> query</a></dt>
<dd>
<p>Accepts another span query whose matches must appear within the first N
positions of the field.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-span-near-query"><code>span_near</code> query</a></dt>
<dd>
<p>Accepts multiple span queries whose matches must be within the specified distance of each other, and possibly in the same order.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-span-or-query"><code>span_or</code> query</a></dt>
<dd>
<p>Combines multiple span queries&#8201;&#8212;&#8201;returns documents which match any of the
specified queries.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-span-not-query"><code>span_not</code> query</a></dt>
<dd>
<p>Wraps another span query, and excludes any documents which match that query.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-span-containing-query"><code>span_containing</code> query</a></dt>
<dd>
<p>Accepts a list of span queries, but only returns those spans which also match a second span query.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-span-within-query"><code>span_within</code> query</a></dt>
<dd>
<p>The result from a single span query is returned as long is its span falls
within the spans returned by a list of other span queries.</p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="java-query-dsl-span-term-query"><a class="anchor" href="#java-query-dsl-span-term-query"></a>12.8.1. Span Term Query</h4>
<div class="paragraph">
<p>See <a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/query-dsl-span-term-query.html">Span Term Query</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">QueryBuilder qb = spanTermQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>,                                     <img src="./images/icons/callouts/1.png" alt="1">
    <span class="string"><span class="delimiter">&quot;</span><span class="content">kimchy</span><span class="delimiter">&quot;</span></span>                                    <img src="./images/icons/callouts/2.png" alt="2">
);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>field</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>value</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-span-multi-term-query"><a class="anchor" href="#java-query-dsl-span-multi-term-query"></a>12.8.2. Span Multi Term Query</h4>
<div class="paragraph">
<p>See <a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/query-dsl-span-multi-term-query.html">Span Multi Term Query</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">QueryBuilder qb = spanMultiTermQueryBuilder(
    prefixQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">ki</span><span class="delimiter">&quot;</span></span>)                   <img src="./images/icons/callouts/1.png" alt="1">
);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>Can be any builder extending the <code>MultiTermQueryBuilder</code> class. For example: <code>FuzzyQueryBuilder</code>,
<code>PrefixQueryBuilder</code>, <code>RangeQueryBuilder</code>, <code>RegexpQueryBuilder</code> or <code>WildcardQueryBuilder</code>.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-span-first-query"><a class="anchor" href="#java-query-dsl-span-first-query"></a>12.8.3. Span First Query</h4>
<div class="paragraph">
<p>See <a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/query-dsl-span-first-query.html">Span First Query</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">QueryBuilder qb = spanFirstQuery(
    spanTermQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">kimchy</span><span class="delimiter">&quot;</span></span>),            <img src="./images/icons/callouts/1.png" alt="1">
    <span class="integer">3</span>                                           <img src="./images/icons/callouts/2.png" alt="2">
);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>query</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>max end position</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-span-near-query"><a class="anchor" href="#java-query-dsl-span-near-query"></a>12.8.4. Span Near Query</h4>
<div class="paragraph">
<p>See <a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/query-dsl-span-near-query.html">Span Near Query</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">QueryBuilder qb = spanNearQuery()
    .clause(spanTermQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">field</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">value1</span><span class="delimiter">&quot;</span></span>))    <img src="./images/icons/callouts/1.png" alt="1">
    .clause(spanTermQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">field</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">value2</span><span class="delimiter">&quot;</span></span>))    <img src="./images/icons/callouts/1.png" alt="1">
    .clause(spanTermQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">field</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">value3</span><span class="delimiter">&quot;</span></span>))    <img src="./images/icons/callouts/1.png" alt="1">
    .slop(<span class="integer">12</span>)                                   <img src="./images/icons/callouts/2.png" alt="2">
    .inOrder(<span class="predefined-constant">false</span>)                             <img src="./images/icons/callouts/3.png" alt="3">
    .collectPayloads(<span class="predefined-constant">false</span>);                    <img src="./images/icons/callouts/4.png" alt="4"></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>span term queries</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>slop factor: the maximum number of intervening unmatched positions</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/3.png" alt="3"></td>
<td>whether matches are required to be in-order</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/4.png" alt="4"></td>
<td>collect payloads or not</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-span-or-query"><a class="anchor" href="#java-query-dsl-span-or-query"></a>12.8.5. Span Or Query</h4>
<div class="paragraph">
<p>See <a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/query-dsl-span-or-query.html">Span Or Query</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">QueryBuilder qb = spanOrQuery()
    .clause(spanTermQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">field</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">value1</span><span class="delimiter">&quot;</span></span>))    <img src="./images/icons/callouts/1.png" alt="1">
    .clause(spanTermQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">field</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">value2</span><span class="delimiter">&quot;</span></span>))    <img src="./images/icons/callouts/1.png" alt="1">
    .clause(spanTermQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">field</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">value3</span><span class="delimiter">&quot;</span></span>));   <img src="./images/icons/callouts/1.png" alt="1"></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>span term queries</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-span-not-query"><a class="anchor" href="#java-query-dsl-span-not-query"></a>12.8.6. Span Not Query</h4>
<div class="paragraph">
<p>See <a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/query-dsl-span-not-query.html">Span Not Query</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">QueryBuilder qb = spanNotQuery()
    .include(spanTermQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">field</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">value1</span><span class="delimiter">&quot;</span></span>))   <img src="./images/icons/callouts/1.png" alt="1">
    .exclude(spanTermQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">field</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">value2</span><span class="delimiter">&quot;</span></span>));  <img src="./images/icons/callouts/2.png" alt="2"></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>span query whose matches are filtered</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>span query whose matches must not overlap those returned</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-span-containing-query"><a class="anchor" href="#java-query-dsl-span-containing-query"></a>12.8.7. Span Containing Query</h4>
<div class="paragraph">
<p>See <a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/query-dsl-span-containing-query.html">Span Containing Query</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">QueryBuilder qb = spanContainingQuery()
    .little(spanTermQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">field1</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>))      <img src="./images/icons/callouts/1.png" alt="1">
    .big(spanNearQuery()                        <img src="./images/icons/callouts/2.png" alt="2">
        .clause(spanTermQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">field1</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>))
        .clause(spanTermQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">field1</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">baz</span><span class="delimiter">&quot;</span></span>))
        .slop(<span class="integer">5</span>)
        .inOrder(<span class="predefined-constant">true</span>)
    );</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td><code>little</code> part</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td><code>big</code> part</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-span-within-query"><a class="anchor" href="#java-query-dsl-span-within-query"></a>12.8.8. Span Within Query</h4>
<div class="paragraph">
<p>See <a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.3/query-dsl-span-within-query.html">Span Within Query</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">QueryBuilder qb = spanWithinQuery()
    .little(spanTermQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">field1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>))                 <img src="./images/icons/callouts/1.png" alt="1">
    .big(spanNearQuery()                                    <img src="./images/icons/callouts/2.png" alt="2">
                    .clause(spanTermQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">field1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>))
                    .clause(spanTermQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">field1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">baz</span><span class="delimiter">&quot;</span></span>))
                    .slop(<span class="integer">5</span>)
                    .inOrder(<span class="predefined-constant">true</span>)
    );</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td><code>little</code> part</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td><code>big</code> part</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="indexed-scripts"><a class="anchor" href="#indexed-scripts"></a>13. Indexed Scripts API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The indexed script API allows one to interact with scripts and templates
stored in an elasticsearch index. It can be used to create, update, get,
and delete indexed scripts and templates.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">PutIndexedScriptResponse = client.preparePutIndexedScript()
                         .setScriptLang(<span class="string"><span class="delimiter">&quot;</span><span class="content">groovy</span><span class="delimiter">&quot;</span></span>)
                         .setId(<span class="string"><span class="delimiter">&quot;</span><span class="content">script1</span><span class="delimiter">&quot;</span></span>)
                         .setSource(<span class="string"><span class="delimiter">&quot;</span><span class="content">script</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">_score * doc['my_numeric_field'].value</span><span class="delimiter">&quot;</span></span>)
                         .execute()
                         .actionGet();

GetIndexedScriptResponse = client.prepareGetIndexedScript()
                            .setScriptLang(<span class="string"><span class="delimiter">&quot;</span><span class="content">groovy</span><span class="delimiter">&quot;</span></span>)
                            .setId(<span class="string"><span class="delimiter">&quot;</span><span class="content">script1</span><span class="delimiter">&quot;</span></span>)
                            .execute()
                            .actionGet();

DeleteIndexedScriptResponse = client.prepareDeleteIndexedScript()
                            .setScriptLang(<span class="string"><span class="delimiter">&quot;</span><span class="content">groovy</span><span class="delimiter">&quot;</span></span>)
                            .setId(<span class="string"><span class="delimiter">&quot;</span><span class="content">script1</span><span class="delimiter">&quot;</span></span>)
                            .execute()
                            .actionGet();</code></pre>
</div>
</div>
<div class="paragraph">
<p>To store templates simply use "mustache" for the scriptLang.</p>
</div>
<div class="sect2">
<h3 id="_script_language"><a class="anchor" href="#_script_language"></a>13.1. Script Language</h3>
<div class="paragraph">
<p>The API allows one to set the language of the indexed script being
interacted with. If one is not provided the default scripting language
will be used.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="java-admin"><a class="anchor" href="#java-admin"></a>14. Java API Administration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Elasticsearch provides a full Java API to deal with administration tasks.</p>
</div>
<div class="paragraph">
<p>To access them, you need to call <code>admin()</code> method from a client to get an <code>AdminClient</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">AdminClient adminClient = client.admin();</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<img src="./images/icons/note.png" alt="Note">
</td>
<td class="content">
In the rest of this guide, we will use <code>client.admin()</code>.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="java-admin-indices"><a class="anchor" href="#java-admin-indices"></a>14.1. Indices Administration</h3>
<div class="paragraph">
<p>To access indices Java API, you need to call <code>indices()</code> method from an <a href="#java-admin"><code>AdminClient</code></a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">IndicesAdminClient indicesAdminClient = client.admin().indices();</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<img src="./images/icons/note.png" alt="Note">
</td>
<td class="content">
In the rest of this guide, we will use <code>client.admin().indices()</code>.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="java-admin-indices-create-index"><a class="anchor" href="#java-admin-indices-create-index"></a>14.1.1. Create Index</h4>
<div class="paragraph">
<p>Using an <a href="#java-admin-indices"><code>IndicesAdminClient</code></a>, you can create an index with all default settings and no mapping:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">client.admin().indices().prepareCreate(<span class="string"><span class="delimiter">&quot;</span><span class="content">twitter</span><span class="delimiter">&quot;</span></span>).get();</code></pre>
</div>
</div>
<h5 id="java-admin-indices-create-index-settings" class="float">Index Settings</h5>
<div class="paragraph">
<p>Each index created can have specific settings associated with it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">client.admin().indices().prepareCreate(<span class="string"><span class="delimiter">&quot;</span><span class="content">twitter</span><span class="delimiter">&quot;</span></span>)
        .setSettings(Settings.builder()             <img src="./images/icons/callouts/1.png" alt="1">
                .put(<span class="string"><span class="delimiter">&quot;</span><span class="content">index.number_of_shards</span><span class="delimiter">&quot;</span></span>, <span class="integer">3</span>)
                .put(<span class="string"><span class="delimiter">&quot;</span><span class="content">index.number_of_replicas</span><span class="delimiter">&quot;</span></span>, <span class="integer">2</span>)
        )
        .get();                                     <img src="./images/icons/callouts/2.png" alt="2"></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>Settings for this index</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>Execute the action and wait for the result</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-admin-indices-put-mapping"><a class="anchor" href="#java-admin-indices-put-mapping"></a>14.1.2. Put Mapping</h4>
<div class="paragraph">
<p>The PUT mapping API allows you to add a new type while creating an index:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">client.admin().indices().prepareCreate(<span class="string"><span class="delimiter">&quot;</span><span class="content">twitter</span><span class="delimiter">&quot;</span></span>)   <img src="./images/icons/callouts/1.png" alt="1">
        .addMapping(<span class="string"><span class="delimiter">&quot;</span><span class="content">tweet</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">{</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +                <img src="./images/icons/callouts/2.png" alt="2">
                <span class="string"><span class="delimiter">&quot;</span><span class="content">    </span><span class="char">\&quot;</span><span class="content">tweet</span><span class="char">\&quot;</span><span class="content">: {</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">      </span><span class="char">\&quot;</span><span class="content">properties</span><span class="char">\&quot;</span><span class="content">: {</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">        </span><span class="char">\&quot;</span><span class="content">message</span><span class="char">\&quot;</span><span class="content">: {</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">          </span><span class="char">\&quot;</span><span class="content">type</span><span class="char">\&quot;</span><span class="content">: </span><span class="char">\&quot;</span><span class="content">string</span><span class="char">\&quot;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">        }</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">      }</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">    }</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">  }</span><span class="delimiter">&quot;</span></span>)
        .get();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td><a href="#java-admin-indices-create-index">Creates an index</a> called <code>twitter</code></td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>It also adds a <code>tweet</code> mapping type.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The PUT mapping API also allows to add a new type to an existing index:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">client.admin().indices().preparePutMapping(<span class="string"><span class="delimiter">&quot;</span><span class="content">twitter</span><span class="delimiter">&quot;</span></span>)   <img src="./images/icons/callouts/1.png" alt="1">
        .setType(<span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>)                                <img src="./images/icons/callouts/2.png" alt="2">
        .setSource(<span class="string"><span class="delimiter">&quot;</span><span class="content">{</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +                              <img src="./images/icons/callouts/3.png" alt="3">
                <span class="string"><span class="delimiter">&quot;</span><span class="content">  </span><span class="char">\&quot;</span><span class="content">properties</span><span class="char">\&quot;</span><span class="content">: {</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">    </span><span class="char">\&quot;</span><span class="content">name</span><span class="char">\&quot;</span><span class="content">: {</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">      </span><span class="char">\&quot;</span><span class="content">type</span><span class="char">\&quot;</span><span class="content">: </span><span class="char">\&quot;</span><span class="content">string</span><span class="char">\&quot;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">    }</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">  }</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">}</span><span class="delimiter">&quot;</span></span>)
        .get();

<span class="comment">// You can also provide the type in the source document</span>
client.admin().indices().preparePutMapping(<span class="string"><span class="delimiter">&quot;</span><span class="content">twitter</span><span class="delimiter">&quot;</span></span>)
        .setType(<span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>)
        .setSource(<span class="string"><span class="delimiter">&quot;</span><span class="content">{</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">    </span><span class="char">\&quot;</span><span class="content">user</span><span class="char">\&quot;</span><span class="content">:{</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +                        <img src="./images/icons/callouts/4.png" alt="4">
                <span class="string"><span class="delimiter">&quot;</span><span class="content">        </span><span class="char">\&quot;</span><span class="content">properties</span><span class="char">\&quot;</span><span class="content">: {</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">            </span><span class="char">\&quot;</span><span class="content">name</span><span class="char">\&quot;</span><span class="content">: {</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">                </span><span class="char">\&quot;</span><span class="content">type</span><span class="char">\&quot;</span><span class="content">: </span><span class="char">\&quot;</span><span class="content">string</span><span class="char">\&quot;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">            }</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">        }</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">    }</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">}</span><span class="delimiter">&quot;</span></span>)
        .get();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>Puts a mapping on existing index called <code>twitter</code></td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>Adds a <code>user</code> mapping type.</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/3.png" alt="3"></td>
<td>This <code>user</code> has a predefined type</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/4.png" alt="4"></td>
<td>type can be also provided within the source</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can use the same API to update an existing mapping:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">client.admin().indices().preparePutMapping(<span class="string"><span class="delimiter">&quot;</span><span class="content">twitter</span><span class="delimiter">&quot;</span></span>)   <img src="./images/icons/callouts/1.png" alt="1">
        .setType(<span class="string"><span class="delimiter">&quot;</span><span class="content">tweet</span><span class="delimiter">&quot;</span></span>)                               <img src="./images/icons/callouts/2.png" alt="2">
        .setSource(<span class="string"><span class="delimiter">&quot;</span><span class="content">{</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +                              <img src="./images/icons/callouts/3.png" alt="3">
                <span class="string"><span class="delimiter">&quot;</span><span class="content">  </span><span class="char">\&quot;</span><span class="content">properties</span><span class="char">\&quot;</span><span class="content">: {</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">    </span><span class="char">\&quot;</span><span class="content">user_name</span><span class="char">\&quot;</span><span class="content">: {</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">      </span><span class="char">\&quot;</span><span class="content">type</span><span class="char">\&quot;</span><span class="content">: </span><span class="char">\&quot;</span><span class="content">string</span><span class="char">\&quot;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">    }</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">  }</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">}</span><span class="delimiter">&quot;</span></span>)
        .get();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>Puts a mapping on existing index called <code>twitter</code></td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>Updates the <code>user</code> mapping type.</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/3.png" alt="3"></td>
<td>This <code>user</code> has now a new field <code>user_name</code></td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-admin-indices-refresh"><a class="anchor" href="#java-admin-indices-refresh"></a>14.1.3. Refresh</h4>
<div class="paragraph">
<p>The refresh API allows to explicitly refresh one or more index:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">client.admin().indices().prepareRefresh().get(); <img src="./images/icons/callouts/1.png" alt="1">
client.admin().indices()
        .prepareRefresh(<span class="string"><span class="delimiter">&quot;</span><span class="content">twitter</span><span class="delimiter">&quot;</span></span>)               <img src="./images/icons/callouts/2.png" alt="2">
        .get();
client.admin().indices()
        .prepareRefresh(<span class="string"><span class="delimiter">&quot;</span><span class="content">twitter</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">company</span><span class="delimiter">&quot;</span></span>)   <img src="./images/icons/callouts/3.png" alt="3">
        .get();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>Refresh all indices</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>Refresh one index</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/3.png" alt="3"></td>
<td>Refresh many indices</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-admin-indices-get-settings"><a class="anchor" href="#java-admin-indices-get-settings"></a>14.1.4. Get Settings</h4>
<div class="paragraph">
<p>The get settings API allows to retrieve settings of index/indices:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">GetSettingsResponse response = client.admin().indices()
        .prepareGetSettings(<span class="string"><span class="delimiter">&quot;</span><span class="content">company</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">employee</span><span class="delimiter">&quot;</span></span>).get();                           <img src="./images/icons/callouts/1.png" alt="1">
<span class="keyword">for</span> (ObjectObjectCursor&lt;<span class="predefined-type">String</span>, Settings&gt; cursor : response.getIndexToSettings()) { <img src="./images/icons/callouts/2.png" alt="2">
    <span class="predefined-type">String</span> index = cursor.key;                                                      <img src="./images/icons/callouts/3.png" alt="3">
    Settings settings = cursor.value;                                               <img src="./images/icons/callouts/4.png" alt="4">
    <span class="predefined-type">Integer</span> shards = settings.getAsInt(<span class="string"><span class="delimiter">&quot;</span><span class="content">index.number_of_shards</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">null</span>);             <img src="./images/icons/callouts/5.png" alt="5">
    <span class="predefined-type">Integer</span> replicas = settings.getAsInt(<span class="string"><span class="delimiter">&quot;</span><span class="content">index.number_of_replicas</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">null</span>);         <img src="./images/icons/callouts/6.png" alt="6">
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>Get settings for indices <code>company</code> and <code>employee</code></td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>Iterate over results</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/3.png" alt="3"></td>
<td>Index name</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/4.png" alt="4"></td>
<td>Settings for the given index</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/5.png" alt="5"></td>
<td>Number of shards for this index</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/6.png" alt="6"></td>
<td>Number of replicas for this index
==== Update Indices Settings</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can change index settings by calling:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">client.admin().indices().prepareUpdateSettings(<span class="string"><span class="delimiter">&quot;</span><span class="content">twitter</span><span class="delimiter">&quot;</span></span>)   <img src="./images/icons/callouts/1.png" alt="1">
        .setSettings(Settings.builder()                     <img src="./images/icons/callouts/2.png" alt="2">
                .put(<span class="string"><span class="delimiter">&quot;</span><span class="content">index.number_of_replicas</span><span class="delimiter">&quot;</span></span>, <span class="integer">0</span>)
        )
        .get();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>Index to update</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>Settings</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="java-admin-cluster"><a class="anchor" href="#java-admin-cluster"></a>14.2. Cluster Administration</h3>
<div class="paragraph">
<p>To access cluster Java API, you need to call <code>cluster()</code> method from an <a href="#java-admin"><code>AdminClient</code></a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ClusterAdminClient clusterAdminClient = client.admin().cluster();</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<img src="./images/icons/note.png" alt="Note">
</td>
<td class="content">
In the rest of this guide, we will use <code>client.admin().cluster()</code>.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="java-admin-cluster-health"><a class="anchor" href="#java-admin-cluster-health"></a>14.2.1. Cluster Health</h4>
<div class="sect4">
<h5 id="java-admin-cluster-health-health"><a class="anchor" href="#java-admin-cluster-health-health"></a>Health</h5>
<div class="paragraph">
<p>The cluster health API allows to get a very simple status on the health of the cluster and also can give you
some technical information about the cluster status per index:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ClusterHealthResponse healths = client.admin().cluster().prepareHealth().get(); <img src="./images/icons/callouts/1.png" alt="1">
<span class="predefined-type">String</span> clusterName = healths.getClusterName();              <img src="./images/icons/callouts/2.png" alt="2">
<span class="type">int</span> numberOfDataNodes = healths.getNumberOfDataNodes();     <img src="./images/icons/callouts/3.png" alt="3">
<span class="type">int</span> numberOfNodes = healths.getNumberOfNodes();             <img src="./images/icons/callouts/4.png" alt="4">

<span class="keyword">for</span> (ClusterIndexHealth health : healths) {                 <img src="./images/icons/callouts/5.png" alt="5">
    <span class="predefined-type">String</span> index = health.getIndex();                       <img src="./images/icons/callouts/6.png" alt="6">
    <span class="type">int</span> numberOfShards = health.getNumberOfShards();        <img src="./images/icons/callouts/7.png" alt="7">
    <span class="type">int</span> numberOfReplicas = health.getNumberOfReplicas();    <img src="./images/icons/callouts/8.png" alt="8">
    ClusterHealthStatus status = health.getStatus();        <img src="./images/icons/callouts/9.png" alt="9">
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>Get information for all indices</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>Access the cluster name</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/3.png" alt="3"></td>
<td>Get the total number of data nodes</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/4.png" alt="4"></td>
<td>Get the total number of nodes</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/5.png" alt="5"></td>
<td>Iterate over all indices</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/6.png" alt="6"></td>
<td>Index name</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/7.png" alt="7"></td>
<td>Number of shards</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/8.png" alt="8"></td>
<td>Number of replicas</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/9.png" alt="9"></td>
<td>Index status</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="java-admin-cluster-health-wait-status"><a class="anchor" href="#java-admin-cluster-health-wait-status"></a>Wait for status</h5>
<div class="paragraph">
<p>You can use the cluster health API to wait for a specific status for the whole cluster or for a given index:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">client.admin().cluster().prepareHealth()            <img src="./images/icons/callouts/1.png" alt="1">
        .setWaitForYellowStatus()                   <img src="./images/icons/callouts/2.png" alt="2">
        .get();
client.admin().cluster().prepareHealth(<span class="string"><span class="delimiter">&quot;</span><span class="content">company</span><span class="delimiter">&quot;</span></span>)   <img src="./images/icons/callouts/3.png" alt="3">
        .setWaitForGreenStatus()                    <img src="./images/icons/callouts/4.png" alt="4">
        .get();

client.admin().cluster().prepareHealth(<span class="string"><span class="delimiter">&quot;</span><span class="content">employee</span><span class="delimiter">&quot;</span></span>)  <img src="./images/icons/callouts/5.png" alt="5">
        .setWaitForGreenStatus()                    <img src="./images/icons/callouts/6.png" alt="6">
        .setTimeout(TimeValue.timeValueSeconds(<span class="integer">2</span>))  <img src="./images/icons/callouts/7.png" alt="7">
        .get();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>Prepare a health request</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>Wait for the cluster being yellow</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/3.png" alt="3"></td>
<td>Prepare the health request for index <code>company</code></td>
</tr>
<tr>
<td><img src="./images/icons/callouts/4.png" alt="4"></td>
<td>Wait for the index being green</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/5.png" alt="5"></td>
<td>Prepare the health request for index <code>employee</code></td>
</tr>
<tr>
<td><img src="./images/icons/callouts/6.png" alt="6"></td>
<td>Wait for the index being green</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/7.png" alt="7"></td>
<td>Wait at most for 2 seconds</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the index does not have the expected status and you want to fail in that case, you need
to explicitly interpret the result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ClusterHealthResponse response = client.admin().cluster().prepareHealth(<span class="string"><span class="delimiter">&quot;</span><span class="content">company</span><span class="delimiter">&quot;</span></span>)
        .setWaitForGreenStatus()    <img src="./images/icons/callouts/1.png" alt="1">
        .get();

ClusterHealthStatus status = response.getIndices().get(<span class="string"><span class="delimiter">&quot;</span><span class="content">company</span><span class="delimiter">&quot;</span></span>).getStatus();
<span class="keyword">if</span> (!status.equals(ClusterHealthStatus.GREEN)) {
    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">RuntimeException</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Index is in </span><span class="delimiter">&quot;</span></span> + status + <span class="string"><span class="delimiter">&quot;</span><span class="content"> state</span><span class="delimiter">&quot;</span></span>); <img src="./images/icons/callouts/2.png" alt="2">
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>Wait for the index being green</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>Throw an exception if not <code>GREEN</code></td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2016-04-01 06:02:08 中国标准时间
</div>
</div>
</body>
</html>