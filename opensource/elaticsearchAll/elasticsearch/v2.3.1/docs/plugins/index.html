<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.4">
<title>Elasticsearch Plugins and Integrations</title>
<style>
@import url(https://fonts.googleapis.com/css?family=Glegoo);
/*! normalize.css v2.1.2 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }

/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video { display: inline-block; }

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) { display: none; height: 0; }

/** Address `[hidden]` styling not present in IE 8/9. Hide the `template` element in IE, Safari, and Firefox < 22. */
[hidden], template { display: none; }

script { display: none !important; }

/* ========================================================================== Base ========================================================================== */
/** 1. Set default font family to sans-serif. 2. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html { font-family: sans-serif; /* 1 */ -ms-text-size-adjust: 100%; /* 2 */ -webkit-text-size-adjust: 100%; /* 2 */ }

/** Remove default margin. */
body { margin: 0; }

/* ========================================================================== Links ========================================================================== */
/** Remove the gray background color from active links in IE 10. */
a { background: transparent; }

/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus { outline: thin dotted; }

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover { outline: 0; }

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 { font-size: 2em; margin: 0.67em 0; }

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] { border-bottom: 1px dotted; }

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong { font-weight: bold; }

/** Address styling not present in Safari 5 and Chrome. */
dfn { font-style: italic; }

/** Address differences between Firefox and other browsers. */
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }

/** Address styling not present in IE 8/9. */
mark { background: #ff0; color: #000; }

/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }

/** Improve readability of pre-formatted text in all browsers. */
pre { white-space: pre-wrap; }

/** Set consistent quote types. */
q { quotes: "\201C" "\201D" "\2018" "\2019"; }

/** Address inconsistent and variable font size in all browsers. */
small { font-size: 80%; }

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }

sup { top: -0.5em; }

sub { bottom: -0.25em; }

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img { border: 0; }

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) { overflow: hidden; }

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure { margin: 0; }

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend { border: 0; /* 1 */ padding: 0; /* 2 */ }

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea { font-family: inherit; /* 1 */ font-size: 100%; /* 2 */ margin: 0; /* 3 */ }

/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input { line-height: normal; }

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select { text-transform: none; }

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; /* 2 */ cursor: pointer; /* 3 */ }

/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] { cursor: default; }

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ }

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] { -webkit-appearance: textfield; /* 1 */ -moz-box-sizing: content-box; -webkit-box-sizing: content-box; /* 2 */ box-sizing: content-box; }

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea { overflow: auto; /* 1 */ vertical-align: top; /* 2 */ }

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table { border-collapse: collapse; border-spacing: 0; }

meta.foundation-mq-small { font-family: "only screen and (min-width: 768px)"; width: 768px; }

meta.foundation-mq-medium { font-family: "only screen and (min-width:1280px)"; width: 1280px; }

meta.foundation-mq-large { font-family: "only screen and (min-width:1440px)"; width: 1440px; }

*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }

html, body { font-size: 100%; }

body { background: #fff; color: #222; padding: 0; margin: 0; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }

a:hover { cursor: pointer; }

img, object, embed { max-width: 100%; height: auto; }

object, embed { height: 100%; }

img { -ms-interpolation-mode: bicubic; }

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }

.left { float: left !important; }

.right { float: right !important; }

.text-left { text-align: left !important; }

.text-right { text-align: right !important; }

.text-center { text-align: center !important; }

.text-justify { text-align: justify !important; }

.hide { display: none; }

.antialiased, body { -webkit-font-smoothing: antialiased; }

img { display: inline-block; vertical-align: middle; }

textarea { height: auto; min-height: 50px; }

select { width: 100%; }

object, svg { display: inline-block; vertical-align: middle; }

.center { margin-left: auto; margin-right: auto; }

.spread { width: 100%; }

p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }

.subheader, .admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { line-height: 1.4; color: #a32421; font-weight: 300; margin-top: 0.2em; margin-bottom: 0.5em; }

/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }

/* Default Link Styles */
a { color: #cd2e29; text-decoration: none; line-height: inherit; }
a:hover, a:focus { color: #cd2e29; }
a img { border: none; }

/* Default paragraph styles */
p { font-family: inherit; font-weight: normal; font-size: 1em; line-height: 1.6; margin-bottom: 0.75em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }

/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: "Glegoo", "Helvetica Neue", Helvetica, Arial, sans-serif; font-weight: 400; font-style: normal; color: #555; text-rendering: optimizeLegibility; margin-top: 0.5em; margin-bottom: 0.5em; line-height: 1.6125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #a2a2a2; line-height: 0; }

h1 { font-size: 2.125em; }

h2 { font-size: 1.6875em; }

h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }

h4 { font-size: 1.125em; }

h5 { font-size: 1.125em; }

h6 { font-size: 1em; }

hr { border: solid #ddd; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }

/* Helpful Typography Defaults */
em, i { font-style: italic; line-height: inherit; }

strong, b { font-weight: bold; line-height: inherit; }

small { font-size: 60%; line-height: inherit; }

code { font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: bold; color: black; }

/* Lists */
ul, ol, dl { font-size: 1em; line-height: 1.6; margin-bottom: 0.75em; list-style-position: outside; font-family: inherit; }

ul, ol { margin-left: 0; }
ul.no-bullet, ol.no-bullet { margin-left: 0; }

/* Unordered Lists */
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; /* Override nested font-size change */ }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }

/* Ordered Lists */
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }

/* Definition Lists */
dl dt { margin-bottom: 0.3em; font-weight: bold; }
dl dd { margin-bottom: 0.75em; }

/* Abbreviations */
abbr, acronym { text-transform: uppercase; font-size: 90%; color: black; border-bottom: 1px dotted #ddd; cursor: help; }

abbr { text-transform: none; }

/* Blockquotes */
blockquote { margin: 0 0 0.75em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #ddd; }
blockquote cite { display: block; font-size: 0.8125em; color: #888888; }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: #888888; }

blockquote, blockquote p { line-height: 1.6; color: #555; }

/* Microformats */
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #ddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }

.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }

@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.8; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }
/* Tables */
table { background: #fff; margin-bottom: 1.25em; border: solid 1px #ddd; }
table thead, table tfoot { background: #f5f5f5; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: #222; text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: #222; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #f9f9f9; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.4; }

body { tab-size: 4; }

h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.8; }

a:hover, a:focus { text-decoration: underline; }

.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }

*:not(pre) > code { font-size: inherit; font-style: normal !important; letter-spacing: 0; padding: 0; line-height: inherit; }

pre, pre > code { line-height: 1.6; color: #333; font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: normal; }

.keyseq { color: #333333; }

kbd { font-family: Consolas, "Liberation Mono", Courier, monospace; display: inline-block; color: black; font-size: 0.65em; line-height: 1.45; background-color: #f7f7f7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -moz-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; margin: 0 0.15em; padding: 0.2em 0.5em; vertical-align: middle; position: relative; top: -0.1em; white-space: nowrap; }

.keyseq kbd:first-child { margin-left: 0; }

.keyseq kbd:last-child { margin-right: 0; }

.menuseq, .menu { color: black; }

b.button:before, b.button:after { position: relative; top: -1px; font-weight: normal; }

b.button:before { content: "["; padding: 0 3px 0 2px; }

b.button:after { content: "]"; padding: 0 2px 0 3px; }

#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 1.5em; padding-right: 1.5em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }

#content { margin-top: 1.25em; }

#content:before { content: none; }

#header > h1:first-child { color: #000; margin-top: 2.25rem; margin-bottom: 0; }
#header > h1:first-child + #toc { margin-top: 8px; border-top: 1px solid #ddd; }
#header > h1:only-child, body.toc2 #header > h1:nth-last-child(2) { border-bottom: 1px solid #ddd; padding-bottom: 8px; }
#header .details { border-bottom: 1px solid #ddd; line-height: 1.45; padding-top: 0.25em; padding-bottom: 0.25em; padding-left: 0.25em; color: #888888; display: -ms-flexbox; display: -webkit-flex; display: flex; -ms-flex-flow: row wrap; -webkit-flex-flow: row wrap; flex-flow: row wrap; }
#header .details span:first-child { margin-left: -0.125em; }
#header .details span.email a { color: #555; }
#header .details br { display: none; }
#header .details br + span:before { content: "\00a0\2013\00a0"; }
#header .details br + span.author:before { content: "\00a0\22c5\00a0"; color: #555; }
#header .details br + span#revremark:before { content: "\00a0|\00a0"; }
#header #revnumber { text-transform: capitalize; }
#header #revnumber:after { content: "\00a0"; }

#content > h1:first-child:not([class]) { color: #000; border-bottom: 1px solid #ddd; padding-bottom: 8px; margin-top: 0; padding-top: 1rem; margin-bottom: 1.25rem; }

#toc { border-bottom: 0 solid #eee; padding-bottom: 0.5em; }
#toc > ul { margin-left: 0.125em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin: 0.5em 0; }
#toc ul { font-family: "Glegoo", "Helvetica Neue", Helvetica, Arial, sans-serif; list-style-type: none; }
#toc li { line-height: 1.3334; margin-top: 0.3334em; }
#toc a { text-decoration: none; }
#toc a:active { text-decoration: underline; }

#toctitle { color: #a32421; font-size: 1.2em; }

@media only screen and (min-width: 768px) { #toctitle { font-size: 1.375em; }
  body.toc2 { padding-left: 15em; padding-right: 0; }
  #toc.toc2 { margin-top: 0 !important; background-color: #f5f5f5; position: fixed; width: 15em; left: 0; top: 0; border-right: 1px solid #eee; border-top-width: 0 !important; border-bottom-width: 0 !important; z-index: 1000; padding: 1.25em 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; margin-bottom: 0.8rem; font-size: 1.2em; }
  #toc.toc2 > ul { font-size: 0.9em; margin-bottom: 0; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 15em; }
  body.toc2.toc-right #toc.toc2 { border-right-width: 0; border-left: 1px solid #eee; left: auto; right: 0; } }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; padding-right: 0; }
  #toc.toc2 { width: 20em; }
  #toc.toc2 #toctitle { font-size: 1.375em; }
  #toc.toc2 > ul { font-size: 0.95em; }
  #toc.toc2 ul ul { padding-left: 1.25em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; } }
#content #toc { border-style: solid; border-width: 1px; border-color: gainsboro; margin-bottom: 1.25em; padding: 1.25em; background: #f5f5f5; -webkit-border-radius: 3px; border-radius: 3px; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }

#footer { max-width: 100%; background-color: none; padding: 1.25em; }

#footer-text { color: black; line-height: 1.44; }

.sect1 { padding-bottom: 0.625em; }

@media only screen and (min-width: 768px) { .sect1 { padding-bottom: 1.25em; } }
.sect1 + .sect1 { border-top: 0 solid #eee; }

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; z-index: 1001; width: 1.5ex; margin-left: -1.5ex; display: block; text-decoration: none !important; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: "\00A7"; font-size: 0.85em; display: block; padding-top: 0.1em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #555; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #484848; }

.audioblock, .imageblock, .literalblock, .listingblock, .stemblock, .videoblock { margin-bottom: 1.25em; }

.admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-rendering: optimizeLegibility; text-align: left; }

table.tableblock > caption.title { white-space: nowrap; overflow: visible; max-width: 0; }

.paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { color: #000; }

table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }

.admonitionblock > table { border-collapse: separate; border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; font-family: "Glegoo", "Helvetica Neue", Helvetica, Arial, sans-serif; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #ddd; color: #888888; }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }

.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #d5d5d5; margin-bottom: 1.25em; padding: 1.25em; background: #eee; -webkit-border-radius: 3px; border-radius: 3px; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }

.sidebarblock { border-style: solid; border-width: 1px; border-color: gainsboro; margin-bottom: 1.25em; padding: 1.25em; background: #f5f5f5; -webkit-border-radius: 3px; border-radius: 3px; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock > .content > .title { color: #a32421; margin-top: 0; }

.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }

.literalblock pre, .listingblock pre:not(.highlight), .listingblock pre[class="highlight"], .listingblock pre[class^="highlight "], .listingblock pre.CodeRay, .listingblock pre.prettyprint { background: #f8f8f8; }
.sidebarblock .literalblock pre, .sidebarblock .listingblock pre:not(.highlight), .sidebarblock .listingblock pre[class="highlight"], .sidebarblock .listingblock pre[class^="highlight "], .sidebarblock .listingblock pre.CodeRay, .sidebarblock .listingblock pre.prettyprint { background: #f2f1f1; }

.literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; word-wrap: break-word; padding: 0.75em 0.75em 0.625em 0.75em; font-size: 0.8125em; }
.literalblock pre.nowrap, .literalblock pre[class].nowrap, .listingblock pre.nowrap, .listingblock pre[class].nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
@media only screen and (min-width: 768px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.90625em; } }
@media only screen and (min-width: 1280px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 1em; } }

.literalblock.output pre { color: #f8f8f8; background-color: #333; }

.listingblock pre.highlightjs { padding: 0; }
.listingblock pre.highlightjs > code { padding: 0.75em 0.75em 0.625em 0.75em; -webkit-border-radius: 3px; border-radius: 3px; }

.listingblock > .content { position: relative; }

.listingblock code[data-lang]:before { display: none; content: attr(data-lang); position: absolute; font-size: 0.75em; top: 0.425rem; right: 0.5rem; line-height: 1; text-transform: uppercase; color: #999; }

.listingblock:hover code[data-lang]:before { display: block; }

.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }

.listingblock.terminal pre .command:not([data-prompt]):before { content: "$"; }

table.pyhltable { border-collapse: separate; border: 0; margin-bottom: 0; background: none; }

table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; line-height: 1.6; }

table.pyhltable td.code { padding-left: .75em; padding-right: 0; }

pre.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #ddd; }

pre.pygments .lineno { display: inline-block; margin-right: .25em; }

table.pyhltable .linenodiv { background: none !important; padding-right: 0 !important; }

.quoteblock { margin: 0 1em 0.75em 1.5em; display: table; }
.quoteblock > .title { margin-left: -1.5em; margin-bottom: 0.75em; }
.quoteblock blockquote, .quoteblock blockquote p { color: #555; font-size: 1.15rem; line-height: 1.75; word-spacing: 0.1em; letter-spacing: 0; font-style: italic; text-align: justify; }
.quoteblock blockquote { margin: 0; padding: 0; border: 0; }
.quoteblock blockquote:before { content: "\201c"; float: left; font-size: 2.75em; font-weight: bold; line-height: 0.6em; margin-left: -0.6em; color: #a32421; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: 0.5em; margin-right: 0.5ex; text-align: right; }
.quoteblock .quoteblock { margin-left: 0; margin-right: 0; padding: 0.5em 0; border-left: 3px solid #888888; }
.quoteblock .quoteblock blockquote { padding: 0 0 0 0.75em; }
.quoteblock .quoteblock blockquote:before { display: none; }

.verseblock { margin: 0 1em 0.75em 1em; }
.verseblock pre { font-family: "Open Sans", "DejaVu Sans", sans; font-size: 1.15rem; color: #555; font-weight: 300; text-rendering: optimizeLegibility; }
.verseblock pre strong { font-weight: 400; }
.verseblock .attribution { margin-top: 1.25rem; margin-left: 0.5ex; }

.quoteblock .attribution, .verseblock .attribution { font-size: 0.8125em; line-height: 1.45; font-style: italic; }
.quoteblock .attribution br, .verseblock .attribution br { display: none; }
.quoteblock .attribution cite, .verseblock .attribution cite { display: block; letter-spacing: -0.025em; color: #888888; }

.quoteblock.abstract { margin: 0 0 0.75em 0; display: block; }
.quoteblock.abstract blockquote, .quoteblock.abstract blockquote p { text-align: left; word-spacing: 0; }
.quoteblock.abstract blockquote:before, .quoteblock.abstract blockquote p:first-of-type:before { display: none; }

table.tableblock { max-width: 100%; border-collapse: separate; }
table.tableblock td > .paragraph:last-child p > p:last-child, table.tableblock th > p:last-child, table.tableblock td > p:last-child { margin-bottom: 0; }

table.tableblock, th.tableblock, td.tableblock { border: 0 solid #ddd; }

table.grid-all th.tableblock, table.grid-all td.tableblock { border-width: 0 1px 1px 0; }

table.grid-all tfoot > tr > th.tableblock, table.grid-all tfoot > tr > td.tableblock { border-width: 1px 1px 0 0; }

table.grid-cols th.tableblock, table.grid-cols td.tableblock { border-width: 0 1px 0 0; }

table.grid-all * > tr > .tableblock:last-child, table.grid-cols * > tr > .tableblock:last-child { border-right-width: 0; }

table.grid-rows th.tableblock, table.grid-rows td.tableblock { border-width: 0 0 1px 0; }

table.grid-all tbody > tr:last-child > th.tableblock, table.grid-all tbody > tr:last-child > td.tableblock, table.grid-all thead:last-child > tr > th.tableblock, table.grid-rows tbody > tr:last-child > th.tableblock, table.grid-rows tbody > tr:last-child > td.tableblock, table.grid-rows thead:last-child > tr > th.tableblock { border-bottom-width: 0; }

table.grid-rows tfoot > tr > th.tableblock, table.grid-rows tfoot > tr > td.tableblock { border-width: 1px 0 0 0; }

table.frame-all { border-width: 1px; }

table.frame-sides { border-width: 0 1px; }

table.frame-topbot { border-width: 1px 0; }

th.halign-left, td.halign-left { text-align: left; }

th.halign-right, td.halign-right { text-align: right; }

th.halign-center, td.halign-center { text-align: center; }

th.valign-top, td.valign-top { vertical-align: top; }

th.valign-bottom, td.valign-bottom { vertical-align: bottom; }

th.valign-middle, td.valign-middle { vertical-align: middle; }

table thead th, table tfoot th { font-weight: bold; }

tbody tr th { display: table-cell; line-height: 1.4; background: #f5f5f5; }

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p { color: #222; font-weight: bold; }

p.tableblock > code:only-child { background: none; padding: 0; }

p.tableblock { font-size: 1em; }

td > div.verse { white-space: pre; }

ol { margin-left: 0.25em; }

ul li ol { margin-left: 0; }

dl dd { margin-left: 1.125em; }

dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.375em; }

ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }

ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 0.625em; }

ul.checklist li > p:first-child > .fa-square-o:first-child, ul.checklist li > p:first-child > .fa-check-square-o:first-child { width: 1em; font-size: 0.85em; }

ul.checklist li > p:first-child > input[type="checkbox"]:first-child { width: 1em; position: relative; top: 1px; }

ul.inline { margin: 0 auto 0.375em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }

.unstyled dl dt { font-weight: normal; font-style: normal; }

ol.arabic { list-style-type: decimal; }

ol.decimal { list-style-type: decimal-leading-zero; }

ol.loweralpha { list-style-type: lower-alpha; }

ol.upperalpha { list-style-type: upper-alpha; }

ol.lowerroman { list-style-type: lower-roman; }

ol.upperroman { list-style-type: upper-roman; }

ol.lowergreek { list-style-type: lower-greek; }

.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }

td.hdlist1, td.hdlist2 { vertical-align: top; padding: 0 0.625em; }

td.hdlist1 { font-weight: bold; padding-bottom: 0.75em; }

.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }

.colist > table tr > td:first-of-type { padding: 0 0.75em; line-height: 1; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }

.thumb, .th { line-height: 0; display: inline-block; border: solid 4px #fff; -webkit-box-shadow: 0 0 0 1px #ddd; box-shadow: 0 0 0 1px #ddd; }

.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }

.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }

a.image { text-decoration: none; display: inline-block; }
a.image object { pointer-events: none; }

sup.footnote, sup.footnoteref { font-size: 0.875em; position: static; vertical-align: super; }
sup.footnote a, sup.footnoteref a { text-decoration: none; }
sup.footnote a:active, sup.footnoteref a:active { text-decoration: underline; }

#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -0.25em 0 0.75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em 0 0.225em; line-height: 1.3334; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.05em; margin-bottom: 0.2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }
#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }

.gist .file-data > table { border: 0; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }

div.unbreakable { page-break-inside: avoid; }

.big { font-size: larger; }

.small { font-size: smaller; }

.underline { text-decoration: underline; }

.overline { text-decoration: overline; }

.line-through { text-decoration: line-through; }

.aqua { color: #00bfbf; }

.aqua-background { background-color: #00fafa; }

.black { color: black; }

.black-background { background-color: black; }

.blue { color: #0000bf; }

.blue-background { background-color: #0000fa; }

.fuchsia { color: #bf00bf; }

.fuchsia-background { background-color: #fa00fa; }

.gray { color: #606060; }

.gray-background { background-color: #7d7d7d; }

.green { color: #006000; }

.green-background { background-color: #007d00; }

.lime { color: #00bf00; }

.lime-background { background-color: #00fa00; }

.maroon { color: #600000; }

.maroon-background { background-color: #7d0000; }

.navy { color: #000060; }

.navy-background { background-color: #00007d; }

.olive { color: #606000; }

.olive-background { background-color: #7d7d00; }

.purple { color: #600060; }

.purple-background { background-color: #7d007d; }

.red { color: #bf0000; }

.red-background { background-color: #fa0000; }

.silver { color: #909090; }

.silver-background { background-color: #bcbcbc; }

.teal { color: #006060; }

.teal-background { background-color: #007d7d; }

.white { color: #bfbfbf; }

.white-background { background-color: #fafafa; }

.yellow { color: #bfbf00; }

.yellow-background { background-color: #fafa00; }

span.icon > .fa { cursor: default; }

.admonitionblock td.icon [class^="fa icon-"] { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #9a231f; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }

.conum[data-value] { display: inline-block; color: #fff !important; background-color: black; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; font-size: 0.75em; width: 1.67em; height: 1.67em; line-height: 1.67em; font-family: "Open Sans", "DejaVu Sans", sans-serif; font-style: normal; font-weight: bold; }
.conum[data-value] * { color: #fff !important; }
.conum[data-value] + b { display: none; }
.conum[data-value]:after { content: attr(data-value); }
pre .conum[data-value] { position: relative; top: -0.125em; }

b.conum * { color: inherit !important; }

.conum:not([data-value]):empty { display: none; }

body { background-image: url('../images/maker/body-bg.png?1459295891'); padding-bottom: 5em; }

#header, #content { background-color: #fff; -moz-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.15); -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.15); box-shadow: 0 1px 2px rgba(0, 0, 0, 0.15); }

#content { -moz-border-radius: 0 0 6px 6px; -webkit-border-radius: 0; border-radius: 0 0 6px 6px; }

#header { -moz-border-radius: 6px 6px 0 0; -webkit-border-radius: 6px; border-radius: 6px 6px 0 0; margin-top: 2em; margin-bottom: 0; padding-bottom: 0.625em; }

#footer-text { text-align: center; }

#toc { margin-top: 2em; }

#toctitle { color: #555; }

.imageblock > .content { text-align: center; }
.imageblock > .title { text-align: center; font-style: italic; font-weight: normal; color: black; }

</style>
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Elasticsearch Plugins and Integrations</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#intro">1. Introduction to plugins</a></li>
<li><a href="#plugin-management">2. Plugin Management</a>
<ul class="sectlevel2">
<li><a href="#installation">2.1. Installing Plugins</a></li>
<li><a href="#listing-removing">2.2. Listing and Removing Installed Plugins</a></li>
<li><a href="#_other_command_line_parameters">2.3. Other command line parameters</a></li>
<li><a href="#_settings_related_to_plugins">2.4. Settings related to plugins</a></li>
</ul>
</li>
<li><a href="#api">3. API Extension Plugins</a>
<ul class="sectlevel2">
<li><a href="#plugins-delete-by-query">3.1. Delete By Query Plugin</a>
<ul class="sectlevel3">
<li><a href="#delete-by-query-usage">3.1.1. Using Delete-by-Query</a></li>
<li><a href="#delete-by-query-plugin-reason">3.1.2. Why Delete-By-Query is a plugin</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#alerting">4. Alerting Plugins</a></li>
<li><a href="#analysis">5. Analysis Plugins</a>
<ul class="sectlevel2">
<li><a href="#analysis-icu">5.1. ICU Analysis Plugin</a>
<ul class="sectlevel3">
<li><a href="#analysis-icu-normalization-charfilter">5.1.1. ICU Normalization Character Filter</a></li>
<li><a href="#analysis-icu-tokenizer">5.1.2. ICU Tokenizer</a></li>
<li><a href="#analysis-icu-normalization">5.1.3. ICU Normalization Token Filter</a></li>
<li><a href="#analysis-icu-folding">5.1.4. ICU Folding Token Filter</a></li>
<li><a href="#analysis-icu-collation">5.1.5. ICU Collation Token Filter</a></li>
<li><a href="#analysis-icu-transform">5.1.6. ICU Transform Token Filter</a></li>
</ul>
</li>
<li><a href="#analysis-kuromoji">5.2. Japanese (kuromoji) Analysis Plugin</a>
<ul class="sectlevel3">
<li><a href="#analysis-kuromoji-analyzer">5.2.1. <code>kuromoji</code> analyzer</a></li>
<li><a href="#analysis-kuromoji-charfilter">5.2.2. <code>kuromoji_iteration_mark</code> character filter</a></li>
<li><a href="#analysis-kuromoji-tokenizer">5.2.3. <code>kuromoji_tokenizer</code></a></li>
<li><a href="#analysis-kuromoji-baseform">5.2.4. <code>kuromoji_baseform</code> token filter</a></li>
<li><a href="#analysis-kuromoji-speech">5.2.5. <code>kuromoji_part_of_speech</code> token filter</a></li>
<li><a href="#analysis-kuromoji-readingform">5.2.6. <code>kuromoji_readingform</code> token filter</a></li>
<li><a href="#analysis-kuromoji-stemmer">5.2.7. <code>kuromoji_stemmer</code> token filter</a></li>
</ul>
</li>
<li><a href="#analysis-phonetic">5.3. Phonetic Analysis Plugin</a>
<ul class="sectlevel3">
<li><a href="#analysis-phonetic-token-filter">5.3.1. <code>phonetic</code> token filter</a></li>
</ul>
</li>
<li><a href="#analysis-smartcn">5.4. Smart Chinese Analysis Plugin</a></li>
<li><a href="#analysis-stempel">5.5. Stempel Polish Analysis Plugin</a></li>
</ul>
</li>
<li><a href="#discovery">6. Discovery Plugins</a>
<ul class="sectlevel2">
<li><a href="#cloud-aws">6.1. AWS Cloud Plugin</a>
<ul class="sectlevel3">
<li><a href="#cloud-aws-usage">6.1.1. Getting started with AWS</a></li>
<li><a href="#cloud-aws-discovery">6.1.2. EC2 Discovery</a></li>
<li><a href="#cloud-aws-repository">6.1.3. S3 Repository</a></li>
<li><a href="#cloud-aws-repository-aws-vpc">6.1.4. AWS VPC Bandwidth Settings</a></li>
<li><a href="#cloud-aws-testing">6.1.5. Testing AWS</a></li>
<li><a href="#cloud-aws-best-practices">6.1.6. Best Practices in AWS</a></li>
</ul>
</li>
<li><a href="#cloud-azure">6.2. Azure Cloud Plugin</a>
<ul class="sectlevel3">
<li><a href="#cloud-azure-discovery">6.2.1. Azure Virtual Machine Discovery</a></li>
<li><a href="#cloud-azure-discovery-long">6.2.2. Setup process for Azure Discovery</a></li>
<li><a href="#cloud-azure-discovery-scale">6.2.3. Scaling Out!</a></li>
<li><a href="#cloud-azure-repository">6.2.4. Azure Repository</a></li>
<li><a href="#cloud-azure-testing">6.2.5. Testing Azure</a></li>
<li><a href="#cloud-azure-smb-workaround">6.2.6. Working around a bug in Windows SMB and Java on windows</a></li>
</ul>
</li>
<li><a href="#cloud-gce">6.3. GCE Cloud Plugin</a>
<ul class="sectlevel3">
<li><a href="#cloud-gce-usage-discovery">6.3.1. GCE Virtual Machine Discovery</a></li>
<li><a href="#discovery-gce-network-host">6.3.2. GCE Network Host</a></li>
<li><a href="#cloud-gce-usage-discovery-long">6.3.3. Setting up GCE Discovery</a></li>
<li><a href="#cloud-gce-usage-discovery-cloning">6.3.4. Cloning your existing machine</a></li>
<li><a href="#cloud-gce-usage-discovery-zones">6.3.5. Using GCE zones</a></li>
<li><a href="#cloud-gce-usage-discovery-tags">6.3.6. Filtering by tags</a></li>
<li><a href="#cloud-gce-usage-discovery-port">6.3.7. Changing default transport port</a></li>
<li><a href="#cloud-gce-usage-discovery-tips">6.3.8. GCE Tips</a></li>
<li><a href="#cloud-gce-usage-discovery-testing">6.3.9. Testing GCE</a></li>
</ul>
</li>
<li><a href="#discovery-multicast">6.4. Multicast Discovery Plugin</a>
<ul class="sectlevel3">
<li><a href="#discovery-multicast-usage">6.4.1. Configuring multicast discovery</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#management">7. Management and Site Plugins</a></li>
<li><a href="#mapper">8. Mapper Plugins</a>
<ul class="sectlevel2">
<li><a href="#mapper-attachments">8.1. Mapper Attachments Plugin</a>
<ul class="sectlevel3">
<li><a href="#mapper-attachments-helloworld">8.1.1. Hello, world</a></li>
<li><a href="#mapper-attachments-usage">8.1.2. Usage</a></li>
<li><a href="#mapper-attachments-copy-to">8.1.3. Copy To feature</a></li>
<li><a href="#mapper-attachments-querying-metadata">8.1.4. Querying or accessing metadata</a></li>
<li><a href="#mapper-attachments-indexed-characters">8.1.5. Indexed Characters</a></li>
<li><a href="#mapper-attachments-error-handling">8.1.6. Metadata parsing error handling</a></li>
<li><a href="#mapper-attachments-language-detection">8.1.7. Language Detection</a></li>
<li><a href="#mapper-attachments-highlighting">8.1.8. Highlighting attachments</a></li>
<li><a href="#mapper-attachments-standalone">8.1.9. Stand alone runner</a></li>
</ul>
</li>
<li><a href="#mapper-size">8.2. Mapper Size Plugin</a>
<ul class="sectlevel3">
<li><a href="#mapper-size-usage">8.2.1. Using the <code>_size</code> field</a></li>
</ul>
</li>
<li><a href="#mapper-murmur3">8.3. Mapper Murmur3 Plugin</a>
<ul class="sectlevel3">
<li><a href="#mapper-murmur3-usage">8.3.1. Using the <code>murmur3</code> field</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#scripting">9. Scripting Plugins</a>
<ul class="sectlevel2">
<li><a href="#lang-javascript">9.1. JavaScript Language Plugin</a>
<ul class="sectlevel3">
<li><a href="#lang-javascript-usage">9.1.1. Using JavaScript in Elasticsearch</a></li>
</ul>
</li>
<li><a href="#lang-python">9.2. Python Language Plugin</a>
<ul class="sectlevel3">
<li><a href="#lang-python-usage">9.2.1. Using Python in Elasticsearch</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#security">10. Security Plugins</a></li>
<li><a href="#repository">11. Snapshot/Restore Repository Plugins</a></li>
<li><a href="#transport">12. Transport Plugins</a></li>
<li><a href="#integrations">13. Integrations</a></li>
<li><a href="#plugin-authors">14. Help for plugin authors</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="intro"><a class="anchor" href="#intro"></a>1. Introduction to plugins</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Plugins are a way to enhance the core Elasticsearch functionality in a custom
manner. They range from adding custom mapping types, custom analyzers, native
scripts, custom discovery and more.</p>
</div>
<div class="paragraph">
<p>There are three types of plugins:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java plugins</dt>
<dd>
<p>These plugins contain only JAR files, and must be installed on every node
in the cluster.  After installation, each node must be restarted before
the plugin becomes visible.</p>
</dd>
<dt class="hdlist1">Site plugins</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>These plugins contain static web content like Javascript, HTML, and CSS files,
that can be served directly from Elasticsearch. Site plugins may only need to
be installed on one node, and do not require a restart to become visible. The
content of site plugins is accessible via a URL like:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http://yournode:9200/_plugin/[plugin name]</pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">Mixed plugins</dt>
<dd>
<p>Mixed plugins contain both JAR files and web content.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>For advice on writing your own plugin, see <a href="#plugin-authors">Help for plugin authors</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="plugin-management"><a class="anchor" href="#plugin-management"></a>2. Plugin Management</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>plugin</code> script is used to install, list, and remove plugins. It is
located in the <code>$ES_HOME/bin</code> directory by default but it may be in a
<a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.3/setup-dir-layout.html">different location</a> if you installed Elasticsearch
with an RPM or deb package.</p>
</div>
<div class="paragraph">
<p>Run the following command to get usage instructions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">sudo bin/plugin -h</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<img src="./images/icons/important.png" alt="Important">
</td>
<td class="content">
<div class="title">Running as root</div>
<div class="paragraph">
<p>If Elasticsearch was installed using the deb or rpm package then run
<code>bin/plugin</code> as <code>root</code> so it can write to the appropriate files on disk.
Otherwise run <code>bin/plugin</code> as the user that owns all of the Elasticsearch
files.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="installation"><a class="anchor" href="#installation"></a>2.1. Installing Plugins</h3>
<div class="paragraph">
<p>The documentation for each plugin usually includes specific installation
instructions for that plugin, but below we document the various available
options:</p>
</div>
<h3 id="_core_elasticsearch_plugins" class="float">Core Elasticsearch plugins</h3>
<div class="paragraph">
<p>Core Elasticsearch plugins can be installed as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">sudo bin/plugin install [plugin_name]</code></pre>
</div>
</div>
<div class="paragraph">
<p>For instance, to install the core <a href="#analysis-icu">ICU plugin</a>, just run the
following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">sudo bin/plugin install analysis-icu</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command will install the version of the plugin that matches your
Elasticsearch version.</p>
</div>
<h3 id="_community_and_non_core_plugins" class="float">Community and non-core plugins</h3>
<div class="paragraph">
<p>Non-core plugins provided by Elasticsearch, or plugins provided by the
community, can be installed from <code>download.elastic.co</code>, from Maven (Central
and Sonatype), or from GitHub.  In this case, the command is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">sudo bin/plugin install [org]/[user|component]/[version]</code></pre>
</div>
</div>
<div class="paragraph">
<p>For instance, to install the <a href="https://github.com/lmenezes/elasticsearch-kopf">Kopf</a>
plugin from GitHub, run one of the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">sudo bin/plugin install lmenezes/elasticsearch-kopf <img src="./images/icons/callouts/1.png" alt="1">
sudo bin/plugin install lmenezes/elasticsearch-kopf/2.x <img src="./images/icons/callouts/2.png" alt="2"></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>Installs the latest version from GitHub.</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>Installs the 2.x version from GitHub.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When installing from Maven Central/Sonatype, <code>[org]</code> should be replaced by
the artifact <code>groupId</code>, and <code>[user|component]</code> by the <code>artifactId</code>.  For
instance, to install the {plugins}/mapper-attachments.html[<code>mapper-attachments</code>]
plugin from Sonatype, run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">sudo bin/plugin install org.elasticsearch.plugin/mapper-attachments/3.0.0 <img src="./images/icons/callouts/1.png" alt="1"></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>When installing from <code>download.elastic.co</code> or from Maven Central/Sonatype, the
version is required.</td>
</tr>
</table>
</div>
<h3 id="_custom_url_or_file_system" class="float">Custom URL or file system</h3>
<div class="paragraph">
<p>A plugin can also be downloaded directly from a custom location by specifying the URL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">sudo bin/plugin install [url] <img src="./images/icons/callouts/1.png" alt="1"></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>must be a valid URL, the plugin name is determined from its descriptor.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For instance, to install a plugin from your local file system, you could run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">sudo bin/plugin install file:///path/to/plugin.zip</code></pre>
</div>
</div>
<div class="paragraph">
<p>The plugin script will refuse to talk to an HTTPS URL with an untrusted
certificate. To use a self-signed HTTPS cert, you will need to add the CA cert
to a local Java truststore and pass the location to the script as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">sudo bin/plugin -Djavax.net.ssl.trustStore=/path/to/trustStore.jks install https://....</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="listing-removing"><a class="anchor" href="#listing-removing"></a>2.2. Listing and Removing Installed Plugins</h3>
<h3 id="_listing_plugins" class="float">Listing plugins</h3>
<div class="paragraph">
<p>A list of the currently loaded plugins can be retrieved with the <code>list</code> option:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">sudo bin/plugin list</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, use the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.3/cluster-nodes-info.html">node-info API</a> to find
out which plugins are installed on each node in the cluster</p>
</div>
<h3 id="_removing_plugins" class="float">Removing plugins</h3>
<div class="paragraph">
<p>Plugins can be removed manually, by deleting the appropriate directory under
<code>plugins/</code>, or using the public script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">sudo bin/plugin remove [pluginname]</code></pre>
</div>
</div>
<div class="paragraph">
<p>After a Java plugin has been removed, you will need to restart the node to complete the removal process.</p>
</div>
</div>
<div class="sect2">
<h3 id="_other_command_line_parameters"><a class="anchor" href="#_other_command_line_parameters"></a>2.3. Other command line parameters</h3>
<div class="paragraph">
<p>The <code>plugin</code> scripts supports a number of other command line parameters:</p>
</div>
<h3 id="_silent_verbose_mode" class="float">Silent/Verbose mode</h3>
<div class="paragraph">
<p>The <code>--verbose</code> parameter outputs more debug information, while the <code>--silent</code>
parameter turns off all output.  The script may return the following exit
codes:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>0</code>
</td>
<td class="hdlist2">
<p>everything was OK</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>64</code>
</td>
<td class="hdlist2">
<p>unknown command or incorrect option parameter</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>74</code>
</td>
<td class="hdlist2">
<p>IO error</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>70</code>
</td>
<td class="hdlist2">
<p>any other error</p>
</td>
</tr>
</table>
</div>
<h3 id="_custom_config_directory" class="float">Custom config directory</h3>
<div class="paragraph">
<p>If your <code>elasticsearch.yml</code> config file is in a custom location, you will need
to specify the path to the config file when using the <code>plugin</code> script.  You
can do this as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">sudo bin/plugin -Des.path.conf=/path/to/custom/config/dir install &lt;plugin name&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also set the <code>CONF_DIR</code> environment variable to the custom config
directory path.</p>
</div>
<h3 id="_timeout_settings" class="float">Timeout settings</h3>
<div class="paragraph">
<p>By default, the <code>plugin</code> script will wait indefinitely when downloading before
failing. The timeout parameter can be used to explicitly specify how long it
waits. Here is some examples of setting it to different values:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell"># Wait for 30 seconds before failing
sudo bin/plugin install mobz/elasticsearch-head --timeout 30s

# Wait for 1 minute before failing
sudo bin/plugin install mobz/elasticsearch-head --timeout 1m

# Wait forever (default)
sudo bin/plugin install mobz/elasticsearch-head --timeout 0</code></pre>
</div>
</div>
<h3 id="_proxy_settings" class="float">Proxy settings</h3>
<div class="paragraph">
<p>To install a plugin via a proxy, you can pass the proxy details in with the
Java settings <code>proxyHost</code> and <code>proxyPort</code>. On Unix based systems, these
options can be set on the command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">sudo bin/plugin install mobz/elasticsearch-head -DproxyHost=host_name -DproxyPort=port_number</code></pre>
</div>
</div>
<div class="paragraph">
<p>On Windows, they need to be added to the <code>JAVA_OPTS</code> environment variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">set JAVA_OPTS=&quot;-DproxyHost=host_name -DproxyPort=port_number&quot;
bin/plugin install mobz/elasticsearch-head</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_settings_related_to_plugins"><a class="anchor" href="#_settings_related_to_plugins"></a>2.4. Settings related to plugins</h3>
<h3 id="_custom_plugins_directory" class="float">Custom plugins directory</h3>
<div class="paragraph">
<p>The <code>plugins</code> directory can be changed from the default by adding the
following to the <code>elasticsearch.yml</code> config file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yml"><span class="key">path.plugins</span>: <span class="string"><span class="content">/path/to/custom/plugins/dir</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The default location of the <code>plugins</code> directory depends on
<a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.3/setup-dir-layout.html">which package you install</a>.</p>
</div>
<h3 id="_mandatory_plugins" class="float">Mandatory Plugins</h3>
<div class="paragraph">
<p>If you rely on some plugins, you can define mandatory plugins by adding
<code>plugin.mandatory</code> setting to the <code>config/elasticsearch.yml</code> file, for
example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">plugin.mandatory</span>: <span class="string"><span class="content">mapper-attachments,lang-python</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For safety reasons, a node will not start if it is missing a mandatory plugin.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="api"><a class="anchor" href="#api"></a>3. API Extension Plugins</h2>
<div class="sectionbody">
<div class="paragraph">
<p>API extension plugins add new functionality to Elasticsearch by adding new APIs or features, usually to do with search or mapping.</p>
</div>
<h3 id="_core_api_extension_plugins" class="float">Core API extension plugins</h3>
<div class="paragraph">
<p>The core API extension plugins are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="#plugins-delete-by-query">Delete by Query</a></dt>
<dd>
<p>The delete by query plugin adds support for deleting all of the documents
(from one or more indices) which match the specified query. It is a
replacement for the problematic <em>delete-by-query</em> functionality which has been
removed from Elasticsearch core.</p>
</dd>
</dl>
</div>
<h3 id="_community_contributed_api_extension_plugins" class="float">Community contributed API extension plugins</h3>
<div class="paragraph">
<p>A number of plugins have been contributed by our community:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/carrot2/elasticsearch-carrot2">carrot2 Plugin</a>:
Results clustering with <a href="http://project.carrot2.org/">carrot2</a> (by Dawid Weiss)</p>
</li>
<li>
<p><a href="https://github.com/wikimedia/search-extra">Elasticsearch Trigram Accelerated Regular Expression Filter</a>:
(by Wikimedia Foundation/Nik Everett)</p>
</li>
<li>
<p><a href="https://github.com/kzwang/elasticsearch-image">Elasticsearch Image Plugin</a>:
Uses <a href="https://code.google.com/p/lire/">Lire (Lucene Image Retrieval)</a> to allow users
to index images and search for similar images (by Kevin Wang)</p>
</li>
<li>
<p><a href="https://github.com/wikimedia/search-highlighter">Elasticsearch Experimental Highlighter</a>:
(by Wikimedia Foundation/Nik Everett)</p>
</li>
<li>
<p><a href="https://github.com/YannBrrd/elasticsearch-entity-resolution">Entity Resolution Plugin</a>:
Uses <a href="http://github.com/larsga/Duke">Duke</a> for duplication detection (by Yann Barraud)</p>
</li>
<li>
<p><a href="https://github.com/NLPchina/elasticsearch-sql/">SQL language Plugin</a>:
Allows Elasticsearch to be queried with SQL (by nlpcn)</p>
</li>
<li>
<p><a href="https://github.com/codelibs/elasticsearch-taste">Elasticsearch Taste Plugin</a>:
Mahout Taste-based Collaborative Filtering implementation (by CodeLibs Project)</p>
</li>
<li>
<p><a href="https://github.com/hadashiA/elasticsearch-flavor">Elasticsearch Flavor Plugin</a> using
<a href="http://mahout.apache.org/">Mahout</a> Collaboration filtering (by hadashiA)</p>
</li>
<li>
<p><a href="https://github.com/jurgc11/es-change-feed-plugin">WebSocket Change Feed Plugin</a> (by ForgeRock/Chris Clifton)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These community plugins appear to have been abandoned:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/derryx/elasticsearch-changes-plugin">Elasticsearch Changes Plugin</a> (by Thomas Peuss)</p>
</li>
<li>
<p><a href="https://github.com/mattweber/elasticsearch-mocksolrplugin">Elasticsearch Mock Solr Plugin</a> (by Matt Weber)</p>
</li>
<li>
<p><a href="http://siren.solutions/siren/downloads/">Elasticsearch SIREn Plugin</a>: Nested data search (by SIREn Solutions)</p>
</li>
<li>
<p><a href="https://github.com/endgameinc/elasticsearch-term-plugin">Terms Component Plugin</a> (by Endgame Inc.)</p>
</li>
<li>
<p><a href="https://github.com/etsy/es-restlog">REST Request Logging Plugin</a> (by Etsy/Shikhar Bhushan)</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="plugins-delete-by-query"><a class="anchor" href="#plugins-delete-by-query"></a>3.1. Delete By Query Plugin</h3>
<div class="paragraph">
<p>The delete-by-query plugin adds support for deleting all of the documents
(from one or more indices) which match the specified query. It is a
replacement for the problematic <em>delete-by-query</em> functionality which has been
removed from Elasticsearch core.</p>
</div>
<div class="paragraph">
<p>Internally, it uses <a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.3/search-request-scroll.html">Scroll</a>
and <a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.3/docs-bulk.html">Bulk</a> APIs to delete documents in an efficient and
safe manner. It is slower than the old <em>delete-by-query</em> functionality, but
fixes the problems with the previous implementation.</p>
</div>
<div class="paragraph">
<p>To understand more about why we removed delete-by-query from core and about
the semantics of the new implementation, see
<a href="#delete-by-query-plugin-reason">Why Delete-By-Query is a plugin</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<img src="./images/icons/tip.png" alt="Tip">
</td>
<td class="content">
<div class="paragraph">
<p>Queries which match large numbers of documents may run for a long time,
as every document has to be deleted individually.  Don&#8217;t use <em>delete-by-query</em>
to clean out all or most documents in an index.  Rather create a new index and
perhaps reindex the documents you want to keep.</p>
</div>
</td>
</tr>
</table>
</div>
<h4 id="_installation" class="float">Installation</h4>
<div class="paragraph">
<p>This plugin can be installed using the plugin manager:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">sudo bin/plugin install delete-by-query</code></pre>
</div>
</div>
<div class="paragraph">
<p>The plugin must be installed on every node in the cluster, and each node must
be restarted after installation.</p>
</div>
<h4 id="_removal" class="float">Removal</h4>
<div class="paragraph">
<p>The plugin can be removed with the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">sudo bin/plugin remove delete-by-query</code></pre>
</div>
</div>
<div class="paragraph">
<p>The node must be stopped before removing the plugin.</p>
</div>
<div class="sect3">
<h4 id="delete-by-query-usage"><a class="anchor" href="#delete-by-query-usage"></a>3.1.1. Using Delete-by-Query</h4>
<div class="paragraph">
<p>The query can either be provided using a simple query string as
a parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">DELETE /twitter/tweet/_query?q=user:kimchy</code></pre>
</div>
</div>
<div class="paragraph">
<p>or using the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.3/query-dsl.html">Query DSL</a> defined within the request body:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">DELETE /twitter/tweet/_query
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">query</span><span class="delimiter">&quot;</span></span>: { <img src="./images/icons/callouts/1.png" alt="1">
    <span class="key"><span class="delimiter">&quot;</span><span class="content">term</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">kimchy</span><span class="delimiter">&quot;</span></span>
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>The query must be passed as a value to the <code>query</code> key, in the same way as
the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.3/search-search.html">search api</a>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Both of the above examples end up doing the same thing, which is to delete all
tweets from the twitter index for the user <code>kimchy</code>.</p>
</div>
<div class="paragraph">
<p>Delete-by-query supports deletion across
<a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.3/search-search.html#search-multi-index-type">multiple indices and multiple types</a>.</p>
</div>
<h3 id="_query_string_parameters" class="float">Query-string parameters</h3>
<div class="paragraph">
<p>The following query string parameters are supported:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>q</code></dt>
<dd>
<p>Instead of using the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.3/query-dsl.html">Query DSL</a> to pass a <code>query</code> in the request
body, you can use the <code>q</code> query string parameter to  specify a query using
<a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.3/query-dsl-query-string-query.html#query-string-syntax"><code>query_string</code> syntax</a>.
In this case, the following additional parameters are supported: <code>df</code>,
<code>analyzer</code>, <code>default_operator</code>,  <code>lowercase_expanded_terms</code>,
<code>analyze_wildcard</code> and <code>lenient</code>.
See <a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.3/search-uri-request.html">URI search request</a> for details.</p>
</dd>
<dt class="hdlist1"><code>size</code></dt>
<dd>
<p>The number of hits returned by the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.3/search-request-scroll.html">scroll</a>
request.  Defaults to 10.  May also be specified in the request body.</p>
</dd>
<dt class="hdlist1"><code>timeout</code></dt>
<dd>
<p>The maximum execution time of the delete by query process. Once expired, no
more documents will be deleted.</p>
</dd>
<dt class="hdlist1"><code>routing</code></dt>
<dd>
<p>A comma separated list of routing values to control which shards the delete by
query request should be executed on.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>When using the <code>q</code> parameter, the following additional parameters are
supported (as explained in <a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.3/search-uri-request.html">URI search request</a>): <code>df</code>, <code>analyzer</code>,
<code>default_operator</code>.</p>
</div>
<h3 id="_response_body" class="float">Response body</h3>
<div class="paragraph">
<p>The JSON response looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">took</span><span class="delimiter">&quot;</span></span> : <span class="integer">639</span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">timed_out</span><span class="delimiter">&quot;</span></span> : <span class="predefined-constant">false</span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">_indices</span><span class="delimiter">&quot;</span></span> : {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">_all</span><span class="delimiter">&quot;</span></span> : {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">found</span><span class="delimiter">&quot;</span></span> : <span class="integer">5901</span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">deleted</span><span class="delimiter">&quot;</span></span> : <span class="integer">5901</span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">missing</span><span class="delimiter">&quot;</span></span> : <span class="integer">0</span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">failed</span><span class="delimiter">&quot;</span></span> : <span class="integer">0</span>
    },
    <span class="key"><span class="delimiter">&quot;</span><span class="content">twitter</span><span class="delimiter">&quot;</span></span> : {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">found</span><span class="delimiter">&quot;</span></span> : <span class="integer">5901</span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">deleted</span><span class="delimiter">&quot;</span></span> : <span class="integer">5901</span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">missing</span><span class="delimiter">&quot;</span></span> : <span class="integer">0</span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">failed</span><span class="delimiter">&quot;</span></span> : <span class="integer">0</span>
    }
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">failures</span><span class="delimiter">&quot;</span></span> : [ ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Internally, the query is used to execute an initial
<a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.3/search-request-scroll.html">scroll</a> request. As hits are
pulled from the scroll API, they are passed to the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.3/docs-bulk.html">Bulk
API</a> for deletion.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<img src="./images/icons/important.png" alt="Important">
</td>
<td class="content">
Delete by query will only delete the version of the document that
was visible to search at the time the request was executed.  Any documents
that have been reindexed or updated during execution will not be deleted.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Since documents can be updated or deleted by external operations during the
<em>scroll-bulk</em> process, the plugin keeps track of different counters for
each index, with the totals displayed under the <code>_all</code> index.  The counters
are as follows:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>found</code></dt>
<dd>
<p>The number of documents matching the query for the given index.</p>
</dd>
<dt class="hdlist1"><code>deleted</code></dt>
<dd>
<p>The number of documents successfully deleted for the given index.</p>
</dd>
<dt class="hdlist1"><code>missing</code></dt>
<dd>
<p>The number of documents that were missing when the plugin tried to delete
them. Missing documents were present when the original query was run, but have
already been deleted by another process.</p>
</dd>
<dt class="hdlist1"><code>failed</code></dt>
<dd>
<p>The number of documents that failed to be deleted for the given index. A
document may fail to be deleted if it has been updated to a new version by
another process, or if the shard containing the document has gone missing due
to hardware failure, for example.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="delete-by-query-plugin-reason"><a class="anchor" href="#delete-by-query-plugin-reason"></a>3.1.2. Why Delete-By-Query is a plugin</h4>
<div class="paragraph">
<p>The old delete-by-query API in Elasticsearch 1.x was fast but problematic. We
decided to remove the feature from Elasticsearch for these reasons:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Forward compatibility</dt>
<dd>
<p>The old implementation wrote a delete-by-query request, including the
query, to the transaction log.  This meant that, when upgrading to a new
version, old unsupported queries which cannot be executed might exist in
the translog, thus causing data corruption.</p>
</dd>
<dt class="hdlist1">Consistency and correctness</dt>
<dd>
<p>The old implementation executed the query and deleted all matching docs on
the primary first.  It then repeated this procedure on each replica shard.
There was no guarantee that the queries on the primary and the replicas
matched the same document, so it was quite possible to end up with
different documents on each shard copy.</p>
</dd>
<dt class="hdlist1">Resiliency</dt>
<dd>
<p>The old implementation could cause out-of-memory exceptions, merge storms,
and dramatic slow downs if used incorrectly.</p>
</dd>
</dl>
</div>
<h3 id="_new_delete_by_query_implementation" class="float">New delete-by-query implementation</h3>
<div class="paragraph">
<p>The new implementation, provided by this plugin, is built internally
using  <a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.3/search-request-scroll.html">scroll</a> to return
the document IDs and versions of all the documents that need to be deleted.
It then uses  the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.3/docs-bulk.html"><code>bulk</code> API</a> to do the actual deletion.</p>
</div>
<div class="paragraph">
<p>This can have performance as well as visibility implications. Delete-by-query
now has the following semantics:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">non-atomic</dt>
<dd>
<p>A delete-by-query may fail at any time while some documents matching the
query have already been deleted.</p>
</dd>
<dt class="hdlist1">try-once</dt>
<dd>
<p>A delete-by-query may fail at any time and will not retry it&#8217;s execution.
All retry logic is left to the user.</p>
</dd>
<dt class="hdlist1">syntactic sugar</dt>
<dd>
<p>A delete-by-query is equivalent to a scroll search ordered by <code>_doc</code> and
corresponding bulk-deletes by ID.</p>
</dd>
<dt class="hdlist1">point-in-time</dt>
<dd>
<p>A delete-by-query will only delete the documents that are visible at the
point in time the delete-by-query was started, equivalent to the
scan/scroll API.</p>
</dd>
<dt class="hdlist1">consistent</dt>
<dd>
<p>A delete-by-query will yield consistent results across all replicas of a
shard.</p>
</dd>
<dt class="hdlist1">forward-compatible</dt>
<dd>
<p>A delete-by-query will only send IDs to the shards as deletes such that no
queries are stored in the transaction logs that might not be supported in
the future.</p>
</dd>
<dt class="hdlist1">visibility</dt>
<dd>
<p>The effect of a delete-by-query request will not be visible to search
until the user refreshes the index, or the index is refreshed
automatically.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The new implementation suffers from two issues, which is why we decided to
move the functionality to a plugin instead of replacing the feautre in core:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It is not as fast as the previous implementation. For most use cases, this
difference should not be noticeable but users running delete-by-query on
many matching documents may be affected.</p>
</li>
<li>
<p>There is currently no way to monitor or cancel a running delete-by-query
request, except for the <code>timeout</code> parameter.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We have plans to solve both of these issues in a later version of Elasticsearch.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="alerting"><a class="anchor" href="#alerting"></a>4. Alerting Plugins</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Alerting plugins allow Elasticsearch to monitor indices and to trigger alerts when thresholds are breached.</p>
</div>
<h3 id="_core_alerting_plugins" class="float">Core alerting plugins</h3>
<div class="paragraph">
<p>The core alerting plugins are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="/products/watcher">Watcher</a></dt>
<dd>
<p>Watcher is the alerting and notification product for Elasticsearch that lets
you take action based on changes in your data. It is designed around the
principle that if you can query something in Elasticsearch, you can alert on
it. Simply define a query, condition, schedule, and the actions to take, and
Watcher will do the rest.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="analysis"><a class="anchor" href="#analysis"></a>5. Analysis Plugins</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Analysis plugins extend Elasticsearch by adding new analyzers, tokenizers,
token filters, or character filters to Elasticsearch.</p>
</div>
<h4 id="_core_analysis_plugins" class="float">Core analysis plugins</h4>
<div class="paragraph">
<p>The core analysis plugins are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="#analysis-icu">ICU</a></dt>
<dd>
<p>Adds extended Unicode support using the <a href="http://site.icu-project.org/">ICU</a>
libraries, including better analysis of Asian languages, Unicode
normalization, Unicode-aware case folding, collation support, and
transliteration.</p>
</dd>
<dt class="hdlist1"><a href="#analysis-kuromoji">Kuromoji</a></dt>
<dd>
<p>Advanced analysis of Japanese using the <a href="http://www.atilika.org/">Kuromoji analyzer</a>.</p>
</dd>
<dt class="hdlist1"><a href="#analysis-phonetic">Phonetic</a></dt>
<dd>
<p>Analyzes tokens into their phonetic equivalent using Soundex, Metaphone,
Caverphone, and other codecs.</p>
</dd>
<dt class="hdlist1"><a href="#analysis-smartcn">SmartCN</a></dt>
<dd>
<p>An analyzer for Chinese or mixed Chinese-English text. This analyzer uses
probabilistic knowledge to find the optimal word segmentation for Simplified
Chinese text. The text is first broken into sentences, then each sentence is
segmented into words.</p>
</dd>
<dt class="hdlist1"><a href="#analysis-stempel">Stempel</a></dt>
<dd>
<p>Provides high quality stemming for Polish.</p>
</dd>
</dl>
</div>
<h4 id="_community_contributed_analysis_plugins" class="float">Community contributed analysis plugins</h4>
<div class="paragraph">
<p>A number of analysis plugins have been contributed by our community:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/yakaz/elasticsearch-analysis-combo/">Combo Analysis Plugin</a> (by Olivier Favre, Yakaz)</p>
</li>
<li>
<p><a href="https://github.com/synhershko/elasticsearch-analysis-hebrew">Hebrew Analysis Plugin</a> (by Itamar Syn-Hershko)</p>
</li>
<li>
<p><a href="https://github.com/medcl/elasticsearch-analysis-ik">IK Analysis Plugin</a> (by Medcl)</p>
</li>
<li>
<p><a href="https://github.com/medcl/elasticsearch-analysis-mmseg">Mmseg Analysis Plugin</a> (by Medcl)</p>
</li>
<li>
<p><a href="https://github.com/chytreg/elasticsearch-analysis-morfologik">Morfologik (Polish) Analysis plugin</a> (by chytreg)</p>
</li>
<li>
<p><a href="https://github.com/imotov/elasticsearch-analysis-morphology">Russian and English Morphological Analysis Plugin</a> (by Igor Motov)</p>
</li>
<li>
<p><a href="https://github.com/medcl/elasticsearch-analysis-pinyin">Pinyin Analysis Plugin</a> (by Medcl)</p>
</li>
<li>
<p><a href="https://github.com/duydo/elasticsearch-analysis-vietnamese">Vietnamese Analysis Plugin</a> (by Duy Do)</p>
</li>
<li>
<p><a href="https://github.com/ofir123/elasticsearch-network-analysis">Network Addresses Analysis Plugin</a> (by Ofir123)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These community plugins appear to have been abandoned:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/barminator/elasticsearch-analysis-annotation">Annotation Analysis Plugin</a> (by Michal Samek)</p>
</li>
<li>
<p><a href="https://github.com/medcl/elasticsearch-analysis-string2int">String2Integer Analysis Plugin</a> (by Medcl)</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="analysis-icu"><a class="anchor" href="#analysis-icu"></a>5.1. ICU Analysis Plugin</h3>
<div class="paragraph">
<p>The ICU Analysis plugin integrates the Lucene ICU module into elasticsearch,
adding extended Unicode support using the <a href="http://site.icu-project.org/">ICU</a>
libraries, including better analysis of Asian languages, Unicode
normalization, Unicode-aware case folding, collation support, and
transliteration.</p>
</div>
<h4 id="analysis-icu-install" class="float">Installation</h4>
<div class="paragraph">
<p>This plugin can be installed using the plugin manager:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">sudo bin/plugin install analysis-icu</code></pre>
</div>
</div>
<div class="paragraph">
<p>The plugin must be installed on every node in the cluster, and each node must
be restarted after installation.</p>
</div>
<h4 id="analysis-icu-remove" class="float">Removal</h4>
<div class="paragraph">
<p>The plugin can be removed with the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">sudo bin/plugin remove analysis-icu</code></pre>
</div>
</div>
<div class="paragraph">
<p>The node must be stopped before removing the plugin.</p>
</div>
<div class="sect3">
<h4 id="analysis-icu-normalization-charfilter"><a class="anchor" href="#analysis-icu-normalization-charfilter"></a>5.1.1. ICU Normalization Character Filter</h4>
<div class="paragraph">
<p>Normalizes characters as explained
<a href="http://userguide.icu-project.org/transforms/normalization">here</a>.
It registers itself as the <code>icu_normalizer</code> character filter, which is
available to all indices without any further configuration. The type of
normalization can be specified with the <code>name</code> parameter, which accepts <code>nfc</code>,
<code>nfkc</code>, and <code>nfkc_cf</code> (default).  Set the <code>mode</code> parameter to <code>decompose</code> to
convert <code>nfc</code> to <code>nfd</code> or <code>nfkc</code> to <code>nfkd</code> respectively:</p>
</div>
<div class="paragraph">
<p>Here are two examples, the default usage and a customised character filter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json"><span class="error">P</span><span class="error">U</span><span class="error">T</span> <span class="error">i</span><span class="error">c</span><span class="error">u</span><span class="error">_</span><span class="error">s</span><span class="error">a</span><span class="error">m</span><span class="error">p</span><span class="error">l</span><span class="error">e</span>
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">settings</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">index</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">analysis</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">analyzer</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">nfkc_cf_normalized</span><span class="delimiter">&quot;</span></span>: { <img src="./images/icons/callouts/1.png" alt="1">
            <span class="key"><span class="delimiter">&quot;</span><span class="content">tokenizer</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">icu_tokenizer</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">char_filter</span><span class="delimiter">&quot;</span></span>: [
              <span class="string"><span class="delimiter">&quot;</span><span class="content">icu_normalizer</span><span class="delimiter">&quot;</span></span>
            ]
          },
          <span class="key"><span class="delimiter">&quot;</span><span class="content">nfd_normalized</span><span class="delimiter">&quot;</span></span>: { <img src="./images/icons/callouts/2.png" alt="2">
            <span class="key"><span class="delimiter">&quot;</span><span class="content">tokenizer</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">icu_tokenizer</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">char_filter</span><span class="delimiter">&quot;</span></span>: [
              <span class="string"><span class="delimiter">&quot;</span><span class="content">nfd_normalizer</span><span class="delimiter">&quot;</span></span>
            ]
          }
        },
        <span class="key"><span class="delimiter">&quot;</span><span class="content">char_filter</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">nfd_normalizer</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">icu_normalizer</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">nfc</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">mode</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">decompose</span><span class="delimiter">&quot;</span></span>
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>Uses the default <code>nfkc_cf</code> normalization.</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>Uses the customized <code>nfd_normalizer</code> token filter, which is set to use <code>nfc</code> normalization with decomposition.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="analysis-icu-tokenizer"><a class="anchor" href="#analysis-icu-tokenizer"></a>5.1.2. ICU Tokenizer</h4>
<div class="paragraph">
<p>Tokenizes text into words on word boundaries, as defined in
<a href="http://www.unicode.org/reports/tr29/">UAX #29: Unicode Text Segmentation</a>.
It behaves much like the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.3/analysis-standard-tokenizer.html"><code>standard</code> tokenizer</a>,
but adds better support for some Asian languages by using a dictionary-based
approach to identify words in Thai, Lao, Chinese, Japanese, and Korean, and
using custom rules to break Myanmar and Khmer text into syllables.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json"><span class="error">P</span><span class="error">U</span><span class="error">T</span> <span class="error">i</span><span class="error">c</span><span class="error">u</span><span class="error">_</span><span class="error">s</span><span class="error">a</span><span class="error">m</span><span class="error">p</span><span class="error">l</span><span class="error">e</span>
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">settings</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">index</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">analysis</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">analyzer</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">my_icu_analyzer</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">tokenizer</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">icu_tokenizer</span><span class="delimiter">&quot;</span></span>
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="analysis-icu-normalization"><a class="anchor" href="#analysis-icu-normalization"></a>5.1.3. ICU Normalization Token Filter</h4>
<div class="paragraph">
<p>Normalizes characters as explained
<a href="http://userguide.icu-project.org/transforms/normalization">here</a>. It registers
itself as the <code>icu_normalizer</code> token filter, which is available to all indices
without any further configuration. The type of normalization can be specified
with the <code>name</code> parameter, which accepts <code>nfc</code>, <code>nfkc</code>, and <code>nfkc_cf</code>
(default).</p>
</div>
<div class="paragraph">
<p>You should probably prefer the <a href="#analysis-icu-normalization-charfilter">Normalization character filter</a>.</p>
</div>
<div class="paragraph">
<p>Here are two examples, the default usage and a customised token filter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json"><span class="error">P</span><span class="error">U</span><span class="error">T</span> <span class="error">i</span><span class="error">c</span><span class="error">u</span><span class="error">_</span><span class="error">s</span><span class="error">a</span><span class="error">m</span><span class="error">p</span><span class="error">l</span><span class="error">e</span>
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">settings</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">index</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">analysis</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">analyzer</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">nfkc_cf_normalized</span><span class="delimiter">&quot;</span></span>: { <img src="./images/icons/callouts/1.png" alt="1">
            <span class="key"><span class="delimiter">&quot;</span><span class="content">tokenizer</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">icu_tokenizer</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">filter</span><span class="delimiter">&quot;</span></span>: [
              <span class="string"><span class="delimiter">&quot;</span><span class="content">icu_normalizer</span><span class="delimiter">&quot;</span></span>
            ]
          },
          <span class="key"><span class="delimiter">&quot;</span><span class="content">nfc_normalized</span><span class="delimiter">&quot;</span></span>: { <img src="./images/icons/callouts/2.png" alt="2">
            <span class="key"><span class="delimiter">&quot;</span><span class="content">tokenizer</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">icu_tokenizer</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">filter</span><span class="delimiter">&quot;</span></span>: [
              <span class="string"><span class="delimiter">&quot;</span><span class="content">nfc_normalizer</span><span class="delimiter">&quot;</span></span>
            ]
          }
        },
        <span class="key"><span class="delimiter">&quot;</span><span class="content">filter</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">nfc_normalizer</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">icu_normalizer</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">nfc</span><span class="delimiter">&quot;</span></span>
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>Uses the default <code>nfkc_cf</code> normalization.</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>Uses the customized <code>nfc_normalizer</code> token filter, which is set to use <code>nfc</code> normalization.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="analysis-icu-folding"><a class="anchor" href="#analysis-icu-folding"></a>5.1.4. ICU Folding Token Filter</h4>
<div class="paragraph">
<p>Case folding of Unicode characters based on <code>UTR#30</code>, like the
<a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.3/analysis-asciifolding-tokenfilter.html">ASCII-folding token filter</a>
on steroids. It registers itself as the <code>icu_folding</code> token filter and is
available to all indices:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json"><span class="error">P</span><span class="error">U</span><span class="error">T</span> <span class="error">i</span><span class="error">c</span><span class="error">u</span><span class="error">_</span><span class="error">s</span><span class="error">a</span><span class="error">m</span><span class="error">p</span><span class="error">l</span><span class="error">e</span>
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">settings</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">index</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">analysis</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">analyzer</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">folded</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">tokenizer</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">icu</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">filter</span><span class="delimiter">&quot;</span></span>: [
              <span class="string"><span class="delimiter">&quot;</span><span class="content">icu_folding</span><span class="delimiter">&quot;</span></span>
            ]
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The ICU folding token filter already does Unicode normalization, so there is
no need to use Normalize character or token filter as well.</p>
</div>
<div class="paragraph">
<p>Which letters are folded can be controlled by specifying the
<code>unicodeSetFilter</code> parameter, which accepts a
<a href="http://icu-project.org/apiref/icu4j/com/ibm/icu/text/UnicodeSet.html">UnicodeSet</a>.</p>
</div>
<div class="paragraph">
<p>The following example exempts Swedish characters from folding. It is important
to note that both upper and lowercase forms should be specified, and that
these filtered character are not lowercased which is why we add the
<code>lowercase</code> filter as well:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json"><span class="error">P</span><span class="error">U</span><span class="error">T</span> <span class="error">i</span><span class="error">c</span><span class="error">u</span><span class="error">_</span><span class="error">s</span><span class="error">a</span><span class="error">m</span><span class="error">p</span><span class="error">l</span><span class="error">e</span>
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">settings</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">index</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">analysis</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">analyzer</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">swedish_analyzer</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">tokenizer</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">icu_tokenizer</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">filter</span><span class="delimiter">&quot;</span></span>: [
              <span class="string"><span class="delimiter">&quot;</span><span class="content">swedish_folding</span><span class="delimiter">&quot;</span></span>,
              <span class="string"><span class="delimiter">&quot;</span><span class="content">lowercase</span><span class="delimiter">&quot;</span></span>
            ]
          }
        },
        <span class="key"><span class="delimiter">&quot;</span><span class="content">filter</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">swedish_folding</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">icu_folding</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">unicodeSetFilter</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">[^]</span><span class="delimiter">&quot;</span></span>
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="analysis-icu-collation"><a class="anchor" href="#analysis-icu-collation"></a>5.1.5. ICU Collation Token Filter</h4>
<div class="paragraph">
<p>Collations are used for sorting documents in a language-specific word order.
The <code>icu_collation</code> token filter is available to all indices and defaults to
using the
<a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/sorting-collations.html#uca">DUCET collation</a>,
which is a best-effort attempt at language-neutral sorting.</p>
</div>
<div class="paragraph">
<p>Below is an example of how to set up a field for sorting German names in
&#8220;phonebook&#8221; order:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json"><span class="error">P</span><span class="error">U</span><span class="error">T</span> <span class="error">/</span><span class="error">m</span><span class="error">y</span><span class="error">_</span><span class="error">i</span><span class="error">n</span><span class="error">d</span><span class="error">e</span><span class="error">x</span>
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">settings</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">analysis</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">filter</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">german_phonebook</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>:     <span class="string"><span class="delimiter">&quot;</span><span class="content">icu_collation</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">language</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">de</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">country</span><span class="delimiter">&quot;</span></span>:  <span class="string"><span class="delimiter">&quot;</span><span class="content">DE</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">variant</span><span class="delimiter">&quot;</span></span>:  <span class="string"><span class="delimiter">&quot;</span><span class="content">@collation=phonebook</span><span class="delimiter">&quot;</span></span>
        }
      },
      <span class="key"><span class="delimiter">&quot;</span><span class="content">analyzer</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">german_phonebook</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">tokenizer</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">keyword</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">filter</span><span class="delimiter">&quot;</span></span>:  [ <span class="string"><span class="delimiter">&quot;</span><span class="content">german_phonebook</span><span class="delimiter">&quot;</span></span> ]
        }
      }
    }
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">mappings</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: { <img src="./images/icons/callouts/1.png" alt="1">
          <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">string</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">fields</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">sort</span><span class="delimiter">&quot;</span></span>: { <img src="./images/icons/callouts/2.png" alt="2">
              <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>:     <span class="string"><span class="delimiter">&quot;</span><span class="content">string</span><span class="delimiter">&quot;</span></span>,
              <span class="key"><span class="delimiter">&quot;</span><span class="content">analyzer</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">german_phonebook</span><span class="delimiter">&quot;</span></span>
            }
          }
        }
      }
    }
  }
}

<span class="error">G</span><span class="error">E</span><span class="error">T</span> <span class="error">_</span><span class="error">s</span><span class="error">e</span><span class="error">a</span><span class="error">r</span><span class="error">c</span><span class="error">h</span> <img src="./images/icons/callouts/3.png" alt="3">
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">query</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">match</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Fritz</span><span class="delimiter">&quot;</span></span>
    }
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">sort</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">name.sort</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>The <code>name</code> field uses the <code>standard</code> analyzer, and so support full text queries.</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>The <code>name.sort</code> field uses the <code>keyword</code> analyzer to preserve the name as
a single token, and applies the <code>german_phonebook</code> token filter to index
the value in German phonebook sort order.</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/3.png" alt="3"></td>
<td>An example query which searches the <code>name</code> field and sorts on the <code>name.sort</code> field.</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_collation_options"><a class="anchor" href="#_collation_options"></a>Collation options</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>strength</code></dt>
<dd>
<p>The strength property determines the minimum level of difference considered
significant during comparison. Possible values are : <code>primary</code>, <code>secondary</code>,
<code>tertiary</code>, <code>quaternary</code> or <code>identical</code>. See the
<a href="http://icu-project.org/apiref/icu4j/com/ibm/icu/text/Collator.html">ICU Collation documentation</a>
for a more detailed  explanation for each value.  Defaults to <code>tertiary</code>
unless otherwise specified in the collation.</p>
</dd>
<dt class="hdlist1"><code>decomposition</code></dt>
<dd>
<p>Possible values: <code>no</code> (default, but collation-dependent) or <code>canonical</code>.
Setting this decomposition property to <code>canonical</code> allows the Collator to
handle unnormalized text properly, producing the same results as if the text
were normalized. If <code>no</code> is set, it is the user&#8217;s responsibility to insure
that all text is already in the appropriate form before a comparison or before
getting a CollationKey. Adjusting decomposition mode allows the user to select
between faster and more complete collation behavior. Since a great many of the
world&#8217;s languages do not require text normalization, most locales set <code>no</code> as
the default decomposition mode.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The following options are expert only:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>alternate</code></dt>
<dd>
<p>Possible values: <code>shifted</code> or <code>non-ignorable</code>. Sets the alternate handling for
strength <code>quaternary</code> to be either shifted or non-ignorable. Which boils down
to ignoring punctuation and whitespace.</p>
</dd>
<dt class="hdlist1"><code>caseLevel</code></dt>
<dd>
<p>Possible values: <code>true</code> or <code>false</code> (default). Whether case level sorting is
required. When strength is set to <code>primary</code> this will ignore accent
differences.</p>
</dd>
<dt class="hdlist1"><code>caseFirst</code></dt>
<dd>
<p>Possible values: <code>lower</code> or <code>upper</code>. Useful to control which case is sorted
first when case is not ignored for strength <code>tertiary</code>. The default depends on
the collation.</p>
</dd>
<dt class="hdlist1"><code>numeric</code></dt>
<dd>
<p>Possible values: <code>true</code> or <code>false</code> (default) . Whether digits are sorted
according to their numeric representation. For example the value <code>egg-9</code> is
sorted before the value <code>egg-21</code>.</p>
</dd>
<dt class="hdlist1"><code>variableTop</code></dt>
<dd>
<p>Single character or contraction. Controls what is variable for <code>alternate</code>.</p>
</dd>
<dt class="hdlist1"><code>hiraganaQuaternaryMode</code></dt>
<dd>
<p>Possible values: <code>true</code> or <code>false</code>.  Distinguishing between Katakana and
Hiragana characters in <code>quaternary</code> strength.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="analysis-icu-transform"><a class="anchor" href="#analysis-icu-transform"></a>5.1.6. ICU Transform Token Filter</h4>
<div class="paragraph">
<p>Transforms are used to process Unicode text in many different ways, such as
case mapping, normalization, transliteration and bidirectional text handling.</p>
</div>
<div class="paragraph">
<p>You can define which transformation you want to apply with the <code>id</code> parameter
(defaults to <code>Null</code>), and specify text direction with the <code>dir</code> parameter
which accepts <code>forward</code> (default) for LTR and <code>reverse</code> for RTL.  Custom
rulesets are not yet supported.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json"><span class="error">P</span><span class="error">U</span><span class="error">T</span> <span class="error">i</span><span class="error">c</span><span class="error">u</span><span class="error">_</span><span class="error">s</span><span class="error">a</span><span class="error">m</span><span class="error">p</span><span class="error">l</span><span class="error">e</span>
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">settings</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">index</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">analysis</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">analyzer</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">latin</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">tokenizer</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">keyword</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">filter</span><span class="delimiter">&quot;</span></span>: [
              <span class="string"><span class="delimiter">&quot;</span><span class="content">myLatinTransform</span><span class="delimiter">&quot;</span></span>
            ]
          }
        },
        <span class="key"><span class="delimiter">&quot;</span><span class="content">filter</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">myLatinTransform</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">icu_transform</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Any-Latin; NFD; [:Nonspacing Mark:] Remove; NFC</span><span class="delimiter">&quot;</span></span> <img src="./images/icons/callouts/1.png" alt="1">
          }
        }
      }
    }
  }
}

<span class="error">G</span><span class="error">E</span><span class="error">T</span> <span class="error">i</span><span class="error">c</span><span class="error">u</span><span class="error">_</span><span class="error">s</span><span class="error">a</span><span class="error">m</span><span class="error">p</span><span class="error">l</span><span class="error">e</span><span class="error">/</span><span class="error">_</span><span class="error">a</span><span class="error">n</span><span class="error">a</span><span class="error">l</span><span class="error">y</span><span class="error">z</span><span class="error">e</span><span class="error">?</span><span class="error">a</span><span class="error">n</span><span class="error">a</span><span class="error">l</span><span class="error">y</span><span class="error">z</span><span class="error">e</span><span class="error">r</span><span class="error">=</span><span class="error">l</span><span class="error">a</span><span class="error">t</span><span class="error">i</span><span class="error">n</span>
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content"></span><span class="delimiter">&quot;</span></span> <img src="./images/icons/callouts/2.png" alt="2">
}

<span class="error">G</span><span class="error">E</span><span class="error">T</span> <span class="error">i</span><span class="error">c</span><span class="error">u</span><span class="error">_</span><span class="error">s</span><span class="error">a</span><span class="error">m</span><span class="error">p</span><span class="error">l</span><span class="error">e</span><span class="error">/</span><span class="error">_</span><span class="error">a</span><span class="error">n</span><span class="error">a</span><span class="error">l</span><span class="error">y</span><span class="error">z</span><span class="error">e</span><span class="error">?</span><span class="error">a</span><span class="error">n</span><span class="error">a</span><span class="error">l</span><span class="error">y</span><span class="error">z</span><span class="error">e</span><span class="error">r</span><span class="error">=</span><span class="error">l</span><span class="error">a</span><span class="error">t</span><span class="error">i</span><span class="error">n</span>
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content"></span><span class="delimiter">&quot;</span></span> <img src="./images/icons/callouts/3.png" alt="3">
}

<span class="error">G</span><span class="error">E</span><span class="error">T</span> <span class="error">i</span><span class="error">c</span><span class="error">u</span><span class="error">_</span><span class="error">s</span><span class="error">a</span><span class="error">m</span><span class="error">p</span><span class="error">l</span><span class="error">e</span><span class="error">/</span><span class="error">_</span><span class="error">a</span><span class="error">n</span><span class="error">a</span><span class="error">l</span><span class="error">y</span><span class="error">z</span><span class="error">e</span><span class="error">?</span><span class="error">a</span><span class="error">n</span><span class="error">a</span><span class="error">l</span><span class="error">y</span><span class="error">z</span><span class="error">e</span><span class="error">r</span><span class="error">=</span><span class="error">l</span><span class="error">a</span><span class="error">t</span><span class="error">i</span><span class="error">n</span>
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content"></span><span class="delimiter">&quot;</span></span> <img src="./images/icons/callouts/4.png" alt="4">
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>This transforms transliterates characters to Latin, and separates accents
from their base characters, removes the accents, and then puts the
remaining text into an unaccented form.</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>Returns <code>ni hao</code>.</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/3.png" alt="3"></td>
<td>Returns <code>zdravstvujte</code>.</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/4.png" alt="4"></td>
<td>Returns <code>kon'nichiha</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For more documentation, Please see the <a href="http://userguide.icu-project.org/transforms/general">user guide of ICU Transform</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="analysis-kuromoji"><a class="anchor" href="#analysis-kuromoji"></a>5.2. Japanese (kuromoji) Analysis Plugin</h3>
<div class="paragraph">
<p>The Japanese (kuromoji) Analysis plugin integrates Lucene kuromoji analysis
module into elasticsearch.</p>
</div>
<h4 id="analysis-kuromoji-install" class="float">Installation</h4>
<div class="paragraph">
<p>This plugin can be installed using the plugin manager:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">sudo bin/plugin install analysis-kuromoji</code></pre>
</div>
</div>
<div class="paragraph">
<p>The plugin must be installed on every node in the cluster, and each node must
be restarted after installation.</p>
</div>
<h4 id="analysis-kuromoji-remove" class="float">Removal</h4>
<div class="paragraph">
<p>The plugin can be removed with the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">sudo bin/plugin remove analysis-kuromoji</code></pre>
</div>
</div>
<div class="paragraph">
<p>The node must be stopped before removing the plugin.</p>
</div>
<div class="sect3">
<h4 id="analysis-kuromoji-analyzer"><a class="anchor" href="#analysis-kuromoji-analyzer"></a>5.2.1. <code>kuromoji</code> analyzer</h4>
<div class="paragraph">
<p>The <code>kuromoji</code> analyzer consists of the following tokenizer and token filters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#analysis-kuromoji-tokenizer"><code>kuromoji_tokenizer</code></a></p>
</li>
<li>
<p><a href="#analysis-kuromoji-baseform"><code>kuromoji_baseform</code></a> token filter</p>
</li>
<li>
<p><a href="#analysis-kuromoji-speech"><code>kuromoji_part_of_speech</code></a> token filter</p>
</li>
<li>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.3/analysis-cjk-width-tokenfilter.html"><code>cjk_width</code></a> token filter</p>
</li>
<li>
<p><a href="#analysis-kuromoji-stop"><code>ja_stop</code></a> token filter</p>
</li>
<li>
<p><a href="#analysis-kuromoji-stemmer"><code>kuromoji_stemmer</code></a> token filter</p>
</li>
<li>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.3/analysis-lowercase-tokenfilter.html"><code>lowercase</code></a> token filter</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It supports the <code>mode</code> and <code>user_dictionary</code> settings from
<a href="#analysis-kuromoji-tokenizer"><code>kuromoji_tokenizer</code></a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="analysis-kuromoji-charfilter"><a class="anchor" href="#analysis-kuromoji-charfilter"></a>5.2.2. <code>kuromoji_iteration_mark</code> character filter</h4>
<div class="paragraph">
<p>The <code>kuromoji_iteration_mark</code> normalizes Japanese horizontal iteration marks
(<em>odoriji</em>) to their expanded form. It accepts the following settings:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>normalize_kanji</code></dt>
<dd>
<p>Indicates whether kanji iteration marks should be normalize. Defaults to <code>true</code>.</p>
</dd>
<dt class="hdlist1"><code>normalize_kana</code></dt>
<dd>
<p>Indicates whether kana iteration marks should be normalized. Defaults to <code>true</code></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="analysis-kuromoji-tokenizer"><a class="anchor" href="#analysis-kuromoji-tokenizer"></a>5.2.3. <code>kuromoji_tokenizer</code></h4>
<div class="paragraph">
<p>The <code>kuromoji_tokenizer</code> accepts the following settings:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>mode</code></dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The tokenization mode determines how the tokenizer handles compound and
unknown words.  It can be set to:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>normal</code></dt>
<dd>
<p>Normal segmentation, no decomposition for compounds. Example output:</p>
<div class="literalblock">
<div class="content">
<pre>
</pre>
</div>
</div>
</dd>
<dt class="hdlist1"><code>search</code></dt>
<dd>
<p>Segmentation geared towards search. This includes a decompounding process
for long nouns, also including the full compound token as a synonym.
Example output:</p>
<div class="literalblock">
<div class="content">
<pre>, , , 
</pre>
</div>
</div>
</dd>
<dt class="hdlist1"><code>extended</code></dt>
<dd>
<p>Extended mode outputs unigrams for unknown words. Example output:</p>
<div class="literalblock">
<div class="content">
<pre>, , 
, , , , , , </pre>
</div>
</div>
</dd>
</dl>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>discard_punctuation</code></dt>
<dd>
<p>Whether punctuation should be discarded from the output. Defaults to <code>true</code>.</p>
</dd>
<dt class="hdlist1"><code>user_dictionary</code></dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The Kuromoji tokenizer uses the MeCab-IPADIC dictionary by default. A <code>user_dictionary</code>
may be appended to the default dictionary. The dictionary should have the following CSV format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="csv">&lt;text&gt;,&lt;token 1&gt; ... &lt;token n&gt;,&lt;reading 1&gt; ... &lt;reading n&gt;,&lt;part-of-speech tag&gt;</code></pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>As a demonstration of how the user dictionary can be used, save the following
dictionary to <code>$ES_HOME/config/userdict_ja.txt</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="csv">, , ,</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then create an analyzer as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json"><span class="error">P</span><span class="error">U</span><span class="error">T</span> <span class="error">k</span><span class="error">u</span><span class="error">r</span><span class="error">o</span><span class="error">m</span><span class="error">o</span><span class="error">j</span><span class="error">i</span><span class="error">_</span><span class="error">s</span><span class="error">a</span><span class="error">m</span><span class="error">p</span><span class="error">l</span><span class="error">e</span>
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">settings</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">index</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">analysis</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">tokenizer</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">kuromoji_user_dict</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">kuromoji_tokenizer</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">mode</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">extended</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">discard_punctuation</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">user_dictionary</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">userdict_ja.txt</span><span class="delimiter">&quot;</span></span>
          }
        },
        <span class="key"><span class="delimiter">&quot;</span><span class="content">analyzer</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">my_analyzer</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">custom</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">tokenizer</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">kuromoji_user_dict</span><span class="delimiter">&quot;</span></span>
          }
        }
      }
    }
  }
}

<span class="error">P</span><span class="error">O</span><span class="error">S</span><span class="error">T</span> <span class="error">k</span><span class="error">u</span><span class="error">r</span><span class="error">o</span><span class="error">m</span><span class="error">o</span><span class="error">j</span><span class="error">i</span><span class="error">_</span><span class="error">s</span><span class="error">a</span><span class="error">m</span><span class="error">p</span><span class="error">l</span><span class="error">e</span><span class="error">/</span><span class="error">_</span><span class="error">a</span><span class="error">n</span><span class="error">a</span><span class="error">l</span><span class="error">y</span><span class="error">z</span><span class="error">e</span><span class="error">?</span><span class="error">a</span><span class="error">n</span><span class="error">a</span><span class="error">l</span><span class="error">y</span><span class="error">z</span><span class="error">e</span><span class="error">r</span><span class="error">=</span><span class="error">m</span><span class="error">y</span><span class="error">_</span><span class="error">a</span><span class="error">n</span><span class="error">a</span><span class="error">l</span><span class="error">y</span><span class="error">z</span><span class="error">e</span><span class="error">r</span><span class="error">&amp;</span><span class="error">t</span><span class="error">e</span><span class="error">x</span><span class="error">t</span><span class="error">=</span><span class="error"></span><span class="error"></span><span class="error"></span><span class="error"></span><span class="error"></span><span class="error"></span><span class="error"></span><span class="error"></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The above <code>analyze</code> request returns the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json"><span class="error">#</span> <span class="error">R</span><span class="error">e</span><span class="error">s</span><span class="error">u</span><span class="error">l</span><span class="error">t</span>
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">tokens</span><span class="delimiter">&quot;</span></span> : [ {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">token</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content"></span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">start_offset</span><span class="delimiter">&quot;</span></span> : <span class="integer">0</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">end_offset</span><span class="delimiter">&quot;</span></span> : <span class="integer">2</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">word</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">position</span><span class="delimiter">&quot;</span></span> : <span class="integer">1</span>
  }, {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">token</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content"></span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">start_offset</span><span class="delimiter">&quot;</span></span> : <span class="integer">2</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">end_offset</span><span class="delimiter">&quot;</span></span> : <span class="integer">8</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">word</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">position</span><span class="delimiter">&quot;</span></span> : <span class="integer">2</span>
  } ]
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="analysis-kuromoji-baseform"><a class="anchor" href="#analysis-kuromoji-baseform"></a>5.2.4. <code>kuromoji_baseform</code> token filter</h4>
<div class="paragraph">
<p>The <code>kuromoji_baseform</code> token filter replaces terms with their
BaseFormAttribute. This acts as a lemmatizer for verbs and adjectives.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json"><span class="error">P</span><span class="error">U</span><span class="error">T</span> <span class="error">k</span><span class="error">u</span><span class="error">r</span><span class="error">o</span><span class="error">m</span><span class="error">o</span><span class="error">j</span><span class="error">i</span><span class="error">_</span><span class="error">s</span><span class="error">a</span><span class="error">m</span><span class="error">p</span><span class="error">l</span><span class="error">e</span>
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">settings</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">index</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">analysis</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">analyzer</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">my_analyzer</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">tokenizer</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">kuromoji_tokenizer</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">filter</span><span class="delimiter">&quot;</span></span>: [
              <span class="string"><span class="delimiter">&quot;</span><span class="content">kuromoji_baseform</span><span class="delimiter">&quot;</span></span>
            ]
          }
        }
      }
    }
  }
}

<span class="error">P</span><span class="error">O</span><span class="error">S</span><span class="error">T</span> <span class="error">k</span><span class="error">u</span><span class="error">r</span><span class="error">o</span><span class="error">m</span><span class="error">o</span><span class="error">j</span><span class="error">i</span><span class="error">_</span><span class="error">s</span><span class="error">a</span><span class="error">m</span><span class="error">p</span><span class="error">l</span><span class="error">e</span><span class="error">/</span><span class="error">_</span><span class="error">a</span><span class="error">n</span><span class="error">a</span><span class="error">l</span><span class="error">y</span><span class="error">z</span><span class="error">e</span><span class="error">?</span><span class="error">a</span><span class="error">n</span><span class="error">a</span><span class="error">l</span><span class="error">y</span><span class="error">z</span><span class="error">e</span><span class="error">r</span><span class="error">=</span><span class="error">m</span><span class="error">y</span><span class="error">_</span><span class="error">a</span><span class="error">n</span><span class="error">a</span><span class="error">l</span><span class="error">y</span><span class="error">z</span><span class="error">e</span><span class="error">r</span><span class="error">&amp;</span><span class="error">t</span><span class="error">e</span><span class="error">x</span><span class="error">t</span><span class="error">=</span><span class="error"></span><span class="error"></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text"># Result
{
  &quot;tokens&quot; : [ {
    &quot;token&quot; : &quot;&quot;,
    &quot;start_offset&quot; : 0,
    &quot;end_offset&quot; : 2,
    &quot;type&quot; : &quot;word&quot;,
    &quot;position&quot; : 1
  } ]
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="analysis-kuromoji-speech"><a class="anchor" href="#analysis-kuromoji-speech"></a>5.2.5. <code>kuromoji_part_of_speech</code> token filter</h4>
<div class="paragraph">
<p>The <code>kuromoji_part_of_speech</code> token filter removes tokens that match a set of
part-of-speech tags. It accepts the following setting:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>stoptags</code></dt>
<dd>
<p>An array of part-of-speech tags that should be removed. It defaults to the
<code>stoptags.txt</code> file embedded in the <code>lucene-analyzer-kuromoji.jar</code>.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json"><span class="error">P</span><span class="error">U</span><span class="error">T</span> <span class="error">k</span><span class="error">u</span><span class="error">r</span><span class="error">o</span><span class="error">m</span><span class="error">o</span><span class="error">j</span><span class="error">i</span><span class="error">_</span><span class="error">s</span><span class="error">a</span><span class="error">m</span><span class="error">p</span><span class="error">l</span><span class="error">e</span>
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">settings</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">index</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">analysis</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">analyzer</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">my_analyzer</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">tokenizer</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">kuromoji_tokenizer</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">filter</span><span class="delimiter">&quot;</span></span>: [
              <span class="string"><span class="delimiter">&quot;</span><span class="content">my_posfilter</span><span class="delimiter">&quot;</span></span>
            ]
          }
        },
        <span class="key"><span class="delimiter">&quot;</span><span class="content">filter</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">my_posfilter</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">kuromoji_part_of_speech</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">stoptags</span><span class="delimiter">&quot;</span></span>: [
              <span class="string"><span class="delimiter">&quot;</span><span class="content">--</span><span class="delimiter">&quot;</span></span>,
              <span class="string"><span class="delimiter">&quot;</span><span class="content">-</span><span class="delimiter">&quot;</span></span>
            ]
          }
        }
      }
    }
  }
}

<span class="error">P</span><span class="error">O</span><span class="error">S</span><span class="error">T</span> <span class="error">k</span><span class="error">u</span><span class="error">r</span><span class="error">o</span><span class="error">m</span><span class="error">o</span><span class="error">j</span><span class="error">i</span><span class="error">_</span><span class="error">s</span><span class="error">a</span><span class="error">m</span><span class="error">p</span><span class="error">l</span><span class="error">e</span><span class="error">/</span><span class="error">_</span><span class="error">a</span><span class="error">n</span><span class="error">a</span><span class="error">l</span><span class="error">y</span><span class="error">z</span><span class="error">e</span><span class="error">?</span><span class="error">a</span><span class="error">n</span><span class="error">a</span><span class="error">l</span><span class="error">y</span><span class="error">z</span><span class="error">e</span><span class="error">r</span><span class="error">=</span><span class="error">m</span><span class="error">y</span><span class="error">_</span><span class="error">a</span><span class="error">n</span><span class="error">a</span><span class="error">l</span><span class="error">y</span><span class="error">z</span><span class="error">e</span><span class="error">r</span><span class="error">&amp;</span><span class="error">t</span><span class="error">e</span><span class="error">x</span><span class="error">t</span><span class="error">=</span><span class="error"></span><span class="error"></span><span class="error"></span><span class="error"></span><span class="error"></span><span class="error"></span><span class="error"></span><span class="error"></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text"># Result
{
  &quot;tokens&quot; : [ {
    &quot;token&quot; : &quot;&quot;,
    &quot;start_offset&quot; : 0,
    &quot;end_offset&quot; : 2,
    &quot;type&quot; : &quot;word&quot;,
    &quot;position&quot; : 1
  }, {
    &quot;token&quot; : &quot;&quot;,
    &quot;start_offset&quot; : 3,
    &quot;end_offset&quot; : 7,
    &quot;type&quot; : &quot;word&quot;,
    &quot;position&quot; : 3
  } ]
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="analysis-kuromoji-readingform"><a class="anchor" href="#analysis-kuromoji-readingform"></a>5.2.6. <code>kuromoji_readingform</code> token filter</h4>
<div class="paragraph">
<p>The <code>kuromoji_readingform</code> token filter replaces the token with its reading
form in either katakana or romaji. It accepts the following setting:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>use_romaji</code></dt>
<dd>
<p>Whether romaji reading form should be output instead of katakana.  Defaults to <code>false</code>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>When using the pre-defined <code>kuromoji_readingform</code> filter, <code>use_romaji</code> is set
to <code>true</code>. The default when defining a custom <code>kuromoji_readingform</code>, however,
is <code>false</code>.  The only reason to use the custom form is if you need the
katakana reading form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json"><span class="error">P</span><span class="error">U</span><span class="error">T</span> <span class="error">k</span><span class="error">u</span><span class="error">r</span><span class="error">o</span><span class="error">m</span><span class="error">o</span><span class="error">j</span><span class="error">i</span><span class="error">_</span><span class="error">s</span><span class="error">a</span><span class="error">m</span><span class="error">p</span><span class="error">l</span><span class="error">e</span>
{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">settings</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">index</span><span class="delimiter">&quot;</span></span>:{
            <span class="key"><span class="delimiter">&quot;</span><span class="content">analysis</span><span class="delimiter">&quot;</span></span>:{
                <span class="key"><span class="delimiter">&quot;</span><span class="content">analyzer</span><span class="delimiter">&quot;</span></span> : {
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">romaji_analyzer</span><span class="delimiter">&quot;</span></span> : {
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">tokenizer</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">kuromoji_tokenizer</span><span class="delimiter">&quot;</span></span>,
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">filter</span><span class="delimiter">&quot;</span></span> : [<span class="string"><span class="delimiter">&quot;</span><span class="content">romaji_readingform</span><span class="delimiter">&quot;</span></span>]
                    },
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">katakana_analyzer</span><span class="delimiter">&quot;</span></span> : {
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">tokenizer</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">kuromoji_tokenizer</span><span class="delimiter">&quot;</span></span>,
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">filter</span><span class="delimiter">&quot;</span></span> : [<span class="string"><span class="delimiter">&quot;</span><span class="content">katakana_readingform</span><span class="delimiter">&quot;</span></span>]
                    }
                },
                <span class="key"><span class="delimiter">&quot;</span><span class="content">filter</span><span class="delimiter">&quot;</span></span> : {
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">romaji_readingform</span><span class="delimiter">&quot;</span></span> : {
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">kuromoji_readingform</span><span class="delimiter">&quot;</span></span>,
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">use_romaji</span><span class="delimiter">&quot;</span></span> : <span class="value">true</span>
                    },
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">katakana_readingform</span><span class="delimiter">&quot;</span></span> : {
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">kuromoji_readingform</span><span class="delimiter">&quot;</span></span>,
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">use_romaji</span><span class="delimiter">&quot;</span></span> : <span class="value">false</span>
                    }
                }
            }
        }
    }
}

<span class="error">P</span><span class="error">O</span><span class="error">S</span><span class="error">T</span> <span class="error">k</span><span class="error">u</span><span class="error">r</span><span class="error">o</span><span class="error">m</span><span class="error">o</span><span class="error">j</span><span class="error">i</span><span class="error">_</span><span class="error">s</span><span class="error">a</span><span class="error">m</span><span class="error">p</span><span class="error">l</span><span class="error">e</span><span class="error">/</span><span class="error">_</span><span class="error">a</span><span class="error">n</span><span class="error">a</span><span class="error">l</span><span class="error">y</span><span class="error">z</span><span class="error">e</span><span class="error">?</span><span class="error">a</span><span class="error">n</span><span class="error">a</span><span class="error">l</span><span class="error">y</span><span class="error">z</span><span class="error">e</span><span class="error">r</span><span class="error">=</span><span class="error">k</span><span class="error">a</span><span class="error">t</span><span class="error">a</span><span class="error">k</span><span class="error">a</span><span class="error">n</span><span class="error">a</span><span class="error">_</span><span class="error">a</span><span class="error">n</span><span class="error">a</span><span class="error">l</span><span class="error">y</span><span class="error">z</span><span class="error">e</span><span class="error">r</span><span class="error">&amp;</span><span class="error">t</span><span class="error">e</span><span class="error">x</span><span class="error">t</span><span class="error">=</span><span class="error"></span><span class="error"></span> <img src="./images/icons/callouts/1.png" alt="1">

<span class="error">P</span><span class="error">O</span><span class="error">S</span><span class="error">T</span> <span class="error">k</span><span class="error">u</span><span class="error">r</span><span class="error">o</span><span class="error">m</span><span class="error">o</span><span class="error">j</span><span class="error">i</span><span class="error">_</span><span class="error">s</span><span class="error">a</span><span class="error">m</span><span class="error">p</span><span class="error">l</span><span class="error">e</span><span class="error">/</span><span class="error">_</span><span class="error">a</span><span class="error">n</span><span class="error">a</span><span class="error">l</span><span class="error">y</span><span class="error">z</span><span class="error">e</span><span class="error">?</span><span class="error">a</span><span class="error">n</span><span class="error">a</span><span class="error">l</span><span class="error">y</span><span class="error">z</span><span class="error">e</span><span class="error">r</span><span class="error">=</span><span class="error">r</span><span class="error">o</span><span class="error">m</span><span class="error">a</span><span class="error">j</span><span class="error">i</span><span class="error">_</span><span class="error">a</span><span class="error">n</span><span class="error">a</span><span class="error">l</span><span class="error">y</span><span class="error">z</span><span class="error">e</span><span class="error">r</span><span class="error">&amp;</span><span class="error">t</span><span class="error">e</span><span class="error">x</span><span class="error">t</span><span class="error">=</span><span class="error"></span><span class="error"></span> <img src="./images/icons/callouts/2.png" alt="2"></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>Returns <code></code>.</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>Returns <code>sushi</code>.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="analysis-kuromoji-stemmer"><a class="anchor" href="#analysis-kuromoji-stemmer"></a>5.2.7. <code>kuromoji_stemmer</code> token filter</h4>
<div class="paragraph">
<p>The <code>kuromoji_stemmer</code> token filter normalizes common katakana spelling
variations ending in a long sound character by removing this character
(U+30FC). Only full-width katakana characters are supported.</p>
</div>
<div class="paragraph">
<p>This token filter accepts the following setting:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>minimum_length</code></dt>
<dd>
<p>Katakana words shorter than the <code>minimum length</code> are not stemmed (default
is <code>4</code>).</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json"><span class="error">P</span><span class="error">U</span><span class="error">T</span> <span class="error">k</span><span class="error">u</span><span class="error">r</span><span class="error">o</span><span class="error">m</span><span class="error">o</span><span class="error">j</span><span class="error">i</span><span class="error">_</span><span class="error">s</span><span class="error">a</span><span class="error">m</span><span class="error">p</span><span class="error">l</span><span class="error">e</span>
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">settings</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">index</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">analysis</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">analyzer</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">my_analyzer</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">tokenizer</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">kuromoji_tokenizer</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">filter</span><span class="delimiter">&quot;</span></span>: [
              <span class="string"><span class="delimiter">&quot;</span><span class="content">my_katakana_stemmer</span><span class="delimiter">&quot;</span></span>
            ]
          }
        },
        <span class="key"><span class="delimiter">&quot;</span><span class="content">filter</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">my_katakana_stemmer</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">kuromoji_stemmer</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">minimum_length</span><span class="delimiter">&quot;</span></span>: <span class="integer">4</span>
          }
        }
      }
    }
  }
}

<span class="error">P</span><span class="error">O</span><span class="error">S</span><span class="error">T</span> <span class="error">k</span><span class="error">u</span><span class="error">r</span><span class="error">o</span><span class="error">m</span><span class="error">o</span><span class="error">j</span><span class="error">i</span><span class="error">_</span><span class="error">s</span><span class="error">a</span><span class="error">m</span><span class="error">p</span><span class="error">l</span><span class="error">e</span><span class="error">/</span><span class="error">_</span><span class="error">a</span><span class="error">n</span><span class="error">a</span><span class="error">l</span><span class="error">y</span><span class="error">z</span><span class="error">e</span><span class="error">?</span><span class="error">a</span><span class="error">n</span><span class="error">a</span><span class="error">l</span><span class="error">y</span><span class="error">z</span><span class="error">e</span><span class="error">r</span><span class="error">=</span><span class="error">m</span><span class="error">y</span><span class="error">_</span><span class="error">a</span><span class="error">n</span><span class="error">a</span><span class="error">l</span><span class="error">y</span><span class="error">z</span><span class="error">e</span><span class="error">r</span><span class="error">&amp;</span><span class="error">t</span><span class="error">e</span><span class="error">x</span><span class="error">t</span><span class="error">=</span><span class="error"></span><span class="error"></span><span class="error"></span> <img src="./images/icons/callouts/1.png" alt="1">

<span class="error">P</span><span class="error">O</span><span class="error">S</span><span class="error">T</span> <span class="error">k</span><span class="error">u</span><span class="error">r</span><span class="error">o</span><span class="error">m</span><span class="error">o</span><span class="error">j</span><span class="error">i</span><span class="error">_</span><span class="error">s</span><span class="error">a</span><span class="error">m</span><span class="error">p</span><span class="error">l</span><span class="error">e</span><span class="error">/</span><span class="error">_</span><span class="error">a</span><span class="error">n</span><span class="error">a</span><span class="error">l</span><span class="error">y</span><span class="error">z</span><span class="error">e</span><span class="error">?</span><span class="error">a</span><span class="error">n</span><span class="error">a</span><span class="error">l</span><span class="error">y</span><span class="error">z</span><span class="error">e</span><span class="error">r</span><span class="error">=</span><span class="error">m</span><span class="error">y</span><span class="error">_</span><span class="error">a</span><span class="error">n</span><span class="error">a</span><span class="error">l</span><span class="error">y</span><span class="error">z</span><span class="error">e</span><span class="error">r</span><span class="error">&amp;</span><span class="error">t</span><span class="error">e</span><span class="error">x</span><span class="error">t</span><span class="error">=</span><span class="error"></span><span class="error"></span><span class="error"></span><span class="error"></span> <img src="./images/icons/callouts/2.png" alt="2"></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>Returns <code></code>.</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>Return <code></code>.</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="analysis-kuromoji-stop"><a class="anchor" href="#analysis-kuromoji-stop"></a><code>ja_stop</code> token filter</h5>
<div class="paragraph">
<p>The <code>ja_stop</code> token filter filters out Japanese stopwords (<code>_japanese_</code>), and
any other custom stopwords specified by the user. This filter only supports
the predefined <code>_japanese_</code> stopwords list.  If you want to use a different
predefined list, then use the
<a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.3/analysis-stop-tokenfilter.html"><code>stop</code> token filter</a> instead.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json"><span class="error">P</span><span class="error">U</span><span class="error">T</span> <span class="error">k</span><span class="error">u</span><span class="error">r</span><span class="error">o</span><span class="error">m</span><span class="error">o</span><span class="error">j</span><span class="error">i</span><span class="error">_</span><span class="error">s</span><span class="error">a</span><span class="error">m</span><span class="error">p</span><span class="error">l</span><span class="error">e</span>
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">settings</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">index</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">analysis</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">analyzer</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">analyzer_with_ja_stop</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">tokenizer</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">kuromoji_tokenizer</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">filter</span><span class="delimiter">&quot;</span></span>: [
              <span class="string"><span class="delimiter">&quot;</span><span class="content">ja_stop</span><span class="delimiter">&quot;</span></span>
            ]
          }
        },
        <span class="key"><span class="delimiter">&quot;</span><span class="content">filter</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">ja_stop</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ja_stop</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">stopwords</span><span class="delimiter">&quot;</span></span>: [
              <span class="string"><span class="delimiter">&quot;</span><span class="content">_japanese_</span><span class="delimiter">&quot;</span></span>,
              <span class="string"><span class="delimiter">&quot;</span><span class="content"></span><span class="delimiter">&quot;</span></span>
            ]
          }
        }
      }
    }
  }
}

<span class="error">P</span><span class="error">O</span><span class="error">S</span><span class="error">T</span> <span class="error">k</span><span class="error">u</span><span class="error">r</span><span class="error">o</span><span class="error">m</span><span class="error">o</span><span class="error">j</span><span class="error">i</span><span class="error">_</span><span class="error">s</span><span class="error">a</span><span class="error">m</span><span class="error">p</span><span class="error">l</span><span class="error">e</span><span class="error">/</span><span class="error">_</span><span class="error">a</span><span class="error">n</span><span class="error">a</span><span class="error">l</span><span class="error">y</span><span class="error">z</span><span class="error">e</span><span class="error">?</span><span class="error">a</span><span class="error">n</span><span class="error">a</span><span class="error">l</span><span class="error">y</span><span class="error">z</span><span class="error">e</span><span class="error">r</span><span class="error">=</span><span class="error">m</span><span class="error">y</span><span class="error">_</span><span class="error">a</span><span class="error">n</span><span class="error">a</span><span class="error">l</span><span class="error">y</span><span class="error">z</span><span class="error">e</span><span class="error">r</span><span class="error">&amp;</span><span class="error">t</span><span class="error">e</span><span class="error">x</span><span class="error">t</span><span class="error">=</span><span class="error"></span><span class="error"></span><span class="error"></span><span class="error"></span><span class="error"></span><span class="error"></span><span class="error"></span><span class="error"></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The above request returns:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text"># Result
{
  &quot;tokens&quot; : [ {
    &quot;token&quot; : &quot;&quot;,
    &quot;start_offset&quot; : 5,
    &quot;end_offset&quot; : 8,
    &quot;type&quot; : &quot;word&quot;,
    &quot;position&quot; : 3
  } ]
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="analysis-phonetic"><a class="anchor" href="#analysis-phonetic"></a>5.3. Phonetic Analysis Plugin</h3>
<div class="paragraph">
<p>The Phonetic Analysis plugin provides token filters which convert tokens to
their phonetic representation using Soundex, Metaphone, and a variety of other
algorithms.</p>
</div>
<h4 id="analysis-phonetic-install" class="float">Installation</h4>
<div class="paragraph">
<p>This plugin can be installed using the plugin manager:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">sudo bin/plugin install analysis-phonetic</code></pre>
</div>
</div>
<div class="paragraph">
<p>The plugin must be installed on every node in the cluster, and each node must
be restarted after installation.</p>
</div>
<h4 id="analysis-phonetic-remove" class="float">Removal</h4>
<div class="paragraph">
<p>The plugin can be removed with the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">sudo bin/plugin remove analysis-phonetic</code></pre>
</div>
</div>
<div class="paragraph">
<p>The node must be stopped before removing the plugin.</p>
</div>
<div class="sect3">
<h4 id="analysis-phonetic-token-filter"><a class="anchor" href="#analysis-phonetic-token-filter"></a>5.3.1. <code>phonetic</code> token filter</h4>
<div class="paragraph">
<p>The <code>phonetic</code> token filter takes the following settings:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>encoder</code></dt>
<dd>
<p>Which phonetic encoder to use.  Accepts <code>metaphone</code> (default),
<code>doublemetaphone</code>, <code>soundex</code>, <code>refinedsoundex</code>, <code>caverphone1</code>,
<code>caverphone2</code>, <code>cologne</code>, <code>nysiis</code>, <code>koelnerphonetik</code>, <code>haasephonetik</code>,
<code>beidermorse</code>, <code>daitch_mokotoff</code>.</p>
</dd>
<dt class="hdlist1"><code>replace</code></dt>
<dd>
<p>Whether or not the original token should be replaced by the phonetic
token. Accepts <code>true</code> (default) and <code>false</code>.  Not supported by
<code>beidermorse</code> encoding.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json"><span class="error">P</span><span class="error">U</span><span class="error">T</span> <span class="error">p</span><span class="error">h</span><span class="error">o</span><span class="error">n</span><span class="error">e</span><span class="error">t</span><span class="error">i</span><span class="error">c</span><span class="error">_</span><span class="error">s</span><span class="error">a</span><span class="error">m</span><span class="error">p</span><span class="error">l</span><span class="error">e</span>
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">settings</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">index</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">analysis</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">analyzer</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">my_analyzer</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">tokenizer</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">standard</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">filter</span><span class="delimiter">&quot;</span></span>: [
              <span class="string"><span class="delimiter">&quot;</span><span class="content">standard</span><span class="delimiter">&quot;</span></span>,
              <span class="string"><span class="delimiter">&quot;</span><span class="content">lowercase</span><span class="delimiter">&quot;</span></span>,
              <span class="string"><span class="delimiter">&quot;</span><span class="content">my_metaphone</span><span class="delimiter">&quot;</span></span>
            ]
          }
        },
        <span class="key"><span class="delimiter">&quot;</span><span class="content">filter</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">my_metaphone</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">phonetic</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">encoder</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">metaphone</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">replace</span><span class="delimiter">&quot;</span></span>: <span class="value">false</span>
          }
        }
      }
    }
  }
}

<span class="error">P</span><span class="error">O</span><span class="error">S</span><span class="error">T</span> <span class="error">p</span><span class="error">h</span><span class="error">o</span><span class="error">n</span><span class="error">e</span><span class="error">t</span><span class="error">i</span><span class="error">c</span><span class="error">_</span><span class="error">s</span><span class="error">a</span><span class="error">m</span><span class="error">p</span><span class="error">l</span><span class="error">e</span><span class="error">/</span><span class="error">_</span><span class="error">a</span><span class="error">n</span><span class="error">a</span><span class="error">l</span><span class="error">y</span><span class="error">z</span><span class="error">e</span><span class="error">?</span><span class="error">a</span><span class="error">n</span><span class="error">a</span><span class="error">l</span><span class="error">y</span><span class="error">z</span><span class="error">e</span><span class="error">r</span><span class="error">=</span><span class="error">m</span><span class="error">y</span><span class="error">_</span><span class="error">a</span><span class="error">n</span><span class="error">a</span><span class="error">l</span><span class="error">y</span><span class="error">z</span><span class="error">e</span><span class="error">r</span><span class="error">&amp;</span><span class="error">t</span><span class="error">e</span><span class="error">x</span><span class="error">t</span><span class="error">=</span><span class="error">J</span><span class="error">o</span><span class="error">e</span> <span class="error">B</span><span class="error">l</span><span class="error">o</span><span class="error">g</span><span class="error">g</span><span class="error">s</span> <img src="./images/icons/callouts/1.png" alt="1"></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>Returns: <code>J</code>, <code>joe</code>, <code>BLKS</code>, <code>bloggs</code></td>
</tr>
</table>
</div>
<h5 id="_double_metaphone_settings" class="float">Double metaphone settings</h5>
<div class="paragraph">
<p>If the <code>double_metaphone</code> encoder is used, then this additional setting is
supported:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>max_code_len</code></dt>
<dd>
<p>The maximum length of the emitted metaphone token.  Defaults to <code>4</code>.</p>
</dd>
</dl>
</div>
<h5 id="_beider_morse_settings" class="float">Beider Morse settings</h5>
<div class="paragraph">
<p>If the <code>beider_morse</code> encoder is used, then these additional settings are
supported:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>rule_type</code></dt>
<dd>
<p>Whether matching should be <code>exact</code> or <code>approx</code> (default).</p>
</dd>
<dt class="hdlist1"><code>name_type</code></dt>
<dd>
<p>Whether names are <code>ashkenazi</code>, <code>sephardic</code>, or <code>generic</code> (default).</p>
</dd>
<dt class="hdlist1"><code>languageset</code></dt>
<dd>
<p>An array of languages to check. If not specified, then the language will
be guessed. Accepts: <code>any</code>, <code>comomon</code>, <code>cyrillic</code>, <code>english</code>, <code>french</code>,
<code>german</code>, <code>hebrew</code>, <code>hungarian</code>, <code>polish</code>, <code>romanian</code>, <code>russian</code>,
<code>spanish</code>.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="analysis-smartcn"><a class="anchor" href="#analysis-smartcn"></a>5.4. Smart Chinese Analysis Plugin</h3>
<div class="paragraph">
<p>The Smart Chinese Analysis plugin integrates Lucene&#8217;s Smart Chinese analysis
module into elasticsearch.</p>
</div>
<div class="paragraph">
<p>It provides an analyzer for Chinese or mixed Chinese-English text. This
analyzer uses probabilistic knowledge to find the optimal word segmentation
for Simplified Chinese text. The text is first broken into sentences, then
each sentence is segmented into words.</p>
</div>
<h4 id="analysis-smartcn-install" class="float">Installation</h4>
<div class="paragraph">
<p>This plugin can be installed using the plugin manager:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">sudo bin/plugin install analysis-smartcn</code></pre>
</div>
</div>
<div class="paragraph">
<p>The plugin must be installed on every node in the cluster, and each node must
be restarted after installation.</p>
</div>
<h4 id="analysis-smartcn-remove" class="float">Removal</h4>
<div class="paragraph">
<p>The plugin can be removed with the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">sudo bin/plugin remove analysis-smartcn</code></pre>
</div>
</div>
<div class="paragraph">
<p>The node must be stopped before removing the plugin.</p>
</div>
<h4 id="analysis-smartcn-tokenizer" class="float"><code>smartcn</code> tokenizer and token filter</h4>
<div class="paragraph">
<p>The plugin provides the <code>smartcn</code> analyzer and <code>smartcn_tokenizer</code> tokenizer,
which are not configurable.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<img src="./images/icons/note.png" alt="Note">
</td>
<td class="content">
The <code>smartcn_word</code> token filter and <code>smartcn_sentence</code> have been deprecated.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="analysis-stempel"><a class="anchor" href="#analysis-stempel"></a>5.5. Stempel Polish Analysis Plugin</h3>
<div class="paragraph">
<p>The Stempel Analysis plugin integrates Lucene&#8217;s Stempel analysis
module for Polish into elasticsearch.</p>
</div>
<div class="paragraph">
<p>It provides high quality stemming for Polish, based on the
<a href="http://www.egothor.org/">Egothor project</a>.</p>
</div>
<h4 id="analysis-stempel-install" class="float">Installation</h4>
<div class="paragraph">
<p>This plugin can be installed using the plugin manager:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">sudo bin/plugin install analysis-stempel</code></pre>
</div>
</div>
<div class="paragraph">
<p>The plugin must be installed on every node in the cluster, and each node must
be restarted after installation.</p>
</div>
<h4 id="analysis-stempel-remove" class="float">Removal</h4>
<div class="paragraph">
<p>The plugin can be removed with the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">sudo bin/plugin remove analysis-stempel</code></pre>
</div>
</div>
<div class="paragraph">
<p>The node must be stopped before removing the plugin.</p>
</div>
<h4 id="analysis-stempel-tokenizer" class="float"><code>stempel</code> tokenizer and token filter</h4>
<div class="paragraph">
<p>The plugin provides the <code>polish</code> analyzer and <code>polish_stem</code> token filter,
which are not configurable.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="discovery"><a class="anchor" href="#discovery"></a>6. Discovery Plugins</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Discovery plugins extend Elasticsearch by adding new discovery mechanisms that
can be used instead of <a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.3/modules-discovery-zen.html">Zen Discovery</a>.</p>
</div>
<h4 id="_core_discovery_plugins" class="float">Core discovery plugins</h4>
<div class="paragraph">
<p>The core discovery plugins are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="#cloud-aws">AWS Cloud</a></dt>
<dd>
<p>The Amazon Web Service (AWS) Cloud plugin uses the
<a href="https://github.com/aws/aws-sdk-java">AWS API</a> for unicast discovery, and adds
support for using S3 as a repository for
<a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.3/modules-snapshots.html">Snapshot/Restore</a>.</p>
</dd>
<dt class="hdlist1"><a href="#cloud-azure">Azure Cloud</a></dt>
<dd>
<p>The Azure Cloud plugin uses the Azure API for unicast discovery, and adds
support for using Azure as a repository for
<a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.3/modules-snapshots.html">Snapshot/Restore</a>.</p>
</dd>
<dt class="hdlist1"><a href="#cloud-gce">GCE Cloud</a></dt>
<dd>
<p>The Google Compute Engine Cloud plugin uses the GCE API for unicast discovery.</p>
</dd>
<dt class="hdlist1"><a href="#discovery-multicast">Multicast</a></dt>
<dd>
<p>The multicast plugin sends multicast messages to discover other nodes in the cluster.</p>
</dd>
</dl>
</div>
<h4 id="_community_contributed_discovery_plugins" class="float">Community contributed discovery plugins</h4>
<div class="paragraph">
<p>A number of discovery plugins have been contributed by our community:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/grantr/elasticsearch-srv-discovery">DNS SRV Discovery Plugin</a> (by Grant Rodgers)</p>
</li>
<li>
<p><a href="https://github.com/shikhar/eskka">eskka Discovery Plugin</a> (by Shikhar Bhushan)</p>
</li>
<li>
<p><a href="https://github.com/grmblfrz/elasticsearch-zookeeper">ZooKeeper Discovery Plugin</a> (by Sonian Inc.)</p>
</li>
<li>
<p><a href="https://github.com/fabric8io/elasticsearch-cloud-kubernetes">Kubernetes Discovery Plugin</a> (by Jimmi Dyson, <a href="http://fabric8.io">fabric8</a>)</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="cloud-aws"><a class="anchor" href="#cloud-aws"></a>6.1. AWS Cloud Plugin</h3>
<div class="paragraph">
<p>The Amazon Web Service (AWS) Cloud plugin uses the
<a href="https://github.com/aws/aws-sdk-java">AWS API</a> for unicast discovery, and adds
support for using S3 as a repository for
<a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.3/modules-snapshots.html">Snapshot/Restore</a>.</p>
</div>
<h4 id="cloud-aws-install" class="float">Installation</h4>
<div class="paragraph">
<p>This plugin can be installed using the plugin manager:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">sudo bin/plugin install cloud-aws</code></pre>
</div>
</div>
<div class="paragraph">
<p>The plugin must be installed on every node in the cluster, and each node must
be restarted after installation.</p>
</div>
<h4 id="cloud-aws-remove" class="float">Removal</h4>
<div class="paragraph">
<p>The plugin can be removed with the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">sudo bin/plugin remove cloud-aws</code></pre>
</div>
</div>
<div class="paragraph">
<p>The node must be stopped before removing the plugin.</p>
</div>
<div class="sect3">
<h4 id="cloud-aws-usage"><a class="anchor" href="#cloud-aws-usage"></a>6.1.1. Getting started with AWS</h4>
<div class="paragraph">
<p>The plugin will default to using
<a href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html">IAM Role</a>
credentials for authentication. These can be overridden by, in increasing
order of precedence, system properties <code>aws.accessKeyId</code> and <code>aws.secretKey</code>,
environment variables <code>AWS_ACCESS_KEY_ID</code> and <code>AWS_SECRET_KEY</code>, or the
elasticsearch config using <code>cloud.aws.access_key</code> and <code>cloud.aws.secret_key</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">cloud</span>:
    <span class="key">aws</span>:
        <span class="key">access_key</span>: <span class="string"><span class="content">AKVAIQBF2RECL7FJWGJQ</span></span>
        <span class="key">secret_key</span>: <span class="string"><span class="content">vExyMThREXeRMm/b/LRzEB8jWwvzQeXgjqMX+6br</span></span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="cloud-aws-usage-security"><a class="anchor" href="#cloud-aws-usage-security"></a>Transport security</h5>
<div class="paragraph">
<p>By default this plugin uses HTTPS for all API calls to AWS endpoints. If you wish to configure HTTP you can set
<code>cloud.aws.protocol</code> in the elasticsearch config. You can optionally override this setting per individual service
via: <code>cloud.aws.ec2.protocol</code> or <code>cloud.aws.s3.protocol</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">cloud</span>:
    <span class="key">aws</span>:
        <span class="key">protocol</span>: <span class="string"><span class="content">https</span></span>
        <span class="key">s3</span>:
            <span class="key">protocol</span>: <span class="string"><span class="content">http</span></span>
        <span class="key">ec2</span>:
            <span class="key">protocol</span>: <span class="string"><span class="content">https</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition, a proxy can be configured with the <code>proxy.host</code>, <code>proxy.port</code>, <code>proxy.username</code> and <code>proxy.password</code> settings
(note that protocol can be <code>http</code> or <code>https</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">cloud</span>:
    <span class="key">aws</span>:
        <span class="key">protocol</span>: <span class="string"><span class="content">https</span></span>
        <span class="key">proxy</span>:
            <span class="key">host</span>: <span class="string"><span class="content">proxy1.company.com</span></span>
            <span class="key">port</span>: <span class="string"><span class="content">8083</span></span>
            <span class="key">username</span>: <span class="string"><span class="content">myself</span></span>
            <span class="key">password</span>: <span class="string"><span class="content">theBestPasswordEver!</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also set different proxies for <code>ec2</code> and <code>s3</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">cloud</span>:
    <span class="key">aws</span>:
        <span class="key">s3</span>:
            <span class="key">proxy</span>:
                <span class="key">host</span>: <span class="string"><span class="content">proxy1.company.com</span></span>
                <span class="key">port</span>: <span class="string"><span class="content">8083</span></span>
                <span class="key">username</span>: <span class="string"><span class="content">myself1</span></span>
                <span class="key">password</span>: <span class="string"><span class="content">theBestPasswordEver1!</span></span>
        <span class="key">ec2</span>:
            <span class="key">proxy</span>:
                <span class="key">host</span>: <span class="string"><span class="content">proxy2.company.com</span></span>
                <span class="key">port</span>: <span class="string"><span class="content">8083</span></span>
                <span class="key">username</span>: <span class="string"><span class="content">myself2</span></span>
                <span class="key">password</span>: <span class="string"><span class="content">theBestPasswordEver2!</span></span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="cloud-aws-usage-region"><a class="anchor" href="#cloud-aws-usage-region"></a>Region</h5>
<div class="paragraph">
<p>The <code>cloud.aws.region</code> can be set to a region and will automatically use the relevant settings for both <code>ec2</code> and <code>s3</code>.
The available values are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>us-east</code> (<code>us-east-1</code>)</p>
</li>
<li>
<p><code>us-west</code> (<code>us-west-1</code>)</p>
</li>
<li>
<p><code>us-west-1</code></p>
</li>
<li>
<p><code>us-west-2</code></p>
</li>
<li>
<p><code>ap-southeast</code> (<code>ap-southeast-1</code>)</p>
</li>
<li>
<p><code>ap-southeast-1</code></p>
</li>
<li>
<p><code>ap-southeast-2</code></p>
</li>
<li>
<p><code>ap-northeast</code> (<code>ap-northeast-1</code>)</p>
</li>
<li>
<p><code>ap-northeast-2</code> (<code>ap-northeast-2</code>)</p>
</li>
<li>
<p><code>eu-west</code> (<code>eu-west-1</code>)</p>
</li>
<li>
<p><code>eu-central</code> (<code>eu-central-1</code>)</p>
</li>
<li>
<p><code>sa-east</code> (<code>sa-east-1</code>)</p>
</li>
<li>
<p><code>cn-north</code> (<code>cn-north-1</code>)</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="cloud-aws-usage-signer"><a class="anchor" href="#cloud-aws-usage-signer"></a>EC2/S3 Signer API</h5>
<div class="paragraph">
<p>If you are using a compatible EC2 or S3 service, they might be using an older API to sign the requests.
You can set your compatible signer API using <code>cloud.aws.signer</code> (or <code>cloud.aws.ec2.signer</code> and <code>cloud.aws.s3.signer</code>)
with the right signer to use.</p>
</div>
<div class="paragraph">
<p>If you are using a compatible S3 service which do not support Version 4 signing process, you may need to use
<code>S3SignerType</code> for <code>cloud.aws.s3.signer</code>, which is Signature Version 2.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cloud-aws-discovery"><a class="anchor" href="#cloud-aws-discovery"></a>6.1.2. EC2 Discovery</h4>
<div class="paragraph">
<p>ec2 discovery allows to use the ec2 APIs to perform automatic discovery (similar to multicast in non hostile multicast
environments). Here is a simple sample configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">discovery</span>:
    <span class="key">type</span>: <span class="string"><span class="content">ec2</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You must also set <code>cloud.aws.region</code> if you are not using default AWS region. See <a href="#cloud-aws-usage-region">Region</a> for details.</p>
</div>
<div class="paragraph">
<p>The ec2 discovery is using the same credentials as the rest of the AWS services provided by this plugin (<code>repositories</code>).
See <a href="#cloud-aws-usage">Getting started with AWS</a> for details.</p>
</div>
<div class="paragraph">
<p>The following are a list of settings (prefixed with <code>discovery.ec2</code>) that can further control the discovery:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>groups</code></dt>
<dd>
<p>Either a comma separated list or array based list of (security) groups.
Only instances with the provided security groups will be used in the
cluster discovery. (NOTE: You could provide either group NAME or group
ID.)</p>
</dd>
<dt class="hdlist1"><code>host_type</code></dt>
<dd>
<p>The type of host type to use to communicate with other instances. Can be
one of <code>private_ip</code>, <code>public_ip</code>, <code>private_dns</code>, <code>public_dns</code>. Defaults to
<code>private_ip</code>.</p>
</dd>
<dt class="hdlist1"><code>availability_zones</code></dt>
<dd>
<p>Either a comma separated list or array based list of availability zones.
Only instances within the provided availability zones will be used in the
cluster discovery.</p>
</dd>
<dt class="hdlist1"><code>any_group</code></dt>
<dd>
<p>If set to <code>false</code>, will require all security groups to be present for the
instance to be used for the discovery. Defaults to <code>true</code>.</p>
</dd>
<dt class="hdlist1"><code>ping_timeout</code></dt>
<dd>
<p>How long to wait for existing EC2 nodes to reply during discovery.
Defaults to <code>3s</code>. If no unit like <code>ms</code>, <code>s</code> or <code>m</code> is specified,
milliseconds are used.</p>
</dd>
<dt class="hdlist1"><code>node_cache_time</code></dt>
<dd>
<p>How long the list of hosts is cached to prevent further requests to the AWS API.
Defaults to <code>10s</code>.</p>
</dd>
</dl>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<img src="./images/icons/important.png" alt="Important">
</td>
<td class="content">
<div class="title">Binding the network host</div>
<div class="paragraph">
<p>It&#8217;s important to define <code>network.host</code> as by default it&#8217;s bound to <code>localhost</code>.</p>
</div>
<div class="paragraph">
<p>You can use <a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.3/modules-network.html">core network host settings</a> or
<a href="#cloud-aws-discovery-network-host">ec2 specific host settings</a>:</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="cloud-aws-discovery-network-host"><a class="anchor" href="#cloud-aws-discovery-network-host"></a>EC2 Network Host</h5>
<div class="paragraph">
<p>When the <code>cloud-aws</code> plugin is installed, the following are also allowed
as valid network host settings:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">EC2 Host Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>_ec2:privateIpv4_</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The private IP address (ipv4) of the machine.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>_ec2:privateDns_</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The private host of the machine.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>_ec2:publicIpv4_</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The public IP address (ipv4) of the machine.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>_ec2:publicDns_</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The public host of the machine.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>_ec2:privateIp_</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">equivalent to <code>_ec2:privateIpv4_</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>_ec2:publicIp_</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">equivalent to <code>_ec2:publicIpv4_</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>_ec2_</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">equivalent to <code>_ec2:privateIpv4_</code>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="cloud-aws-discovery-permissions"><a class="anchor" href="#cloud-aws-discovery-permissions"></a>Recommended EC2 Permissions</h5>
<div class="paragraph">
<p>EC2 discovery requires making a call to the EC2 service. You&#8217;ll want to setup
an IAM policy to allow this. You can create a custom policy via the IAM
Management Console. It should look similar to this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">Statement</span><span class="delimiter">&quot;</span></span>: [
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">Action</span><span class="delimiter">&quot;</span></span>: [
        <span class="string"><span class="delimiter">&quot;</span><span class="content">ec2:DescribeInstances</span><span class="delimiter">&quot;</span></span>
      ],
      <span class="key"><span class="delimiter">&quot;</span><span class="content">Effect</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Allow</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">Resource</span><span class="delimiter">&quot;</span></span>: [
        <span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span>
      ]
    }
  ],
  <span class="key"><span class="delimiter">&quot;</span><span class="content">Version</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2012-10-17</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="cloud-aws-discovery-filtering"><a class="anchor" href="#cloud-aws-discovery-filtering"></a>Filtering by Tags</h5>
<div class="paragraph">
<p>The ec2 discovery can also filter machines to include in the cluster based on tags (and not just groups). The settings
to use include the <code>discovery.ec2.tag.</code> prefix. For example, setting <code>discovery.ec2.tag.stage</code> to <code>dev</code> will only
filter instances with a tag key set to <code>stage</code>, and a value of <code>dev</code>. Several tags set will require all of those tags
to be set for the instance to be included.</p>
</div>
<div class="paragraph">
<p>One practical use for tag filtering is when an ec2 cluster contains many nodes that are not running elasticsearch. In
this case (particularly with high <code>ping_timeout</code> values) there is a risk that a new node&#8217;s discovery phase will end
before it has found the cluster (which will result in it declaring itself master of a new cluster with the same name
- highly undesirable). Tagging elasticsearch ec2 nodes and then filtering by that tag will resolve this issue.</p>
</div>
</div>
<div class="sect4">
<h5 id="cloud-aws-discovery-attributes"><a class="anchor" href="#cloud-aws-discovery-attributes"></a>Automatic Node Attributes</h5>
<div class="paragraph">
<p>Though not dependent on actually using <code>ec2</code> as discovery (but still requires the cloud aws plugin installed), the
plugin can automatically add node attributes relating to ec2 (for example, availability zone, that can be used with
the awareness allocation feature). In order to enable it, set <code>cloud.node.auto_attributes</code> to <code>true</code> in the settings.</p>
</div>
</div>
<div class="sect4">
<h5 id="cloud-aws-discovery-endpoint"><a class="anchor" href="#cloud-aws-discovery-endpoint"></a>Using other EC2 endpoint</h5>
<div class="paragraph">
<p>If you are using any EC2 api compatible service, you can set the endpoint you want to use by setting
<code>cloud.aws.ec2.endpoint</code> to your URL provider.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cloud-aws-repository"><a class="anchor" href="#cloud-aws-repository"></a>6.1.3. S3 Repository</h4>
<div class="paragraph">
<p>The S3 repository is using S3 to store snapshots. The S3 repository can be created using the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json"><span class="error">P</span><span class="error">U</span><span class="error">T</span> <span class="error">_</span><span class="error">s</span><span class="error">n</span><span class="error">a</span><span class="error">p</span><span class="error">s</span><span class="error">h</span><span class="error">o</span><span class="error">t</span><span class="error">/</span><span class="error">m</span><span class="error">y</span><span class="error">_</span><span class="error">s</span><span class="integer">3</span><span class="error">_</span><span class="error">r</span><span class="error">e</span><span class="error">p</span><span class="error">o</span><span class="error">s</span><span class="error">i</span><span class="error">t</span><span class="error">o</span><span class="error">r</span><span class="error">y</span>
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">s3</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">settings</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">bucket</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">my_bucket_name</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">region</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">us-west</span><span class="delimiter">&quot;</span></span>
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following settings are supported:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>bucket</code></dt>
<dd>
<p>The name of the bucket to be used for snapshots. (Mandatory)</p>
</dd>
<dt class="hdlist1"><code>region</code></dt>
<dd>
<p>The region where bucket is located. Defaults to US Standard</p>
</dd>
<dt class="hdlist1"><code>endpoint</code></dt>
<dd>
<p>The endpoint to the S3 API. Defaults to AWS&#8217;s default S3 endpoint. Note
that setting a region overrides the endpoint setting.</p>
</dd>
<dt class="hdlist1"><code>protocol</code></dt>
<dd>
<p>The protocol to use (<code>http</code> or <code>https</code>). Defaults to value of
<code>cloud.aws.protocol</code> or <code>cloud.aws.s3.protocol</code>.</p>
</dd>
<dt class="hdlist1"><code>base_path</code></dt>
<dd>
<p>Specifies the path within bucket to repository data. Defaults to
value of <code>repositories.s3.base_path</code> or to root directory if not set.</p>
</dd>
<dt class="hdlist1"><code>access_key</code></dt>
<dd>
<p>The access key to use for authentication. Defaults to value of
<code>cloud.aws.access_key</code>.</p>
</dd>
<dt class="hdlist1"><code>secret_key</code></dt>
<dd>
<p>The secret key to use for authentication. Defaults to value of
<code>cloud.aws.secret_key</code>.</p>
</dd>
<dt class="hdlist1"><code>chunk_size</code></dt>
<dd>
<p>Big files can be broken down into chunks during snapshotting if needed.
The chunk size can be specified in bytes or by using size value notation,
i.e. <code>1g</code>, <code>10m</code>, <code>5k</code>. Defaults to <code>100m</code>.</p>
</dd>
<dt class="hdlist1"><code>compress</code></dt>
<dd>
<p>When set to <code>true</code> metadata files are stored in compressed format. This
setting doesn&#8217;t affect index files that are already compressed by default.
Defaults to <code>false</code>.</p>
</dd>
<dt class="hdlist1"><code>server_side_encryption</code></dt>
<dd>
<p>When set to <code>true</code> files are encrypted on server side using AES256
algorithm. Defaults to <code>false</code>.</p>
</dd>
<dt class="hdlist1"><code>buffer_size</code></dt>
<dd>
<p>Minimum threshold below which the chunk is uploaded using a single
request. Beyond this threshold, the S3 repository will use the
<a href="http://docs.aws.amazon.com/AmazonS3/latest/dev/uploadobjusingmpu.html">AWS Multipart Upload API</a>
to split the chunk into several parts, each of <code>buffer_size</code> length, and
to upload each part in its own request. Note that setting a buffer
size lower than <code>5mb</code> is not allowed since it will prevents the use of the
Multipart API and may result in upload errors. Defaults to <code>5mb</code>.</p>
</dd>
<dt class="hdlist1"><code>max_retries</code></dt>
<dd>
<p>Number of retries in case of S3 errors. Defaults to <code>3</code>.</p>
</dd>
<dt class="hdlist1"><code>read_only</code></dt>
<dd>
<p>Makes repository read-only. Defaults to <code>false</code>.</p>
</dd>
<dt class="hdlist1"><code>canned_acl</code></dt>
<dd>
<p>The S3 repository supports all <a href="http://docs.aws.amazon.com/AmazonS3/latest/dev/acl-overview.html#canned-acl">S3 canned ACLs</a>
: <code>private</code>, <code>public-read</code>, <code>public-read-write</code>, <code>authenticated-read</code>, <code>log-delivery-write</code>,
<code>bucket-owner-read</code>, <code>bucket-owner-full-control</code>. Defaults to <code>private</code>.
You could specify a canned ACL using the <code>canned_acl</code> setting. When the S3 repository
creates buckets and objects, it adds the canned ACL into the buckets and objects.</p>
</dd>
<dt class="hdlist1"><code>storage_class</code></dt>
<dd>
<p>Sets the S3 storage class type for the backup files. Values may be
<code>standard</code>, <code>reduced_redundancy</code>, <code>standard_ia</code>. Defaults to <code>standard</code>.
Due to the extra complexity with the Glacier class lifecycle, it is not
currently supported by the plugin. For more information about the
different classes, see <a href="http://docs.aws.amazon.com/AmazonS3/latest/dev/storage-class-intro.html">AWS Storage Classes Guide</a></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The S3 repositories use the same credentials as the rest of the AWS services
provided by this plugin (<code>discovery</code>). See <a href="#cloud-aws-usage">Getting started with AWS</a> for details.</p>
</div>
<div class="paragraph">
<p>Multiple S3 repositories can be created. If the buckets require different
credentials, then define them as part of the repository settings.</p>
</div>
<div class="sect4">
<h5 id="cloud-aws-repository-permissions"><a class="anchor" href="#cloud-aws-repository-permissions"></a>Recommended S3 Permissions</h5>
<div class="paragraph">
<p>In order to restrict the Elasticsearch snapshot process to the minimum required resources, we recommend using Amazon
IAM in conjunction with pre-existing S3 buckets. Here is an example policy which will allow the snapshot access to an
 S3 bucket named "snaps.example.com". This may be configured through the AWS IAM console, by creating a Custom Policy,
 and using a Policy Document similar to this (changing snaps.example.com to your bucket name).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">Statement</span><span class="delimiter">&quot;</span></span>: [
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">Action</span><span class="delimiter">&quot;</span></span>: [
        <span class="string"><span class="delimiter">&quot;</span><span class="content">s3:ListBucket</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">s3:GetBucketLocation</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">s3:ListBucketMultipartUploads</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">s3:ListBucketVersions</span><span class="delimiter">&quot;</span></span>
      ],
      <span class="key"><span class="delimiter">&quot;</span><span class="content">Effect</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Allow</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">Resource</span><span class="delimiter">&quot;</span></span>: [
        <span class="string"><span class="delimiter">&quot;</span><span class="content">arn:aws:s3:::snaps.example.com</span><span class="delimiter">&quot;</span></span>
      ]
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">Action</span><span class="delimiter">&quot;</span></span>: [
        <span class="string"><span class="delimiter">&quot;</span><span class="content">s3:GetObject</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">s3:PutObject</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">s3:DeleteObject</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">s3:AbortMultipartUpload</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">s3:ListMultipartUploadParts</span><span class="delimiter">&quot;</span></span>
      ],
      <span class="key"><span class="delimiter">&quot;</span><span class="content">Effect</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Allow</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">Resource</span><span class="delimiter">&quot;</span></span>: [
        <span class="string"><span class="delimiter">&quot;</span><span class="content">arn:aws:s3:::snaps.example.com/*</span><span class="delimiter">&quot;</span></span>
      ]
    }
  ],
  <span class="key"><span class="delimiter">&quot;</span><span class="content">Version</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2012-10-17</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You may further restrict the permissions by specifying a prefix within the bucket, in this example, named "foo".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">Statement</span><span class="delimiter">&quot;</span></span>: [
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">Action</span><span class="delimiter">&quot;</span></span>: [
        <span class="string"><span class="delimiter">&quot;</span><span class="content">s3:ListBucket</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">s3:GetBucketLocation</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">s3:ListBucketMultipartUploads</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">s3:ListBucketVersions</span><span class="delimiter">&quot;</span></span>
      ],
      <span class="key"><span class="delimiter">&quot;</span><span class="content">Condition</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">StringLike</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">s3:prefix</span><span class="delimiter">&quot;</span></span>: [
            <span class="string"><span class="delimiter">&quot;</span><span class="content">foo/*</span><span class="delimiter">&quot;</span></span>
          ]
        }
      },
      <span class="key"><span class="delimiter">&quot;</span><span class="content">Effect</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Allow</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">Resource</span><span class="delimiter">&quot;</span></span>: [
        <span class="string"><span class="delimiter">&quot;</span><span class="content">arn:aws:s3:::snaps.example.com</span><span class="delimiter">&quot;</span></span>
      ]
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">Action</span><span class="delimiter">&quot;</span></span>: [
        <span class="string"><span class="delimiter">&quot;</span><span class="content">s3:GetObject</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">s3:PutObject</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">s3:DeleteObject</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">s3:AbortMultipartUpload</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">s3:ListMultipartUploadParts</span><span class="delimiter">&quot;</span></span>
      ],
      <span class="key"><span class="delimiter">&quot;</span><span class="content">Effect</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Allow</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">Resource</span><span class="delimiter">&quot;</span></span>: [
        <span class="string"><span class="delimiter">&quot;</span><span class="content">arn:aws:s3:::snaps.example.com/foo/*</span><span class="delimiter">&quot;</span></span>
      ]
    }
  ],
  <span class="key"><span class="delimiter">&quot;</span><span class="content">Version</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2012-10-17</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The bucket needs to exist to register a repository for snapshots. If you did not create the bucket then the repository
registration will fail. If you want elasticsearch to create the bucket instead, you can add the permission to create a
specific bucket like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">{
   <span class="key"><span class="delimiter">&quot;</span><span class="content">Action</span><span class="delimiter">&quot;</span></span>: [
      <span class="string"><span class="delimiter">&quot;</span><span class="content">s3:CreateBucket</span><span class="delimiter">&quot;</span></span>
   ],
   <span class="key"><span class="delimiter">&quot;</span><span class="content">Effect</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Allow</span><span class="delimiter">&quot;</span></span>,
   <span class="key"><span class="delimiter">&quot;</span><span class="content">Resource</span><span class="delimiter">&quot;</span></span>: [
      <span class="string"><span class="delimiter">&quot;</span><span class="content">arn:aws:s3:::snaps.example.com</span><span class="delimiter">&quot;</span></span>
   ]
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="cloud-aws-repository-endpoint"><a class="anchor" href="#cloud-aws-repository-endpoint"></a>Using other S3 endpoint</h5>
<div class="paragraph">
<p>If you are using any S3 api compatible service, you can set a global endpoint by setting <code>cloud.aws.s3.endpoint</code>
to your URL provider. Note that this setting will be used for all S3 repositories.</p>
</div>
<div class="paragraph">
<p>Different <code>endpoint</code>, <code>region</code> and <code>protocol</code> settings can be set on a per-repository basis
See <a href="#cloud-aws-repository">S3 Repository</a> for details.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cloud-aws-repository-aws-vpc"><a class="anchor" href="#cloud-aws-repository-aws-vpc"></a>6.1.4. AWS VPC Bandwidth Settings</h4>
<div class="paragraph">
<p>AWS instances resolve S3 endpoints to a public IP. If the elasticsearch instances reside in a private subnet in an AWS VPC then all traffic to S3 will go through that VPC&#8217;s NAT instance. If your VPC&#8217;s NAT instance is a smaller instance size (e.g. a t1.micro) or is handling a high volume of network traffic your bandwidth to S3 may be limited by that NAT instance&#8217;s networking bandwidth limitations.</p>
</div>
<div class="paragraph">
<p>Instances residing in a public subnet in an AWS VPC will connect to S3 via the VPC&#8217;s internet gateway and not be bandwidth limited by the VPC&#8217;s NAT instance.</p>
</div>
</div>
<div class="sect3">
<h4 id="cloud-aws-testing"><a class="anchor" href="#cloud-aws-testing"></a>6.1.5. Testing AWS</h4>
<div class="paragraph">
<p>Integrations tests in this plugin require working AWS configuration and therefore disabled by default. Three buckets
and two iam users have to be created. The first iam user needs access to two buckets in different regions and the final
bucket is exclusive for the other iam user. To enable tests prepare a config file elasticsearch.yml with the following
content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">cloud</span>:
    <span class="key">aws</span>:
        <span class="key">access_key</span>: <span class="string"><span class="content">AKVAIQBF2RECL7FJWGJQ</span></span>
        <span class="key">secret_key</span>: <span class="string"><span class="content">vExyMThREXeRMm/b/LRzEB8jWwvzQeXgjqMX+6br</span></span>

<span class="key">repositories</span>:
    <span class="key">s3</span>:
        <span class="key">bucket</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">bucket_name</span><span class="delimiter">&quot;</span></span>
        <span class="key">region</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">us-west-2</span><span class="delimiter">&quot;</span></span>
        <span class="key">private-bucket</span>:
            <span class="key">bucket</span>: <span class="string"><span class="content">&lt;bucket not accessible by default key&gt;</span></span>
            <span class="key">access_key</span>: <span class="string"><span class="content">&lt;access key&gt;</span></span>
            <span class="key">secret_key</span>: <span class="string"><span class="content">&lt;secret key&gt;</span></span>
        <span class="key">remote-bucket</span>:
            <span class="key">bucket</span>: <span class="string"><span class="content">&lt;bucket in other region&gt;</span></span>
            <span class="key">region</span>: <span class="string"><span class="content">&lt;region&gt;</span></span>
<span class="error">        </span><span class="key">external-bucket</span>:
<span class="error">        </span>    <span class="key">bucket</span>: <span class="string"><span class="content">&lt;bucket&gt;</span></span>
<span class="error">        </span>    <span class="key">access_key</span>: <span class="string"><span class="content">&lt;access key&gt;</span></span>
<span class="error">        </span>    <span class="key">secret_key</span>: <span class="string"><span class="content">&lt;secret key&gt;</span></span>
<span class="error">        </span>    <span class="key">endpoint</span>: <span class="string"><span class="content">&lt;endpoint&gt;</span></span>
<span class="error">        </span>    <span class="key">protocol</span>: <span class="string"><span class="content">&lt;protocol&gt;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Replace all occurrences of <code>access_key</code>, <code>secret_key</code>, <code>endpoint</code>, <code>protocol</code>, <code>bucket</code> and <code>region</code> with your settings.
Please, note that the test will delete all snapshot/restore related files in the specified buckets.</p>
</div>
<div class="paragraph">
<p>To run test:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn -Dtests.aws=true -Dtests.config=/path/to/config/file/elasticsearch.yml clean test</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cloud-aws-best-practices"><a class="anchor" href="#cloud-aws-best-practices"></a>6.1.6. Best Practices in AWS</h4>
<div class="paragraph">
<p>Collection of best practices and other information around running Elasticsearch on AWS.</p>
</div>
<div class="sect4">
<h5 id="_instance_disk"><a class="anchor" href="#_instance_disk"></a>Instance/Disk</h5>
<div class="paragraph">
<p>When selecting disk please be aware of the following order of preference:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://aws.amazon.com/efs/">EFS</a> - Avoid as the sacrifices made to offer durability, shared storage, and grow/shrink come at performance cost, such file systems have been known to cause corruption of indices, and due to Elasticsearch being distributed and having built-in replication, the benefits that EFS offers are not needed.</p>
</li>
<li>
<p><a href="https://aws.amazon.com/ebs/">EBS</a> - Works well if running a small cluster (1-2 nodes) and cannot tolerate the loss all storage backing a node easily or if running indices with no replicas. If EBS is used, then leverage provisioned IOPS to ensure performance.</p>
</li>
<li>
<p><a href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/InstanceStorage.html">Instance Store</a> - When running clusters of larger size and with replicas the ephemeral nature of Instance Store is ideal since Elasticsearch can tolerate the loss of shards. With Instance Store one gets the performance benefit of having disk physically attached to the host running the instance and also the cost benefit of avoiding paying extra for EBS.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Prefer <a href="https://aws.amazon.com/amazon-linux-ami/">Amazon Linux AMIs</a> as since Elasticsearch runs on the JVM, OS dependencies are very minimal and one can benefit from the lightweight nature, support, and performance tweaks specific to EC2 that the Amazon Linux AMIs offer.</p>
</div>
</div>
<div class="sect4">
<h5 id="_networking"><a class="anchor" href="#_networking"></a>Networking</h5>
<div class="ulist">
<ul>
<li>
<p>Networking throttling takes place on smaller instance types in both the form of <a href="https://lab.getbase.com/how-we-discovered-limitations-on-the-aws-tcp-stack/">bandwidth and number of connections</a>. Therefore if large number of connections are needed and networking is becoming a bottleneck, avoid <a href="https://aws.amazon.com/ec2/instance-types/">instance types</a> with networking labeled as <code>Moderate</code> or <code>Low</code>.</p>
</li>
<li>
<p>Multicast is not supported, even when in an VPC; the aws cloud plugin which joins by performing a security group lookup.</p>
</li>
<li>
<p>When running in multiple <a href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-regions-availability-zones.html">availability zones</a> be sure to leverage <a href="https://www.elastic.co/guide/en/elasticsearch/reference/master/allocation-awareness.html">shard allocation awareness</a> so that not all copies of shard data reside in the same availability zone.</p>
</li>
<li>
<p>Do not span a cluster across regions.  If necessary, use a tribe node.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_misc"><a class="anchor" href="#_misc"></a>Misc</h5>
<div class="ulist">
<ul>
<li>
<p>If you have split your nodes into roles, consider <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/Using_Tags.html">tagging the EC2 instances</a> by role to make it easier to filter and view your EC2 instances in the AWS console.</p>
</li>
<li>
<p>Consider <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/terminating-instances.html#Using_ChangingDisableAPITermination">enabling termination protection</a> for all of your instances to avoid accidentally terminating a node in the cluster and causing a potentially disruptive reallocation.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cloud-azure"><a class="anchor" href="#cloud-azure"></a>6.2. Azure Cloud Plugin</h3>
<div class="paragraph">
<p>The Azure Cloud plugin uses the Azure API for unicast discovery, and adds
support for using Azure as a repository for
<a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.3/modules-snapshots.html">Snapshot/Restore</a>.</p>
</div>
<h4 id="cloud-azure-install" class="float">Installation</h4>
<div class="paragraph">
<p>This plugin can be installed using the plugin manager:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">sudo bin/plugin install cloud-azure</code></pre>
</div>
</div>
<div class="paragraph">
<p>The plugin must be installed on every node in the cluster, and each node must
be restarted after installation.</p>
</div>
<h4 id="cloud-azure-remove" class="float">Removal</h4>
<div class="paragraph">
<p>The plugin can be removed with the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">sudo bin/plugin remove cloud-azure</code></pre>
</div>
</div>
<div class="paragraph">
<p>The node must be stopped before removing the plugin.</p>
</div>
<div class="sect3">
<h4 id="cloud-azure-discovery"><a class="anchor" href="#cloud-azure-discovery"></a>6.2.1. Azure Virtual Machine Discovery</h4>
<div class="paragraph">
<p>Azure VM discovery allows to use the azure APIs to perform automatic discovery (similar to multicast in non hostile
multicast environments). Here is a simple sample configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">cloud</span>:
    <span class="key">azure</span>:
        <span class="key">management</span>:
             <span class="key">subscription.id</span>: <span class="string"><span class="content">XXX-XXX-XXX-XXX</span></span>
             <span class="key">cloud.service.name</span>: <span class="string"><span class="content">es-demo-app</span></span>
             <span class="key">keystore</span>:
                   <span class="key">path</span>: <span class="string"><span class="content">/path/to/azurekeystore.pkcs12</span></span>
                   <span class="key">password</span>: <span class="string"><span class="content">WHATEVER</span></span>
                   <span class="key">type</span>: <span class="string"><span class="content">pkcs12</span></span>

<span class="key">discovery</span>:
    <span class="key">type</span>: <span class="string"><span class="content">azure</span></span></code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<img src="./images/icons/important.png" alt="Important">
</td>
<td class="content">
<div class="title">Binding the network host</div>
<div class="paragraph">
<p>It&#8217;s important to define <code>network.host</code> as by default it&#8217;s bound to <code>localhost</code>.</p>
</div>
<div class="paragraph">
<p>You can use <a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.3/modules-network.html">core network host settings</a>. For example <code>_non_loopback_</code> or <code>_en0_</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="cloud-azure-discovery-short"><a class="anchor" href="#cloud-azure-discovery-short"></a>How to start (short story)</h5>
<div class="ulist">
<ul>
<li>
<p>Create Azure instances</p>
</li>
<li>
<p>Install Elasticsearch</p>
</li>
<li>
<p>Install Azure plugin</p>
</li>
<li>
<p>Modify <code>elasticsearch.yml</code> file</p>
</li>
<li>
<p>Start Elasticsearch</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="cloud-azure-discovery-settings"><a class="anchor" href="#cloud-azure-discovery-settings"></a>Azure credential API settings</h5>
<div class="paragraph">
<p>The following are a list of settings that can further control the credential API:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>cloud.azure.management.keystore.path</code>
</td>
<td class="hdlist2">
<p>/path/to/keystore</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>cloud.azure.management.keystore.type</code>
</td>
<td class="hdlist2">
<p><code>pkcs12</code>, <code>jceks</code> or <code>jks</code>. Defaults to <code>pkcs12</code>.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>cloud.azure.management.keystore.password</code>
</td>
<td class="hdlist2">
<p>your_password for the keystore</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>cloud.azure.management.subscription.id</code>
</td>
<td class="hdlist2">
<p>your_azure_subscription_id</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>cloud.azure.management.cloud.service.name</code>
</td>
<td class="hdlist2">
<p>your_azure_cloud_service_name</p>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="cloud-azure-discovery-settings-advanced"><a class="anchor" href="#cloud-azure-discovery-settings-advanced"></a>Advanced settings</h5>
<div class="paragraph">
<p>The following are a list of settings that can further control the discovery:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>discovery.azure.host.type</code></dt>
<dd>
<p>Either <code>public_ip</code> or <code>private_ip</code> (default). Azure discovery will use the
one you set to ping other nodes.</p>
</dd>
<dt class="hdlist1"><code>discovery.azure.endpoint.name</code></dt>
<dd>
<p>When using <code>public_ip</code> this setting is used to identify the endpoint name
used to forward requests to elasticsearch (aka transport port name).
Defaults to <code>elasticsearch</code>. In Azure management console, you could define
an endpoint <code>elasticsearch</code> forwarding for example requests on public IP
on port 8100 to the virtual machine on port 9300.</p>
</dd>
<dt class="hdlist1"><code>discovery.azure.deployment.name</code></dt>
<dd>
<p>Deployment name if any. Defaults to the value set with
<code>cloud.azure.management.cloud.service.name</code>.</p>
</dd>
<dt class="hdlist1"><code>discovery.azure.deployment.slot</code></dt>
<dd>
<p>Either <code>staging</code> or <code>production</code> (default).</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">discovery</span>:
    <span class="key">type</span>: <span class="string"><span class="content">azure</span></span>
    <span class="key">azure</span>:
        <span class="key">host</span>:
            <span class="key">type</span>: <span class="string"><span class="content">private_ip</span></span>
        <span class="key">endpoint</span>:
            <span class="key">name</span>: <span class="string"><span class="content">elasticsearch</span></span>
        <span class="key">deployment</span>:
            <span class="key">name</span>: <span class="string"><span class="content">your_azure_cloud_service_name</span></span>
            <span class="key">slot</span>: <span class="string"><span class="content">production</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cloud-azure-discovery-long"><a class="anchor" href="#cloud-azure-discovery-long"></a>6.2.2. Setup process for Azure Discovery</h4>
<div class="paragraph">
<p>We will expose here one strategy which is to hide our Elasticsearch cluster from outside.</p>
</div>
<div class="paragraph">
<p>With this strategy, only VMs behind the same virtual port can talk to each
other.  That means that with this mode, you can use elasticsearch unicast
discovery to build a cluster, using the Azure API to retrieve information
about your nodes.</p>
</div>
<div class="sect4">
<h5 id="cloud-azure-discovery-long-prerequisites"><a class="anchor" href="#cloud-azure-discovery-long-prerequisites"></a>Prerequisites</h5>
<div class="paragraph">
<p>Before starting, you need to have:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <a href="http://www.windowsazure.com/">Windows Azure account</a></p>
</li>
<li>
<p>OpenSSL that isn&#8217;t from MacPorts, specifically <code>OpenSSL 1.0.1f 6 Jan
 2014</code> doesn&#8217;t seem to create a valid keypair for ssh. FWIW,
<code>OpenSSL 1.0.1c 10 May 2012</code> on Ubuntu 12.04 LTS is known to work.</p>
</li>
<li>
<p>SSH keys and certificate</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>You should follow <a href="http://azure.microsoft.com/en-us/documentation/articles/linux-use-ssh-key/">this guide</a> to learn
how to create or use existing SSH keys. If you have already did it, you can skip the following.</p>
</div>
<div class="paragraph">
<p>Here is a description on how to generate SSH keys using <code>openssl</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh"># You may want to use another dir than /tmp
cd /tmp
openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout azure-private.key -out azure-certificate.pem
chmod 600 azure-private.key azure-certificate.pem
openssl x509 -outform der -in azure-certificate.pem -out azure-certificate.cer</code></pre>
</div>
</div>
<div class="paragraph">
<p>Generate a keystore which will be used by the plugin to authenticate with a certificate
all Azure API calls.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh"># Generate a keystore (azurekeystore.pkcs12)
# Transform private key to PEM format
openssl pkcs8 -topk8 -nocrypt -in azure-private.key -inform PEM -out azure-pk.pem -outform PEM
# Transform certificate to PEM format
openssl x509 -inform der -in azure-certificate.cer -out azure-cert.pem
cat azure-cert.pem azure-pk.pem &gt; azure.pem.txt
# You MUST enter a password!
openssl pkcs12 -export -in azure.pem.txt -out azurekeystore.pkcs12 -name azure -noiter -nomaciter</code></pre>
</div>
</div>
<div class="paragraph">
<p>Upload the <code>azure-certificate.cer</code> file both in the elasticsearch Cloud Service (under <code>Manage Certificates</code>),
and under <code>Settings -&gt; Manage Certificates</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<img src="./images/icons/important.png" alt="Important">
</td>
<td class="content">
When prompted for a password, you need to enter a non empty one.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See this <a href="http://www.windowsazure.com/en-us/manage/linux/how-to-guides/ssh-into-linux/">guide</a> for
more details about how to create keys for Azure.</p>
</div>
<div class="paragraph">
<p>Once done, you need to upload your certificate in Azure:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Go to the <a href="https://account.windowsazure.com/">management console</a>.</p>
</li>
<li>
<p>Sign in using your account.</p>
</li>
<li>
<p>Click on <code>Portal</code>.</p>
</li>
<li>
<p>Go to Settings (bottom of the left list)</p>
</li>
<li>
<p>On the bottom bar, click on <code>Upload</code> and upload your <code>azure-certificate.cer</code> file.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You may want to use
<a href="http://www.windowsazure.com/en-us/develop/nodejs/how-to-guides/command-line-tools/">Windows Azure Command-Line Tool</a>:</p>
</div>
</div>
</div>
</li>
<li>
<p>Install <a href="https://github.com/joyent/node/wiki/Installing-Node.js-via-package-manager">NodeJS</a>, for example using
homebrew on MacOS X:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">brew install node</code></pre>
</div>
</div>
</li>
<li>
<p>Install Azure tools</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">sudo npm install azure-cli -g</code></pre>
</div>
</div>
</li>
<li>
<p>Download and import your azure settings:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh"># This will open a browser and will download a .publishsettings file
azure account download

# Import this file (we have downloaded it to /tmp)
# Note, it will create needed files in ~/.azure. You can remove azure.publishsettings when done.
azure account import /tmp/azure.publishsettings</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="cloud-azure-discovery-long-instance"><a class="anchor" href="#cloud-azure-discovery-long-instance"></a>Creating your first instance</h5>
<div class="paragraph">
<p>You need to have a storage account available. Check <a href="http://www.windowsazure.com/en-us/develop/net/how-to-guides/blob-storage/#create-account">Azure Blob Storage documentation</a>
for more information.</p>
</div>
<div class="paragraph">
<p>You will need to choose the operating system you want to run on. To get a list of official available images, run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">azure vm image list</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s say we are going to deploy an Ubuntu image on an extra small instance in West Europe:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
Azure cluster name
</td>
<td class="hdlist2">
<p><code>azure-elasticsearch-cluster</code></p>
</td>
</tr>
<tr>
<td class="hdlist1">
Image
</td>
<td class="hdlist2">
<p><code>b39f27a8b8c64d52b05eac6a62ebad85__Ubuntu-13_10-amd64-server-20130808-alpha3-en-us-30GB</code></p>
</td>
</tr>
<tr>
<td class="hdlist1">
VM Name
</td>
<td class="hdlist2">
<p><code>myesnode1</code></p>
</td>
</tr>
<tr>
<td class="hdlist1">
VM Size
</td>
<td class="hdlist2">
<p><code>extrasmall</code></p>
</td>
</tr>
<tr>
<td class="hdlist1">
Location
</td>
<td class="hdlist2">
<p><code>West Europe</code></p>
</td>
</tr>
<tr>
<td class="hdlist1">
Login
</td>
<td class="hdlist2">
<p><code>elasticsearch</code></p>
</td>
</tr>
<tr>
<td class="hdlist1">
Password
</td>
<td class="hdlist2">
<p><code>password1234!!</code></p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Using command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">azure vm create azure-elasticsearch-cluster \
                b39f27a8b8c64d52b05eac6a62ebad85__Ubuntu-13_10-amd64-server-20130808-alpha3-en-us-30GB \
                --vm-name myesnode1 \
                --location &quot;West Europe&quot; \
                --vm-size extrasmall \
                --ssh 22 \
                --ssh-cert /tmp/azure-certificate.pem \
                elasticsearch password1234\!\!</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should see something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">info:    Executing command vm create
+ Looking up image
+ Looking up cloud service
+ Creating cloud service
+ Retrieving storage accounts
+ Configuring certificate
+ Creating VM
info:    vm create command OK</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, your first instance is started.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<img src="./images/icons/tip.png" alt="Tip">
</td>
<td class="content">
<div class="title">Working with SSH</div>
<div class="paragraph">
<p>You need to give the private key and username each time you log on your instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">ssh -i ~/.ssh/azure-private.key elasticsearch@myescluster.cloudapp.net</code></pre>
</div>
</div>
<div class="paragraph">
<p>But you can also define it once in <code>~/.ssh/config</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">Host *.cloudapp.net
 User elasticsearch
 StrictHostKeyChecking no
 UserKnownHostsFile=/dev/null
 IdentityFile ~/.ssh/azure-private.key</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Next, you need to install Elasticsearch on your new instance. First, copy your
keystore to the instance, then connect to the instance using SSH:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">scp /tmp/azurekeystore.pkcs12 azure-elasticsearch-cluster.cloudapp.net:/home/elasticsearch
ssh azure-elasticsearch-cluster.cloudapp.net</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once connected, install Elasticsearch:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh"># Install Latest Java version
# Read http://www.webupd8.org/2012/09/install-oracle-java-8-in-ubuntu-via-ppa.html for details
sudo add-apt-repository ppa:webupd8team/java
sudo apt-get update
sudo apt-get install oracle-java8-installer

# If you want to install OpenJDK instead
# sudo apt-get update
# sudo apt-get install openjdk-8-jre-headless

# Download Elasticsearch
curl -s https://download.elasticsearch.org/elasticsearch/elasticsearch/elasticsearch-2.0.0.deb -o elasticsearch-2.0.0.deb

# Prepare Elasticsearch installation
sudo dpkg -i elasticsearch-2.0.0.deb</code></pre>
</div>
</div>
<div class="paragraph">
<p>Check that elasticsearch is running:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">curl http://localhost:9200/</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command should give you a JSON result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span> : <span class="integer">200</span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">Living Colossus</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span> : {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">number</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">2.0.0</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">build_hash</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">a46900e9c72c0a623d71b54016357d5f94c8ea32</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">build_timestamp</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">2014-02-12T16:18:34Z</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">build_snapshot</span><span class="delimiter">&quot;</span></span> : <span class="predefined-constant">false</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">lucene_version</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">5.1</span><span class="delimiter">&quot;</span></span>
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">tagline</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">You Know, for Search</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="cloud-azure-discovery-long-plugin"><a class="anchor" href="#cloud-azure-discovery-long-plugin"></a>Install elasticsearch cloud azure plugin</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh"># Stop elasticsearch
sudo service elasticsearch stop

# Install the plugin
sudo /usr/share/elasticsearch/bin/plugin install elasticsearch/elasticsearch-cloud-azure/2.6.1

# Configure it
sudo vi /etc/elasticsearch/elasticsearch.yml</code></pre>
</div>
</div>
<div class="paragraph">
<p>And add the following lines:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="comment"># If you don't remember your account id, you may get it with `azure account list`</span>
<span class="key">cloud</span>:
    <span class="key">azure</span>:
        <span class="key">management</span>:
             <span class="key">subscription.id</span>: <span class="string"><span class="content">your_azure_subscription_id</span></span>
             <span class="key">cloud.service.name</span>: <span class="string"><span class="content">your_azure_cloud_service_name</span></span>
             <span class="key">keystore</span>:
                   <span class="key">path</span>: <span class="string"><span class="content">/home/elasticsearch/azurekeystore.pkcs12</span></span>
                   <span class="key">password</span>: <span class="string"><span class="content">your_password_for_keystore</span></span>

<span class="key">discovery</span>:
    <span class="key">type</span>: <span class="string"><span class="content">azure</span></span>

<span class="comment"># Recommended (warning: non durable disk)</span>
<span class="comment"># path.data: /mnt/resource/elasticsearch/data</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Restart elasticsearch:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">sudo service elasticsearch start</code></pre>
</div>
</div>
<div class="paragraph">
<p>If anything goes wrong, check your logs in <code>/var/log/elasticsearch</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cloud-azure-discovery-scale"><a class="anchor" href="#cloud-azure-discovery-scale"></a>6.2.3. Scaling Out!</h4>
<div class="paragraph">
<p>You need first to create an image of your previous machine.
Disconnect from your machine and run locally the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh"># Shutdown the instance
azure vm shutdown myesnode1

# Create an image from this instance (it could take some minutes)
azure vm capture myesnode1 esnode-image --delete

# Note that the previous instance has been deleted (mandatory)
# So you need to create it again and BTW create other instances.

azure vm create azure-elasticsearch-cluster \
                esnode-image \
                --vm-name myesnode1 \
                --location &quot;West Europe&quot; \
                --vm-size extrasmall \
                --ssh 22 \
                --ssh-cert /tmp/azure-certificate.pem \
                elasticsearch password1234\!\!</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<img src="./images/icons/tip.png" alt="Tip">
</td>
<td class="content">
<div class="paragraph">
<p>It could happen that azure changes the endpoint public IP address.
DNS propagation could take some minutes before you can connect again using
name. You can get from azure the IP address if needed, using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh"># Look at Network `Endpoints 0 Vip`
azure vm show myesnode1</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Let&#8217;s start more instances!</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">for x in $(seq  2 10)
        do
                echo &quot;Launching azure instance #$x...&quot;
                azure vm create azure-elasticsearch-cluster \
                                esnode-image \
                                --vm-name myesnode$x \
                                --vm-size extrasmall \
                                --ssh $((21 + $x)) \
                                --ssh-cert /tmp/azure-certificate.pem \
                                --connect \
                                elasticsearch password1234\!\!
        done</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to remove your running instances:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">azure vm delete myesnode1</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cloud-azure-repository"><a class="anchor" href="#cloud-azure-repository"></a>6.2.4. Azure Repository</h4>
<div class="paragraph">
<p>To enable Azure repositories, you have first to set your azure storage settings in <code>elasticsearch.yml</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">cloud</span>:
    <span class="key">azure</span>:
        <span class="key">storage</span>:
            <span class="key">my_account</span>:
                <span class="key">account</span>: <span class="string"><span class="content">your_azure_storage_account</span></span>
                <span class="key">key</span>: <span class="string"><span class="content">your_azure_storage_key</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that you can also define more than one account:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">cloud</span>:
    <span class="key">azure</span>:
        <span class="key">storage</span>:
            <span class="key">my_account1</span>:
                <span class="key">account</span>: <span class="string"><span class="content">your_azure_storage_account1</span></span>
                <span class="key">key</span>: <span class="string"><span class="content">your_azure_storage_key1</span></span>
                <span class="key">default</span>: <span class="string"><span class="content">true</span></span>
            <span class="key">my_account2</span>:
                <span class="key">account</span>: <span class="string"><span class="content">your_azure_storage_account2</span></span>
                <span class="key">key</span>: <span class="string"><span class="content">your_azure_storage_key2</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>my_account1</code> is the default account which will be used by a repository unless you set an explicit one.</p>
</div>
<div class="paragraph">
<p>You can set the client side timeout to use when making any single request. It can be defined globally, per account or both.
It&#8217;s not set by default which means that elasticsearch is using the
<a href="http://azure.github.io/azure-storage-java/com/microsoft/azure/storage/RequestOptions.html#setTimeoutIntervalInMs(java.lang.Integer)">default value</a>
set by the azure client (known as 5 minutes).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">cloud</span>:
    <span class="key">azure</span>:
        <span class="key">storage</span>:
            <span class="key">timeout</span>: <span class="string"><span class="content">10s</span></span>
            <span class="key">my_account1</span>:
                <span class="key">account</span>: <span class="string"><span class="content">your_azure_storage_account1</span></span>
                <span class="key">key</span>: <span class="string"><span class="content">your_azure_storage_key1</span></span>
                <span class="key">default</span>: <span class="string"><span class="content">true</span></span>
            <span class="key">my_account2</span>:
                <span class="key">account</span>: <span class="string"><span class="content">your_azure_storage_account2</span></span>
                <span class="key">key</span>: <span class="string"><span class="content">your_azure_storage_key2</span></span>
                <span class="key">timeout</span>: <span class="string"><span class="content">30s</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, timeout will be 10s for <code>my_account1</code> and 30s for <code>my_account2</code>.</p>
</div>
<div class="paragraph">
<p>The Azure repository supports following settings:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>account</code></dt>
<dd>
<p>Azure account settings to use. Defaults to the only one if you set a single
account or to the one marked as <code>default</code> if you have more than one.</p>
</dd>
<dt class="hdlist1"><code>container</code></dt>
<dd>
<p>Container name. Defaults to <code>elasticsearch-snapshots</code></p>
</dd>
<dt class="hdlist1"><code>base_path</code></dt>
<dd>
<p>Specifies the path within container to repository data. Defaults to empty
(root directory).</p>
</dd>
<dt class="hdlist1"><code>chunk_size</code></dt>
<dd>
<p>Big files can be broken down into chunks during snapshotting if needed.
The chunk size can be specified in bytes or by using size value notation,
i.e. <code>1g</code>, <code>10m</code>, <code>5k</code>. Defaults to <code>64m</code> (64m max)</p>
</dd>
<dt class="hdlist1"><code>compress</code></dt>
<dd>
<p>When set to <code>true</code> metadata files are stored in compressed format. This
setting doesn&#8217;t affect index files that are already compressed by default.
Defaults to <code>false</code>.</p>
</dd>
<dt class="hdlist1"><code>read_only</code></dt>
<dd>
<p>Makes repository read-only. coming[2.1.0]  Defaults to <code>false</code>.</p>
</dd>
<dt class="hdlist1"><code>location_mode</code></dt>
<dd>
<p><code>primary_only</code> or <code>secondary_only</code>. Defaults to <code>primary_only</code>. Note that if you set it
to <code>secondary_only</code>, it will force <code>read_only</code> to true.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Some examples, using scripts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json"><span class="error">#</span> <span class="error">T</span><span class="error">h</span><span class="error">e</span> <span class="error">s</span><span class="error">i</span><span class="error">m</span><span class="error">p</span><span class="error">l</span><span class="error">i</span><span class="error">e</span><span class="error">s</span><span class="error">t</span> <span class="error">o</span><span class="error">n</span><span class="error">e</span>
<span class="error">P</span><span class="error">U</span><span class="error">T</span> <span class="error">_</span><span class="error">s</span><span class="error">n</span><span class="error">a</span><span class="error">p</span><span class="error">s</span><span class="error">h</span><span class="error">o</span><span class="error">t</span><span class="error">/</span><span class="error">m</span><span class="error">y</span><span class="error">_</span><span class="error">b</span><span class="error">a</span><span class="error">c</span><span class="error">k</span><span class="error">u</span><span class="error">p</span><span class="integer">1</span>
{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">azure</span><span class="delimiter">&quot;</span></span>
}

<span class="error">#</span> <span class="error">W</span><span class="error">i</span><span class="error">t</span><span class="error">h</span> <span class="error">s</span><span class="error">o</span><span class="error">m</span><span class="error">e</span> <span class="error">s</span><span class="error">e</span><span class="error">t</span><span class="error">t</span><span class="error">i</span><span class="error">n</span><span class="error">g</span><span class="error">s</span>
<span class="error">P</span><span class="error">U</span><span class="error">T</span> <span class="error">_</span><span class="error">s</span><span class="error">n</span><span class="error">a</span><span class="error">p</span><span class="error">s</span><span class="error">h</span><span class="error">o</span><span class="error">t</span><span class="error">/</span><span class="error">m</span><span class="error">y</span><span class="error">_</span><span class="error">b</span><span class="error">a</span><span class="error">c</span><span class="error">k</span><span class="error">u</span><span class="error">p</span><span class="integer">2</span>
{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">azure</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">settings</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">container</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">backup-container</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">base_path</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">backups</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">chunk_size</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">32m</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">compress</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>
    }
}


<span class="error">#</span> <span class="error">W</span><span class="error">i</span><span class="error">t</span><span class="error">h</span> <span class="error">t</span><span class="error">w</span><span class="error">o</span> <span class="error">a</span><span class="error">c</span><span class="error">c</span><span class="error">o</span><span class="error">u</span><span class="error">n</span><span class="error">t</span><span class="error">s</span> <span class="error">d</span><span class="error">e</span><span class="error">f</span><span class="error">i</span><span class="error">n</span><span class="error">e</span><span class="error">d</span> <span class="error">i</span><span class="error">n</span> <span class="error">e</span><span class="error">l</span><span class="error">a</span><span class="error">s</span><span class="error">t</span><span class="error">i</span><span class="error">c</span><span class="error">s</span><span class="error">e</span><span class="error">a</span><span class="error">r</span><span class="error">c</span><span class="error">h</span><span class="error">.</span><span class="error">y</span><span class="error">m</span><span class="error">l</span> <span class="error">(</span><span class="error">m</span><span class="error">y</span><span class="error">_</span><span class="error">a</span><span class="error">c</span><span class="error">c</span><span class="error">o</span><span class="error">u</span><span class="error">n</span><span class="error">t</span><span class="integer">1</span> <span class="error">a</span><span class="error">n</span><span class="error">d</span> <span class="error">m</span><span class="error">y</span><span class="error">_</span><span class="error">a</span><span class="error">c</span><span class="error">c</span><span class="error">o</span><span class="error">u</span><span class="error">n</span><span class="error">t</span><span class="integer">2</span><span class="error">)</span>
<span class="error">P</span><span class="error">U</span><span class="error">T</span> <span class="error">_</span><span class="error">s</span><span class="error">n</span><span class="error">a</span><span class="error">p</span><span class="error">s</span><span class="error">h</span><span class="error">o</span><span class="error">t</span><span class="error">/</span><span class="error">m</span><span class="error">y</span><span class="error">_</span><span class="error">b</span><span class="error">a</span><span class="error">c</span><span class="error">k</span><span class="error">u</span><span class="error">p</span><span class="integer">3</span>
{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">azure</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">settings</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">account</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">my_account1</span><span class="delimiter">&quot;</span></span>
    }
}
<span class="error">P</span><span class="error">U</span><span class="error">T</span> <span class="error">_</span><span class="error">s</span><span class="error">n</span><span class="error">a</span><span class="error">p</span><span class="error">s</span><span class="error">h</span><span class="error">o</span><span class="error">t</span><span class="error">/</span><span class="error">m</span><span class="error">y</span><span class="error">_</span><span class="error">b</span><span class="error">a</span><span class="error">c</span><span class="error">k</span><span class="error">u</span><span class="error">p</span><span class="integer">4</span>
{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">azure</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">settings</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">account</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">my_account2</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">location_mode</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">primary_only</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example using Java:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">client.admin().cluster().preparePutRepository(<span class="string"><span class="delimiter">&quot;</span><span class="content">my_backup_java1</span><span class="delimiter">&quot;</span></span>)
    .setType(<span class="string"><span class="delimiter">&quot;</span><span class="content">azure</span><span class="delimiter">&quot;</span></span>).setSettings(Settings.settingsBuilder()
        .put(Storage.CONTAINER, <span class="string"><span class="delimiter">&quot;</span><span class="content">backup-container</span><span class="delimiter">&quot;</span></span>)
        .put(Storage.CHUNK_SIZE, <span class="keyword">new</span> ByteSizeValue(<span class="integer">32</span>, ByteSizeUnit.MB))
    ).get();</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="cloud-azure-repository-validation"><a class="anchor" href="#cloud-azure-repository-validation"></a>Repository validation rules</h5>
<div class="paragraph">
<p>According to the <a href="http://msdn.microsoft.com/en-us/library/dd135715.aspx">containers naming guide</a>, a container name must
be a valid DNS name, conforming to the following naming rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Container names must start with a letter or number, and can contain only letters, numbers, and the dash (-) character.</p>
</li>
<li>
<p>Every dash (-) character must be immediately preceded and followed by a letter or number; consecutive dashes are not
permitted in container names.</p>
</li>
<li>
<p>All letters in a container name must be lowercase.</p>
</li>
<li>
<p>Container names must be from 3 through 63 characters long.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cloud-azure-testing"><a class="anchor" href="#cloud-azure-testing"></a>6.2.5. Testing Azure</h4>
<div class="paragraph">
<p>Integrations tests in this plugin require working Azure configuration and therefore disabled by default.
To enable tests prepare a config file <code>elasticsearch.yml</code> with the following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">cloud</span>:
  <span class="key">azure</span>:
    <span class="key">storage</span>:
      <span class="key">account</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">YOUR-AZURE-STORAGE-NAME</span><span class="delimiter">&quot;</span></span>
      <span class="key">key</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">YOUR-AZURE-STORAGE-KEY</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Replaces <code>account</code>, <code>key</code> with your settings. Please, note that the test will delete all snapshot/restore related
files in the specified bucket.</p>
</div>
<div class="paragraph">
<p>To run test:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn -Dtests.azure=true -Dtests.config=/path/to/config/file/elasticsearch.yml clean test</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cloud-azure-smb-workaround"><a class="anchor" href="#cloud-azure-smb-workaround"></a>6.2.6. Working around a bug in Windows SMB and Java on windows</h4>
<div class="paragraph">
<p>When using a shared file system based on the SMB protocol (like Azure File Service) to store indices, the way Lucene
open index segment files is with a write only flag. This is the <em>correct</em> way to open the files, as they will only be
used for writes and allows different FS implementations to optimize for it. Sadly, in windows with SMB, this disables
the cache manager, causing writes to be slow. This has been described in
<a href="https://issues.apache.org/jira/browse/LUCENE-6176">LUCENE-6176</a>, but it affects each and every Java program out there!.
This need and must be fixed outside of ES and/or Lucene, either in windows or OpenJDK. For now, we are providing an
experimental support to open the files with read flag, but this should be considered experimental and the correct way
to fix it is in OpenJDK or Windows.</p>
</div>
<div class="paragraph">
<p>The Azure Cloud plugin provides two storage types optimized for SMB:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>smb_mmap_fs</code></dt>
<dd>
<p>a SMB specific implementation of the default
<a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.3/index-modules-store.html#mmapfs">mmap fs</a></p>
</dd>
<dt class="hdlist1"><code>smb_simple_fs</code></dt>
<dd>
<p>a SMB specific implementation of the default
<a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.3/index-modules-store.html#simplefs">simple fs</a></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>To use one of these specific storage types, you need to install the Azure Cloud plugin and restart the node.
Then configure Elasticsearch to set the storage type you want.</p>
</div>
<div class="paragraph">
<p>This can be configured for all indices by adding this to the <code>elasticsearch.yml</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">index.store.type</span>: <span class="string"><span class="content">smb_simple_fs</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that setting will be applied for newly created indices.</p>
</div>
<div class="paragraph">
<p>It can also be set on a per-index basis at index creation time:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json"><span class="error">P</span><span class="error">U</span><span class="error">T</span> <span class="error">m</span><span class="error">y</span><span class="error">_</span><span class="error">i</span><span class="error">n</span><span class="error">d</span><span class="error">e</span><span class="error">x</span>
{
   <span class="key"><span class="delimiter">&quot;</span><span class="content">settings</span><span class="delimiter">&quot;</span></span>: {
       <span class="key"><span class="delimiter">&quot;</span><span class="content">index.store.type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">smb_mmap_fs</span><span class="delimiter">&quot;</span></span>
   }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cloud-gce"><a class="anchor" href="#cloud-gce"></a>6.3. GCE Cloud Plugin</h3>
<div class="paragraph">
<p>The Google Compute Engine Cloud plugin uses the GCE API for unicast discovery.</p>
</div>
<h4 id="cloud-gce-install" class="float">Installation</h4>
<div class="paragraph">
<p>This plugin can be installed using the plugin manager:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">sudo bin/plugin install cloud-gce</code></pre>
</div>
</div>
<div class="paragraph">
<p>The plugin must be installed on every node in the cluster, and each node must
be restarted after installation.</p>
</div>
<h4 id="cloud-gce-remove" class="float">Removal</h4>
<div class="paragraph">
<p>The plugin can be removed with the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">sudo bin/plugin remove cloud-gce</code></pre>
</div>
</div>
<div class="paragraph">
<p>The node must be stopped before removing the plugin.</p>
</div>
<div class="sect3">
<h4 id="cloud-gce-usage-discovery"><a class="anchor" href="#cloud-gce-usage-discovery"></a>6.3.1. GCE Virtual Machine Discovery</h4>
<div class="paragraph">
<p>Google Compute Engine VM discovery allows to use the google APIs to perform automatic discovery (similar to multicast
in non hostile multicast environments). Here is a simple sample configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">cloud</span>:
  <span class="key">gce</span>:
      <span class="key">project_id</span>: <span class="string"><span class="content">&lt;your-google-project-id&gt;</span></span>
      <span class="key">zone</span>: <span class="string"><span class="content">&lt;your-zone&gt;</span></span>
<span class="key">discovery</span>:
      <span class="key">type</span>: <span class="string"><span class="content">gce</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>+The following gce settings (prefixed with <code>cloud.gce</code>) are supported:</p>
</div>
<div class="paragraph">
<p>+
+ <code>retry</code>::</p>
</div>
<div class="paragraph">
<p>+
+     If set to <code>true</code>, client will use
+     <a href="https://developers.google.com/api-client-library/java/google-http-java-client/backoff">ExponentialBackOff</a>
+     policy to retry the failed http request. Defaults to <code>true</code>.</p>
</div>
<div class="paragraph">
<p>+
+ <code>max_wait</code>::</p>
</div>
<div class="paragraph">
<p>+
+     The maximum elapsed time in milliseconds after the client instantiating retry. If the time elapsed goes past the
+     <code>max_wait</code>, client stops to retry. Defaults to 15 minutes (900000 milliseconds).</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<img src="./images/icons/important.png" alt="Important">
</td>
<td class="content">
<div class="title">Binding the network host</div>
<div class="paragraph">
<p>It&#8217;s important to define <code>network.host</code> as by default it&#8217;s bound to <code>localhost</code>.</p>
</div>
<div class="paragraph">
<p>You can use <a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.3/modules-network.html">core network host settings</a> or
<a href="#discovery-gce-network-host">gce specific host settings</a>:</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="discovery-gce-network-host"><a class="anchor" href="#discovery-gce-network-host"></a>6.3.2. GCE Network Host</h4>
<div class="paragraph">
<p>When the <code>cloud-gce</code> plugin is installed, the following are also allowed
as valid network host settings:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">GCE Host Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>_gce:privateIp:X_</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The private IP address of the machine for a given network interface.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>_gce:hostname_</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The hostname of the machine.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>_gce_</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Same as <code>_gce:privateIp:0_</code> (recommended).</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="comment"># get the IP address from network interface 1</span>
<span class="key">network.host</span>: <span class="string"><span class="content">_gce:privateIp:1_</span></span>
<span class="comment"># shortcut for _gce:privateIp:0_</span>
<span class="key">network.host</span>: <span class="string"><span class="content">_gce_</span></span>
<span class="comment"># Using GCE internal hostname (recommended)</span>
<span class="key">network.host</span>: <span class="string"><span class="content">_gce:hostname_</span></span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="cloud-gce-usage-discovery-short"><a class="anchor" href="#cloud-gce-usage-discovery-short"></a>How to start (short story)</h5>
<div class="ulist">
<ul>
<li>
<p>Create Google Compute Engine instance (with compute rw permissions)</p>
</li>
<li>
<p>Install Elasticsearch</p>
</li>
<li>
<p>Install Google Compute Engine Cloud plugin</p>
</li>
<li>
<p>Modify <code>elasticsearch.yml</code> file</p>
</li>
<li>
<p>Start Elasticsearch</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cloud-gce-usage-discovery-long"><a class="anchor" href="#cloud-gce-usage-discovery-long"></a>6.3.3. Setting up GCE Discovery</h4>
<div class="sect4">
<h5 id="cloud-gce-usage-discovery-long-prerequisites"><a class="anchor" href="#cloud-gce-usage-discovery-long-prerequisites"></a>Prerequisites</h5>
<div class="paragraph">
<p>Before starting, you need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Your project ID, e.g. <code>es-cloud</code>. Get it from <a href="https://code.google.com/apis/console/">Google API Console</a>.</p>
</li>
<li>
<p>To install <a href="https://developers.google.com/cloud/sdk/">Google Cloud SDK</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you did not set it yet, you can define your default project you will work on:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">gcloud config set project es-cloud</code></pre>
</div>
</div>
<div id="cloud-gce-usage-discovery-long-login" class="paragraph">
<p>If you haven&#8217;t already, login to Google Cloud</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">gcloud auth login</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will open your browser. You will be asked to sign-in to a Google account and
authorize access to the Google Cloud SDK.</p>
</div>
</div>
<div class="sect4">
<h5 id="cloud-gce-usage-discovery-long-first-instance"><a class="anchor" href="#cloud-gce-usage-discovery-long-first-instance"></a>Creating your first instance</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">gcloud compute instances create myesnode1 \
       --zone &lt;your-zone&gt; \
       --scopes compute-rw</code></pre>
</div>
</div>
<div class="paragraph">
<p>When done, a report like this one should appears:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">Created [https://www.googleapis.com/compute/v1/projects/es-cloud-1070/zones/us-central1-f/instances/myesnode1].
NAME      ZONE          MACHINE_TYPE  PREEMPTIBLE INTERNAL_IP   EXTERNAL_IP   STATUS
myesnode1 us-central1-f n1-standard-1             10.240.133.54 104.197.94.25 RUNNING</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can now connect to your instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh"># Connect using google cloud SDK
gcloud compute ssh myesnode1 --zone europe-west1-a

# Or using SSH with external IP address
ssh -i ~/.ssh/google_compute_engine 192.158.29.199</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<img src="./images/icons/important.png" alt="Important">
</td>
<td class="content">
<div class="title">Service Account Permissions</div>
<div class="paragraph">
<p>It&#8217;s important when creating an instance that the correct permissions are set. At a minimum, you must ensure you have:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">scopes=compute-rw</code></pre>
</div>
</div>
<div class="paragraph">
<p>Failing to set this will result in unauthorized messages when starting Elasticsearch.
See <a href="#cloud-gce-usage-discovery-tips-permissions">Machine Permissions</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once connected, install Elasticsearch:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">sudo apt-get update

# Download Elasticsearch
wget https://download.elasticsearch.org/elasticsearch/elasticsearch/elasticsearch-2.0.0.deb

# Prepare Java installation (Oracle)
sudo echo &quot;deb http://ppa.launchpad.net/webupd8team/java/ubuntu trusty main&quot; | sudo tee /etc/apt/sources.list.d/webupd8team-java.list
sudo echo &quot;deb-src http://ppa.launchpad.net/webupd8team/java/ubuntu trusty main&quot; | sudo tee -a /etc/apt/sources.list.d/webupd8team-java.list
sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys EEA14886
sudo apt-get update
sudo apt-get install oracle-java8-installer

# Prepare Java installation (or OpenJDK)
# sudo apt-get install java8-runtime-headless

# Prepare Elasticsearch installation
sudo dpkg -i elasticsearch-2.0.0.deb</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="cloud-gce-usage-discovery-long-install-plugin"><a class="anchor" href="#cloud-gce-usage-discovery-long-install-plugin"></a>Install elasticsearch cloud gce plugin</h5>
<div class="paragraph">
<p>Install the plugin:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh"># Use Plugin Manager to install it
sudo bin/plugin install cloud-gce</code></pre>
</div>
</div>
<div class="paragraph">
<p>Open the <code>elasticsearch.yml</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">sudo vi /etc/elasticsearch/elasticsearch.yml</code></pre>
</div>
</div>
<div class="paragraph">
<p>And add the following lines:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">cloud</span>:
  <span class="key">gce</span>:
      <span class="key">project_id</span>: <span class="string"><span class="content">es-cloud</span></span>
      <span class="key">zone</span>: <span class="string"><span class="content">europe-west1-a</span></span>
<span class="key">discovery</span>:
      <span class="key">type</span>: <span class="string"><span class="content">gce</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Start elasticsearch:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">sudo /etc/init.d/elasticsearch start</code></pre>
</div>
</div>
<div class="paragraph">
<p>If anything goes wrong, you should check logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">tail -f /var/log/elasticsearch/elasticsearch.log</code></pre>
</div>
</div>
<div class="paragraph">
<p>If needed, you can change log level to <code>TRACE</code> by opening <code>logging.yml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">sudo vi /etc/elasticsearch/logging.yml</code></pre>
</div>
</div>
<div class="paragraph">
<p>and adding the following line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="comment"># discovery</span>
<span class="key">discovery.gce</span>: <span class="string"><span class="content">TRACE</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cloud-gce-usage-discovery-cloning"><a class="anchor" href="#cloud-gce-usage-discovery-cloning"></a>6.3.4. Cloning your existing machine</h4>
<div class="paragraph">
<p>In order to build a cluster on many nodes, you can clone your configured instance to new nodes.
You won&#8217;t have to reinstall everything!</p>
</div>
<div class="paragraph">
<p>First create an image of your running instance and upload it to Google Cloud Storage:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh"># Create an image of your current instance
sudo /usr/bin/gcimagebundle -d /dev/sda -o /tmp/

# An image has been created in `/tmp` directory:
ls /tmp
e4686d7f5bf904a924ae0cfeb58d0827c6d5b966.image.tar.gz

# Upload your image to Google Cloud Storage:
# Create a bucket to hold your image, let's say `esimage`:
gsutil mb gs://esimage

# Copy your image to this bucket:
gsutil cp /tmp/e4686d7f5bf904a924ae0cfeb58d0827c6d5b966.image.tar.gz gs://esimage

# Then add your image to images collection:
gcloud compute images create elasticsearch-2-0-0 --source-uri gs://esimage/e4686d7f5bf904a924ae0cfeb58d0827c6d5b966.image.tar.gz

# If the previous command did not work for you, logout from your instance
# and launch the same command from your local machine.</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="cloud-gce-usage-discovery-start-new-instances"><a class="anchor" href="#cloud-gce-usage-discovery-start-new-instances"></a>Start new instances</h5>
<div class="paragraph">
<p>As you have now an image, you can create as many instances as you need:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh"># Just change node name (here myesnode2)
gcloud compute instances create myesnode2 --image elasticsearch-2-0-0 --zone europe-west1-a

# If you want to provide all details directly, you can use:
gcloud compute instances create myesnode2 --image=elasticsearch-2-0-0 \
       --zone europe-west1-a --machine-type f1-micro --scopes=compute-rw</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="cloud-gce-usage-discovery-remove-instance"><a class="anchor" href="#cloud-gce-usage-discovery-remove-instance"></a>Remove an instance (aka shut it down)</h5>
<div class="paragraph">
<p>You can use <a href="https://cloud.google.com/console">Google Cloud Console</a> or CLI to manage your instances:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh"># Stopping and removing instances
gcloud compute instances delete myesnode1 myesnode2 \
       --zone=europe-west1-a

# Consider removing disk as well if you don't need them anymore
gcloud compute disks deleted boot-myesnode1 boot-myesnode2  \
       --zone=europe-west1-a</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cloud-gce-usage-discovery-zones"><a class="anchor" href="#cloud-gce-usage-discovery-zones"></a>6.3.5. Using GCE zones</h4>
<div class="paragraph">
<p><code>cloud.gce.zone</code> helps to retrieve instances running in a given zone. It should be one of the
<a href="https://developers.google.com/compute/docs/zones#available">GCE supported zones</a>.</p>
</div>
<div class="paragraph">
<p>The GCE discovery can support multi zones although you need to be aware of network latency between zones.
To enable discovery across more than one zone, just enter add your zone list to <code>cloud.gce.zone</code> setting:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">cloud</span>:
  <span class="key">gce</span>:
      <span class="key">project_id</span>: <span class="string"><span class="content">&lt;your-google-project-id&gt;</span></span>
      <span class="key">zone</span>: <span class="string"><span class="content">[&quot;&lt;your-zone1&gt;&quot;, &quot;&lt;your-zone2&gt;&quot;]</span></span>
<span class="key">discovery</span>:
      <span class="key">type</span>: <span class="string"><span class="content">gce</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cloud-gce-usage-discovery-tags"><a class="anchor" href="#cloud-gce-usage-discovery-tags"></a>6.3.6. Filtering by tags</h4>
<div class="paragraph">
<p>The GCE discovery can also filter machines to include in the cluster based on tags using <code>discovery.gce.tags</code> settings.
For example, setting <code>discovery.gce.tags</code> to <code>dev</code> will only filter instances having a tag set to <code>dev</code>. Several tags
set will require all of those tags to be set for the instance to be included.</p>
</div>
<div class="paragraph">
<p>One practical use for tag filtering is when an GCE cluster contains many nodes that are not running
elasticsearch. In this case (particularly with high ping_timeout values) there is a risk that a new node&#8217;s discovery
phase will end before it has found the cluster (which will result in it declaring itself master of a new cluster
with the same name - highly undesirable). Adding tag on elasticsearch GCE nodes and then filtering by that
tag will resolve this issue.</p>
</div>
<div class="paragraph">
<p>Add your tag when building the new instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">gcloud compute instances create myesnode1 --project=es-cloud \
       --scopes=compute-rw \
       --tags=elasticsearch,dev</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, define it in <code>elasticsearch.yml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">cloud</span>:
  <span class="key">gce</span>:
      <span class="key">project_id</span>: <span class="string"><span class="content">es-cloud</span></span>
      <span class="key">zone</span>: <span class="string"><span class="content">europe-west1-a</span></span>
<span class="key">discovery</span>:
      <span class="key">type</span>: <span class="string"><span class="content">gce</span></span>
      <span class="key">gce</span>:
            <span class="key">tags</span>: <span class="string"><span class="content">elasticsearch, dev</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cloud-gce-usage-discovery-port"><a class="anchor" href="#cloud-gce-usage-discovery-port"></a>6.3.7. Changing default transport port</h4>
<div class="paragraph">
<p>By default, elasticsearch GCE plugin assumes that you run elasticsearch on 9300 default port.
But you can specify the port value elasticsearch is meant to use using google compute engine metadata <code>es_port</code>:</p>
</div>
<div class="sect4">
<h5 id="cloud-gce-usage-discovery-port-create"><a class="anchor" href="#cloud-gce-usage-discovery-port-create"></a>When creating instance</h5>
<div class="paragraph">
<p>Add <code>--metadata es_port=9301</code> option:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh"># when creating first instance
gcloud compute instances create myesnode1 \
       --scopes=compute-rw,storage-full \
       --metadata es_port=9301

# when creating an instance from an image
gcloud compute instances create myesnode2 --image=elasticsearch-1-0-0-RC1 \
       --zone europe-west1-a --machine-type f1-micro --scopes=compute-rw \
       --metadata es_port=9301</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="cloud-gce-usage-discovery-port-run"><a class="anchor" href="#cloud-gce-usage-discovery-port-run"></a>On a running instance</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">gcloud compute instances add-metadata myesnode1 \
       --zone europe-west1-a \
       --metadata es_port=9301</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cloud-gce-usage-discovery-tips"><a class="anchor" href="#cloud-gce-usage-discovery-tips"></a>6.3.8. GCE Tips</h4>
<div class="sect4">
<h5 id="cloud-gce-usage-discovery-tips-projectid"><a class="anchor" href="#cloud-gce-usage-discovery-tips-projectid"></a>Store project id locally</h5>
<div class="paragraph">
<p>If you don&#8217;t want to repeat the project id each time, you can save it in the local gcloud config</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">gcloud config set project es-cloud</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="cloud-gce-usage-discovery-tips-permissions"><a class="anchor" href="#cloud-gce-usage-discovery-tips-permissions"></a>Machine Permissions</h5>
<div class="paragraph">
<p>If you have created a machine without the correct permissions, you will see <code>403 unauthorized</code> error messages. The only
way to alter these permissions is to delete the instance (NOT THE DISK). Then create another with the correct permissions.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Creating machines with gcloud</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Ensure the following flags are set:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">--scopes=compute-rw</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">Creating with console (web)</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>When creating an instance using the web portal, click <em>Show advanced options</em>.</p>
</div>
<div class="paragraph">
<p>At the bottom of the page, under <code>PROJECT ACCESS</code>, choose <code>&gt;&gt; Compute &gt;&gt; Read Write</code>.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">Creating with knife google</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Set the service account scopes when creating the machine:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">knife google server create www1 \
    -m n1-standard-1 \
    -I debian-8 \
    -Z us-central1-a \
    -i ~/.ssh/id_rsa \
    -x jdoe \
    --gce-service-account-scopes https://www.googleapis.com/auth/compute.full_control</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or, you may use the alias:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">    --gce-service-account-scopes compute-rw</code></pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cloud-gce-usage-discovery-testing"><a class="anchor" href="#cloud-gce-usage-discovery-testing"></a>6.3.9. Testing GCE</h4>
<div class="paragraph">
<p>Integrations tests in this plugin require working GCE configuration and
therefore disabled by default. To enable tests prepare a config file
elasticsearch.yml with the following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">cloud</span>:
  <span class="key">gce</span>:
      <span class="key">project_id</span>: <span class="string"><span class="content">es-cloud</span></span>
      <span class="key">zone</span>: <span class="string"><span class="content">europe-west1-a</span></span>
<span class="key">discovery</span>:
      <span class="key">type</span>: <span class="string"><span class="content">gce</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Replaces <code>project_id</code> and <code>zone</code> with your settings.</p>
</div>
<div class="paragraph">
<p>To run test:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn -Dtests.gce=true -Dtests.config=/path/to/config/file/elasticsearch.yml clean test</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="discovery-multicast"><a class="anchor" href="#discovery-multicast"></a>6.4. Multicast Discovery Plugin</h3>
<div class="paragraph">
<p>deprecated[2.2.0,This plugin is deprecated and has been removed in 3.0.0]</p>
</div>
<div class="paragraph">
<p>The Multicast Discovery plugin provides the ability to form a cluster using
TCP/IP multicast messages.</p>
</div>
<h4 id="discovery-multicast-install" class="float">Installation</h4>
<div class="paragraph">
<p>This plugin can be installed using the plugin manager:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">sudo bin/plugin install discovery-multicast</code></pre>
</div>
</div>
<div class="paragraph">
<p>The plugin must be installed on every node in the cluster, and each node must
be restarted after installation.</p>
</div>
<h4 id="discovery-multicast-remove" class="float">Removal</h4>
<div class="paragraph">
<p>The plugin can be removed with the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">sudo bin/plugin remove discovery-multicast</code></pre>
</div>
</div>
<div class="paragraph">
<p>The node must be stopped before removing the plugin.</p>
</div>
<div class="sect3">
<h4 id="discovery-multicast-usage"><a class="anchor" href="#discovery-multicast-usage"></a>6.4.1. Configuring multicast discovery</h4>
<div class="paragraph">
<p>Multicast ping discovery of other nodes is done by sending one or more
multicast requests which existing nodes will receive and
respond to. It provides the following settings with the
<code>discovery.zen.ping.multicast</code> prefix:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Setting</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>group</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The group address to use. Defaults to <code>224.2.2.4</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The port to use. Defaults to <code>54328</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ttl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ttl of the multicast message. Defaults to <code>3</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>address</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The address to bind to, defaults to <code>null</code> which means it
will bind <code>network.bind_host</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether multicast ping discovery is enabled. Defaults to <code>false</code>.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="management"><a class="anchor" href="#management"></a>7. Management and Site Plugins</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Management and site plugins offer UIs for managing and interacting with
Elasticsearch.</p>
</div>
<h3 id="_core_management_plugins" class="float">Core management plugins</h3>
<div class="paragraph">
<p>The core management plugins are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="/products/marvel">Marvel</a></dt>
<dd>
<p>Marvel is a management and monitoring product for Elasticsearch. Marvel
aggregates cluster wide statistics and events and offers a single interface to
view and analyze them. Marvel is free for development use but requires a
license to run in production.</p>
</dd>
<dt class="hdlist1"><a href="https://github.com/elastic/elasticsearch-migration">Migration</a></dt>
<dd>
<p>This plugin will help you to check whether you can upgrade directly to
Elasticsearch version 2.x, or whether you need to make changes to your data
before doing so. It will run on Elasticsearch versions 0.90.x to 1.x.</p>
</dd>
</dl>
</div>
<h3 id="_community_contributed_management_and_site_plugins" class="float">Community contributed management and site plugins</h3>
<div class="paragraph">
<p>A number of plugins have been contributed by our community:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/lukas-vlcek/bigdesk">BigDesk Plugin</a> (by Luk Vlek)</p>
</li>
<li>
<p><a href="https://github.com/spinscale/elasticsearch-graphite-plugin">Elasticsearch Graphite Plugin</a>:
Regularly updates a graphite host with indices stats and nodes stats (by Alexander Reelsen)</p>
</li>
<li>
<p><a href="https://github.com/mobz/elasticsearch-head">Elasticsearch Head Plugin</a> (by Ben Birch)</p>
</li>
<li>
<p><a href="https://github.com/royrusso/elasticsearch-HQ">Elasticsearch HQ</a> (by Roy Russo)</p>
</li>
<li>
<p><a href="https://github.com/andrewvc/elastic-hammer">Hammer Plugin</a> (by Andrew Cholakian)</p>
</li>
<li>
<p><a href="https://github.com/polyfractal/elasticsearch-inquisitor">Inquisitor Plugin</a> (by Zachary Tong)</p>
</li>
<li>
<p><a href="https://github.com/lmenezes/elasticsearch-kopf">Kopf Plugin</a> (by lmenezes)</p>
</li>
<li>
<p><a href="https://github.com/timschlechter/swagger-for-elasticsearch">Swagger for Elasticsearch</a> (by Tim Schlechter)</p>
</li>
<li>
<p><a href="https://github.com/Dynatrace/Dynatrace-Elasticsearch-Plugin">Elasticsearch monitoring plugin for Dynatrace Application Monitoring</a> (by Dynatrace)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These community plugins appear to have been abandoned:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/karmi/elasticsearch-paramedic">Paramedic Plugin</a> (by Karel Minak)</p>
</li>
<li>
<p><a href="https://github.com/polyfractal/elasticsearch-segmentspy">SegmentSpy Plugin</a> (by Zachary Tong)</p>
</li>
<li>
<p><a href="https://github.com/xyu/elasticsearch-whatson">Whatson Plugin</a> (by Xiao Yu)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="mapper"><a class="anchor" href="#mapper"></a>8. Mapper Plugins</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Mapper plugins allow new field datatypes to be added to Elasticsearch.</p>
</div>
<h3 id="_core_mapper_plugins" class="float">Core mapper plugins</h3>
<div class="paragraph">
<p>The core mapper plugins are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="#mapper-attachments">Mapper Attachments Plugin</a></dt>
<dd>
<p>deprecated[5.0.0,The <code>mapper-attachments</code> plugin will be replaced by the <code>ingest-attachment</code> plugin]:
The mapper-attachments integrates <a href="http://lucene.apache.org/tika/">Apache Tika</a> to provide a new field type <code>attachment</code>
to allow indexing of documents such as PDFs and Microsoft Word.</p>
</dd>
<dt class="hdlist1"><a href="#mapper-size">Mapper Size Plugin</a></dt>
<dd>
<p>The mapper-size plugin provides the <code>_size</code> meta field which, when enabled,
indexes the size in bytes of the original
<a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.3/mapping-source-field.html"><code>_source</code></a> field.</p>
</dd>
<dt class="hdlist1"><a href="#mapper-murmur3">Mapper Murmur3 Plugin</a></dt>
<dd>
<p>The mapper-murmur3 plugin allows hashes to be computed at index-time and stored
in the index for later use with the <code>cardinality</code> aggregation.</p>
</dd>
</dl>
</div>
<div class="sect2">
<h3 id="mapper-attachments"><a class="anchor" href="#mapper-attachments"></a>8.1. Mapper Attachments Plugin</h3>
<div class="paragraph">
<p>deprecated[5.0.0,The <code>mapper-attachments</code> plugin will be replaced by the <code>ingest-attachment</code> plugin]</p>
</div>
<div class="paragraph">
<p>The mapper attachments plugin lets Elasticsearch index file attachments in common formats (such as PPT, XLS, PDF)
using the Apache text extraction library <a href="http://lucene.apache.org/tika/">Tika</a>.</p>
</div>
<div class="paragraph">
<p>In practice, the plugin adds the <code>attachment</code> type when mapping properties so that documents can be populated with
file attachment contents (encoded as <code>base64</code>).</p>
</div>
<h4 id="mapper-attachments-install" class="float">Installation</h4>
<div class="paragraph">
<p>This plugin can be installed using the plugin manager:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">sudo bin/plugin install mapper-attachments</code></pre>
</div>
</div>
<div class="paragraph">
<p>The plugin must be installed on every node in the cluster, and each node must
be restarted after installation.</p>
</div>
<h4 id="mapper-attachments-remove" class="float">Removal</h4>
<div class="paragraph">
<p>The plugin can be removed with the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">sudo bin/plugin remove mapper-attachments</code></pre>
</div>
</div>
<div class="paragraph">
<p>The node must be stopped before removing the plugin.</p>
</div>
<div class="sect3">
<h4 id="mapper-attachments-helloworld"><a class="anchor" href="#mapper-attachments-helloworld"></a>8.1.1. Hello, world</h4>
<div class="paragraph">
<p>Create a property mapping using the new type <code>attachment</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">POST /trying-out-mapper-attachments
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">mappings</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">person</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">cv</span><span class="delimiter">&quot;</span></span>: { <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">attachment</span><span class="delimiter">&quot;</span></span> }
}}}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Index a new document populated with a <code>base64</code>-encoded attachment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">POST /trying-out-mapper-attachments/person/<span class="integer">1</span>
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">cv</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">e1xydGYxXGFuc2kNCkxvcmVtIGlwc3VtIGRvbG9yIHNpdCBhbWV0DQpccGFyIH0=</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Search for the document using words in the attachment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">POST /trying-out-mapper-attachments/person/_search
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">query</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">query_string</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">query</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ipsum</span><span class="delimiter">&quot;</span></span>
}}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you get a hit for your indexed document, the plugin should be installed and working.</p>
</div>
</div>
<div class="sect3">
<h4 id="mapper-attachments-usage"><a class="anchor" href="#mapper-attachments-usage"></a>8.1.2. Usage</h4>
<div class="paragraph">
<p>Using the attachment type is simple, in your mapping JSON, simply set a certain JSON element as attachment, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">PUT /test
PUT /test/person/_mapping
{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">person</span><span class="delimiter">&quot;</span></span> : {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span> : {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">my_attachment</span><span class="delimiter">&quot;</span></span> : { <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">attachment</span><span class="delimiter">&quot;</span></span> }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, the JSON to index can be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">PUT /test/person/<span class="integer">1</span>
{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">my_attachment</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">... base64 encoded attachment ...</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or it is possible to use more elaborated JSON if content type, resource name or language need to be set explicitly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">PUT /test/person/<span class="integer">1</span>
{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">my_attachment</span><span class="delimiter">&quot;</span></span> : {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">_content_type</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">application/pdf</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">_name</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">resource/name/of/my.pdf</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">_language</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">_content</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">... base64 encoded attachment ...</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>attachment</code> type not only indexes the content of the doc in <code>content</code> sub field, but also automatically adds meta
data on the attachment as well (when available).</p>
</div>
<div class="paragraph">
<p>The metadata supported are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>date</code></p>
</li>
<li>
<p><code>title</code></p>
</li>
<li>
<p><code>name</code> only available if you set <code>_name</code> see above</p>
</li>
<li>
<p><code>author</code></p>
</li>
<li>
<p><code>keywords</code></p>
</li>
<li>
<p><code>content_type</code></p>
</li>
<li>
<p><code>content_length</code> is the original content_length before text extraction (aka file size)</p>
</li>
<li>
<p><code>language</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>They can be queried using the "dot notation", for example: <code>my_attachment.author</code>.</p>
</div>
<div class="paragraph">
<p>Both the meta data and the actual content are simple core type mappers (string, date, ), thus, they can be controlled
in the mappings. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">PUT /test/person/_mapping
{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">person</span><span class="delimiter">&quot;</span></span> : {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span> : {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">file</span><span class="delimiter">&quot;</span></span> : {
                <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">attachment</span><span class="delimiter">&quot;</span></span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">fields</span><span class="delimiter">&quot;</span></span> : {
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">content</span><span class="delimiter">&quot;</span></span> : {<span class="key"><span class="delimiter">&quot;</span><span class="content">index</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">no</span><span class="delimiter">&quot;</span></span>},
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span> : {<span class="key"><span class="delimiter">&quot;</span><span class="content">store</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">yes</span><span class="delimiter">&quot;</span></span>},
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span> : {<span class="key"><span class="delimiter">&quot;</span><span class="content">store</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">yes</span><span class="delimiter">&quot;</span></span>},
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">author</span><span class="delimiter">&quot;</span></span> : {<span class="key"><span class="delimiter">&quot;</span><span class="content">analyzer</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">myAnalyzer</span><span class="delimiter">&quot;</span></span>},
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">keywords</span><span class="delimiter">&quot;</span></span> : {<span class="key"><span class="delimiter">&quot;</span><span class="content">store</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">yes</span><span class="delimiter">&quot;</span></span>},
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">content_type</span><span class="delimiter">&quot;</span></span> : {<span class="key"><span class="delimiter">&quot;</span><span class="content">store</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">yes</span><span class="delimiter">&quot;</span></span>},
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">content_length</span><span class="delimiter">&quot;</span></span> : {<span class="key"><span class="delimiter">&quot;</span><span class="content">store</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">yes</span><span class="delimiter">&quot;</span></span>},
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">language</span><span class="delimiter">&quot;</span></span> : {<span class="key"><span class="delimiter">&quot;</span><span class="content">store</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">yes</span><span class="delimiter">&quot;</span></span>}
                }
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, the actual content indexed is mapped under <code>fields</code> name <code>content</code>, and we decide not to index it, so
it will only be available in the <code>_all</code> field. The other fields map to their respective metadata names, but there is no
need to specify the <code>type</code> (like <code>string</code> or <code>date</code>) since it is already known.</p>
</div>
</div>
<div class="sect3">
<h4 id="mapper-attachments-copy-to"><a class="anchor" href="#mapper-attachments-copy-to"></a>8.1.3. Copy To feature</h4>
<div class="paragraph">
<p>If you want to use <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/copy-to.html">copy_to</a>
feature, you need to define it on each sub-field you want to copy to another field:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">PUT /test/person/_mapping
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">person</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">file</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">attachment</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">fields</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">content</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">string</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">copy_to</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">copy</span><span class="delimiter">&quot;</span></span>
          }
        }
      },
      <span class="key"><span class="delimiter">&quot;</span><span class="content">copy</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">string</span><span class="delimiter">&quot;</span></span>
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the extracted content will be copy as well to <code>copy</code> field.</p>
</div>
</div>
<div class="sect3">
<h4 id="mapper-attachments-querying-metadata"><a class="anchor" href="#mapper-attachments-querying-metadata"></a>8.1.4. Querying or accessing metadata</h4>
<div class="paragraph">
<p>If you need to query on metadata fields, use the attachment field name dot the metadata field. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">DELETE /test
PUT /test
PUT /test/person/_mapping
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">person</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">file</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">attachment</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">fields</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">content_type</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">string</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">store</span><span class="delimiter">&quot;</span></span>: <span class="predefined-constant">true</span>
          }
        }
      }
    }
  }
}
PUT /test/person/<span class="integer">1</span>?refresh=<span class="predefined-constant">true</span>
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">file</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">IkdvZCBTYXZlIHRoZSBRdWVlbiIgKGFsdGVybmF0aXZlbHkgIkdvZCBTYXZlIHRoZSBLaW5nIg==</span><span class="delimiter">&quot;</span></span>
}
GET /test/person/_search
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">fields</span><span class="delimiter">&quot;</span></span>: [ <span class="string"><span class="delimiter">&quot;</span><span class="content">file.content_type</span><span class="delimiter">&quot;</span></span> ],
  <span class="key"><span class="delimiter">&quot;</span><span class="content">query</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">match</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">file.content_type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">text plain</span><span class="delimiter">&quot;</span></span>
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Will give you:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">{
   <span class="key"><span class="delimiter">&quot;</span><span class="content">took</span><span class="delimiter">&quot;</span></span>: <span class="integer">2</span>,
   <span class="key"><span class="delimiter">&quot;</span><span class="content">timed_out</span><span class="delimiter">&quot;</span></span>: <span class="predefined-constant">false</span>,
   <span class="key"><span class="delimiter">&quot;</span><span class="content">_shards</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">total</span><span class="delimiter">&quot;</span></span>: <span class="integer">5</span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">successful</span><span class="delimiter">&quot;</span></span>: <span class="integer">5</span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">failed</span><span class="delimiter">&quot;</span></span>: <span class="integer">0</span>
   },
   <span class="key"><span class="delimiter">&quot;</span><span class="content">hits</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">total</span><span class="delimiter">&quot;</span></span>: <span class="integer">1</span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">max_score</span><span class="delimiter">&quot;</span></span>: <span class="float">0.16273327</span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">hits</span><span class="delimiter">&quot;</span></span>: [
         {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">_index</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">_type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">person</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">_id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">_score</span><span class="delimiter">&quot;</span></span>: <span class="float">0.16273327</span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">fields</span><span class="delimiter">&quot;</span></span>: {
               <span class="key"><span class="delimiter">&quot;</span><span class="content">file.content_type</span><span class="delimiter">&quot;</span></span>: [
                  <span class="string"><span class="delimiter">&quot;</span><span class="content">text/plain; charset=ISO-8859-1</span><span class="delimiter">&quot;</span></span>
               ]
            }
         }
      ]
   }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="mapper-attachments-indexed-characters"><a class="anchor" href="#mapper-attachments-indexed-characters"></a>8.1.5. Indexed Characters</h4>
<div class="paragraph">
<p>By default, <code>100000</code> characters are extracted when indexing the content. This default value can be changed by setting
the <code>index.mapping.attachment.indexed_chars</code> setting. It can also be provided on a per document indexed using the
<code>_indexed_chars</code> parameter. <code>-1</code> can be set to extract all text, but note that all the text needs to be allowed to be
represented in memory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">PUT /test/person/<span class="integer">1</span>
{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">my_attachment</span><span class="delimiter">&quot;</span></span> : {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">_indexed_chars</span><span class="delimiter">&quot;</span></span> : -<span class="integer">1</span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">_content</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">... base64 encoded attachment ...</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="mapper-attachments-error-handling"><a class="anchor" href="#mapper-attachments-error-handling"></a>8.1.6. Metadata parsing error handling</h4>
<div class="paragraph">
<p>While extracting metadata content, errors could happen for example when parsing dates.
Parsing errors are ignored so your document is indexed.</p>
</div>
<div class="paragraph">
<p>You can disable this feature by setting the <code>index.mapping.attachment.ignore_errors</code> setting to <code>false</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="mapper-attachments-language-detection"><a class="anchor" href="#mapper-attachments-language-detection"></a>8.1.7. Language Detection</h4>
<div class="paragraph">
<p>By default, language detection is disabled (<code>false</code>) as it could come with a cost.
This default value can be changed by setting the <code>index.mapping.attachment.detect_language</code> setting.
It can also be provided on a per document indexed using the <code>_detect_language</code> parameter.</p>
</div>
<div class="paragraph">
<p>Note that you can force language using <code>_language</code> field when sending your actual document:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">my_attachment</span><span class="delimiter">&quot;</span></span> : {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">_language</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">_content</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">... base64 encoded attachment ...</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="mapper-attachments-highlighting"><a class="anchor" href="#mapper-attachments-highlighting"></a>8.1.8. Highlighting attachments</h4>
<div class="paragraph">
<p>If you want to highlight your attachment content, you will need to set <code>"store": true</code> and
<code>"term_vector":"with_positions_offsets"</code> for your attachment field. Here is a full script which does it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">DELETE /test
PUT /test
PUT /test/person/_mapping
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">person</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">file</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">attachment</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">fields</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">content</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">string</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">term_vector</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">with_positions_offsets</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">store</span><span class="delimiter">&quot;</span></span>: <span class="predefined-constant">true</span>
          }
        }
      }
    }
  }
}
PUT /test/person/<span class="integer">1</span>?refresh=<span class="predefined-constant">true</span>
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">file</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">IkdvZCBTYXZlIHRoZSBRdWVlbiIgKGFsdGVybmF0aXZlbHkgIkdvZCBTYXZlIHRoZSBLaW5nIg==</span><span class="delimiter">&quot;</span></span>
}
GET /test/person/_search
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">fields</span><span class="delimiter">&quot;</span></span>: [],
  <span class="key"><span class="delimiter">&quot;</span><span class="content">query</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">match</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">file.content</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">king queen</span><span class="delimiter">&quot;</span></span>
    }
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">highlight</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">fields</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">file.content</span><span class="delimiter">&quot;</span></span>: {
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It gives back:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">{
   <span class="key"><span class="delimiter">&quot;</span><span class="content">took</span><span class="delimiter">&quot;</span></span>: <span class="integer">9</span>,
   <span class="key"><span class="delimiter">&quot;</span><span class="content">timed_out</span><span class="delimiter">&quot;</span></span>: <span class="predefined-constant">false</span>,
   <span class="key"><span class="delimiter">&quot;</span><span class="content">_shards</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">total</span><span class="delimiter">&quot;</span></span>: <span class="integer">1</span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">successful</span><span class="delimiter">&quot;</span></span>: <span class="integer">1</span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">failed</span><span class="delimiter">&quot;</span></span>: <span class="integer">0</span>
   },
   <span class="key"><span class="delimiter">&quot;</span><span class="content">hits</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">total</span><span class="delimiter">&quot;</span></span>: <span class="integer">1</span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">max_score</span><span class="delimiter">&quot;</span></span>: <span class="float">0.13561106</span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">hits</span><span class="delimiter">&quot;</span></span>: [
         {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">_index</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">_type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">person</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">_id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">_score</span><span class="delimiter">&quot;</span></span>: <span class="float">0.13561106</span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">highlight</span><span class="delimiter">&quot;</span></span>: {
               <span class="key"><span class="delimiter">&quot;</span><span class="content">file.content</span><span class="delimiter">&quot;</span></span>: [
                  <span class="string"><span class="delimiter">&quot;</span><span class="char">\&quot;</span><span class="content">God Save the &lt;em&gt;Queen&lt;/em&gt;</span><span class="char">\&quot;</span><span class="content"> (alternatively </span><span class="char">\&quot;</span><span class="content">God Save the &lt;em&gt;King&lt;/em&gt;</span><span class="char">\&quot;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>
               ]
            }
         }
      ]
   }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="mapper-attachments-standalone"><a class="anchor" href="#mapper-attachments-standalone"></a>8.1.9. Stand alone runner</h4>
<div class="paragraph">
<p>If you want to run some tests within your IDE, you can use <code>StandaloneRunner</code> class.
It accepts arguments:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>-u file://URL/TO/YOUR/DOC</code></p>
</li>
<li>
<p><code>--size</code> set extracted size (default to mapper attachment size)</p>
</li>
<li>
<p><code>BASE64</code> encoded binary</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">StandaloneRunner BASE64Text
StandaloneRunner -u /tmp/mydoc.pdf
StandaloneRunner -u /tmp/mydoc.pdf --size 1000000</code></pre>
</div>
</div>
<div class="paragraph">
<p>It produces something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">## Extracted text
--------------------- BEGIN -----------------------
This is the extracted text
---------------------- END ------------------------
## Metadata
- author: null
- content_length: null
- content_type: application/pdf
- date: null
- keywords: null
- language: null
- name: null
- title: null</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="mapper-size"><a class="anchor" href="#mapper-size"></a>8.2. Mapper Size Plugin</h3>
<div class="paragraph">
<p>The mapper-size plugin provides the <code>_size</code> meta field which, when enabled,
indexes the size in bytes of the original
<a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.3/mapping-source-field.html"><code>_source</code></a> field.</p>
</div>
<h4 id="mapper-size-install" class="float">Installation</h4>
<div class="paragraph">
<p>This plugin can be installed using the plugin manager:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">sudo bin/plugin install mapper-size</code></pre>
</div>
</div>
<div class="paragraph">
<p>The plugin must be installed on every node in the cluster, and each node must
be restarted after installation.</p>
</div>
<h4 id="mapper-size-remove" class="float">Removal</h4>
<div class="paragraph">
<p>The plugin can be removed with the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">sudo bin/plugin remove mapper-size</code></pre>
</div>
</div>
<div class="paragraph">
<p>The node must be stopped before removing the plugin.</p>
</div>
<div class="sect3">
<h4 id="mapper-size-usage"><a class="anchor" href="#mapper-size-usage"></a>8.2.1. Using the <code>_size</code> field</h4>
<div class="paragraph">
<p>In order to enable the <code>_size</code> field, set the mapping as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">PUT my_index
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">mappings</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">my_type</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">_size</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">enabled</span><span class="delimiter">&quot;</span></span>: <span class="predefined-constant">true</span>
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The value of the <code>_size</code> field is accessible in queries, aggregations, scripts,
and when sorting:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js"><span class="error">#</span> Example documents
PUT my_index/my_type/<span class="integer">1</span>
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">This is a document</span><span class="delimiter">&quot;</span></span>
}

PUT my_index/my_type/<span class="integer">2</span>
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">This is another document</span><span class="delimiter">&quot;</span></span>
}

GET my_index/_search
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">query</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">range</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">_size</span><span class="delimiter">&quot;</span></span>: { <img src="./images/icons/callouts/1.png" alt="1">
        <span class="key"><span class="delimiter">&quot;</span><span class="content">gt</span><span class="delimiter">&quot;</span></span>: <span class="integer">10</span>
      }
    }
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">aggs</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Sizes</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">terms</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">field</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">_size</span><span class="delimiter">&quot;</span></span>, <img src="./images/icons/callouts/2.png" alt="2">
        <span class="key"><span class="delimiter">&quot;</span><span class="content">size</span><span class="delimiter">&quot;</span></span>: <span class="integer">10</span>
      }
    }
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">sort</span><span class="delimiter">&quot;</span></span>: [
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">_size</span><span class="delimiter">&quot;</span></span>: { <img src="./images/icons/callouts/3.png" alt="3">
        <span class="key"><span class="delimiter">&quot;</span><span class="content">order</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">desc</span><span class="delimiter">&quot;</span></span>
      }
    }
  ],
  <span class="key"><span class="delimiter">&quot;</span><span class="content">script_fields</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Size</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">script</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">doc['_size']</span><span class="delimiter">&quot;</span></span>  <img src="./images/icons/callouts/4.png" alt="4">
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>Querying on the <code>_size</code> field</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>Aggregating on the <code>_size</code> field</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/3.png" alt="3"></td>
<td>Sorting on the <code>_size</code> field</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/4.png" alt="4"></td>
<td>Accessing the <code>_size</code> field in scripts (inline scripts must be modules-scripting.html#enable-dynamic-scripting[enabled] for this example to work)</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="mapper-murmur3"><a class="anchor" href="#mapper-murmur3"></a>8.3. Mapper Murmur3 Plugin</h3>
<div class="paragraph">
<p>The mapper-murmur3 plugin provides the ability to compute hash of field values
at index-time and store them in the index. This can sometimes be helpful when
running cardinality aggregations on high-cardinality and large string fields.</p>
</div>
<h4 id="mapper-murmur3-install" class="float">Installation</h4>
<div class="paragraph">
<p>This plugin can be installed using the plugin manager:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">sudo bin/plugin install mapper-murmur3</code></pre>
</div>
</div>
<div class="paragraph">
<p>The plugin must be installed on every node in the cluster, and each node must
be restarted after installation.</p>
</div>
<h4 id="mapper-murmur3-remove" class="float">Removal</h4>
<div class="paragraph">
<p>The plugin can be removed with the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">sudo bin/plugin remove mapper-murmur3</code></pre>
</div>
</div>
<div class="paragraph">
<p>The node must be stopped before removing the plugin.</p>
</div>
<div class="sect3">
<h4 id="mapper-murmur3-usage"><a class="anchor" href="#mapper-murmur3-usage"></a>8.3.1. Using the <code>murmur3</code> field</h4>
<div class="paragraph">
<p>The <code>murmur3</code> is typically used within a multi-field, so that both the original
value and its hash are stored in the index:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">PUT my_index
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">mappings</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">my_type</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">my_field</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">string</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">fields</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">hash</span><span class="delimiter">&quot;</span></span>: {
              <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">murmur3</span><span class="delimiter">&quot;</span></span>
            }
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Such a mapping would allow to refer to <code>my_field.hash</code> in order to get hashes
of the values of the <code>my_field</code> field. This is only useful in order to run
<code>cardinality</code> aggregations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js"><span class="error">#</span> Example documents
PUT my_index/my_type/<span class="integer">1</span>
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">my_field</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">This is a document</span><span class="delimiter">&quot;</span></span>
}

PUT my_index/my_type/<span class="integer">2</span>
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">my_field</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">This is another document</span><span class="delimiter">&quot;</span></span>
}

GET my_index/_search
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">aggs</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">my_field_cardinality</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">cardinality</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">field</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">my_field.hash</span><span class="delimiter">&quot;</span></span> <img src="./images/icons/callouts/1.png" alt="1">
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>Counting unique values on the <code>my_field.hash</code> field</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Running a <code>cardinality</code> aggregation on the <code>my_field</code> field directly would
yield the same result, however using <code>my_field.hash</code> instead might result in
a speed-up if the field has a high-cardinality. On the other hand, it is
discouraged to use the <code>murmur3</code> field on numeric fields and string fields
that are not almost unique as the use of a <code>murmur3</code> field is unlikely to
bring significant speed-ups, while increasing the amount of disk space required
to store the index.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="scripting"><a class="anchor" href="#scripting"></a>9. Scripting Plugins</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Scripting plugins extend the scripting functionality in Elasticsearch to allow
the use of other scripting languages.</p>
</div>
<h3 id="_core_scripting_plugins" class="float">Core scripting plugins</h3>
<div class="paragraph">
<p>The core scripting plugins are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="#lang-javascript">JavaScript Language</a></dt>
<dd>
<p>The JavaScript language plugin enables the use of JavaScript in Elasticsearch
scripts, via Mozilla&#8217;s
<a href="https://developer.mozilla.org/en-US/docs/Mozilla/Projects/Rhino">Rhino JavaScript</a> engine.</p>
</dd>
<dt class="hdlist1"><a href="#lang-python">Python Language</a></dt>
<dd>
<p>The Python language plugin enables the use of Python in Elasticsearch
scripts, via the <a href="http://www.jython.org/">Jython</a> Java implementation of Python.</p>
</dd>
</dl>
</div>
<h3 id="_abandoned_community_scripting_plugins" class="float">Abandoned community scripting plugins</h3>
<div class="paragraph">
<p>This plugin has been contributed by our community, but appears to be abandoned:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/hiredman/elasticsearch-lang-clojure">Clojure Language Plugin</a> (by Kevin Downey)</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="lang-javascript"><a class="anchor" href="#lang-javascript"></a>9.1. JavaScript Language Plugin</h3>
<div class="paragraph">
<p>The JavaScript language plugin enables the use of JavaScript in Elasticsearch
scripts, via Mozilla&#8217;s
<a href="https://developer.mozilla.org/en-US/docs/Mozilla/Projects/Rhino">Rhino JavaScript</a> engine.</p>
</div>
<h4 id="lang-javascript-install" class="float">Installation</h4>
<div class="paragraph">
<p>This plugin can be installed using the plugin manager:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">sudo bin/plugin install lang-javascript</code></pre>
</div>
</div>
<div class="paragraph">
<p>The plugin must be installed on every node in the cluster, and each node must
be restarted after installation.</p>
</div>
<h4 id="lang-javascript-remove" class="float">Removal</h4>
<div class="paragraph">
<p>The plugin can be removed with the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">sudo bin/plugin remove lang-javascript</code></pre>
</div>
</div>
<div class="paragraph">
<p>The node must be stopped before removing the plugin.</p>
</div>
<div class="sect3">
<h4 id="lang-javascript-usage"><a class="anchor" href="#lang-javascript-usage"></a>9.1.1. Using JavaScript in Elasticsearch</h4>
<div class="paragraph">
<p>Once the plugin has been installed, JavaScript can be used at a scripting
language by setting the <code>lang</code> parameter to <code>javascript</code> or <code>js</code>.</p>
</div>
<div class="paragraph">
<p>Scripting is available in many APIs, but we will use an example with the
<code>function_score</code> for demonstration purposes:</p>
</div>
<h3 id="lang-javascript-inline" class="float">Inline scripts</h3>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<img src="./images/icons/warning.png" alt="Warning">
</td>
<td class="content">
Enabling inline scripting on an unprotected Elasticsearch cluster is dangerous.
See <a href="#lang-javascript-file">File scripts</a> for a safer option.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you have enabled <a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.3/modules-scripting.html#enable-dynamic-scripting">inline scripts</a>,
you can use JavaScript as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json"><span class="error">D</span><span class="error">E</span><span class="error">L</span><span class="error">E</span><span class="error">T</span><span class="error">E</span> <span class="error">t</span><span class="error">e</span><span class="error">s</span><span class="error">t</span>

<span class="error">P</span><span class="error">U</span><span class="error">T</span> <span class="error">t</span><span class="error">e</span><span class="error">s</span><span class="error">t</span><span class="error">/</span><span class="error">d</span><span class="error">o</span><span class="error">c</span><span class="error">/</span><span class="integer">1</span>
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">num</span><span class="delimiter">&quot;</span></span>: <span class="float">1.0</span>
}

<span class="error">P</span><span class="error">U</span><span class="error">T</span> <span class="error">t</span><span class="error">e</span><span class="error">s</span><span class="error">t</span><span class="error">/</span><span class="error">d</span><span class="error">o</span><span class="error">c</span><span class="error">/</span><span class="integer">2</span>
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">num</span><span class="delimiter">&quot;</span></span>: <span class="float">2.0</span>
}

<span class="error">G</span><span class="error">E</span><span class="error">T</span> <span class="error">t</span><span class="error">e</span><span class="error">s</span><span class="error">t</span><span class="error">/</span><span class="error">_</span><span class="error">s</span><span class="error">e</span><span class="error">a</span><span class="error">r</span><span class="error">c</span><span class="error">h</span>
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">query</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">function_score</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">script_score</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">script</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">inline</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">doc[</span><span class="char">\&quot;</span><span class="content">num</span><span class="char">\&quot;</span><span class="content">].value * factor</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">lang</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">javascript</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">params</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">factor</span><span class="delimiter">&quot;</span></span>: <span class="integer">2</span>
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<h3 id="lang-javascript-indexed" class="float">Indexed scripts</h3>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<img src="./images/icons/warning.png" alt="Warning">
</td>
<td class="content">
Enabling indexed scripting on an unprotected Elasticsearch cluster is dangerous.
See <a href="#lang-javascript-file">File scripts</a> for a safer option.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you have enabled <a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.3/modules-scripting.html#enable-dynamic-scripting">indexed scripts</a>,
you can use JavaScript as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json"><span class="error">D</span><span class="error">E</span><span class="error">L</span><span class="error">E</span><span class="error">T</span><span class="error">E</span> <span class="error">t</span><span class="error">e</span><span class="error">s</span><span class="error">t</span>

<span class="error">P</span><span class="error">U</span><span class="error">T</span> <span class="error">t</span><span class="error">e</span><span class="error">s</span><span class="error">t</span><span class="error">/</span><span class="error">d</span><span class="error">o</span><span class="error">c</span><span class="error">/</span><span class="integer">1</span>
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">num</span><span class="delimiter">&quot;</span></span>: <span class="float">1.0</span>
}

<span class="error">P</span><span class="error">U</span><span class="error">T</span> <span class="error">t</span><span class="error">e</span><span class="error">s</span><span class="error">t</span><span class="error">/</span><span class="error">d</span><span class="error">o</span><span class="error">c</span><span class="error">/</span><span class="integer">2</span>
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">num</span><span class="delimiter">&quot;</span></span>: <span class="float">2.0</span>
}

<span class="error">P</span><span class="error">O</span><span class="error">S</span><span class="error">T</span> <span class="error">_</span><span class="error">s</span><span class="error">c</span><span class="error">r</span><span class="error">i</span><span class="error">p</span><span class="error">t</span><span class="error">s</span><span class="error">/</span><span class="error">j</span><span class="error">a</span><span class="error">v</span><span class="error">a</span><span class="error">s</span><span class="error">c</span><span class="error">r</span><span class="error">i</span><span class="error">p</span><span class="error">t</span><span class="error">/</span><span class="error">m</span><span class="error">y</span><span class="error">_</span><span class="error">s</span><span class="error">c</span><span class="error">r</span><span class="error">i</span><span class="error">p</span><span class="error">t</span>  <img src="./images/icons/callouts/1.png" alt="1">
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">script</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">doc[</span><span class="char">\&quot;</span><span class="content">num</span><span class="char">\&quot;</span><span class="content">].value * factor</span><span class="delimiter">&quot;</span></span>
}

<span class="error">G</span><span class="error">E</span><span class="error">T</span> <span class="error">t</span><span class="error">e</span><span class="error">s</span><span class="error">t</span><span class="error">/</span><span class="error">_</span><span class="error">s</span><span class="error">e</span><span class="error">a</span><span class="error">r</span><span class="error">c</span><span class="error">h</span>
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">query</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">function_score</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">script_score</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">script</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">my_script</span><span class="delimiter">&quot;</span></span>, <img src="./images/icons/callouts/2.png" alt="2">
          <span class="key"><span class="delimiter">&quot;</span><span class="content">lang</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">javascript</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">params</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">factor</span><span class="delimiter">&quot;</span></span>: <span class="integer">2</span>
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>We index the script under the id <code>my_script</code>.</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>The function score query retrieves the script with id <code>my_script</code>.</td>
</tr>
</table>
</div>
<h3 id="lang-javascript-file" class="float">File scripts</h3>
<div class="paragraph">
<p>You can save your scripts to a file in the <code>config/scripts/</code> directory on
every node. The <code>.javascript</code> file suffix identifies the script as containing
JavaScript:</p>
</div>
<div class="paragraph">
<p>First, save this file as <code>config/scripts/my_script.javascript</code> on every node
in the cluster:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">doc[<span class="string"><span class="delimiter">&quot;</span><span class="content">num</span><span class="delimiter">&quot;</span></span>].value * factor</code></pre>
</div>
</div>
<div class="paragraph">
<p>then use the script as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json"><span class="error">D</span><span class="error">E</span><span class="error">L</span><span class="error">E</span><span class="error">T</span><span class="error">E</span> <span class="error">t</span><span class="error">e</span><span class="error">s</span><span class="error">t</span>

<span class="error">P</span><span class="error">U</span><span class="error">T</span> <span class="error">t</span><span class="error">e</span><span class="error">s</span><span class="error">t</span><span class="error">/</span><span class="error">d</span><span class="error">o</span><span class="error">c</span><span class="error">/</span><span class="integer">1</span>
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">num</span><span class="delimiter">&quot;</span></span>: <span class="float">1.0</span>
}

<span class="error">P</span><span class="error">U</span><span class="error">T</span> <span class="error">t</span><span class="error">e</span><span class="error">s</span><span class="error">t</span><span class="error">/</span><span class="error">d</span><span class="error">o</span><span class="error">c</span><span class="error">/</span><span class="integer">2</span>
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">num</span><span class="delimiter">&quot;</span></span>: <span class="float">2.0</span>
}

<span class="error">G</span><span class="error">E</span><span class="error">T</span> <span class="error">t</span><span class="error">e</span><span class="error">s</span><span class="error">t</span><span class="error">/</span><span class="error">_</span><span class="error">s</span><span class="error">e</span><span class="error">a</span><span class="error">r</span><span class="error">c</span><span class="error">h</span>
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">query</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">function_score</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">script_score</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">script</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">file</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">my_script</span><span class="delimiter">&quot;</span></span>, <img src="./images/icons/callouts/1.png" alt="1">
          <span class="key"><span class="delimiter">&quot;</span><span class="content">lang</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">javascript</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">params</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">factor</span><span class="delimiter">&quot;</span></span>: <span class="integer">2</span>
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>The function score query retrieves the script with filename <code>my_script.javascript</code>.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="lang-python"><a class="anchor" href="#lang-python"></a>9.2. Python Language Plugin</h3>
<div class="paragraph">
<p>The Python language plugin enables the use of Python in Elasticsearch
scripts, via the <a href="http://www.jython.org/">Jython</a> Java implementation of Python.</p>
</div>
<h4 id="lang-python-install" class="float">Installation</h4>
<div class="paragraph">
<p>This plugin can be installed using the plugin manager:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">sudo bin/plugin install lang-python</code></pre>
</div>
</div>
<div class="paragraph">
<p>The plugin must be installed on every node in the cluster, and each node must
be restarted after installation.</p>
</div>
<h4 id="lang-python-remove" class="float">Removal</h4>
<div class="paragraph">
<p>The plugin can be removed with the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">sudo bin/plugin remove lang-python</code></pre>
</div>
</div>
<div class="paragraph">
<p>The node must be stopped before removing the plugin.</p>
</div>
<div class="sect3">
<h4 id="lang-python-usage"><a class="anchor" href="#lang-python-usage"></a>9.2.1. Using Python in Elasticsearch</h4>
<div class="paragraph">
<p>Once the plugin has been installed, Python can be used at a scripting
language by setting the <code>lang</code> parameter to <code>python</code>.</p>
</div>
<div class="paragraph">
<p>Scripting is available in many APIs, but we will use an example with the
<code>function_score</code> for demonstration purposes:</p>
</div>
<h3 id="lang-python-inline" class="float">Inline scripts</h3>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<img src="./images/icons/warning.png" alt="Warning">
</td>
<td class="content">
Enabling inline scripting on an unprotected Elasticsearch cluster is dangerous.
See <a href="#lang-python-file">File scripts</a> for a safer option.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you have enabled <a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.3/modules-scripting.html#enable-dynamic-scripting">inline scripts</a>,
you can use Python as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json"><span class="error">D</span><span class="error">E</span><span class="error">L</span><span class="error">E</span><span class="error">T</span><span class="error">E</span> <span class="error">t</span><span class="error">e</span><span class="error">s</span><span class="error">t</span>

<span class="error">P</span><span class="error">U</span><span class="error">T</span> <span class="error">t</span><span class="error">e</span><span class="error">s</span><span class="error">t</span><span class="error">/</span><span class="error">d</span><span class="error">o</span><span class="error">c</span><span class="error">/</span><span class="integer">1</span>
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">num</span><span class="delimiter">&quot;</span></span>: <span class="float">1.0</span>
}

<span class="error">P</span><span class="error">U</span><span class="error">T</span> <span class="error">t</span><span class="error">e</span><span class="error">s</span><span class="error">t</span><span class="error">/</span><span class="error">d</span><span class="error">o</span><span class="error">c</span><span class="error">/</span><span class="integer">2</span>
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">num</span><span class="delimiter">&quot;</span></span>: <span class="float">2.0</span>
}

<span class="error">G</span><span class="error">E</span><span class="error">T</span> <span class="error">t</span><span class="error">e</span><span class="error">s</span><span class="error">t</span><span class="error">/</span><span class="error">_</span><span class="error">s</span><span class="error">e</span><span class="error">a</span><span class="error">r</span><span class="error">c</span><span class="error">h</span>
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">query</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">function_score</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">script_score</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">script</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">inline</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">doc[</span><span class="char">\&quot;</span><span class="content">num</span><span class="char">\&quot;</span><span class="content">].value * factor</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">lang</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">python</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">params</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">factor</span><span class="delimiter">&quot;</span></span>: <span class="integer">2</span>
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<h3 id="lang-python-indexed" class="float">Indexed scripts</h3>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<img src="./images/icons/warning.png" alt="Warning">
</td>
<td class="content">
Enabling indexed scripting on an unprotected Elasticsearch cluster is dangerous.
See <a href="#lang-python-file">File scripts</a> for a safer option.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you have enabled <a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.3/modules-scripting.html#enable-dynamic-scripting">indexed scripts</a>,
you can use Python as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json"><span class="error">D</span><span class="error">E</span><span class="error">L</span><span class="error">E</span><span class="error">T</span><span class="error">E</span> <span class="error">t</span><span class="error">e</span><span class="error">s</span><span class="error">t</span>

<span class="error">P</span><span class="error">U</span><span class="error">T</span> <span class="error">t</span><span class="error">e</span><span class="error">s</span><span class="error">t</span><span class="error">/</span><span class="error">d</span><span class="error">o</span><span class="error">c</span><span class="error">/</span><span class="integer">1</span>
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">num</span><span class="delimiter">&quot;</span></span>: <span class="float">1.0</span>
}

<span class="error">P</span><span class="error">U</span><span class="error">T</span> <span class="error">t</span><span class="error">e</span><span class="error">s</span><span class="error">t</span><span class="error">/</span><span class="error">d</span><span class="error">o</span><span class="error">c</span><span class="error">/</span><span class="integer">2</span>
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">num</span><span class="delimiter">&quot;</span></span>: <span class="float">2.0</span>
}

<span class="error">P</span><span class="error">O</span><span class="error">S</span><span class="error">T</span> <span class="error">_</span><span class="error">s</span><span class="error">c</span><span class="error">r</span><span class="error">i</span><span class="error">p</span><span class="error">t</span><span class="error">s</span><span class="error">/</span><span class="error">p</span><span class="error">y</span><span class="error">t</span><span class="error">h</span><span class="error">o</span><span class="error">n</span><span class="error">/</span><span class="error">m</span><span class="error">y</span><span class="error">_</span><span class="error">s</span><span class="error">c</span><span class="error">r</span><span class="error">i</span><span class="error">p</span><span class="error">t</span>  <img src="./images/icons/callouts/1.png" alt="1">
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">script</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">doc[</span><span class="char">\&quot;</span><span class="content">num</span><span class="char">\&quot;</span><span class="content">].value * factor</span><span class="delimiter">&quot;</span></span>
}

<span class="error">G</span><span class="error">E</span><span class="error">T</span> <span class="error">t</span><span class="error">e</span><span class="error">s</span><span class="error">t</span><span class="error">/</span><span class="error">_</span><span class="error">s</span><span class="error">e</span><span class="error">a</span><span class="error">r</span><span class="error">c</span><span class="error">h</span>
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">query</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">function_score</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">script_score</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">script</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">my_script</span><span class="delimiter">&quot;</span></span>, <img src="./images/icons/callouts/2.png" alt="2">
          <span class="key"><span class="delimiter">&quot;</span><span class="content">lang</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">python</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">params</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">factor</span><span class="delimiter">&quot;</span></span>: <span class="integer">2</span>
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>We index the script under the id <code>my_script</code>.</td>
</tr>
<tr>
<td><img src="./images/icons/callouts/2.png" alt="2"></td>
<td>The function score query retrieves the script with id <code>my_script</code>.</td>
</tr>
</table>
</div>
<h3 id="lang-python-file" class="float">File scripts</h3>
<div class="paragraph">
<p>You can save your scripts to a file in the <code>config/scripts/</code> directory on
every node. The <code>.py</code> file suffix identifies the script as containing
Python:</p>
</div>
<div class="paragraph">
<p>First, save this file as <code>config/scripts/my_script.py</code> on every node
in the cluster:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">doc[<span class="string"><span class="delimiter">&quot;</span><span class="content">num</span><span class="delimiter">&quot;</span></span>].value * factor</code></pre>
</div>
</div>
<div class="paragraph">
<p>then use the script as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json"><span class="error">D</span><span class="error">E</span><span class="error">L</span><span class="error">E</span><span class="error">T</span><span class="error">E</span> <span class="error">t</span><span class="error">e</span><span class="error">s</span><span class="error">t</span>

<span class="error">P</span><span class="error">U</span><span class="error">T</span> <span class="error">t</span><span class="error">e</span><span class="error">s</span><span class="error">t</span><span class="error">/</span><span class="error">d</span><span class="error">o</span><span class="error">c</span><span class="error">/</span><span class="integer">1</span>
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">num</span><span class="delimiter">&quot;</span></span>: <span class="float">1.0</span>
}

<span class="error">P</span><span class="error">U</span><span class="error">T</span> <span class="error">t</span><span class="error">e</span><span class="error">s</span><span class="error">t</span><span class="error">/</span><span class="error">d</span><span class="error">o</span><span class="error">c</span><span class="error">/</span><span class="integer">2</span>
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">num</span><span class="delimiter">&quot;</span></span>: <span class="float">2.0</span>
}

<span class="error">G</span><span class="error">E</span><span class="error">T</span> <span class="error">t</span><span class="error">e</span><span class="error">s</span><span class="error">t</span><span class="error">/</span><span class="error">_</span><span class="error">s</span><span class="error">e</span><span class="error">a</span><span class="error">r</span><span class="error">c</span><span class="error">h</span>
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">query</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">function_score</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">script_score</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">script</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">file</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">my_script</span><span class="delimiter">&quot;</span></span>, <img src="./images/icons/callouts/1.png" alt="1">
          <span class="key"><span class="delimiter">&quot;</span><span class="content">lang</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">python</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">params</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">factor</span><span class="delimiter">&quot;</span></span>: <span class="integer">2</span>
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><img src="./images/icons/callouts/1.png" alt="1"></td>
<td>The function score query retrieves the script with filename <code>my_script.py</code>.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="security"><a class="anchor" href="#security"></a>10. Security Plugins</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Security plugins add a security layer to  Elasticsearch.</p>
</div>
<h3 id="_core_security_plugins" class="float">Core security plugins</h3>
<div class="paragraph">
<p>The core security plugins are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="/products/shield">Shield</a></dt>
<dd>
<p>Shield is the Elastic product that makes it easy for anyone to add
enterprise-grade security to their ELK stack. Designed to address the growing security
needs of thousands of enterprises using ELK today, Shield provides peace of
mind when it comes to protecting your data.</p>
</dd>
</dl>
</div>
<h3 id="_community_contributed_security_plugins" class="float">Community contributed security plugins</h3>
<div class="paragraph">
<p>The following plugins have been contributed by our community:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/codecentric/elasticsearch-shield-kerberos-realm">Kerberos/SPNEGO Realm</a>:
Custom Shield realm to Authenticate HTTP and Transport requests via Kerberos/SPNEGO (by codecentric AG)</p>
</li>
<li>
<p><a href="https://github.com/sscarduzio/elasticsearch-readonlyrest-plugin">Readonly REST</a>:
High performance access control for Elasticsearch native REST API (by Simone Scarduzio)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This community plugin appears to have been abandoned:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/sonian/elasticsearch-jetty">Jetty HTTP transport plugin</a>:
Uses Jetty to provide SSL connections, basic authentication, and request logging (by Sonian Inc.)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="repository"><a class="anchor" href="#repository"></a>11. Snapshot/Restore Repository Plugins</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Repository plugins extend the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.3/modules-snapshots.html">Snapshot/Restore</a>
functionality in Elasticsearch by adding repositories backed by the cloud or
by distributed file systems:</p>
</div>
<h4 id="_core_repository_plugins" class="float">Core repository plugins</h4>
<div class="paragraph">
<p>The core repository plugins are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="#cloud-aws">AWS Cloud</a></dt>
<dd>
<p>The Amazon Web Service (AWS) Cloud plugin adds support for using S3 as a
repository.</p>
</dd>
<dt class="hdlist1"><a href="#cloud-azure">Azure Cloud</a></dt>
<dd>
<p>The Azure Cloud plugin adds support for using Azure as a repository.</p>
</dd>
<dt class="hdlist1"><a href="https://github.com/elastic/elasticsearch-hadoop/tree/master/repository-hdfs">Hadoop HDFS Repository</a></dt>
<dd>
<p>The Hadoop HDFS Repository plugin adds support for using an HDFS file system
as a repository.</p>
</dd>
</dl>
</div>
<h3 id="_community_contributed_repository_plugins" class="float">Community contributed repository plugins</h3>
<div class="paragraph">
<p>The following plugin has been contributed by our community:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/wikimedia/search-repository-swift">Openstack Swift</a> (by Wikimedia Foundation)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This community plugin appears to have been abandoned:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/kzwang/elasticsearch-repository-gridfs">GridFS</a> Repository (by Kevin Wang)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="transport"><a class="anchor" href="#transport"></a>12. Transport Plugins</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Transport plugins offer alternatives to HTTP.</p>
</div>
<h3 id="_core_transport_plugins" class="float">Core transport plugins</h3>
<div class="paragraph">
<p>The core transport plugins are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="https://github.com/elastic/elasticsearch-transport-wares">Servlet transport</a></dt>
<dd>
<p>Use the REST interface over servlets.</p>
</dd>
</dl>
</div>
<h3 id="_community_contributed_transport_plugins" class="float">Community contributed transport plugins</h3>
<div class="paragraph">
<p>The following community plugins appear to have been abandoned:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/kzwang/elasticsearch-transport-redis">Redis transport plugin</a> (by Kevin Wang)</p>
</li>
<li>
<p><a href="https://github.com/tlrx/transport-zeromq">MQ transport plugin</a> (by Tanguy Leroux)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="integrations"><a class="anchor" href="#integrations"></a>13. Integrations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Integrations are not plugins, but are external tools or modules that make it easier to work with Elasticsearch.</p>
</div>
<h3 id="cms-integrations" class="float">CMS integrations</h3>
<h4 id="_supported_by_the_community" class="float">Supported by the community:</h4>
<div class="ulist">
<ul>
<li>
<p><a href="http://drupal.org/project/search_api_elasticsearch">Drupal</a>:
Drupal Elasticsearch integration via Search API.</p>
</li>
<li>
<p><a href="https://drupal.org/project/elasticsearch_connector">Drupal</a>:
Drupal Elasticsearch integration.</p>
</li>
<li>
<p><a href="http://searchbox-io.github.com/wp-elasticsearch/">Wp-Elasticsearch</a>:
Elasticsearch WordPress Plugin</p>
</li>
<li>
<p><a href="https://github.com/wallmanderco/elasticsearch-indexer">Elasticsearch Indexer</a>:
Elasticsearch WordPress Plugin</p>
</li>
<li>
<p><a href="https://doc.tiki.org/Elasticsearch">Tiki Wiki CMS Groupware</a>:
Tiki has native support for Elasticsearch. This provides faster &amp; better
search (facets, etc), along with some Natural Language Processing features
(ex.: More like this)</p>
</li>
</ul>
</div>
<h3 id="data-integrations" class="float">Data import/export and validation</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<img src="./images/icons/note.png" alt="Note">
</td>
<td class="content">
Rivers were used to import data from external systems into Elasticsearch prior to the 2.0 release. Elasticsearch
releases 2.0 and later do not support rivers.
</td>
</tr>
</table>
</div>
<h4 id="_supported_by_elasticsearch" class="float">Supported by elasticsearch:</h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.elastic.co/guide/en/logstash/current/plugins-outputs-elasticsearch.html">Logstash output to Elasticsearch</a>:
The Logstash <code>elasticsearch</code> output plugin.</p>
</li>
<li>
<p><a href="https://www.elastic.co/guide/en/logstash/current/plugins-inputs-elasticsearch.html">Elasticsearch input to Logstash</a>
The Logstash <code>elasticsearch</code> input plugin.</p>
</li>
<li>
<p><a href="https://www.elastic.co/guide/en/logstash/current/plugins-filters-elasticsearch.html">Elasticsearch event filtering in Logstash</a>
The Logstash <code>elasticsearch</code> filter plugin.</p>
</li>
<li>
<p><a href="https://www.elastic.co/guide/en/logstash/current/plugins-codecs-es_bulk.html">Elasticsearch bulk codec</a>
The Logstash <code>es_bulk</code> plugin decodes the Elasticsearch bulk format into individual events.</p>
</li>
</ul>
</div>
<h4 id="_supported_by_the_community_2" class="float">Supported by the community:</h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/jprante/elasticsearch-jdbc">JDBC importer</a>:
The Java Database Connection (JDBC) importer allows to fetch data from JDBC sources for indexing into Elasticsearch (by Jrg Prante)</p>
</li>
<li>
<p><a href="https://github.com/reachkrishnaraj/kafka-elasticsearch-standalone-consumer/tree/branch2.0">Kafka Standalone Consumer(Indexer)</a>:
Kafka Standalone Consumer [Indexer] will read messages from Kafka in batches, processes(as implemented) and bulk-indexes them into ElasticSearch. Flexible and scalable. More documentation in above GitHub repo&#8217;s Wiki.(Please use branch 2.0)!</p>
</li>
<li>
<p><a href="https://github.com/ozlerhakan/mongolastic">Mongolastic</a>:
A tool that clones data from ElasticSearch to MongoDB and vice versa</p>
</li>
<li>
<p><a href="https://github.com/Aconex/scrutineer">Scrutineer</a>:
A high performance consistency checker to compare what you&#8217;ve indexed
with your source of truth content</p>
</li>
<li>
<p><a href="https://github.com/salyh/elasticsearch-imap">IMAP/POP3/Mail importer</a>:
The Mail importer allows to fetch data from IMAP and POP3 servers for indexing into Elasticsearch (by Hendrik Saly)</p>
</li>
<li>
<p><a href="https://github.com/dadoonet/fscrawler">FS Crawler</a>:
The File System (FS) crawler allows to index documents (PDF, Open Office&#8230;&#8203;) from your local file system and over SSH. (by David Pilato)</p>
</li>
</ul>
</div>
<h3 id="deployment" class="float">Deployment</h3>
<h4 id="_supported_by_elasticsearch_2" class="float">Supported by Elasticsearch:</h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/elasticsearch/puppet-elasticsearch">Puppet</a>:
Elasticsearch puppet module.</p>
</li>
</ul>
</div>
<h4 id="_supported_by_the_community_3" class="float">Supported by the community:</h4>
<div class="ulist">
<ul>
<li>
<p><a href="http://github.com/elasticsearch/cookbook-elasticsearch">Chef</a>:
Chef cookbook for Elasticsearch</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This project appears to have been abandoned:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/medcl/salt-elasticsearch">SaltStack</a>:
SaltStack Module for Elasticsearch</p>
</li>
</ul>
</div>
<h3 id="framework-integrations" class="float">Framework integrations</h3>
<h4 id="_supported_by_the_community_4" class="float">Supported by the community:</h4>
<div class="ulist">
<ul>
<li>
<p><a href="http://www.searchtechnologies.com/aspire-for-elasticsearch">Aspire for Elasticsearch</a>:
Aspire, from Search Technologies, is a powerful connector and processing
framework designed for unstructured data. It has connectors to internal and
external repositories including SharePoint, Documentum, Jive, RDB, file
systems, websites and more, and can transform and normalize this data before
indexing in Elasticsearch.</p>
</li>
<li>
<p><a href="https://camel.apache.org/elasticsearch.html">Apache Camel Integration</a>:
An Apache camel component to integrate elasticsearch</p>
</li>
<li>
<p><a href="https://metacpan.org/release/Catmandu-Store-ElasticSearch">Catmanadu</a>:
An Elasticsearch backend for the Catmandu framework.</p>
</li>
<li>
<p><a href="https://github.com/tlrx/elasticsearch-test">elasticsearch-test</a>:
Elasticsearch Java annotations for unit testing with
<a href="http://www.junit.org/">JUnit</a></p>
</li>
<li>
<p><a href="https://github.com/FriendsOfSymfony/FOSElasticaBundle">FOSElasticaBundle</a>:
Symfony2 Bundle wrapping Elastica.</p>
</li>
<li>
<p><a href="http://grails.org/plugin/elasticsearch">Grails</a>:
Elasticsearch Grails plugin.</p>
</li>
<li>
<p><a href="http://haystacksearch.org/">Haystack</a>:
Modular search for Django</p>
</li>
<li>
<p><a href="https://github.com/cleverage/play2-elasticsearch">play2-elasticsearch</a>:
Elasticsearch module for Play Framework 2.x</p>
</li>
<li>
<p><a href="https://github.com/spring-projects/spring-data-elasticsearch">Spring Data Elasticsearch</a>:
Spring Data implementation for Elasticsearch</p>
</li>
<li>
<p><a href="https://github.com/dadoonet/spring-elasticsearch">Spring Elasticsearch</a>:
Spring Factory for Elasticsearch</p>
</li>
<li>
<p><a href="https://github.com/twitter/storehaus">Twitter Storehaus</a>:
Thin asynchronous Scala client for Storehaus.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These projects appear to have been abandoned:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://metacpan.org/module/Catalyst::Model::Search::Elasticsearch">Catalyst</a>:
Elasticsearch and Catalyst integration.</p>
</li>
<li>
<p><a href="http://github.com/aparo/django-elasticsearch">django-elasticsearch</a>:
Django Elasticsearch Backend.</p>
</li>
<li>
<p><a href="https://github.com/kzwang/elasticsearch-osem">elasticsearch-osem</a>:
A Java Object Search Engine Mapping (OSEM) for Elasticsearch</p>
</li>
<li>
<p><a href="http://geeks.aretotally.in/play-framework-module-elastic-search-distributed-searching-with-json-http-rest-or-java">Play!Framework</a>:
Integrate with Play! Framework Application.</p>
</li>
<li>
<p><a href="http://code.google.com/p/terrastore/wiki/Search_Integration">Terrastore Search</a>:
<a href="http://code.google.com/p/terrastore/">Terrastore</a> integration module with elasticsearch.</p>
</li>
</ul>
</div>
<h3 id="hadoop-integrations" class="float">Hadoop integrations</h3>
<h4 id="_supported_by_elasticsearch_3" class="float">Supported by Elasticsearch:</h4>
<div class="ulist">
<ul>
<li>
<p><a href="/guide/en/elasticsearch/hadoop/current/">es-hadoop</a>: Elasticsearch real-time
search and analytics natively integrated with Hadoop. Supports Map/Reduce,
Cascading, Apache Hive, Apache Pig, Apache Spark and Apache Storm.</p>
</li>
</ul>
</div>
<h4 id="_supported_by_the_community_5" class="float">Supported by the community:</h4>
<div class="paragraph">
<p>These projects appear to have been abandoned:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://github.com/Aconex/elasticflume">elasticflume</a>:
<a href="http://github.com/cloudera/flume">Flume</a> sink implementation.</p>
</li>
<li>
<p><a href="https://github.com/infochimps-labs/wonderdog">Wonderdog</a>:
Hadoop bulk loader into elasticsearch.</p>
</li>
</ul>
</div>
<h3 id="monitoring-integrations" class="float">Health and Performance Monitoring</h3>
<h4 id="_supported_by_the_community_6" class="float">Supported by the community:</h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/anchor/nagios-plugin-elasticsearch">check_elasticsearch</a>:
An Elasticsearch availability and performance monitoring plugin for
Nagios.</p>
</li>
<li>
<p><a href="https://github.com/radu-gheorghe/check-es">check-es</a>:
Nagios/Shinken plugins for checking on elasticsearch</p>
</li>
<li>
<p><a href="https://github.com/mattweber/es2graphite">es2graphite</a>:
Send cluster and indices stats and status to Graphite for monitoring and graphing.</p>
</li>
<li>
<p><a href="https://itunes.apple.com/us/app/elasticocean/id955278030?ls=1&amp;mt=8">ElasticOcean</a>:
Elasticsearch &amp; DigitalOcean iOS Real-Time Monitoring tool to keep an eye on DigitalOcean Droplets or Elasticsearch instances or both of them on-a-go.</p>
</li>
<li>
<p><a href="https://github.com/rbramley/Opsview-elasticsearch">opsview-elasticsearch</a>:
Opsview plugin written in Perl for monitoring Elasticsearch</p>
</li>
<li>
<p><a href="https://scoutapp.com">Scout</a>: Provides plugins for monitoring Elasticsearch <a href="https://scoutapp.com/plugin_urls/1331-elasticsearch-node-status">nodes</a>, <a href="https://scoutapp.com/plugin_urls/1321-elasticsearch-cluster-status">clusters</a>, and <a href="https://scoutapp.com/plugin_urls/1341-elasticsearch-index-status">indices</a>.</p>
</li>
<li>
<p><a href="http://sematext.com/spm/index.html">SPM for Elasticsearch</a>:
Performance monitoring with live charts showing cluster and node stats, integrated
alerts, email reports, etc.</p>
</li>
</ul>
</div>
<h3 id="other-integrations" class="float">Other integrations</h3>
<h4 id="_supported_by_the_community_7" class="float">Supported by the community:</h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/kodcu/pes">Pes</a>:
A pluggable elastic Javascript query DSL builder for Elasticsearch</p>
</li>
<li>
<p><a href="https://www.wireshark.org/">Wireshark</a>:
Protocol dissection for Zen discovery, HTTP and the binary protocol</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These projects appear to have been abandoned:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://www.github.com/neogenix/daikon">daikon</a>:
Daikon Elasticsearch CLI</p>
</li>
<li>
<p><a href="https://github.com/fullscale/dangle">dangle</a>:
A set of AngularJS directives that provide common visualizations for elasticsearch based on
D3.</p>
</li>
<li>
<p><a href="https://github.com/OlegKunitsyn/eslogd">eslogd</a>:
Linux daemon that replicates events to a central Elasticsearch server in realtime</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="plugin-authors"><a class="anchor" href="#plugin-authors"></a>14. Help for plugin authors</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Elasticsearch repository contains examples of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a <a href="https://github.com/elastic/elasticsearch/tree/2.x/plugins/site-example">site plugin</a>
for serving static HTML, JavaScript, and CSS.</p>
</li>
<li>
<p>a <a href="https://github.com/elastic/elasticsearch/tree/master/plugins/jvm-example">Java plugin</a>
which contains Java code.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These examples provide the bare bones needed to get started.  For more
information about how to write a plugin, we recommend looking at the plugins
listed in this documentation for inspiration.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<img src="./images/icons/note.png" alt="Note">
</td>
<td class="content">
<div class="title">Site plugins</div>
<div class="paragraph">
<p>The example site plugin mentioned above contains all of the scaffolding needed
for integrating with Maven builds.  If you don&#8217;t plan on using Maven, then all
you really need in your plugin is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>plugin-descriptor.properties</code> file</p>
</li>
<li>
<p>The <code>_site/</code> directory</p>
</li>
<li>
<p>The <code>_site/index.html</code> file</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<h3 id="_plugin_descriptor_file" class="float">Plugin descriptor file</h3>
<div class="paragraph">
<p>All plugins, be they site or Java plugins, must contain a file called
<code>plugin-descriptor.properties</code> in the root directory. The format for this file
is described in detail  here:</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/elastic/elasticsearch/blob/2.x/dev-tools/src/main/resources/plugin-metadata/plugin-descriptor.properties"><code>dev-tools/src/main/resources/plugin-metadata/plugin-descriptor.properties</code></a>.</p>
</div>
<div class="paragraph">
<p>Either fill in this template yourself (see
<a href="https://github.com/lmenezes/elasticsearch-kopf/blob/master/plugin-descriptor.properties">elasticsearch-kopf</a>
as an example) or, if you are using Elasticsearch&#8217;s Maven build system, you
can fill in the necessary values in the <code>pom.xml</code> for your plugin. For
instance, see
<a href="https://github.com/elastic/elasticsearch/blob/2.x/plugins/site-example/pom.xml"><code>plugins/site-example/pom.xml</code></a>.</p>
</div>
<h4 id="_mandatory_elements_for_all_plugins" class="float">Mandatory elements for all plugins</h4>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>description</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">simple summary of the plugin</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>version</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">plugin&#8217;s version</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the plugin name</p></td>
</tr>
</tbody>
</table>
<h4 id="_mandatory_elements_for_java_plugins" class="float">Mandatory elements for Java plugins</h4>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jvm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true if the <code>classname</code> class should be loaded
from jar files in the root directory of the plugin.
Note that only jar files in the root directory are added to the classpath for the plugin!
If you need other resources, package them into a resources jar.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>classname</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the name of the class to load, fully-qualified.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.version</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">version of java the code is built against.
Use the system property <code>java.specification.version</code>. Version string must be a sequence
of nonnegative decimal integers separated by "."'s and may have leading zeros.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>elasticsearch.version</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">version of elasticsearch compiled against.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<img src="./images/icons/important.png" alt="Important">
</td>
<td class="content">
<div class="title">Plugin release lifecycle</div>
<div class="paragraph">
<p>You will have to release a new version of the plugin for each new elasticsearch release.
This version is checked when the plugin is loaded so Elasticsearch will refuse to start
in the presence of plugins with the incorrect <code>elasticsearch.version</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<h4 id="_mandatory_elements_for_site_plugins" class="float">Mandatory elements for Site plugins</h4>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>site</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true to indicate contents of the <code>_site/</code>
directory in the root of the plugin should be served.</p></td>
</tr>
</tbody>
</table>
<h3 id="_testing_your_plugin" class="float">Testing your plugin</h3>
<div class="paragraph">
<p>When testing a Java plugin, it will only be auto-loaded if it is in the
<code>plugins/</code> directory.  Use <code>bin/plugin install file:///path/to/your/plugin</code>
to install your plugin for testing.</p>
</div>
<div class="paragraph">
<p>You may also load your plugin within the test framework for integration tests.
Read more in <a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.3/integration-tests.html#changing-node-configuration">Changing Node Configuration</a>.</p>
</div>
<h3 id="_java_security_permissions" class="float">Java Security permissions</h3>
<div class="paragraph">
<p>Some plugins may need additional security permissions. A plugin can include
the optional <code>plugin-security.policy</code> file containing <code>grant</code> statements for
additional permissions. Any additional permissions will be displayed to the user
with a large warning, and they will have to confirm them when installing the
plugin interactively. So if possible, it is best to avoid requesting any
spurious permissions!</p>
</div>
<div class="paragraph">
<p>If you are using the elasticsearch Maven build system, place this file in
<code>src/main/plugin-metadata</code> and it will be applied during unit tests as well.</p>
</div>
<div class="paragraph">
<p>Keep in mind that the Java security model is stack-based, and the additional
permissions will only be granted to the jars in your plugin, so you will have
write proper security code around operations requiring elevated privileges.
It is recommended to add a check to prevent unprivileged code (such as scripts)
from gaining escalated permissions. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// ES permission you should check before doPrivileged() blocks</span>
<span class="keyword">import</span> <span class="include">org.elasticsearch.SpecialPermission</span>;

<span class="predefined-type">SecurityManager</span> sm = <span class="predefined-type">System</span>.getSecurityManager();
<span class="keyword">if</span> (sm != <span class="predefined-constant">null</span>) {
  <span class="comment">// unprivileged code such as scripts do not have SpecialPermission</span>
  sm.checkPermission(<span class="keyword">new</span> SpecialPermission());
}
<span class="predefined-type">AccessController</span>.doPrivileged(
  <span class="comment">// sensitive operation</span>
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="http://www.oracle.com/technetwork/java/seccodeguide-139067.html">Secure Coding Guidelines for Java SE</a>
for more information.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2016-04-01 06:02:08 
</div>
</div>
</body>
</html>