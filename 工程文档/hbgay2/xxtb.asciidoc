= 信息化通报
:imagesDir: images

== 介绍

=== 项目背景
信息化通报，是为了帮助考核各地市各警种的每月评分。数据由各警种负责人统计并上报，考核指标由管理员预定义，最终得分将根据上报的分数经考核规则处理后算出。

[NOTE]
====
. 各警种负责人上报各地市的数据
. 考核指标由管理员预定义
. 考核分数则根据对应的指标规则及各地市数据算出
====

== 系统概述
=== 系统目标
. 能够动态设置考核指标项，及指标的权重、分值等。
. 能够让用户直接在系统上报送相关考核数据，报送的表单应是可调整配置的。
. 能够定义考核公式，根据考核指标和报送的数据，自动计算考核结果。
. 能够对考核的数据进行相关统计分析并进行展现。

=== 设计原则
保证所有的考核内容都是灵活可配置的，包含考核的部门、指标、指标的算分规则、地市等。保证系统的 *灵活性* 。

== 系统总体结构
=== 系统流程

image::xxtb.gif[]

=== 功能设计

==== 系统管理
此处主要进行一些管理操作

===== 地市及部门
====== 地市管理
地市管理即配置一些需要考核的地市，如在地市部署本系统，则这里应该为各级区县。数据为手动录入。

image::city.png[]

====== 部门管理
部门管理中维护的是需要参与信息通报考核的部门，数据手动录入。

image:org.png[]

在各部门下，可以添加对应的用户，添加至此处的用户即为该部门的管理员，可进行之后的 *数据上报* 等操作。

[NOTE]
====
如果需要进行 *数据上报* ，请先在此处添加你的用户信息。
====

===== 指标等管理
指标定义了某项考核指标，配置各指标后，用户上报数据后则根据指标关联的算分规则计算最终得分。

image::xxtb.png[]

====== 运算法则
运算法则进行管理，包含新增、删除、修改、查找。运算法则是定义一个基本的运算指标分数的逻辑，算分的规则在此逻辑上配置相应的参数，即可变成不同的算分规则。运算法则是指标算分的基础。

image::operate.png[]

[IMPORTANT]
====
此处定义的运算法则，必须后台程序开发出相应的运算法则实现类才行。

.如 _Dec_ 对应的则为 _DecServiceImpl_
image::dec.png[]
====

====== 指标算分规则
指标的算分规则进行管理，包含新增、删除、修改、查找规则。指标的算分规则就是指标被配置后需要配置，用于进行运算分数，是各地市某个指标最后得分的依据。规则信息包含规则名、运算法则、算分的权重、比较结果值、描述等。

image::rule.png[]

注：对于一个指标，可以配置多个算分规则的组合算分。


====== 考核指标
用户登录后，在拥有权限的情况下，可以对所在部门的考核指标进行管理，包括增加、删除、修改、查找。

image::zb.png[]

指标是部门负责人在部门考核时需要配置的，是部门进行考核的一个项目。

考核指标包含指标名称、简称、指标总分、指标描述、所属部门、创建人、创建时间、修改人、修改时间。

[NOTE]
====
对每个指标，还有相应的算分规则需要进行关联。
====

[TIP]
====
一个指标可以对应一到多个算分规则
====

===== 数据上报等管理

====== 考核模板配置

image::model.png[]

增加指标::
即对当前所选的月份模版添加指标，可选的指标由先前在指标管理对部门配置的。

指标总分::
指定该项指标的总分

指标序列::
指定该项指标的排序号

====== 数据上报
数据上报，此处为各级部门的管理员上报数据使用。各部门管理员会将18个地市的数据手动录入或 _Excel_ 导入后，进行上报。

image::sb.png[]

[CAUTION]
====
此处数据是手动录入的
====

====== 数据审核
在用户将数据上报后，需要相关的用户进行数据审核。此页面上显示的为各项考核的最终得分。

image::sh.png[]

[TIP]
====
审批人可以进行通过或撤销

通过:: 通过后最后将由管理员（吴佳妮）进行部分核算
撤销:: 即将上报的数据打回，由上报人重新上报
====

====== 总分核算

image::tj.png[]

[TIP]
====
总分核算需要所有的部门数据都上报完后才可以进行核算
====

====== 数据发布
即将核算后的数据直接发布出去。发布后的数据将在公安云首页显示。

image::xxtb_fs.png[]

== 数据库表结构

image::xxtb_table.png[]

详细见 link:images/xxtb.html[信息通报表结构]

== 功能块代码说明
=== 数据上报
用户导入或填写了数据之后，将会进行数据上报。

数据上报后将全部存储至 *XXTB_FSTJ* 表，之后会进行分数计算。

image::report.png[]

[source,java]
----
//把填写的数据添加到数据库中
xxtbService.createReport(params); // <1>
----
<1> 此方法中会将上报的数据写入 *XXTB_FSTJ* 表，并进行各项分数计算

[NOTE]
====
. *XXTB_FSTJ* 表中的 _ZB_SJZ_ 字段为用户上报的数据值

. *XXTB_FSTJ* 表中的 _FS_ 字段为该行数据最终计算的得分。
====

image::createReport.png[]

[source,java]
----
this.listDataByIndicator(sj,indicatorId); // <1>
----
<1> 此处进行各项分数的计算

.最终各项得分进行计算调用
image::operation.png[]

[TIP]
====
image::fz.png[]

根据传过来的 *service_name* 然后加上 *ServiceImpl* 取得 _beanName_ 。

此处为策略模式进行调用。
====
