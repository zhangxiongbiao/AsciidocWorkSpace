= 自定义数据源抽取

:imagesdir: images2

== 背景
由于大部分应用会涉及到使用自定义数据源访问连接，而之前各数据源连接池也是分布在各子系统中，造成连接池大量分布，连接大量浪费。


=== 问题描述

== 解决方案
由于自定义数据源的定义集中在metadata的 _SqlDaoUtil_ 工具类中。现在就需要把 _SqlDaoUtil_ 提供的服务封装成对应的服务，然后提供给上层项目使用。


=== 主要难题
==== 数据源连接不可序列化
_SqlDaoUtil_ 中使用的 _DataSource_ 及 _Connection_ 等不可能被序列化。所以在提供服务接口时，不能依赖于这些项。服务接口应该只依赖于数据查询与结果返回。

==== Ibatis的*.xml文件无法加载
如果提供了服务，那么就算取得了 _SqlDao_ ，也无法加载到原先使用到 ibatis的 *.xml 配置文件，因为不在 _metadata_ 中，那些 xml文件应该是在各系统中。


=== 解决方法

==== 类图
image::sqlDao.png[]

具体详见代码
